<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:pm="http://primefaces.org/mobile" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:jsf="http://xmlns.jcp.org/jsf">

<cc:interface componentType="IvyComponent">
	<cc:attribute name="caseItem" type="ch.ivy.addon.portalkit.bo.RemoteCase" />
	<cc:attribute name="destroyCaseActionListener"
		method-signature="void actionListener(ch.ivy.addon.portalkit.bo.RemoteCase)" />
	<cc:attribute name="update" default="" required="false" />
	<cc:attribute name="showDestroyButton" default="false" type="java.lang.Boolean" />
	<cc:attribute name="isSelected" default="false" type="java.lang.Boolean" />
	<cc:attribute name="onCompleteDestroyCase" />
</cc:interface>

<cc:implementation>

	<c:set var="caseItem" value="#{cc.attrs.caseItem}" />
	<c:set var="isSelected" value="#{data.expandedCaseId eq null and cc.attrs.isSelected}" />
	<c:set var="isExpanded" value="#{caseItem.id eq data.expandedCaseId or isSelected}" />

	<!-- This remote command needs to be run when being display as the first time to set the id of the expanded case -->
	<p:remoteCommand actionListener="#{logic.setExpandedCaseId(caseItem.id)}" autoRun="#{isSelected}" />

	<div id="#{cc.clientId}"
		class="widget-content-list-item u-shadow-effect js-case-item #{isExpanded ? 'mod-expanded' : ''} case-list-item case-list-item-position u-shadow-effect ">
		<h:panelGroup id="case-item-container" class="case-header-container u-unselectable u-hover-effect" layout="block">
			<div class="case-show-detail-container #{isExpanded ? 'case-header-padding' : ''}">
				<h:panelGroup styleClass="case-header-data js-case-item-header">
					<p:ajax event="click" listener="#{logic.setExpandedCaseId(caseItem.id)}" update="@(.case-list-item)" />
					<f:passThroughAttribute name="data-content"
						value="#{ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/showDetailsHint')}" />
					<div class="case-state">
						<h:panelGroup styleClass="fa fa-circle in-progress-case"
							rendered="#{caseItem.state eq 'CREATED' or caseItem.state eq 'RUNNING'}" />
						<h:panelGroup styleClass="fa fa-circle done-case" rendered="#{caseItem.state eq 'DONE'}" />
					</div>
					<div>
						<div id="#{cc.clientId}:case-header-data-top" class="case-info-header">##{caseItem.id}
							#{caseBean.getState(caseItem).toUpperCase()}</div>
						<div id="#{cc.clientId}:case-header-data-middle" class="case-info-content">
							<h:outputText
								value="#{empty caseItem.getName() ? ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/CasesNameIsNot') : caseItem.name}"
								rendered="#{!isExpanded or caseItem.state eq 'DONE'}" />
							<span onclick="if('#{case.canChangeName}'=='true') {event.stopPropagation()}"> <p:inplace
									id="case-name-edit-inplace" editor="true" rendered="#{isExpanded and caseItem.state ne 'DONE'}"
									disabled="#{!caseItem.canChangeName}" saveLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}"
									cancelLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" widgetVar="case-name-edit-inplace"
									label="#{empty caseItem.getName() ? ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/CasesNameIsNot') : caseItem.name}">
									<p:inputText id="case-name-input" value="#{caseItem.name}" maxlength="200" styleClass="case-name-input"
										onkeypress="if(event.keyCode == 13) {PF('case-name-edit-inplace').save()}" />
									<p:ajax event="save" listener="#{logic.updateName(caseItem)}" process="case-name-edit-inplace"
										update="case-name-edit-inplace" />
								</p:inplace>
							</span>
						</div>
						<div id="#{cc.clientId}:case-header-data-bottom" class="case-info-footer">
							<span jsf:rendered="#{not isExpanded}">#{ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/Created')}:
								<h:outputText value="#{caseItem.startTimestamp}">
									<f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
								</h:outputText> <h:outputText value=" / #{ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/lastModified')}: "
									rendered="#{caseItem.endTimestamp ne null}" /> <h:outputText value="#{caseItem.endTimestamp}">
									<f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
								</h:outputText>
							</span>
						</div>
						<h:panelGroup rendered="#{isExpanded}" styleClass="case-description ">
							<span onclick="if('#{case.canChangeDescription}'=='true') {event.stopPropagation()}"> <p:inplace
									id="case-description-inplace" editor="true" styleClass="case-info-footer case-description-inplace"
									saveLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}"
									cancelLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
									emptyLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseDetails/noDescription')}"
									disabled="#{!case.canChangeDescription or caseItem.state eq 'DONE'}">
									<p:inputTextarea id="case-description-input" cols="100" rows="4" styleClass="case-description-input"
										value="#{caseItem.description}" autoResize="false" />
									<p:ajax event="cancel" resetValues="true" />
									<p:ajax event="save" listener="#{logic.updateCaseDescription(caseItem)}" />
								</p:inplace>
							</span>
						</h:panelGroup>
					</div>
				</h:panelGroup>

			</div>
			<div class="case-header-action">
				<p:commandLink id="destroy-case"
					rendered="#{(not empty cc.attrs.destroyCaseActionListener) and cc.attrs.showDestroyButton and caseItem.state ne 'DONE'}"
					update="#{cc.attrs.update}" actionListener="#{cc.attrs.destroyCaseActionListener}" styleClass="case-command"
					process="@this" oncomplete="#{cc.attrs.onCompleteDestroyCase}">
					<span class="fa fa-remove" />
					<p:outputLabel value="#{ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/Destroy')}" />
				</p:commandLink>
			</div>
		</h:panelGroup>

		<h:panelGroup layout="block" rendered="#{isExpanded}" styleClass="case-body js-case-item-body">
			<cc:insertChildren />
		</h:panelGroup>
	</div>
</cc:implementation>
</html>