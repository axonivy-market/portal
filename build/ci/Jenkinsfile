pipeline {
  agent {
    label 'linux'
  }

  options {
    buildDiscarder(logRotator(numToKeepStr: '60', artifactNumToKeepStr: '2'))
  }

  stages {
    stage('build') {
      steps {
        script {
          docker.withRegistry('', 'docker.io') {
            docker.image('maven:3.8.6-eclipse-temurin-17').inside {
              sh 'RUN addgroup --gid 1000 build && adduser --uid 1000 --gid 1000 --disabled-password --gecos "" build'
              sh 'mvn -version'
              maven cmd: "clean install -f AxonIvyPortal/portal-components/pom.xml"
            }
          }
        }
        archiveArtifacts artifacts: "*/*/target/*.iar", allowEmptyArchive: true
      }
    }
  }
}