pipeline {
  agent any

  environment {
    imgSimilarity = 98
    dockerfileParams = '--shm-size 1g --hostname=ivy'
  }

  stages {
    stage('build') {
      steps {
        script { 
          docker.image('selenium/standalone-firefox:4').withRun("-e START_XVFB=false --shm-size=2g") {
            docker.build('maven').inside() {
              maven cmd: "clean install -f AxonIvyPortal/portal-components/pom.xml -Divy.engine.version='[11.1.0,] -Dmaven.test.failure.ignore=true"
            }
          }
        }
        archiveArtifacts artifacts: "*/*/target/*.iar", allowEmptyArchive: true
      }
    }
  }
}