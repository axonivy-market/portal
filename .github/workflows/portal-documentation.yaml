name: Portal Documentation
run-name: Build and Deploy Documentation ğŸš€
on:
  push:
  workflow_dispatch:
    inputs:
      ivyVersion:
        description: 'Ivy version use to replace |version| placeholder of the links which navigate to ivy documentation. e.g.: https://developer.axonivy.com/doc/nightly/designer-guide/configuration/variables.html'
        required: true
        default: 'nightly'
        type: string

jobs:
  # test-ne:
  #   runs-on: portal-01
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v4

  #     - name: Set build description
  #       run: echo "Running on ${{ runner.name }}" # Similar to setting currentBuild.description in Jenkins
  
  get-current-version:
    runs-on: portal-01
    container:
      image: maven:3.9.8-eclipse-temurin-21 
    outputs:
      documentVersion: ${{ steps.get_version.outputs.version }}
    steps:
      - name: Check for dockerenv file
        id: get_version
        run: |
          VERSION=$(mvn help:evaluate -Dexpression=revision -q -DforceStdout -f Documentation/pom.xml)
          echo "version=$VERSION" >> "$GITHUB_OUTPUT"
          if [[ "$VERSION" == "null object or invalid expression" ]]; then
            echo "Error: could not evaluate maven revision property"
            exit 1
          fi
          echo "Version is $VERSION"
          echo "version=$VERSION" >> "$GITHUB_OUTPUT"

      - name: Unzip screenshots
        run: echo ${{ steps.get_version.outputs.version }}

      - name: Unzip portal screenshots
        run: |
          unzip /mnt/portal02/document-screenshots/portal-document-screenshots-selenide-${{ steps.get_version.outputs.version }}.zip \
            -d Documentation/portal-guide/source/screenshots

  test-another-job:
    runs-on: portal-01
    needs: get-current-version
    container:
      image: axonivy/build-container:read-the-docs-2
    steps:
      - name: test-1
        run: echo ${{ needs.get-current-version.outputs.documentVersion }}



      # - run: echo "ğŸ‰ The job was manually triggered by a ${{ inputs.ivyVersion }} event."
      # - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      # - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      # - name: Check out repository code
      #   uses: actions/checkout@v4
      # - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
      # - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
      # - name: List files in the repository
      #   run: |
      #     ls ${{ github.workspace }}
      # - run: echo "ğŸ This job's status is ${{ job.status }}."
