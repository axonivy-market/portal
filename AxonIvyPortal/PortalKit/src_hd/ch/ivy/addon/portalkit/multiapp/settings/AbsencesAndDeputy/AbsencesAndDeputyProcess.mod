[Ivy]
14C30066460AD7AA 7.5.0 #module
>Proto >Proto Collection #zClass
As0 AbsencesAndDeputyProcess Big #zClass
As0 RD #cInfo
As0 #process
As0 @TextInP .type .type #zField
As0 @TextInP .processKind .processKind #zField
As0 @AnnotationInP-0n ai ai #zField
As0 @TextInP .xml .xml #zField
As0 @TextInP .responsibility .responsibility #zField
As0 @UdInit f0 '' #zField
As0 @UdProcessEnd f18 '' #zField
As0 @UdMethod f79 '' #zField
As0 @UdProcessEnd f80 '' #zField
As0 @GridStep f142 '' #zField
As0 @PushWFArc f143 '' #zField
As0 @Alternative f83 '' #zField
As0 @CallSub f145 '' #zField
As0 @CallSub f146 '' #zField
As0 @PushWFArc f147 '' #zField
As0 @PushWFArc f148 '' #zField
As0 @Alternative f149 '' #zField
As0 @GridStep f152 '' #zField
As0 @GridStep f154 '' #zField
As0 @PushWFArc f156 '' #zField
As0 @UdMethod f11 '' #zField
As0 @GridStep f37 '' #zField
As0 @UdProcessEnd f130 '' #zField
As0 @PushWFArc f131 '' #zField
As0 @PushWFArc f132 '' #zField
As0 @UdMethod f12 '' #zField
As0 @UdProcessEnd f23 '' #zField
As0 @PushWFArc f30 '' #zField
As0 @UdEvent f31 '' #zField
As0 @UdProcessEnd f35 '' #zField
As0 @UdEvent f6 '' #zField
As0 @GridStep f7 '' #zField
As0 @UdProcessEnd f13 '' #zField
As0 @PushWFArc f134 '' #zField
As0 @UdEvent f157 '' #zField
As0 @UdEvent f33 '' #zField
As0 @GridStep f44 '' #zField
As0 @PushWFArc f46 '' #zField
As0 @UdProcessEnd f52 '' #zField
As0 @PushWFArc f53 '' #zField
As0 @UdEvent f54 '' #zField
As0 @GridStep f55 '' #zField
As0 @PushWFArc f56 '' #zField
As0 @UdProcessEnd f57 '' #zField
As0 @PushWFArc f87 '' #zField
As0 @UdEvent f38 '' #zField
As0 @CallSub f39 '' #zField
As0 @UdProcessEnd f61 '' #zField
As0 @PushWFArc f63 '' #zField
As0 @GridStep f88 '' #zField
As0 @PushWFArc f64 '' #zField
As0 @Alternative f90 '' #zField
As0 @PushWFArc f91 '' #zField
As0 @PushWFArc f128 '' #zField
As0 @UdEvent f32 '' #zField
As0 @CallSub f111 '' #zField
As0 @PushWFArc f119 '' #zField
As0 @GridStep f120 '' #zField
As0 @PushWFArc f121 '' #zField
As0 @GridStep f1 '' #zField
As0 @Alternative f4 '' #zField
As0 @PushWFArc f8 '' #zField
As0 @GridStep f9 '' #zField
As0 @PushWFArc f10 '' #zField
As0 @PushWFArc f15 '' #zField
As0 @PushWFArc f16 '' #zField
As0 @UdMethod f51 '' #zField
As0 @UdProcessEnd f59 '' #zField
As0 @CallSub f62 '' #zField
As0 @Alternative f68 '' #zField
As0 @GridStep f60 '' #zField
As0 @PushWFArc f66 '' #zField
As0 @GridStep f70 '' #zField
As0 @PushWFArc f71 '' #zField
As0 @PushWFArc f72 '' #zField
As0 @UdMethod f73 '' #zField
As0 @Alternative f74 '' #zField
As0 @PushWFArc f65 '' #zField
As0 @GridStep f77 '' #zField
As0 @UdEvent f81 '' #zField
As0 @UdEvent f96 '' #zField
As0 @UdProcessEnd f100 '' #zField
As0 @CallSub f101 '' #zField
As0 @GridStep f104 '' #zField
As0 @PushWFArc f103 '' #zField
As0 @GridStep f106 '' #zField
As0 @PushWFArc f49 '' #zField
As0 @PushWFArc f76 '' #zField
As0 @PushWFArc f82 '' #zField
As0 @PushWFArc f84 '' #zField
As0 @Alternative f85 '' #zField
As0 @PushWFArc f86 '' #zField
As0 @UdProcessEnd f89 '' #zField
As0 @GridStep f109 '' #zField
As0 @PushWFArc f110 '' #zField
As0 @PushWFArc f107 '' #zField
As0 @PushWFArc f2 '' #zField
As0 @PushWFArc f3 '' #zField
As0 @PushWFArc f78 '' #zField
As0 @GridStep f113 '' #zField
As0 @PushWFArc f114 '' #zField
As0 @PushWFArc f118 '' #zField
As0 @PushWFArc f122 '' #zField
As0 @PushWFArc f123 '' #zField
As0 @UdProcessEnd f125 '' #zField
As0 @PushWFArc f126 '' #zField
As0 @CallSub f22 '' #zField
As0 @Alternative f28 '' #zField
As0 @PushWFArc f115 '' #zField
As0 @GridStep f124 '' #zField
As0 @PushWFArc f117 '' #zField
As0 @Alternative f17 '' #zField
As0 @PushWFArc f19 '' #zField
As0 @PushWFArc f21 '' #zField
As0 @Alternative f24 '' #zField
As0 @PushWFArc f25 '' #zField
As0 @PushWFArc f29 '' #zField
As0 @GridStep f69 '' #zField
As0 @PushWFArc f127 '' #zField
As0 @PushWFArc f105 '' #zField
As0 @PushWFArc f67 '' #zField
As0 @PushWFArc f112 '' #zField
As0 @PushWFArc f26 '' #zField
As0 @PushWFArc f27 '' #zField
As0 @PushWFArc f36 '' #zField
As0 @PushWFArc f14 '' #zField
As0 @GridStep f5 '' #zField
As0 @PushWFArc f34 '' #zField
As0 @UdMethod f40 '' #zField
As0 @CallSub f41 '' #zField
As0 @PushWFArc f42 '' #zField
As0 @UdProcessEnd f43 '' #zField
As0 @UdMethod f47 '' #zField
As0 @CallSub f50 '' #zField
As0 @GridStep f94 '' #zField
As0 @PushWFArc f95 '' #zField
As0 @PushWFArc f92 '' #zField
As0 @GridStep f97 '' #zField
As0 @Alternative f98 '' #zField
As0 @PushWFArc f99 '' #zField
As0 @PushWFArc f45 '' #zField
As0 @PushWFArc f108 '' #zField
As0 @PushWFArc f129 '' #zField
As0 @PushWFArc f48 '' #zField
As0 @GridStep f75 '' #zField
As0 @GridStep f93 '' #zField
As0 @Alternative f102 '' #zField
As0 @GridStep f116 '' #zField
As0 @PushWFArc f133 '' #zField
As0 @PushWFArc f135 '' #zField
As0 @PushWFArc f136 '' #zField
As0 @PushWFArc f20 '' #zField
As0 @UdProcessEnd f138 '' #zField
As0 @PushWFArc f139 '' #zField
As0 @Alternative f140 '' #zField
As0 @PushWFArc f141 '' #zField
As0 @PushWFArc f137 '' #zField
As0 @PushWFArc f144 '' #zField
As0 @GridStep f150 '' #zField
As0 @PushWFArc f151 '' #zField
As0 @PushWFArc f58 '' #zField
>Proto As0 As0 AbsencesAndDeputyProcess #zField
As0 f0 guid 1679C986E063D36E #txt
As0 f0 method start() #txt
As0 f0 inParameterDecl '<> param;' #txt
As0 f0 outParameterDecl '<> result;' #txt
As0 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>start()</name>
    </language>
</elementInfo>
' #txt
As0 f0 83 51 26 26 -16 15 #rect
As0 f0 @|UdInitIcon #fIcon
As0 f18 339 51 26 26 0 12 #rect
As0 f18 @|UdProcessEndIcon #fIcon
As0 f79 guid 1679C9C2A1FF6686 #txt
As0 f79 method findAbsences() #txt
As0 f79 inParameterDecl '<> param;' #txt
As0 f79 outParameterDecl '<> result;' #txt
As0 f79 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findAbsences()</name>
    </language>
</elementInfo>
' #txt
As0 f79 83 147 26 26 -41 15 #rect
As0 f79 @|UdMethodIcon #fIcon
As0 f80 1899 147 26 26 0 12 #rect
As0 f80 @|UdProcessEndIcon #fIcon
As0 f142 actionTable 'out=in;
' #txt
As0 f142 actionCode 'import ch.ivy.addon.portalkit.service.PermissionCheckerService;
import ch.ivyteam.ivy.security.IPermission;

PermissionCheckerService permissionChecker = new PermissionCheckerService();
in.isSupervisor = permissionChecker.hasPermission(IPermission.USER_READ_ABSENCES);' #txt
As0 f142 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Check if current user &#xD;
can manage other users'' absences</name>
    </language>
</elementInfo>
' #txt
As0 f142 176 138 224 44 -92 -16 #rect
As0 f142 @|StepIcon #fIcon
As0 f143 expr out #txt
As0 f143 109 160 176 160 #arcP
As0 f83 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>isSupervisor?</name>
    </language>
</elementInfo>
' #txt
As0 f83 1224 144 32 32 -37 -33 #rect
As0 f83 @|AlternativeIcon #fIcon
As0 f145 processCall 'Ivy Data Processes/AbsenceService:findAbsencesOfAllUsers(String)' #txt
As0 f145 requestActionDecl '<String username> param;' #txt
As0 f145 requestMappingAction 'param.username=ivy.session.getSessionUserName();
' #txt
As0 f145 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f145 responseMappingAction 'out=in;
out.absencesByUser=result.absencesByUser;
out.errors=result.errors;
' #txt
As0 f145 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Find absences&#xD;
of all users</name>
    </language>
</elementInfo>
' #txt
As0 f145 1336 138 112 44 -41 -20 #rect
As0 f145 @|CallSubIcon #fIcon
As0 f146 processCall 'Ivy Data Processes/AbsenceService:findAbsences(String)' #txt
As0 f146 requestActionDecl '<String username> param;' #txt
As0 f146 requestMappingAction 'param.username=ivy.session.getSessionUserName();
' #txt
As0 f146 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f146 responseMappingAction 'out=in;
out.absencesByUser=result.absencesByUser;
out.errors=in.errors;
' #txt
As0 f146 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Find current &#xD;
user''s absences</name>
    </language>
</elementInfo>
' #txt
As0 f146 1336 234 112 44 -46 -20 #rect
As0 f146 @|CallSubIcon #fIcon
As0 f147 expr in #txt
As0 f147 outCond in.isSupervisor #txt
As0 f147 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>YES</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
As0 f147 1256 160 1336 160 #arcP
As0 f147 0 0.5 0 -7 #arcLabel
As0 f148 expr in #txt
As0 f148 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>NO</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
As0 f148 1240 176 1336 256 #arcP
As0 f148 1 1240 256 #addKink
As0 f148 1 0.40389801867577546 -1 -10 #arcLabel
As0 f149 1640 144 32 32 0 16 #rect
As0 f149 @|AlternativeIcon #fIcon
As0 f152 actionTable 'out=in;
' #txt
As0 f152 actionCode 'import java.util.ArrayList;
import java.util.Set;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

Set<IvyAbsence> ivyAbsences = in.absencesByUser.get(ivy.session.getSessionUserName()) as Set;
if (!in.absenceInThePastShown) {
	out.displayedAbsences.clear();
	for (IvyAbsence absence : ivyAbsences) {
			if (!AbsenceAndSubstituteUtils.isInThePast(absence)) {
				out.displayedAbsences.add(absence);
			}
	}
} else {
	out.displayedAbsences = new ArrayList(ivyAbsences);
}' #txt
As0 f152 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get the absences&#xD;
of current user</name>
    </language>
</elementInfo>
' #txt
As0 f152 1488 234 128 44 -44 -16 #rect
As0 f152 @|StepIcon #fIcon
As0 f154 actionTable 'out=in;
' #txt
As0 f154 actionCode 'import ch.ivy.addon.portalkit.util.BeanUtils;

BeanUtils.invokeBeanMethodViaMethodExpression("#{errorDisplayBean.displayErrors}", in.errors);' #txt
As0 f154 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Display errors &#xD;
if have</name>
    </language>
</elementInfo>
' #txt
As0 f154 1728 138 128 44 -40 -16 #rect
As0 f154 @|StepIcon #fIcon
As0 f156 expr out #txt
As0 f156 1856 160 1899 160 #arcP
As0 f11 guid 167A13CB376C246A #txt
As0 f11 method editAbsence(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence) #txt
As0 f11 inParameterDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence selectedAbsence> param;' #txt
As0 f11 inParameterMapAction 'out.isLoadDeputy=false;
out.selectedAbsence=param.selectedAbsence;
out.validationError=false;
' #txt
As0 f11 outParameterDecl '<> result;' #txt
As0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>editAbsence(IvyAbsence)</name>
    </language>
</elementInfo>
' #txt
As0 f11 83 595 26 26 -68 15 #rect
As0 f11 @|UdMethodIcon #fIcon
As0 f37 actionTable 'out=in;
' #txt
As0 f37 actionCode 'out.backupAbsence.setUser(in.selectedAbsence.getUser());
out.backupAbsence.setFrom(in.selectedAbsence.getFrom());
out.backupAbsence.setUntil(in.selectedAbsence.getUntil());
out.backupAbsence.setComment(in.selectedAbsence.getComment());
out.selectedUser = in.selectedAbsence.getUser();
' #txt
As0 f37 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Backup absence</name>
    </language>
</elementInfo>
' #txt
As0 f37 200 586 112 44 -46 -8 #rect
As0 f37 @|StepIcon #fIcon
As0 f130 499 595 26 26 0 12 #rect
As0 f130 @|UdProcessEndIcon #fIcon
As0 f131 expr out #txt
As0 f131 109 608 200 608 #arcP
As0 f132 expr out #txt
As0 f132 312 608 499 608 #arcP
As0 f12 guid 167A141E9FBD4F48 #txt
As0 f12 method preDelete(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence) #txt
As0 f12 inParameterDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence selectedAbsence> param;' #txt
As0 f12 inParameterMapAction 'out.selectedAbsence=param.selectedAbsence;
' #txt
As0 f12 outParameterDecl '<> result;' #txt
As0 f12 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>preDelete(IvyAbsence)</name>
    </language>
</elementInfo>
' #txt
As0 f12 83 1171 26 26 -61 15 #rect
As0 f12 @|UdMethodIcon #fIcon
As0 f23 371 1171 26 26 0 12 #rect
As0 f23 @|UdProcessEndIcon #fIcon
As0 f30 expr out #txt
As0 f30 109 1184 371 1184 #arcP
As0 f31 guid 167A1481754FE0E1 #txt
As0 f31 actionTable 'out=in;
' #txt
As0 f31 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add</name>
    </language>
</elementInfo>
' #txt
As0 f31 83 787 26 26 -10 15 #rect
As0 f31 @|UdEventIcon #fIcon
As0 f35 499 787 26 26 0 12 #rect
As0 f35 @|UdProcessEndIcon #fIcon
As0 f6 guid 167A149D01ECA4B9 #txt
As0 f6 actionTable 'out=in;
' #txt
As0 f6 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>dateChange</name>
    </language>
</elementInfo>
' #txt
As0 f6 83 883 26 26 -36 15 #rect
As0 f6 @|UdEventIcon #fIcon
As0 f7 actionTable 'out=in;
' #txt
As0 f7 actionCode 'import ch.ivy.addon.portalkit.util.UserUtils;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;
import java.util.Set;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

in.validationError = false;
String username = in.selectedUser.getName();
boolean fromBiggerThanTill = AbsenceAndSubstituteUtils.checkFromBiggerThanTill(in.selectedAbsence);
in.selectedAbsence.user = in.selectedUser;

if (fromBiggerThanTill) {
	in.validationError = true;
	FacesContext.getCurrentInstance().validationFailed();
}

boolean doesNewAbsenceOverlap = AbsenceAndSubstituteUtils.doesNewAbsenceOverlap(in.absencesByUser.get(username) as Set, in.selectedAbsence);
if (doesNewAbsenceOverlap) {
	in.validationError = true;
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR,ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/overlappingAbsence"), ""));
	FacesContext.getCurrentInstance().validationFailed();
}
' #txt
As0 f7 security system #txt
As0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Validation</name>
    </language>
</elementInfo>
' #txt
As0 f7 248 874 112 44 -27 -8 #rect
As0 f7 @|StepIcon #fIcon
As0 f13 499 883 26 26 0 12 #rect
As0 f13 @|UdProcessEndIcon #fIcon
As0 f134 expr out #txt
As0 f134 360 896 499 896 #arcP
As0 f157 guid 167A14F56A293F29 #txt
As0 f157 actionTable 'out=in;
' #txt
As0 f157 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>userSelectInAbsence</name>
    </language>
</elementInfo>
' #txt
As0 f157 83 979 26 26 -48 14 #rect
As0 f157 @|UdEventIcon #fIcon
As0 f33 guid 167A15801CB2F006 #txt
As0 f33 actionTable 'out=in;
' #txt
As0 f33 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>updateGrowlAbsence</name>
    </language>
</elementInfo>
' #txt
As0 f33 83 1075 26 26 -47 15 #rect
As0 f33 @|UdEventIcon #fIcon
As0 f44 actionTable 'out=in;
' #txt
As0 f44 actionCode 'import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;

FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO,ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/common/information"), ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/common/saveSuccessfully")));' #txt
As0 f44 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Inform the sucessful &#xD;
save message</name>
    </language>
</elementInfo>
' #txt
As0 f44 160 1066 144 44 -52 -16 #rect
As0 f44 @|StepIcon #fIcon
As0 f46 expr out #txt
As0 f46 109 1088 160 1088 #arcP
As0 f52 371 1075 26 26 0 12 #rect
As0 f52 @|UdProcessEndIcon #fIcon
As0 f53 expr out #txt
As0 f53 304 1088 371 1088 #arcP
As0 f54 guid 167A15933233F778 #txt
As0 f54 actionTable 'out=in;
' #txt
As0 f54 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>cancel</name>
    </language>
</elementInfo>
' #txt
As0 f54 83 691 26 26 -19 16 #rect
As0 f54 @|UdEventIcon #fIcon
As0 f55 actionTable 'out=in;
' #txt
As0 f55 actionCode 'out.selectedAbsence.setUser(in.backupAbsence.getUser());
out.selectedAbsence.setFrom(in.backupAbsence.getFrom());
out.selectedAbsence.setUntil(in.backupAbsence.getUntil());
out.selectedAbsence.setComment(in.backupAbsence.getComment());
' #txt
As0 f55 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Reset</name>
    </language>
</elementInfo>
' #txt
As0 f55 168 682 112 44 -16 -8 #rect
As0 f55 @|StepIcon #fIcon
As0 f56 expr out #txt
As0 f56 109 704 168 704 #arcP
As0 f57 371 691 26 26 0 12 #rect
As0 f57 @|UdProcessEndIcon #fIcon
As0 f87 expr out #txt
As0 f87 280 704 371 704 #arcP
As0 f38 guid 167A16B0B3C6E78A #txt
As0 f38 actionTable 'out=in;
' #txt
As0 f38 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>deleteAbsence</name>
    </language>
</elementInfo>
' #txt
As0 f38 83 1267 26 26 -47 15 #rect
As0 f38 @|UdEventIcon #fIcon
As0 f39 processCall 'Ivy Data Processes/AbsenceService:deleteAbsence(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence)' #txt
As0 f39 requestActionDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence ivyAbsence> param;' #txt
As0 f39 requestMappingAction 'param.ivyAbsence=in.selectedAbsence;
' #txt
As0 f39 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f39 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
As0 f39 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AbsenceService</name>
    </language>
</elementInfo>
' #txt
As0 f39 184 1258 112 44 -44 -8 #rect
As0 f39 @|CallSubIcon #fIcon
As0 f61 723 1267 26 26 0 12 #rect
As0 f61 @|UdProcessEndIcon #fIcon
As0 f63 expr out #txt
As0 f63 109 1280 184 1280 #arcP
As0 f88 actionTable 'out=in;
' #txt
As0 f88 actionCode 'import ch.ivy.addon.portalkit.util.BeanUtils;

BeanUtils.invokeBeanMethodViaMethodExpression("#{errorDisplayBean.displayErrors}", in.errors);' #txt
As0 f88 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Display errors &#xD;
if have</name>
    </language>
</elementInfo>
' #txt
As0 f88 536 1354 128 44 -40 -16 #rect
As0 f88 @|StepIcon #fIcon
As0 f64 expr out #txt
As0 f64 664 1376 736 1293 #arcP
As0 f64 1 736 1376 #addKink
As0 f64 0 0.7951798915758104 0 0 #arcLabel
As0 f90 176 880 32 32 0 16 #rect
As0 f90 @|AlternativeIcon #fIcon
As0 f91 expr out #txt
As0 f91 109 896 176 896 #arcP
As0 f128 expr in #txt
As0 f128 208 896 248 896 #arcP
As0 f32 guid 167A58955C54C4C0 #txt
As0 f32 actionTable 'out=in;
' #txt
As0 f32 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>updateAbsences</name>
    </language>
</elementInfo>
' #txt
As0 f32 83 499 26 26 -47 15 #rect
As0 f32 @|UdEventIcon #fIcon
As0 f111 processCall 'Ivy Data Processes/AbsenceService:updateAbsences(String,java.util.Set)' #txt
As0 f111 requestActionDecl '<String username,java.util.Set ivyAbsences> param;' #txt
As0 f111 requestMappingAction 'param.username=in.selectedUser.getName();
param.ivyAbsences=in.absencesByUser.get(in.selectedUser.getName()) as java.util.Set;
' #txt
As0 f111 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f111 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
As0 f111 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AbsenceService</name>
    </language>
</elementInfo>
' #txt
As0 f111 168 490 112 44 -44 -8 #rect
As0 f111 @|CallSubIcon #fIcon
As0 f119 expr out #txt
As0 f119 109 512 168 512 #arcP
As0 f120 actionTable 'out=in;
' #txt
As0 f120 actionCode 'import ch.ivy.addon.portalkit.util.BeanUtils;

BeanUtils.invokeBeanMethodViaMethodExpression("#{errorDisplayBean.displayErrors}", in.errors);' #txt
As0 f120 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Display errors &#xD;
if have</name>
    </language>
</elementInfo>
' #txt
As0 f120 328 490 128 44 -40 -16 #rect
As0 f120 @|StepIcon #fIcon
As0 f121 expr out #txt
As0 f121 280 512 328 512 #arcP
As0 f1 actionTable 'out=in;
' #txt
As0 f1 actionCode 'import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import ch.ivy.addon.portalkit.util.Dates;

java.util.Date endOfDate = Dates.toEndOfDate(in.selectedAbsence.getUntil());
in.selectedAbsence.setUntil(endOfDate);
in.isAbsenceCreated = true;
' #txt
As0 f1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set end date&#xD;
to selected absence</name>
    </language>
</elementInfo>
' #txt
As0 f1 224 1738 144 44 -51 -16 #rect
As0 f1 @|StepIcon #fIcon
As0 f4 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>successful?</name>
    </language>
</elementInfo>
' #txt
As0 f4 336 1264 32 32 -32 -30 #rect
As0 f4 @|AlternativeIcon #fIcon
As0 f8 expr out #txt
As0 f8 296 1280 336 1280 #arcP
As0 f9 actionTable 'out=in;
' #txt
As0 f9 actionCode 'import ch.ivy.addon.portalkit.util.UserUtils;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import java.util.Set;

out.displayedAbsences.remove(in.selectedAbsence);
Set<IvyAbsence> ivyAbsences = out.absencesByUser.get(in.selectedAbsence.user.getName()) as Set;
ivyAbsences.remove(in.selectedAbsence);' #txt
As0 f9 security system #txt
As0 f9 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Remove from list</name>
    </language>
</elementInfo>
' #txt
As0 f9 536 1258 112 44 -46 -8 #rect
As0 f9 @|StepIcon #fIcon
As0 f10 expr in #txt
As0 f10 outCond in.errors.isEmpty() #txt
As0 f10 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>YES</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
As0 f10 368 1280 536 1280 #arcP
As0 f10 0 0.5 0 -8 #arcLabel
As0 f15 expr out #txt
As0 f15 648 1280 723 1280 #arcP
As0 f16 expr in #txt
As0 f16 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>NO</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
As0 f16 352 1296 536 1376 #arcP
As0 f16 1 352 1376 #addKink
As0 f16 1 0.3875 0 -8 #arcLabel
As0 f51 guid 167C062278F2D07A #txt
As0 f51 method createAbsenceAndLoadDeputy() #txt
As0 f51 inParameterDecl '<> param;' #txt
As0 f51 outParameterDecl '<> result;' #txt
As0 f51 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>createAbsenceAndLoadDeputy()</name>
    </language>
</elementInfo>
' #txt
As0 f51 83 1747 26 26 -79 19 #rect
As0 f51 @|UdMethodIcon #fIcon
As0 f59 1419 1747 26 26 0 12 #rect
As0 f59 @|UdProcessEndIcon #fIcon
As0 f62 processCall 'Ivy Data Processes/SubstituteService:findSubstitutes(String)' #txt
As0 f62 requestActionDecl '<String username> param;' #txt
As0 f62 requestMappingAction 'param.username=in.selectedUser.getName();
' #txt
As0 f62 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f62 responseMappingAction 'out=in;
out.errors=result.errors;
out.substitutesByApp=result.substitutesByApp;
' #txt
As0 f62 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>SubstituteService</name>
    </language>
</elementInfo>
' #txt
As0 f62 928 1738 112 44 -47 -8 #rect
As0 f62 @|CallSubIcon #fIcon
As0 f68 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>sucessful?</name>
    </language>
</elementInfo>
' #txt
As0 f68 1104 1744 32 32 -32 -37 #rect
As0 f68 @|AlternativeIcon #fIcon
As0 f60 actionTable 'out=in;
' #txt
As0 f60 actionCode 'import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

out.substituteRoot = AbsenceAndSubstituteUtils.buildSustitute(in.substitutesByApp);' #txt
As0 f60 security system #txt
As0 f60 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Build the substitute tree</name>
    </language>
</elementInfo>
' #txt
As0 f60 1208 1738 144 44 -64 -8 #rect
As0 f60 @|StepIcon #fIcon
As0 f66 expr in #txt
As0 f66 outCond in.errors.isEmpty() #txt
As0 f66 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>YES</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
As0 f66 1136 1760 1208 1760 #arcP
As0 f66 0 0.4431818181818182 0 -9 #arcLabel
As0 f70 actionTable 'out=in;
' #txt
As0 f70 actionCode 'import ch.ivy.addon.portalkit.util.BeanUtils;

BeanUtils.invokeBeanMethodViaMethodExpression("#{errorDisplayBean.displayErrors}", in.errors);' #txt
As0 f70 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Display errors&#xD;
if have</name>
    </language>
</elementInfo>
' #txt
As0 f70 1224 1834 112 44 -38 -16 #rect
As0 f70 @|StepIcon #fIcon
As0 f71 expr in #txt
As0 f71 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>NO</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
As0 f71 1120 1776 1224 1856 #arcP
As0 f71 1 1120 1856 #addKink
As0 f71 1 0.2727272727272727 0 -9 #arcLabel
As0 f72 expr out #txt
As0 f72 1336 1856 1432 1773 #arcP
As0 f72 1 1432 1856 #addKink
As0 f72 0 0.3118477277014128 0 0 #arcLabel
As0 f73 guid 167C46A1401C51E0 #txt
As0 f73 method editDeputy() #txt
As0 f73 inParameterDecl '<> param;' #txt
As0 f73 outParameterDecl '<> result;' #txt
As0 f73 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>editDeputy()</name>
    </language>
</elementInfo>
' #txt
As0 f73 83 1843 26 26 -33 15 #rect
As0 f73 @|UdMethodIcon #fIcon
As0 f74 848 1744 32 32 0 16 #rect
As0 f74 @|AlternativeIcon #fIcon
As0 f65 expr in #txt
As0 f65 880 1760 928 1760 #arcP
As0 f77 actionTable 'out=in;
' #txt
As0 f77 actionCode 'import ch.ivy.addon.portalkit.util.UserUtils;
import java.util.Set;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

in.validationError = false;
String username = in.selectedUser.getName();
boolean fromBiggerThanTill = AbsenceAndSubstituteUtils.checkFromBiggerThanTill(in.selectedAbsence);
in.selectedAbsence.user = in.selectedUser;

if (fromBiggerThanTill) {
	in.validationError = true;
}

boolean doesNewAbsenceOverlap = AbsenceAndSubstituteUtils.doesNewAbsenceOverlap(in.absencesByUser.get(username) as Set, in.selectedAbsence);
if (doesNewAbsenceOverlap) {
	in.validationError = true;
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR,ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/overlappingAbsence"), ""));
}' #txt
As0 f77 security system #txt
As0 f77 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Validation</name>
    </language>
</elementInfo>
' #txt
As0 f77 412 1738 112 44 -27 -8 #rect
As0 f77 @|StepIcon #fIcon
As0 f81 guid 167C46DCB44F7DCB #txt
As0 f81 actionTable 'out=in;
' #txt
As0 f81 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>changeUserSubstitute</name>
    </language>
</elementInfo>
' #txt
As0 f81 83 1939 26 26 -47 15 #rect
As0 f81 @|UdEventIcon #fIcon
As0 f96 guid 167C594D283DE9BA #txt
As0 f96 actionTable 'out=in;
' #txt
As0 f96 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>saveSubstitutes</name>
    </language>
</elementInfo>
' #txt
As0 f96 51 339 26 26 -47 15 #rect
As0 f96 @|UdEventIcon #fIcon
As0 f100 1419 339 26 26 0 12 #rect
As0 f100 @|UdProcessEndIcon #fIcon
As0 f101 processCall 'Ivy Data Processes/SubstituteService:saveSubstitutes(String,java.util.Map)' #txt
As0 f101 requestActionDecl '<String username,java.util.Map substitutesByApp> param;' #txt
As0 f101 requestMappingAction 'param.username=in.selectedUser.getName();
param.substitutesByApp=in.substitutesByApp;
' #txt
As0 f101 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f101 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
As0 f101 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>SubstituteService</name>
    </language>
</elementInfo>
' #txt
As0 f101 984 330 112 44 -47 -8 #rect
As0 f101 @|CallSubIcon #fIcon
As0 f104 actionTable 'out=in;
' #txt
As0 f104 actionCode 'import ch.ivy.addon.portalkit.util.BeanUtils;

BeanUtils.invokeBeanMethodViaMethodExpression("#{errorDisplayBean.displayErrors}", in.errors);' #txt
As0 f104 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Display errors</name>
    </language>
</elementInfo>
' #txt
As0 f104 1232 330 112 44 -38 -8 #rect
As0 f104 @|StepIcon #fIcon
As0 f103 expr out #txt
As0 f103 1344 352 1419 352 #arcP
As0 f106 actionTable 'out=in;
' #txt
As0 f106 actionCode 'import ch.ivy.addon.portalkit.dto.UserDTO;
out.selectedUser = new UserDTO(ivy.session.getSessionUser());' #txt
As0 f106 security system #txt
As0 f106 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set selected user&#xD;
as current user</name>
    </language>
</elementInfo>
' #txt
As0 f106 332 1834 128 44 -44 -16 #rect
As0 f106 @|StepIcon #fIcon
As0 f49 expr out #txt
As0 f49 109 1856 332 1856 #arcP
As0 f49 0 0.8148191485830323 0 0 #arcLabel
As0 f76 expr out #txt
As0 f76 460 1856 864 1776 #arcP
As0 f76 1 864 1856 #addKink
As0 f76 0 0.866614339103259 0 0 #arcLabel
As0 f82 expr out #txt
As0 f82 109 1952 864 1776 #arcP
As0 f82 1 864 1952 #addKink
As0 f82 0 0.7044895713743228 0 0 #arcLabel
As0 f84 expr out #txt
As0 f84 109 992 192 912 #arcP
As0 f84 1 192 992 #addKink
As0 f84 0 0.7150846925125054 0 0 #arcLabel
As0 f85 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no errors?</name>
    </language>
</elementInfo>
' #txt
As0 f85 592 1744 32 32 0 16 #rect
As0 f85 @|AlternativeIcon #fIcon
As0 f86 expr out #txt
As0 f86 524 1760 592 1760 #arcP
As0 f89 723 1651 26 26 0 12 #rect
As0 f89 @|UdProcessEndIcon #fIcon
As0 f109 actionTable 'out=in;
' #txt
As0 f109 actionCode 'import javax.faces.context.FacesContext;
FacesContext.getCurrentInstance().validationFailed();
in.isLoadDeputy = false;' #txt
As0 f109 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set validation failed</name>
    </language>
</elementInfo>
' #txt
As0 f109 552 1642 112 44 -53 -8 #rect
As0 f109 @|StepIcon #fIcon
As0 f110 expr in #txt
As0 f110 608 1744 608 1686 #arcP
As0 f110 0 0.9651581755182006 0 0 #arcLabel
As0 f107 expr out #txt
As0 f107 664 1664 723 1664 #arcP
As0 f107 0 0.9892871299061556 0 0 #arcLabel
As0 f2 expr out #txt
As0 f2 109 1760 224 1760 #arcP
As0 f3 expr out #txt
As0 f3 368 1760 412 1760 #arcP
As0 f78 expr out #txt
As0 f78 1448 256 1488 256 #arcP
As0 f78 0 0.6865900143900335 0 0 #arcLabel
As0 f113 actionTable 'out=in;
' #txt
As0 f113 actionCode 'import java.util.ArrayList;
import java.util.Set;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

Set<IvyAbsence> ivyAbsences = AbsenceAndSubstituteUtils.flatIvyAbsenceMap(in.absencesByUser);
if (!in.absenceInThePastShown) {
	out.displayedAbsences.clear();
	for (IvyAbsence absence : ivyAbsences) {
			if (!AbsenceAndSubstituteUtils.isInThePast(absence)) {
				out.displayedAbsences.add(absence);
			}
	}
} else {
	out.displayedAbsences = new ArrayList(ivyAbsences);
}' #txt
As0 f113 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get the absences&#xD;
of all users</name>
    </language>
</elementInfo>
' #txt
As0 f113 1488 138 128 44 -44 -16 #rect
As0 f113 @|StepIcon #fIcon
As0 f114 expr out #txt
As0 f114 1448 160 1488 160 #arcP
As0 f118 expr out #txt
As0 f118 1616 160 1640 160 #arcP
As0 f122 expr in #txt
As0 f122 1672 160 1728 160 #arcP
As0 f123 expr out #txt
As0 f123 1616 256 1656 176 #arcP
As0 f123 1 1656 256 #addKink
As0 f123 0 0.51542288529873 0 0 #arcLabel
As0 f125 627 499 26 26 0 12 #rect
As0 f125 @|UdProcessEndIcon #fIcon
As0 f126 expr out #txt
As0 f126 456 512 627 512 #arcP
As0 f126 0 0.41717001380558716 0 0 #arcLabel
As0 f22 processCall 'Ivy Data Processes/AbsenceService:createAbsence(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence)' #txt
As0 f22 requestActionDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence absence> param;' #txt
As0 f22 requestMappingAction 'param.absence=in.selectedAbsence;
' #txt
As0 f22 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f22 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
As0 f22 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AbsenceService</name>
    </language>
</elementInfo>
' #txt
As0 f22 736 330 112 44 -44 -8 #rect
As0 f22 @|CallSubIcon #fIcon
As0 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>successful?</name>
    </language>
</elementInfo>
' #txt
As0 f28 896 336 32 32 -43 16 #rect
As0 f28 @|AlternativeIcon #fIcon
As0 f115 expr out #txt
As0 f115 848 352 896 352 #arcP
As0 f124 actionTable 'out=in;
' #txt
As0 f124 actionCode 'import org.primefaces.PrimeFaces;

in.isLoadDeputy = true;
PrimeFaces.current().executeScript("PF(''addNewAbsence'').initPosition();");' #txt
As0 f124 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Open deputy dialog</name>
    </language>
</elementInfo>
' #txt
As0 f124 680 1738 112 44 -53 -8 #rect
As0 f124 @|StepIcon #fIcon
As0 f117 expr out #txt
As0 f117 792 1760 848 1760 #arcP
As0 f17 1128 144 32 32 0 16 #rect
As0 f17 @|AlternativeIcon #fIcon
As0 f19 expr out #txt
As0 f19 400 160 1128 160 #arcP
As0 f21 expr in #txt
As0 f21 1160 160 1224 160 #arcP
As0 f24 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>successful?</name>
    </language>
</elementInfo>
' #txt
As0 f24 1128 336 32 32 -38 16 #rect
As0 f24 @|AlternativeIcon #fIcon
As0 f25 expr out #txt
As0 f25 1096 352 1128 352 #arcP
As0 f29 expr in #txt
As0 f29 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>NO</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
As0 f29 1160 352 1232 352 #arcP
As0 f29 0 0.4642857142857143 0 -12 #arcLabel
As0 f69 actionTable 'out=in;
' #txt
As0 f69 actionCode 'import org.primefaces.PrimeFaces;

PrimeFaces.current().executeScript("PF(''addNewAbsence'').hide()");

in.isLoadDeputy = false;
in.selectedAbsence = null;
in.isAbsenceCreated = false;' #txt
As0 f69 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>close dialog</name>
    </language>
</elementInfo>
' #txt
As0 f69 1088 234 112 44 -33 -8 #rect
As0 f69 @|StepIcon #fIcon
As0 f127 expr in #txt
As0 f127 outCond in.errors.isEmpty() #txt
As0 f127 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>YES</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
As0 f127 1144 336 1144 278 #arcP
As0 f127 0 0.4875 -20 -1 #arcLabel
As0 f105 expr out #txt
As0 f105 1144 234 1144 176 #arcP
As0 f105 0 0.4875 -20 1 #arcLabel
As0 f67 expr out #txt
As0 f67 1352 1760 1419 1760 #arcP
As0 f112 expr in #txt
As0 f112 outCond !in.validationError #txt
As0 f112 624 1760 680 1760 #arcP
As0 f26 expr in #txt
As0 f26 outCond in.errors.isEmpty() #txt
As0 f26 928 352 984 352 #arcP
As0 f27 expr in #txt
As0 f27 912 368 1288 374 #arcP
As0 f27 1 912 416 #addKink
As0 f27 2 1288 416 #addKink
As0 f27 1 0.49184782608695654 0 0 #arcLabel
As0 f36 expr out #txt
As0 f36 312 800 499 800 #arcP
As0 f14 expr out #txt
As0 f14 109 800 200 800 #arcP
As0 f5 actionTable 'out=in;
' #txt
As0 f5 actionCode 'import ch.ivy.addon.portalkit.dto.UserDTO;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;

UserDTO currentUserDTO = new UserDTO(ivy.session.getSessionUser());

in.selectedAbsence = new IvyAbsence();
in.selectedAbsence.from = new Date();
in.selectedAbsence.until = new Date();
in.selectedAbsence.user = currentUserDTO;

in.selectedUser = currentUserDTO;

in.validationError = false;
in.isLoadDeputy = false;' #txt
As0 f5 security system #txt
As0 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Init</name>
    </language>
</elementInfo>
' #txt
As0 f5 200 778 112 44 -8 -8 #rect
As0 f5 @|StepIcon #fIcon
As0 f34 expr out #txt
As0 f34 1040 1760 1104 1760 #arcP
As0 f40 guid 1705C7BAE1BE7A21 #txt
As0 f40 method completeUserForAbsence(String) #txt
As0 f40 inParameterDecl '<String query> param;' #txt
As0 f40 inParameterMapAction 'out.queryAutoComplete=param.query;
' #txt
As0 f40 outParameterDecl '<java.util.List<ch.ivy.addon.portalkit.dto.UserDTO> users> result;' #txt
As0 f40 outParameterMapAction 'result.users=in.users;
' #txt
As0 f40 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>completeUserForAbsence(String)</name>
    </language>
</elementInfo>
' #txt
As0 f40 83 1459 26 26 -52 13 #rect
As0 f40 @|UdMethodIcon #fIcon
As0 f41 processCall 'Ivy Data Processes/SecurityService:findUsersOverAllApplications(String,String,Integer,Integer,java.util.List<String>,java.util.List<String>)' #txt
As0 f41 requestActionDecl '<String username,String query,Integer startIndex,Integer count,java.util.List<String> fromRoles,java.util.List<String> excludedUsernames> param;' #txt
As0 f41 requestMappingAction 'param.username=ivy.session.getSessionUserName();
param.query=in.queryAutoComplete;
param.startIndex=0;
param.count=ch.ivy.addon.portalkit.constant.PortalConstants.MAX_USERS_IN_AUTOCOMPLETE;
' #txt
As0 f41 responseMappingAction 'out=in;
out.errors=result.errors;
out.users=result.users;
' #txt
As0 f41 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Ivy Data Processes/SecurityService</name>
    </language>
</elementInfo>
' #txt
As0 f41 192 1450 192 44 -93 -8 #rect
As0 f41 @|CallSubIcon #fIcon
As0 f42 109 1472 192 1472 #arcP
As0 f43 915 1459 26 26 0 12 #rect
As0 f43 @|UdProcessEndIcon #fIcon
As0 f47 guid 1705CD9446F346A5 #txt
As0 f47 method completeUserForDeputy(String) #txt
As0 f47 inParameterDecl '<String query> param;' #txt
As0 f47 inParameterMapAction 'out.queryAutoComplete=param.query;
' #txt
As0 f47 outParameterDecl '<java.util.List<ch.ivy.addon.portalkit.dto.UserDTO> users> result;' #txt
As0 f47 outParameterMapAction 'result.users=in.users;
' #txt
As0 f47 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>completeUserForDeputy(String)</name>
    </language>
</elementInfo>
' #txt
As0 f47 83 1555 26 26 -48 15 #rect
As0 f47 @|UdMethodIcon #fIcon
As0 f50 processCall 'Ivy Data Processes/SecurityService:findUsers(ch.ivyteam.ivy.application.IApplication,String,Integer,Integer,java.util.List<String>,java.util.List<String>)' #txt
As0 f50 requestActionDecl '<ch.ivyteam.ivy.application.IApplication application,String query,Integer startIndex,Integer count,java.util.List<String> fromRoles,java.util.List<String> excludedUsernames> param;' #txt
As0 f50 requestMappingAction 'param.application=in.application;
param.query=in.queryAutoComplete;
param.startIndex=0;
param.count=ch.ivy.addon.portalkit.constant.PortalConstants.MAX_USERS_IN_AUTOCOMPLETE;
param.excludedUsernames=[in.selectedUser.name];
' #txt
As0 f50 responseMappingAction 'out=in;
out.errors=result.errors;
out.users=in.users.addAll(result.users);
' #txt
As0 f50 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Ivy Data Processes/SecurityService</name>
    </language>
</elementInfo>
' #txt
As0 f50 416 1546 192 44 -93 -8 #rect
As0 f50 @|CallSubIcon #fIcon
As0 f94 actionTable 'out=in;
' #txt
As0 f94 actionCode 'import ch.ivy.addon.portalkit.ivydata.utils.ServiceUtilities;
import ch.ivy.addon.portalkit.bo.SubstituteNode;
import ch.ivy.addon.portalkit.jsf.Attrs;

SubstituteNode substituteNode = Attrs.currentContext().get("substituteNode") as SubstituteNode;
out.application = ServiceUtilities.findApp(substituteNode.getApplicationName());
out.users.clear();
out.users.add(null);
' #txt
As0 f94 security system #txt
As0 f94 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get application&#13;
and add no deputy</name>
    </language>
</elementInfo>
' #txt
As0 f94 160 1546 128 44 -43 -16 #rect
As0 f94 @|StepIcon #fIcon
As0 f95 109 1568 160 1568 #arcP
As0 f92 288 1568 416 1568 #arcP
As0 f97 actionTable 'out=in;
' #txt
As0 f97 actionCode 'import ch.ivy.addon.portalkit.util.BeanUtils;

BeanUtils.invokeBeanMethodViaMethodExpression("#{errorDisplayBean.displayErrors}", in.errors);' #txt
As0 f97 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Display errors &#xD;
if have</name>
    </language>
</elementInfo>
' #txt
As0 f97 760 1546 128 44 -40 -16 #rect
As0 f97 @|StepIcon #fIcon
As0 f98 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>successful?</name>
    </language>
</elementInfo>
' #txt
As0 f98 656 1456 32 32 -32 -30 #rect
As0 f98 @|AlternativeIcon #fIcon
As0 f99 384 1472 656 1472 #arcP
As0 f45 expr in #txt
As0 f45 outCond in.errors.isEmpty() #txt
As0 f45 688 1472 915 1472 #arcP
As0 f108 expr in #txt
As0 f108 672 1488 760 1568 #arcP
As0 f108 1 672 1568 #addKink
As0 f108 1 0.20519735823436736 0 0 #arcLabel
As0 f129 512 1546 662 1478 #arcP
As0 f48 888 1568 928 1485 #arcP
As0 f48 1 928 1568 #addKink
As0 f48 0 0.9165811121604647 0 0 #arcLabel
As0 f75 actionTable 'out=in;
' #txt
As0 f75 actionCode 'import ch.ivy.addon.portalkit.util.UserUtils;
import java.util.Set;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

in.validationError = false;
String username = in.selectedUser.getName();
boolean fromBiggerThanTill = AbsenceAndSubstituteUtils.checkFromBiggerThanTill(in.selectedAbsence);
in.selectedAbsence.user = in.selectedUser;

if (fromBiggerThanTill) {
	in.validationError = true;
}

boolean doesNewAbsenceOverlap = AbsenceAndSubstituteUtils.doesNewAbsenceOverlap(in.absencesByUser.get(username) as Set, in.selectedAbsence);
if (doesNewAbsenceOverlap) {
	in.validationError = true;
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR,ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/overlappingAbsence"), ""));
}' #txt
As0 f75 security system #txt
As0 f75 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Validation</name>
    </language>
</elementInfo>
' #txt
As0 f75 456 330 112 44 -27 -8 #rect
As0 f75 @|StepIcon #fIcon
As0 f93 actionTable 'out=in;
' #txt
As0 f93 actionCode 'import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import ch.ivy.addon.portalkit.util.Dates;

java.util.Date endOfDate = Dates.toEndOfDate(in.selectedAbsence.getUntil());
in.selectedAbsence.setUntil(endOfDate);
' #txt
As0 f93 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set end date&#xD;
to selected absence</name>
    </language>
</elementInfo>
' #txt
As0 f93 248 330 144 44 -51 -16 #rect
As0 f93 @|StepIcon #fIcon
As0 f102 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no errors?</name>
    </language>
</elementInfo>
' #txt
As0 f102 624 336 32 32 -25 26 #rect
As0 f102 @|AlternativeIcon #fIcon
As0 f116 actionTable 'out=in;
' #txt
As0 f116 actionCode 'import javax.faces.context.FacesContext;
FacesContext.getCurrentInstance().validationFailed();
in.isLoadDeputy = false;' #txt
As0 f116 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set validation failed</name>
    </language>
</elementInfo>
' #txt
As0 f116 584 202 112 44 -53 -8 #rect
As0 f116 @|StepIcon #fIcon
As0 f133 expr out #txt
As0 f133 568 352 624 352 #arcP
As0 f135 expr out #txt
As0 f135 392 352 456 352 #arcP
As0 f136 expr in #txt
As0 f136 outCond in.validationError #txt
As0 f136 640 336 640 246 #arcP
As0 f136 0 0.9651581755182006 0 0 #arcLabel
As0 f20 expr in #txt
As0 f20 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
    </language>
</elementInfo>
' #txt
As0 f20 656 352 736 352 #arcP
As0 f138 787 211 26 26 0 12 #rect
As0 f138 @|UdProcessEndIcon #fIcon
As0 f139 696 224 787 224 #arcP
As0 f140 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>is absence created ?</name>
    </language>
</elementInfo>
' #txt
As0 f140 144 336 32 32 -59 -43 #rect
As0 f140 @|AlternativeIcon #fIcon
As0 f141 77 352 144 352 #arcP
As0 f137 expr in #txt
As0 f137 outCond in.isAbsenceCreated #txt
As0 f137 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
    </language>
</elementInfo>
' #txt
As0 f137 176 352 248 352 #arcP
As0 f137 0 0.5 0 -9 #arcLabel
As0 f144 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>user click on set deputy</name>
    </language>
</elementInfo>
' #txt
As0 f144 160 368 792 374 #arcP
As0 f144 1 160 416 #addKink
As0 f144 2 792 416 #addKink
As0 f144 1 0.47310126582278483 0 12 #arcLabel
As0 f150 actionTable 'out=in;
' #txt
As0 f150 actionCode 'import ch.ivyteam.ivy.security.IPermission;
import ch.ivy.addon.portalkit.util.PermissionUtils;

in.canCreateAbsenceForOtherUsers = PermissionUtils.hasPermission(ivy.wf.getApplication(), ivy.session.getSessionUserName(), IPermission.USER_CREATE_ABSENCE);' #txt
As0 f150 security system #txt
As0 f150 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Initialize</name>
    </language>
</elementInfo>
' #txt
As0 f150 168 42 112 44 -22 -8 #rect
As0 f150 @|StepIcon #fIcon
As0 f151 expr out #txt
As0 f151 109 64 168 64 #arcP
As0 f58 280 64 339 64 #arcP
>Proto As0 .type ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData #txt
>Proto As0 .processKind HTML_DIALOG #txt
>Proto As0 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <swimlaneLabel>Start</swimlaneLabel>
        <swimlaneLabel>Load absences</swimlaneLabel>
        <swimlaneLabel>Event</swimlaneLabel>
        <swimlaneLabel>Methods</swimlaneLabel>
        <swimlaneLabel></swimlaneLabel>
    </language>
    <swimlaneSize>208</swimlaneSize>
    <swimlaneSize>288</swimlaneSize>
    <swimlaneSize>1792</swimlaneSize>
    <swimlaneSize>1720</swimlaneSize>
    <swimlaneColor gradient="true">-3342388</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-154</swimlaneColor>
    <swimlaneColor gradient="true">-26215</swimlaneColor>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
</elementInfo>
' #txt
>Proto As0 -8 -8 16 16 16 26 #rect
>Proto As0 '' #fIcon
As0 f79 mainOut f143 tail #connect
As0 f143 head f142 mainIn #connect
As0 f83 out f147 tail #connect
As0 f147 head f145 mainIn #connect
As0 f83 out f148 tail #connect
As0 f148 head f146 mainIn #connect
As0 f154 mainOut f156 tail #connect
As0 f156 head f80 mainIn #connect
As0 f11 mainOut f131 tail #connect
As0 f131 head f37 mainIn #connect
As0 f37 mainOut f132 tail #connect
As0 f132 head f130 mainIn #connect
As0 f12 mainOut f30 tail #connect
As0 f30 head f23 mainIn #connect
As0 f31 mainOut f14 tail #connect
As0 f14 head f5 mainIn #connect
As0 f5 mainOut f36 tail #connect
As0 f36 head f35 mainIn #connect
As0 f7 mainOut f134 tail #connect
As0 f134 head f13 mainIn #connect
As0 f33 mainOut f46 tail #connect
As0 f46 head f44 mainIn #connect
As0 f44 mainOut f53 tail #connect
As0 f53 head f52 mainIn #connect
As0 f54 mainOut f56 tail #connect
As0 f56 head f55 mainIn #connect
As0 f55 mainOut f87 tail #connect
As0 f87 head f57 mainIn #connect
As0 f38 mainOut f63 tail #connect
As0 f63 head f39 mainIn #connect
As0 f88 mainOut f64 tail #connect
As0 f64 head f61 mainIn #connect
As0 f6 mainOut f91 tail #connect
As0 f91 head f90 in #connect
As0 f90 out f128 tail #connect
As0 f128 head f7 mainIn #connect
As0 f32 mainOut f119 tail #connect
As0 f119 head f111 mainIn #connect
As0 f111 mainOut f121 tail #connect
As0 f121 head f120 mainIn #connect
As0 f39 mainOut f8 tail #connect
As0 f8 head f4 in #connect
As0 f4 out f10 tail #connect
As0 f10 head f9 mainIn #connect
As0 f9 mainOut f15 tail #connect
As0 f15 head f61 mainIn #connect
As0 f4 out f16 tail #connect
As0 f16 head f88 mainIn #connect
As0 f68 out f66 tail #connect
As0 f66 head f60 mainIn #connect
As0 f68 out f71 tail #connect
As0 f71 head f70 mainIn #connect
As0 f70 mainOut f72 tail #connect
As0 f72 head f59 mainIn #connect
As0 f74 out f65 tail #connect
As0 f65 head f62 mainIn #connect
As0 f104 mainOut f103 tail #connect
As0 f103 head f100 mainIn #connect
As0 f73 mainOut f49 tail #connect
As0 f49 head f106 mainIn #connect
As0 f106 mainOut f76 tail #connect
As0 f76 head f74 in #connect
As0 f81 mainOut f82 tail #connect
As0 f82 head f74 in #connect
As0 f157 mainOut f84 tail #connect
As0 f84 head f90 in #connect
As0 f77 mainOut f86 tail #connect
As0 f86 head f85 in #connect
As0 f110 head f109 mainIn #connect
As0 f109 mainOut f107 tail #connect
As0 f107 head f89 mainIn #connect
As0 f51 mainOut f2 tail #connect
As0 f2 head f1 mainIn #connect
As0 f1 mainOut f3 tail #connect
As0 f3 head f77 mainIn #connect
As0 f146 mainOut f78 tail #connect
As0 f78 head f152 mainIn #connect
As0 f145 mainOut f114 tail #connect
As0 f114 head f113 mainIn #connect
As0 f113 mainOut f118 tail #connect
As0 f118 head f149 in #connect
As0 f149 out f122 tail #connect
As0 f122 head f154 mainIn #connect
As0 f152 mainOut f123 tail #connect
As0 f123 head f149 in #connect
As0 f120 mainOut f126 tail #connect
As0 f126 head f125 mainIn #connect
As0 f22 mainOut f115 tail #connect
As0 f115 head f28 in #connect
As0 f124 mainOut f117 tail #connect
As0 f117 head f74 in #connect
As0 f142 mainOut f19 tail #connect
As0 f19 head f17 in #connect
As0 f17 out f21 tail #connect
As0 f21 head f83 in #connect
As0 f101 mainOut f25 tail #connect
As0 f25 head f24 in #connect
As0 f29 head f104 mainIn #connect
As0 f24 out f127 tail #connect
As0 f127 head f69 mainIn #connect
As0 f24 out f29 tail #connect
As0 f69 mainOut f105 tail #connect
As0 f105 head f17 in #connect
As0 f60 mainOut f67 tail #connect
As0 f67 head f59 mainIn #connect
As0 f85 out f112 tail #connect
As0 f112 head f124 mainIn #connect
As0 f85 out f110 tail #connect
As0 f28 out f26 tail #connect
As0 f26 head f101 mainIn #connect
As0 f28 out f27 tail #connect
As0 f27 head f104 mainIn #connect
As0 f62 mainOut f34 tail #connect
As0 f34 head f68 in #connect
As0 f40 mainOut f42 tail #connect
As0 f42 head f41 mainIn #connect
As0 f47 mainOut f95 tail #connect
As0 f95 head f94 mainIn #connect
As0 f94 mainOut f92 tail #connect
As0 f92 head f50 mainIn #connect
As0 f41 mainOut f99 tail #connect
As0 f99 head f98 in #connect
As0 f98 out f45 tail #connect
As0 f45 head f43 mainIn #connect
As0 f98 out f108 tail #connect
As0 f108 head f97 mainIn #connect
As0 f50 mainOut f129 tail #connect
As0 f129 head f98 in #connect
As0 f97 mainOut f48 tail #connect
As0 f48 head f43 mainIn #connect
As0 f75 mainOut f133 tail #connect
As0 f133 head f102 in #connect
As0 f136 head f116 mainIn #connect
As0 f93 mainOut f135 tail #connect
As0 f135 head f75 mainIn #connect
As0 f102 out f136 tail #connect
As0 f102 out f20 tail #connect
As0 f20 head f22 mainIn #connect
As0 f116 mainOut f139 tail #connect
As0 f139 head f138 mainIn #connect
As0 f96 mainOut f141 tail #connect
As0 f141 head f140 in #connect
As0 f140 out f137 tail #connect
As0 f137 head f93 mainIn #connect
As0 f140 out f144 tail #connect
As0 f144 head f22 mainIn #connect
As0 f0 mainOut f151 tail #connect
As0 f151 head f150 mainIn #connect
As0 f150 mainOut f58 tail #connect
As0 f58 head f18 mainIn #connect
