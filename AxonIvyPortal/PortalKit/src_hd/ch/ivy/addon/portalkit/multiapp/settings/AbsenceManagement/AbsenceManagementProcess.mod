[Ivy]
16FCB335E38B3C05 7.5.0 #module
>Proto >Proto Collection #zClass
As0 AbsenceManagementProcess Big #zClass
As0 RD #cInfo
As0 #process
As0 @TextInP .type .type #zField
As0 @TextInP .processKind .processKind #zField
As0 @TextInP .xml .xml #zField
As0 @TextInP .responsibility .responsibility #zField
As0 @UdInit f0 '' #zField
As0 @UdProcessEnd f35 '' #zField
As0 @GridStep f37 '' #zField
As0 @UdEvent f81 '' #zField
As0 @UdProcessEnd f23 '' #zField
As0 @UdProcessEnd f80 '' #zField
As0 @GridStep f142 '' #zField
As0 @CallSub f39 '' #zField
As0 @UdMethod f12 '' #zField
As0 @Alternative f90 '' #zField
As0 @CallSub f111 '' #zField
As0 @UdMethod f11 '' #zField
As0 @UdProcessEnd f18 '' #zField
As0 @UdEvent f96 '' #zField
As0 @GridStep f5 '' #zField
As0 @GridStep f7 '' #zField
As0 @UdEvent f157 '' #zField
As0 @CallSub f101 '' #zField
As0 @GridStep f152 '' #zField
As0 @UdProcessEnd f100 '' #zField
As0 @CallSub f62 '' #zField
As0 @UdEvent f6 '' #zField
As0 @UdMethod f79 '' #zField
As0 @CallSub f146 '' #zField
As0 @UdEvent f31 '' #zField
As0 @UdProcessEnd f57 '' #zField
As0 @UdProcessEnd f61 '' #zField
As0 @GridStep f9 '' #zField
As0 @UdProcessEnd f130 '' #zField
As0 @UdProcessEnd f125 '' #zField
As0 @UdEvent f38 '' #zField
As0 @UdEvent f54 '' #zField
As0 @UdProcessEnd f59 '' #zField
As0 @GridStep f55 '' #zField
As0 @PushWFArc f63 '' #zField
As0 @PushWFArc f78 '' #zField
As0 @PushWFArc f131 '' #zField
As0 @PushWFArc f143 '' #zField
As0 @PushWFArc f132 '' #zField
As0 @PushWFArc f56 '' #zField
As0 @PushWFArc f58 '' #zField
As0 @PushWFArc f91 '' #zField
As0 @PushWFArc f128 '' #zField
As0 @PushWFArc f15 '' #zField
As0 @PushWFArc f14 '' #zField
As0 @PushWFArc f84 '' #zField
As0 @PushWFArc f36 '' #zField
As0 @PushWFArc f30 '' #zField
As0 @PushWFArc f87 '' #zField
As0 @CallSub f129 '' #zField
As0 @UdProcessEnd f136 '' #zField
As0 @GridStep f137 '' #zField
As0 @GridStep f138 '' #zField
As0 @GridStep f139 '' #zField
As0 @Alternative f140 '' #zField
As0 @PushWFArc f144 '' #zField
As0 @PushWFArc f153 '' #zField
As0 @PushWFArc f155 '' #zField
As0 @PushWFArc f158 '' #zField
As0 @UdProcessEnd f150 '' #zField
As0 @GridStep f86 '' #zField
As0 @UdMethod f27 '' #zField
As0 @GridStep f102 '' #zField
As0 @CallSub f105 '' #zField
As0 @CallSub f115 '' #zField
As0 @UdProcessEnd f117 '' #zField
As0 @PushWFArc f93 '' #zField
As0 @UdMethod f53 '' #zField
As0 @PushWFArc f22 '' #zField
As0 @UdProcessEnd f122 '' #zField
As0 @GridStep f13 '' #zField
As0 @PushWFArc f134 '' #zField
As0 @CallSub f147 '' #zField
As0 @PushWFArc f148 '' #zField
As0 @PushWFArc f149 '' #zField
As0 @CallSub f45 '' #zField
As0 @PushWFArc f46 '' #zField
As0 @CallSub f48 '' #zField
As0 @PushWFArc f40 '' #zField
As0 @UdMethod f52 '' #zField
As0 @Alternative f98 '' #zField
As0 @PushWFArc f99 '' #zField
As0 @PushWFArc f106 '' #zField
As0 @PushWFArc f107 '' #zField
As0 @PushWFArc f118 '' #zField
As0 @GridStep f121 '' #zField
As0 @PushWFArc f119 '' #zField
As0 @PushWFArc f151 '' #zField
As0 @PushWFArc f28 '' #zField
As0 @PushWFArc f26 '' #zField
As0 @PushWFArc f24 '' #zField
As0 @PushWFArc f25 '' #zField
As0 @PushWFArc f21 '' #zField
As0 @PushWFArc f16 '' #zField
As0 @UdProcessEnd f8 '' #zField
As0 @PushWFArc f10 '' #zField
As0 @UdProcessEnd f19 '' #zField
As0 @PushWFArc f29 '' #zField
As0 @PushWFArc f3 '' #zField
As0 @PushWFArc f1 '' #zField
As0 @PushWFArc f2 '' #zField
As0 @PushWFArc f4 '' #zField
As0 @UdMethod f17 '' #zField
As0 @PushWFArc f33 '' #zField
>Proto As0 As0 AbsenceManagementProcess #zField
As0 f0 guid 16FCC0CDEBBE65FA #txt
As0 f0 method start() #txt
As0 f0 inParameterDecl '<> param;' #txt
As0 f0 outParameterDecl '<> result;' #txt
As0 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>start()</name>
    </language>
</elementInfo>
' #txt
As0 f0 99 35 26 26 -16 15 #rect
As0 f0 @|UdInitIcon #fIcon
As0 f35 1379 323 26 26 0 12 #rect
As0 f35 @|UdProcessEndIcon #fIcon
As0 f37 actionTable 'out=in;
' #txt
As0 f37 actionCode 'in.backupAbsence.setUser(in.selectedAbsence.getUser());
in.backupAbsence.setFrom(in.selectedAbsence.getFrom());
in.backupAbsence.setUntil(in.selectedAbsence.getUntil());
in.backupAbsence.setComment(in.selectedAbsence.getComment());
in.selectedUser = in.selectedAbsence.getUser();
in.isCreateMode = false;' #txt
As0 f37 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Backup absence</name>
    </language>
</elementInfo>
' #txt
As0 f37 1216 122 112 44 -46 -8 #rect
As0 f37 @|StepIcon #fIcon
As0 f81 guid 16FCC0CDEBB1A481 #txt
As0 f81 actionTable 'out=in;
' #txt
As0 f81 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>changeUserSubstitute</name>
    </language>
</elementInfo>
' #txt
As0 f81 99 995 26 26 -47 15 #rect
As0 f81 @|UdEventIcon #fIcon
As0 f23 291 323 26 26 0 12 #rect
As0 f23 @|UdProcessEndIcon #fIcon
As0 f80 907 131 26 26 0 12 #rect
As0 f80 @|UdProcessEndIcon #fIcon
As0 f142 actionTable 'out=in;
' #txt
As0 f142 actionCode 'import ch.ivy.addon.portalkit.service.PermissionCheckerService;
import ch.ivyteam.ivy.security.IPermission;

PermissionCheckerService permissionChecker = new PermissionCheckerService();
in.isSupervisor = permissionChecker.hasAllPermissions(IPermission.USER_CREATE_ABSENCE, IPermission.USER_READ_ABSENCES, IPermission.USER_DELETE_ABSENCE);' #txt
As0 f142 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Check if current user &#xD;
can manage other users'' absences</name>
    </language>
</elementInfo>
' #txt
As0 f142 180 122 224 44 -92 -16 #rect
As0 f142 @|StepIcon #fIcon
As0 f39 processCall 'Ivy Data Processes/AbsenceService:deleteAbsence(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence)' #txt
As0 f39 requestActionDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence ivyAbsence> param;' #txt
As0 f39 requestMappingAction 'param.ivyAbsence=in.selectedAbsence;
' #txt
As0 f39 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f39 responseMappingAction 'out=in;
' #txt
As0 f39 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AbsenceService</name>
    </language>
</elementInfo>
' #txt
As0 f39 264 410 112 44 -44 -8 #rect
As0 f39 @|CallSubIcon #fIcon
As0 f12 guid 16FCC0CDEBC7E549 #txt
As0 f12 method preDelete(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence) #txt
As0 f12 inParameterDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence selectedAbsence> param;' #txt
As0 f12 inParameterMapAction 'out.selectedAbsence=param.selectedAbsence;
' #txt
As0 f12 outParameterDecl '<> result;' #txt
As0 f12 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>preDelete(IvyAbsence)</name>
    </language>
</elementInfo>
' #txt
As0 f12 99 323 26 26 -61 15 #rect
As0 f12 @|UdMethodIcon #fIcon
As0 f90 192 512 32 32 0 16 #rect
As0 f90 @|AlternativeIcon #fIcon
As0 f111 processCall 'Ivy Data Processes/AbsenceService:updateAbsences(String,java.util.Set)' #txt
As0 f111 requestActionDecl '<String username,java.util.Set ivyAbsences> param;' #txt
As0 f111 requestMappingAction 'param.username=in.selectedAbsenceUser.getName();
param.ivyAbsences=in.absencesByUser.get(in.selectedAbsenceUser.getName()) as java.util.Set;
' #txt
As0 f111 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f111 responseMappingAction 'out=in;
' #txt
As0 f111 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AbsenceService</name>
    </language>
</elementInfo>
' #txt
As0 f111 256 1274 112 44 -44 -8 #rect
As0 f111 @|CallSubIcon #fIcon
As0 f11 guid 16FCC0CDEBCF45F4 #txt
As0 f11 method editAbsence(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence) #txt
As0 f11 inParameterDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence selectedAbsence> param;' #txt
As0 f11 inParameterMapAction 'out.selectedAbsence=param.selectedAbsence;
out.validationError=false;
' #txt
As0 f11 outParameterDecl '<> result;' #txt
As0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>editAbsence(IvyAbsence)</name>
    </language>
</elementInfo>
' #txt
As0 f11 1091 131 26 26 -68 15 #rect
As0 f11 @|UdMethodIcon #fIcon
As0 f18 293 35 26 26 0 12 #rect
As0 f18 @|UdProcessEndIcon #fIcon
As0 f96 guid 16FCC0CDEBCF3123 #txt
As0 f96 actionTable 'out=in;
' #txt
As0 f96 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>saveSubstitutes</name>
    </language>
</elementInfo>
' #txt
As0 f96 99 707 26 26 -47 15 #rect
As0 f96 @|UdEventIcon #fIcon
As0 f5 actionTable 'out=in;
' #txt
As0 f5 actionCode 'import ch.ivy.addon.portalkit.ivydata.utils.ServiceUtilities;
import ch.ivy.addon.portalkit.dto.UserDTO;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;

UserDTO currentUserDTO = new UserDTO(in.selectedAbsenceUser);

in.selectedAbsence = new IvyAbsence();
in.selectedAbsence.from = new Date();
in.selectedAbsence.until = new Date();
in.selectedAbsence.user = currentUserDTO;

in.selectedUser = currentUserDTO;

in.validationError = false;
in.isCreateMode = true;
' #txt
As0 f5 security system #txt
As0 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Init</name>
    </language>
</elementInfo>
' #txt
As0 f5 1216 314 112 44 -8 -8 #rect
As0 f5 @|StepIcon #fIcon
As0 f7 actionTable 'out=in;
' #txt
As0 f7 actionCode 'import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;
import java.util.Set;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;

in.validationError = false;
String username = in.selectedUser.getName();
boolean fromBiggerThanTill = AbsenceAndSubstituteUtils.checkFromBiggerThanTill(in.selectedAbsence);
in.selectedAbsence.user = in.selectedUser;

if (fromBiggerThanTill) {
	in.validationError = true;
	FacesContext.getCurrentInstance().validationFailed();
}

' #txt
As0 f7 security system #txt
As0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Validation date</name>
    </language>
</elementInfo>
' #txt
As0 f7 264 506 112 44 -40 -8 #rect
As0 f7 @|StepIcon #fIcon
As0 f157 guid 16FCC0CDEBC66FE9 #txt
As0 f157 actionTable 'out=in;
' #txt
As0 f157 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>userSelectInAbsence</name>
    </language>
</elementInfo>
' #txt
As0 f157 99 611 26 26 -48 14 #rect
As0 f157 @|UdEventIcon #fIcon
As0 f101 processCall 'Ivy Data Processes/SubstituteService:saveSubstitutes(ch.ivy.addon.portalkit.dto.UserDTO,java.util.List<ch.ivy.addon.portalkit.ivydata.bo.IvySubstitute>)' #txt
As0 f101 requestActionDecl '<ch.ivy.addon.portalkit.dto.UserDTO userDTO,java.util.List<ch.ivy.addon.portalkit.ivydata.bo.IvySubstitute> substitutes> param;' #txt
As0 f101 requestMappingAction 'param.userDTO=in.substituteUser;
param.substitutes=in.substitutes;
' #txt
As0 f101 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f101 responseMappingAction 'out=in;
' #txt
As0 f101 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>save substitutes</name>
    </language>
</elementInfo>
' #txt
As0 f101 264 698 112 44 -45 -8 #rect
As0 f101 @|CallSubIcon #fIcon
As0 f152 actionTable 'out=in;
' #txt
As0 f152 actionCode 'import ch.ivy.addon.portalkit.ivydata.exception.PortalIvyDataException;
import java.util.ArrayList;
import java.util.Set;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

if (in.#absencesByUser is initialized) {
	Set<IvyAbsence> ivyAbsences = in.absencesByUser.get(in.selectedAbsenceUser.getName()) as Set;
	if (!in.absenceInThePastShown) {
		out.displayedAbsences.clear();
		for (IvyAbsence absence : ivyAbsences) {
				if (!AbsenceAndSubstituteUtils.isInThePast(absence)) {
					out.displayedAbsences.add(absence);
				}
		}
	} else {
		out.displayedAbsences = new ArrayList(ivyAbsences);
	}
}

' #txt
As0 f152 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get the absences&#xD;
of current user</name>
    </language>
</elementInfo>
' #txt
As0 f152 672 122 128 44 -44 -16 #rect
As0 f152 @|StepIcon #fIcon
As0 f100 515 707 26 26 0 12 #rect
As0 f100 @|UdProcessEndIcon #fIcon
As0 f62 processCall 'Ivy Data Processes/SubstituteService:findSubstitutes(String)' #txt
As0 f62 requestActionDecl '<String username> param;' #txt
As0 f62 requestMappingAction 'param.username=in.substituteUser.getName();
' #txt
As0 f62 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f62 responseMappingAction 'out=in;
out.substitutes=result.substitutes;
' #txt
As0 f62 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>find substitutes only for this app</name>
    </language>
</elementInfo>
' #txt
As0 f62 224 986 192 44 -86 -8 #rect
As0 f62 @|CallSubIcon #fIcon
As0 f6 guid 16FCC0CDEBC9A56B #txt
As0 f6 actionTable 'out=in;
' #txt
As0 f6 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>dateChange</name>
    </language>
</elementInfo>
' #txt
As0 f6 99 515 26 26 -36 15 #rect
As0 f6 @|UdEventIcon #fIcon
As0 f79 guid 16FCC0CDEBCA6260 #txt
As0 f79 method findAbsences() #txt
As0 f79 inParameterDecl '<> param;' #txt
As0 f79 outParameterDecl '<> result;' #txt
As0 f79 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findAbsences()</name>
    </language>
</elementInfo>
' #txt
As0 f79 99 131 26 26 -41 15 #rect
As0 f79 @|UdMethodIcon #fIcon
As0 f146 processCall 'Ivy Data Processes/AbsenceService:findAbsences(String)' #txt
As0 f146 requestActionDecl '<String username> param;' #txt
As0 f146 requestMappingAction 'param.username=in.selectedAbsenceUser.getName();
' #txt
As0 f146 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f146 responseMappingAction 'out=in;
out.absencesByUser=result.absencesByUser;
' #txt
As0 f146 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Find current &#xD;
user''s absences</name>
    </language>
</elementInfo>
' #txt
As0 f146 472 122 112 44 -46 -20 #rect
As0 f146 @|CallSubIcon #fIcon
As0 f31 guid 16FCC0CDEBC98603 #txt
As0 f31 actionTable 'out=in;
' #txt
As0 f31 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add</name>
    </language>
</elementInfo>
' #txt
As0 f31 1091 323 26 26 -10 15 #rect
As0 f31 @|UdEventIcon #fIcon
As0 f57 1379 227 26 26 0 12 #rect
As0 f57 @|UdProcessEndIcon #fIcon
As0 f61 619 419 26 26 0 12 #rect
As0 f61 @|UdProcessEndIcon #fIcon
As0 f9 actionTable 'out=in;
' #txt
As0 f9 actionCode 'import ch.ivy.addon.portalkit.util.UserUtils;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import java.util.Set;

out.displayedAbsences.remove(in.selectedAbsence);
Set<IvyAbsence> ivyAbsences = out.absencesByUser.get(in.selectedAbsence.user.getName()) as Set;
ivyAbsences.remove(in.selectedAbsence);' #txt
As0 f9 security system #txt
As0 f9 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Remove from list</name>
    </language>
</elementInfo>
' #txt
As0 f9 448 410 112 44 -46 -8 #rect
As0 f9 @|StepIcon #fIcon
As0 f130 1379 131 26 26 0 12 #rect
As0 f130 @|UdProcessEndIcon #fIcon
As0 f125 803 1283 26 26 0 12 #rect
As0 f125 @|UdProcessEndIcon #fIcon
As0 f38 guid 16FCC0CDEBC953C7 #txt
As0 f38 actionTable 'out=in;
' #txt
As0 f38 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>deleteAbsence</name>
    </language>
</elementInfo>
' #txt
As0 f38 99 419 26 26 -47 15 #rect
As0 f38 @|UdEventIcon #fIcon
As0 f54 guid 16FCC0CDEBCB48D3 #txt
As0 f54 actionTable 'out=in;
' #txt
As0 f54 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>cancel</name>
    </language>
</elementInfo>
' #txt
As0 f54 1091 227 26 26 -19 16 #rect
As0 f54 @|UdEventIcon #fIcon
As0 f59 515 995 26 26 0 12 #rect
As0 f59 @|UdProcessEndIcon #fIcon
As0 f55 actionTable 'out=in;
' #txt
As0 f55 actionCode 'out.selectedAbsence.setUser(in.backupAbsence.getUser());
out.selectedAbsence.setFrom(in.backupAbsence.getFrom());
out.selectedAbsence.setUntil(in.backupAbsence.getUntil());
out.selectedAbsence.setComment(in.backupAbsence.getComment());
' #txt
As0 f55 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Reset</name>
    </language>
</elementInfo>
' #txt
As0 f55 1216 218 112 44 -16 -8 #rect
As0 f55 @|StepIcon #fIcon
As0 f63 expr out #txt
As0 f63 125 432 264 432 #arcP
As0 f78 expr out #txt
As0 f78 584 144 672 144 #arcP
As0 f78 0 0.6865900143900335 0 0 #arcLabel
As0 f131 expr out #txt
As0 f131 1117 144 1216 144 #arcP
As0 f143 expr out #txt
As0 f143 125 144 180 144 #arcP
As0 f132 expr out #txt
As0 f132 1328 144 1379 144 #arcP
As0 f56 expr out #txt
As0 f56 1117 240 1216 240 #arcP
As0 f58 expr out #txt
As0 f58 125 48 293 48 #arcP
As0 f91 expr out #txt
As0 f91 125 528 192 528 #arcP
As0 f128 expr in #txt
As0 f128 224 528 264 528 #arcP
As0 f15 expr out #txt
As0 f15 560 432 619 432 #arcP
As0 f14 expr out #txt
As0 f14 1117 336 1216 336 #arcP
As0 f84 expr out #txt
As0 f84 125 624 208 544 #arcP
As0 f84 1 208 624 #addKink
As0 f84 0 0.7150846925125054 0 0 #arcLabel
As0 f36 expr out #txt
As0 f36 1328 336 1379 336 #arcP
As0 f30 expr out #txt
As0 f30 125 336 291 336 #arcP
As0 f87 expr out #txt
As0 f87 1328 240 1379 240 #arcP
As0 f129 processCall 'Ivy Data Processes/AbsenceService:createAbsence(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence)' #txt
As0 f129 requestActionDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence absence> param;' #txt
As0 f129 requestMappingAction 'param.absence=in.selectedAbsence;
' #txt
As0 f129 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f129 responseMappingAction 'out=in;
' #txt
As0 f129 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AbsenceService</name>
    </language>
</elementInfo>
' #txt
As0 f129 904 1090 112 44 -44 -8 #rect
As0 f129 @|CallSubIcon #fIcon
As0 f136 931 1187 26 26 0 12 #rect
As0 f136 @|UdProcessEndIcon #fIcon
As0 f137 actionTable 'out=in;
' #txt
As0 f137 actionCode 'import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import ch.ivy.addon.portalkit.util.Dates;

java.util.Date endOfDate = Dates.toEndOfDate(in.selectedAbsence.getUntil());
in.selectedAbsence.setUntil(endOfDate);

in.isAbsenceBeingCreated = true;' #txt
As0 f137 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set end date&#xD;
to selected absence</name>
    </language>
</elementInfo>
' #txt
As0 f137 256 1090 144 44 -51 -16 #rect
As0 f137 @|StepIcon #fIcon
As0 f138 actionTable 'out=in;
' #txt
As0 f138 actionCode 'import java.util.Set;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

in.validationError = false;
String username = in.selectedUser.getName();
boolean fromBiggerThanTill = AbsenceAndSubstituteUtils.checkFromBiggerThanTill(in.selectedAbsence);
in.selectedAbsence.user = in.selectedUser;

if (fromBiggerThanTill) {
	in.validationError = true;
}

boolean doesNewAbsenceOverlap = AbsenceAndSubstituteUtils.doesNewAbsenceOverlap(in.absencesByUser.get(username) as Set, in.selectedAbsence);
if (doesNewAbsenceOverlap) {
	in.validationError = true;
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR,ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/overlappingAbsence"), ""));
}

' #txt
As0 f138 security system #txt
As0 f138 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Validation</name>
    </language>
</elementInfo>
' #txt
As0 f138 628 1090 112 44 -27 -8 #rect
As0 f138 @|StepIcon #fIcon
As0 f139 actionTable 'out=in;
' #txt
As0 f139 actionCode 'import javax.faces.context.FacesContext;
FacesContext.getCurrentInstance().validationFailed();
' #txt
As0 f139 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set validation failed</name>
    </language>
</elementInfo>
' #txt
As0 f139 760 1178 112 44 -53 -8 #rect
As0 f139 @|StepIcon #fIcon
As0 f140 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no errors?</name>
    </language>
</elementInfo>
' #txt
As0 f140 800 1096 32 32 0 16 #rect
As0 f140 @|AlternativeIcon #fIcon
As0 f144 expr out #txt
As0 f144 872 1200 931 1200 #arcP
As0 f144 0 0.9892871299061556 0 0 #arcLabel
As0 f153 expr in #txt
As0 f153 816 1128 816 1178 #arcP
As0 f153 0 0.9651581755182006 0 0 #arcLabel
As0 f155 expr out #txt
As0 f155 740 1112 800 1112 #arcP
As0 f158 expr in #txt
As0 f158 outCond !in.validationError #txt
As0 f158 832 1112 904 1112 #arcP
As0 f150 1379 1099 26 26 0 12 #rect
As0 f150 @|UdProcessEndIcon #fIcon
As0 f86 actionTable 'out=in;
' #txt
As0 f86 actionCode 'import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import java.util.Set;

import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

boolean showNewAbsence = in.selectedAbsence.user.name.equals(in.selectedAbsenceUser.name);

if (showNewAbsence && (!AbsenceAndSubstituteUtils.isInThePast(in.selectedAbsence) || in.absenceInThePastShown)){
	in.displayedAbsences.add(in.selectedAbsence);
	(in.absencesByUser.get(in.selectedAbsenceUser.getName()) as Set).add(in.selectedAbsence);
}
' #txt
As0 f86 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>update data</name>
    </language>
</elementInfo>
' #txt
As0 f86 1168 1090 112 44 -32 -8 #rect
As0 f86 @|StepIcon #fIcon
As0 f27 guid 1700AB23B2C65876 #txt
As0 f27 method loadData() #txt
As0 f27 inParameterDecl '<> param;' #txt
As0 f27 outParameterDecl '<> result;' #txt
As0 f27 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>loadData</name>
    </language>
</elementInfo>
' #txt
As0 f27 99 227 26 26 -25 15 #rect
As0 f27 @|UdMethodIcon #fIcon
As0 f102 actionTable 'out=in;
' #txt
As0 f102 actionCode 'import ch.ivy.addon.portalkit.dto.UserDTO;
import ch.ivy.addon.portalkit.ivydata.utils.ServiceUtilities;

in.selectedAbsenceUser = new UserDTO(ivy.session.getSessionUser());
in.substituteUser = new UserDTO(ivy.session.getSessionUser());' #txt
As0 f102 security system #txt
As0 f102 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set current user</name>
    </language>
</elementInfo>
' #txt
As0 f102 236 218 112 44 -43 -8 #rect
As0 f102 @|StepIcon #fIcon
As0 f105 processCall 'Ivy Data Processes/SubstituteService:findSubstitutions(String)' #txt
As0 f105 requestActionDecl '<String username> param;' #txt
As0 f105 requestMappingAction 'param.username=ivy.session.getSessionUserName();
' #txt
As0 f105 responseMappingAction 'out=in;
out.substitutions=result.substitutes;
' #txt
As0 f105 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>find substitutions</name>
    </language>
</elementInfo>
' #txt
As0 f105 680 218 112 44 -47 -8 #rect
As0 f105 @|CallSubIcon #fIcon
As0 f115 processCall 'Ivy Data Processes/SubstituteService:findSubstitutes(String)' #txt
As0 f115 requestActionDecl '<String username> param;' #txt
As0 f115 requestMappingAction 'param.username=ivy.session.getSessionUserName();
' #txt
As0 f115 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f115 responseMappingAction 'out=in;
out.substitutes=result.substitutes;
' #txt
As0 f115 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>find substitutes</name>
    </language>
</elementInfo>
' #txt
As0 f115 472 218 112 44 -42 -8 #rect
As0 f115 @|CallSubIcon #fIcon
As0 f117 907 227 26 26 0 12 #rect
As0 f117 @|UdProcessEndIcon #fIcon
As0 f93 expr out #txt
As0 f93 348 240 472 240 #arcP
As0 f93 0 0.7927141382389294 0 0 #arcLabel
As0 f53 guid 17022F2E50D23EEA #txt
As0 f53 method autoCompleteForUserOnApp(String) #txt
As0 f53 inParameterDecl '<String query> param;' #txt
As0 f53 inParameterMapAction 'out.queryAutoComplete=param.query;
' #txt
As0 f53 outParameterDecl '<java.util.List<ch.ivy.addon.portalkit.dto.UserDTO> users> result;' #txt
As0 f53 outParameterMapAction 'result.users=in.users;
' #txt
As0 f53 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>autoCompleteForUserOnApp(String)</name>
    </language>
</elementInfo>
' #txt
As0 f53 99 803 26 26 -82 22 #rect
As0 f53 @|UdMethodIcon #fIcon
As0 f22 404 144 472 144 #arcP
As0 f122 619 515 26 26 0 12 #rect
As0 f122 @|UdProcessEndIcon #fIcon
As0 f13 actionTable 'out=in;
' #txt
As0 f13 actionCode 'import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;
import java.util.Set;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;

String username = in.selectedUser.getName();

boolean doesNewAbsenceOverlap = AbsenceAndSubstituteUtils.doesNewAbsenceOverlap(in.absencesByUser.get(username) as Set, in.selectedAbsence);
if (doesNewAbsenceOverlap) {
	in.validationError = true;
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR,ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/overlappingAbsence"), ""));
	FacesContext.getCurrentInstance().validationFailed();
}
' #txt
As0 f13 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>validation overlap</name>
    </language>
</elementInfo>
' #txt
As0 f13 448 506 112 44 -47 -8 #rect
As0 f13 @|StepIcon #fIcon
As0 f134 560 528 619 528 #arcP
As0 f147 processCall 'Ivy Data Processes/AbsenceService:findAbsences(String)' #txt
As0 f147 requestActionDecl '<String username> param;' #txt
As0 f147 requestMappingAction 'param.username=in.selectedAbsence.getUsername();
' #txt
As0 f147 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f147 responseMappingAction 'out=in;
out.absencesByUser=result.absencesByUser;
' #txt
As0 f147 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Find current &#xD;
user''s absences</name>
    </language>
</elementInfo>
' #txt
As0 f147 440 1090 112 44 -46 -20 #rect
As0 f147 @|CallSubIcon #fIcon
As0 f148 expr out #txt
As0 f148 400 1112 440 1112 #arcP
As0 f149 552 1112 628 1112 #arcP
As0 f45 processCall 'Ivy Data Processes/SecurityService:findUsers(String,Integer,Integer,java.util.List<String>,java.util.List<String>)' #txt
As0 f45 requestActionDecl '<String query,Integer startIndex,Integer count,java.util.List<String> fromRoles,java.util.List<String> excludedUsernames> param;' #txt
As0 f45 requestMappingAction 'param.query=in.queryAutoComplete;
param.startIndex=0;
param.count=ch.ivy.addon.portalkit.constant.PortalConstants.MAX_USERS_IN_AUTOCOMPLETE;
' #txt
As0 f45 responseMappingAction 'out=in;
out.users=result.users;
' #txt
As0 f45 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Ivy Data Processes/SecurityService</name>
    </language>
</elementInfo>
' #txt
As0 f45 224 794 192 44 -93 -8 #rect
As0 f45 @|CallSubIcon #fIcon
As0 f46 125 816 224 816 #arcP
As0 f48 processCall 'Ivy Data Processes/SecurityService:findUsers(String,Integer,Integer,java.util.List<String>,java.util.List<String>)' #txt
As0 f48 requestActionDecl '<String query,Integer startIndex,Integer count,java.util.List<String> fromRoles,java.util.List<String> excludedUsernames> param;' #txt
As0 f48 requestMappingAction 'param.query=in.queryAutoComplete;
param.startIndex=0;
param.count=ch.ivy.addon.portalkit.constant.PortalConstants.MAX_USERS_IN_AUTOCOMPLETE;
' #txt
As0 f48 responseMappingAction 'out=in;
out.users=result.users;
' #txt
As0 f48 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>find Users</name>
    </language>
</elementInfo>
' #txt
As0 f48 264 890 112 44 -28 -8 #rect
As0 f48 @|CallSubIcon #fIcon
As0 f40 expr out #txt
As0 f40 376 528 448 528 #arcP
As0 f52 guid 17066C1514DB8CC7 #txt
As0 f52 method saveAbsence() #txt
As0 f52 inParameterDecl '<> param;' #txt
As0 f52 outParameterDecl '<> result;' #txt
As0 f52 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>saveAbsence()</name>
    </language>
</elementInfo>
' #txt
As0 f52 99 1187 26 26 -25 15 #rect
As0 f52 @|UdMethodIcon #fIcon
As0 f98 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>is create absence?</name>
    </language>
</elementInfo>
' #txt
As0 f98 208 1184 32 32 0 16 #rect
As0 f98 @|AlternativeIcon #fIcon
As0 f99 125 1200 208 1200 #arcP
As0 f106 expr in #txt
As0 f106 outCond in.isCreateMode #txt
As0 f106 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
    </language>
</elementInfo>
' #txt
As0 f106 233 1193 328 1134 #arcP
As0 f107 expr in #txt
As0 f107 232 1208 312 1274 #arcP
As0 f118 1280 1112 1379 1112 #arcP
As0 f118 0 0.48063036947240817 0 -11 #arcLabel
As0 f121 actionTable 'out=in;
' #txt
As0 f121 actionCode 'import java.util.Set;

Set<IvyAbsence> absencesFromUser = in.absencesByUser.get(in.selectedUser.getName()) as Set;
absencesFromUser.add(in.selectedAbsence);

' #txt
As0 f121 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>update data</name>
    </language>
</elementInfo>
' #txt
As0 f121 568 1274 112 44 -32 -8 #rect
As0 f121 @|StepIcon #fIcon
As0 f119 680 1296 803 1296 #arcP
As0 f151 expr out #txt
As0 f151 125 720 264 720 #arcP
As0 f28 125 240 236 240 #arcP
As0 f26 800 144 907 144 #arcP
As0 f24 376 720 515 720 #arcP
As0 f25 expr out #txt
As0 f25 584 240 680 240 #arcP
As0 f21 792 240 907 240 #arcP
As0 f16 expr out #txt
As0 f16 376 432 448 432 #arcP
As0 f8 515 803 26 26 0 12 #rect
As0 f8 @|UdProcessEndIcon #fIcon
As0 f10 416 816 515 816 #arcP
As0 f19 515 899 26 26 0 12 #rect
As0 f19 @|UdProcessEndIcon #fIcon
As0 f29 376 912 515 912 #arcP
As0 f3 368 1296 568 1296 #arcP
As0 f1 1016 1112 1168 1112 #arcP
As0 f2 416 1008 515 1008 #arcP
As0 f4 125 1008 224 1008 #arcP
As0 f17 guid 173C86858C2FE272 #txt
As0 f17 method autoCompleteForSubstituteOnApp(String) #txt
As0 f17 inParameterDecl '<String query> param;' #txt
As0 f17 inParameterMapAction 'out.queryAutoComplete=param.query;
' #txt
As0 f17 outParameterDecl '<java.util.List<ch.ivy.addon.portalkit.dto.UserDTO> users> result;' #txt
As0 f17 outActionCode 'import ch.ivy.addon.portalkit.dto.UserDTO;
import ch.ivy.addon.portalkit.util.UserUtils;

result.users.add(0, null);

java.util.List<UserDTO> users = UserUtils.filterOut(in.users, in.substituteUser);
result.users.addAll(users);' #txt
As0 f17 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>autoCompleteForSubstituteOnApp(String)</name>
    </language>
</elementInfo>
' #txt
As0 f17 99 899 26 26 -114 15 #rect
As0 f17 @|UdMethodIcon #fIcon
As0 f33 125 912 264 912 #arcP
>Proto As0 .type ch.ivy.addon.portalkit.multiapp.settings.AbsenceManagement.AbsenceManagementData #txt
>Proto As0 .processKind HTML_DIALOG #txt
>Proto As0 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <desc>yes</desc>
    </language>
</elementInfo>
' #txt
>Proto As0 -8 -8 16 16 16 26 #rect
>Proto As0 '' #fIcon
As0 f0 mainOut f58 tail #connect
As0 f58 head f18 mainIn #connect
As0 f79 mainOut f143 tail #connect
As0 f143 head f142 mainIn #connect
As0 f11 mainOut f131 tail #connect
As0 f131 head f37 mainIn #connect
As0 f37 mainOut f132 tail #connect
As0 f132 head f130 mainIn #connect
As0 f12 mainOut f30 tail #connect
As0 f30 head f23 mainIn #connect
As0 f31 mainOut f14 tail #connect
As0 f14 head f5 mainIn #connect
As0 f5 mainOut f36 tail #connect
As0 f36 head f35 mainIn #connect
As0 f54 mainOut f56 tail #connect
As0 f56 head f55 mainIn #connect
As0 f55 mainOut f87 tail #connect
As0 f87 head f57 mainIn #connect
As0 f38 mainOut f63 tail #connect
As0 f63 head f39 mainIn #connect
As0 f6 mainOut f91 tail #connect
As0 f91 head f90 in #connect
As0 f90 out f128 tail #connect
As0 f128 head f7 mainIn #connect
As0 f9 mainOut f15 tail #connect
As0 f15 head f61 mainIn #connect
As0 f157 mainOut f84 tail #connect
As0 f84 head f90 in #connect
As0 f146 mainOut f78 tail #connect
As0 f78 head f152 mainIn #connect
As0 f138 mainOut f155 tail #connect
As0 f155 head f140 in #connect
As0 f153 head f139 mainIn #connect
As0 f139 mainOut f144 tail #connect
As0 f144 head f136 mainIn #connect
As0 f140 out f158 tail #connect
As0 f158 head f129 mainIn #connect
As0 f140 out f153 tail #connect
As0 f102 mainOut f93 tail #connect
As0 f93 head f115 mainIn #connect
As0 f142 mainOut f22 tail #connect
As0 f22 head f146 mainIn #connect
As0 f13 mainOut f134 tail #connect
As0 f134 head f122 mainIn #connect
As0 f137 mainOut f148 tail #connect
As0 f148 head f147 mainIn #connect
As0 f147 mainOut f149 tail #connect
As0 f149 head f138 mainIn #connect
As0 f53 mainOut f46 tail #connect
As0 f46 head f45 mainIn #connect
As0 f7 mainOut f40 tail #connect
As0 f40 head f13 mainIn #connect
As0 f52 mainOut f99 tail #connect
As0 f99 head f98 in #connect
As0 f98 out f106 tail #connect
As0 f106 head f137 mainIn #connect
As0 f98 out f107 tail #connect
As0 f107 head f111 mainIn #connect
As0 f86 mainOut f118 tail #connect
As0 f118 head f150 mainIn #connect
As0 f121 mainOut f119 tail #connect
As0 f119 head f125 mainIn #connect
As0 f96 mainOut f151 tail #connect
As0 f151 head f101 mainIn #connect
As0 f27 mainOut f28 tail #connect
As0 f28 head f102 mainIn #connect
As0 f152 mainOut f26 tail #connect
As0 f26 head f80 mainIn #connect
As0 f101 mainOut f24 tail #connect
As0 f24 head f100 mainIn #connect
As0 f115 mainOut f25 tail #connect
As0 f25 head f105 mainIn #connect
As0 f105 mainOut f21 tail #connect
As0 f21 head f117 mainIn #connect
As0 f39 mainOut f16 tail #connect
As0 f16 head f9 mainIn #connect
As0 f45 mainOut f10 tail #connect
As0 f10 head f8 mainIn #connect
As0 f48 mainOut f29 tail #connect
As0 f29 head f19 mainIn #connect
As0 f111 mainOut f3 tail #connect
As0 f3 head f121 mainIn #connect
As0 f129 mainOut f1 tail #connect
As0 f1 head f86 mainIn #connect
As0 f62 mainOut f2 tail #connect
As0 f2 head f59 mainIn #connect
As0 f81 mainOut f4 tail #connect
As0 f4 head f62 mainIn #connect
As0 f17 mainOut f33 tail #connect
As0 f33 head f48 mainIn #connect
