<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
<cc:interface componentType="IvyComponent">
</cc:interface>

<cc:implementation>
  <f:event listener="#{logic.findAbsences()}" type="preRenderComponent" />
  <!-- fields needs to be inside a h:form tag (which is normaly added by the outer page) -->
  <!-- MY ABSENCE -->
  <p:fieldset legend="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AbsenceManagement/myPlannedAbsences')}">
    <div class="ui-g-12 TexAlRight u-padding-0">
      <p:commandButton value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/addAbsence')}" 
        id="add-absence" process="@this" oncomplete="PF('addAbsence').show()" actionListener="#{logic.add}"
        update="@widgetVar(addAbsence)" rendered="#{absenceManagementBean.ownAbsencesCreatable}"/>
    </div>

    <div class="ui-g-12 u-padding-0 MarTop5">
      <p:dataTable id="absence-table" emptyMessage="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/noRecordsFound')}"
        scrollable="true" scrollHeight="240" reflow="true" value="#{data.displayedAbsences}" var="absence" sortBy="#{absence.from}">
        <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AbsenceManagement/absenceName')}" sortBy="#{absence.fullname}">
          <h:outputText value="#{absenceManagementBean.getDisplayedName(absence)}" />
        </p:column>
        <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/period')}" sortBy="#{absence.period}">
          <h:outputText value="#{absence.period}" />
        </p:column>
        <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/comment')}" sortBy="#{absence.comment}">
          <h:outputText value="#{absence.comment}" />
        </p:column>
        <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/action')}">
          <p:commandLink id="edit-absence" process="absence-table"
            styleClass="absences-table-action-column-icon-button" actionListener="#{logic.editAbsence(absence)}"
            oncomplete="PF('editAbsenceDialog').show()" update="@widgetVar(editAbsenceDialog)"
            title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/edit')}"
            rendered="#{absenceManagementBean.isAbsenceEditable(absence) }">
            <span class="fa fa-pencil" />
          </p:commandLink>
          <p:commandLink id="delete-absence" process="@this" actionListener="#{logic.preDelete(absence)}"
            oncomplete="PF('deleteAbsenceConfirmation').show();"
            styleClass="absences-table-action-column-icon-button"
            rendered="#{absenceManagementBean.isAbsenceDeletable(absence)}"
            title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/delete')}">
            <span class="fa fa-trash-o" />
          </p:commandLink>
          
        </p:column>
      </p:dataTable>
    </div>
  </p:fieldset>

  <p:fieldset legend="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AbsenceManagement/myDeputies')}">
  </p:fieldset>
  <p:fieldset legend="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AbsenceManagement/deputyFor')}">
  </p:fieldset>

  <p:confirmDialog id="delete-absence-confirmation-dialog" styleClass="delete-absence-confirmation-dialog"
    message="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/confirmForDelete')}" appendTo="@(body)"
    header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/confirmation')}" severity="alert"
    widgetVar="deleteAbsenceConfirmation" rendered="#{absenceManagementBean.ownAbsencesDeletable}">
    <p:commandButton process="@this" id="confirm-action" styleClass="confirm-action"
      value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/ok')}" actionListener="#{logic.deleteAbsence}"
      oncomplete="PF('deleteAbsenceConfirmation').hide();" update=":#{p:component('absence-table')}" />
    <p:commandButton id="cancel-confirmation-action" styleClass="portal-cancel-button"
      value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
      onclick="PF('deleteAbsenceConfirmation').hide()" type="button" />
  </p:confirmDialog>
  <c:if test="#{absenceManagementBean.ownAbsencesCreatable}">
    <ui:include src="AddAbsenceDialog.xhtml" />
    <ui:include src="EditAbsenceDialog.xhtml" />
  </c:if>
</cc:implementation>
</html>