<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:cc="http://xmlns.jcp.org/jsf/composite"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="dialogName" shortDescription="Name of setting dialog's widget that contains this component" />
</cc:interface>

<cc:implementation>
  <f:event listener="#{logic.findEmailSettings()}" type="preRenderComponent" />

  <div id="#{cc.clientId}">

    <h:panelGrid>
      <p:growl id="change-email-setting-info" showDetail="true" sticky="false" life="400" severity="info"
        widgetVar="growl" escape="false" />
    </h:panelGrid>
    <p:remoteCommand name="updateGrowlEmail" actionListener="#{logic.updateGrowl}" update="change-email-setting-info" />

    <h:panelGroup layout="block" id="email-setting-container" styleClass="email-setting-container">
      <p:messages showDetail="true" closable="true" id="email-messages" escape="false" />
      <h:panelGrid>

        <h:panelGrid columns="2" rendered="#{emailSettingBean.countApplication() gt 1}">
          <!--  SETTING -->
          <p:fieldset legend="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/setting')}">
            <p:selectOneRadio id="select-setting-options" value="#{data.settingForAllApp}" layout="pageDirection" 
              columns="1">
              <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/forAllApplications')}"
                itemValue="#{true}" />
              <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/forEachApp')}"
                itemValue="#{false}" />
              <p:ajax event="change" listener="#{logic.settingChange}"
                update=":#{p:component('email-setting-container')}"
                oncomplete="PF('#{cc.attributes.dialogName}').initPosition();" />
            </p:selectOneRadio>
          </p:fieldset>
        </h:panelGrid>
        
        <p:panel id="all-applications-email-setting"
          header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/forAllApplications')}"
          rendered="#{data.settingForAllApp}">
          <h:panelGrid columns="2">
            <!-- MAIL NOTIFICATION ON TASK ASSIGNMENT -->
            <p:outputLabel id="mail-notification-on-task-assign-text"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/mailNotificationOnTaskAssign')}"
              for="mail-notification-on-task-assign" rendered="#{data.settingForAllApp}" />
            <p:selectOneMenu id="mail-notification-on-task-assign" value="#{data.generalEmailSetting.emailSendOnNewWorkTasks}"
              rendered="#{data.settingForAllApp}" appendTo="@this">
              <f:selectItem id="enable-mail-notification"
                itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/active')}" itemValue="true" />
              <f:selectItem id="disable-mail-notification"
                itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/inactive')}" itemValue="false" />
            </p:selectOneMenu>

            <!--  DAILY SUMMARY -->
            <p:outputLabel id="daily-summary-text"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/dailySummary')}" for="daily-summary"
              rendered="#{data.settingForAllApp}" />
            <p:selectManyCheckbox id="daily-summary" value="#{data.generalEmailSetting.emailSendDailyTaskSummary}" rendered="#{data.settingForAllApp}">
              <f:selectItems value="#{data.dailySummaryList}" var="day" itemLabel="#{day.getLocalizedName(ivy.session.getContentLocale())}" itemValue="#{day}" />
            </p:selectManyCheckbox>

            <!-- FURTHER MAILS FROM APPLICATION -->
            <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/furtherEmailFromApp')}"
              for="further-mails-from-application" rendered="#{data.settingForAllApp}" />
            <p:selectOneMenu id="further-mails-from-application" value="#{data.generalEmailSetting.customMailEnabled}"
              rendered="#{data.settingForAllApp}" appendTo="@this">
              <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/active')}" itemValue="true" />
              <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/inactive')}"
                itemValue="false" />
            </p:selectOneMenu>
          </h:panelGrid>
        </p:panel>
        <!--  SETTING FOR DYNAMIC APPLICATIONS -->

        <h:panelGrid id="application-email-setting" columns="1" rendered="#{!data.settingForAllApp}">
          <ui:repeat value="#{data.emailSettings}" var="appSetting" step="1">
            <p:panel header="#{appSetting.appDisplayName}" id="application-name">
              <h:panelGrid columns="2">
                <!-- MAIL NOTIFICATION ON TASK ASSIGNMENT -->
                <p:outputLabel
                  value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/mailNotificationOnTaskAssign')}"
                  for="mail-notification-on-task-assign" />
                <p:selectOneMenu id="mail-notification-on-task-assign" value="#{appSetting.emailSendOnNewWorkTasks}"
                  appendTo="@this">
                  <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/active')}"
                    itemValue="#{true}" />
                  <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/inactive')}"
                    itemValue="#{false}" />
                </p:selectOneMenu>

                <!--  DAILY SUMMARY -->
                <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/dailySummary')}"
                  for="daily-summary" />
                <p:selectManyCheckbox id="daily-summary" value="#{appSetting.emailSendDailyTaskSummary}">
                  <f:selectItems value="#{data.dailySummaryList}" var="day" itemLabel="#{day.getLocalizedName(ivy.session.getContentLocale())}" itemValue="#{day}" />
                </p:selectManyCheckbox>

                <!-- FURTHER MAILS FROM APPLICATION -->
                <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/furtherEmailFromApp')}"
                  for="further-mails-from-application" />
                <p:selectOneMenu id="further-mails-from-application" value="#{appSetting.customMailEnabled}"
                  appendTo="@this">
                  <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/active')}"
                    itemValue="#{true}" />
                  <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/inactive')}"
                    itemValue="#{false}" />
                </p:selectOneMenu>
              </h:panelGrid>
            </p:panel>
            <br />
          </ui:repeat>
        </h:panelGrid>
      </h:panelGrid>
    </h:panelGroup>

    <h:panelGroup layout="block" styleClass="ui-dialog-footer u-dialog-footer u-email-dialog-footer">
      <p:commandButton id="save-settings"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}" actionListener="#{logic.saveEmailSettings}"
        update="email-messages" 
        oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('#{cc.attrs.dialogName}').hide();updateGrowlEmail();}" />
      <p:spacer width="5px" />
      <p:commandButton id="cancel-settings" type="button"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" 
        onclick="PF('#{cc.attrs.dialogName}').hide();" styleClass="portal-cancel-button" />
    </h:panelGroup>
  </div>
</cc:implementation>

</html>
