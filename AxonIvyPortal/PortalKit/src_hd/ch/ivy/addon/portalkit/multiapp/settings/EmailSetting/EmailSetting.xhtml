<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:cc="http://xmlns.jcp.org/jsf/composite"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="dialogName" shortDescription="Name of setting dialog's widget that contains this component" />
</cc:interface>

<cc:implementation>
  <f:event listener="#{logic.findEmailSettings()}" type="preRenderComponent" />

  <div id="#{cc.clientId}" class="email-setting-component">

    <h:panelGrid>
      <p:growl id="change-email-setting-info" showDetail="true" sticky="false" life="400" severity="info"
        widgetVar="growl" escape="false" />
    </h:panelGrid>
    <p:remoteCommand name="updateGrowlEmail" actionListener="#{logic.updateGrowl}" update="change-email-setting-info" />

    <h:panelGroup layout="block" id="email-setting-container" styleClass="email-setting-container">
      <p:messages showDetail="true" closable="true" id="email-messages" escape="false" />
      <h:panelGrid styleClass="ui-g-12 u-padding-0">

        <h:panelGrid rendered="#{emailSettingBean.countApplication() gt 1}" styleClass="ui-g-12 u-padding-0">
          <!--  SETTING -->
          <p:fieldset legend="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/setting')}" styleClass="ui-g-6 ui-md-12 ui-sm-12 field-select-setting-options">
            <p:selectOneRadio id="select-setting-options" value="#{data.settingForAllApp}" layout="pageDirection" 
              columns="1">
              <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/forAllApplications')}"
                itemValue="#{true}" />
              <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/forEachApp')}"
                itemValue="#{false}" />
              <p:ajax event="change" listener="#{logic.settingChange}"
                update=":#{p:component('email-setting-container')}"
                oncomplete="PF('#{cc.attributes.dialogName}').initPosition();" />
            </p:selectOneRadio>
          </p:fieldset>
        </h:panelGrid>

        <p:panel id="all-applications-email-setting" header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/forAllApplications')}"
          styleClass="application-email-setting ui-g-12 u-padding-0 application-email-setting-container" rendered="#{data.settingForAllApp}">
          <h:panelGrid id="multi-application-email-setting" columns="2" rowClasses="application-email-setting-row" styleClass="application-email-setting-row">
            <!-- MAIL NOTIFICATION ON TASK ASSIGNMENT -->
            <p:outputLabel id="mail-notification-on-task-assign-text" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/mailNotificationOnTaskAssign')}"
              for="mail-notification-on-task-assign" rendered="#{data.settingForAllApp}" />
            <p:inputSwitch id="mail-notification-on-task-assign" value="#{data.generalEmailSetting.emailSendOnNewWorkTasks}" rendered="#{data.settingForAllApp}" />

            <!-- FURTHER MAILS FROM APPLICATION -->
            <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/furtherEmailFromApp')}" for="further-mails-from-application"
              rendered="#{data.settingForAllApp}" />
            <p:inputSwitch id="further-mails-from-application" value="#{data.generalEmailSetting.customMailEnabled}" rendered="#{data.settingForAllApp}" />

            <!--  DAILY SUMMARY -->
            <p:outputLabel id="daily-summary-text" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/dailySummary')}" for="daily-summary"
              rendered="#{data.settingForAllApp}" />
            <p:inputSwitch id="daily-summary" value="#{data.enableDailySummary}" rendered="#{data.settingForAllApp}">
              <p:ajax event="change" update="multi-app-daily-summary-checkbox-selection-container" oncomplete="changeWidthDailySummaryPanel()"/>
            </p:inputSwitch>
          </h:panelGrid>

          <h:panelGroup id="multi-app-daily-summary-checkbox-selection-container" layout="block">
            <p:selectCheckboxMenu id="multi-app-daily-summary" value="#{data.generalEmailSetting.emailSendDailyTaskSummary}" 
              onShow="changeWidthDailySummaryPanel();" onHide="updateMultiAppDailySummaryMail();" 
              rendered="#{data.enableDailySummary}" 
              label="#{empty data.generalEmailSetting.emailSendDailyTaskSummary ? ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/day'):ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/selectedDay',[data.generalEmailSetting.emailSendDailyTaskSummary.size()])}"
              styleClass="daily-summary-checkbox">
              <f:selectItems value="#{data.dailySummaryList}" var="day" itemLabel="#{day.getLocalizedName(ivy.session.getContentLocale())}" itemValue="#{day}" />
            </p:selectCheckboxMenu>
            <p:remoteCommand name="updateMultiAppDailySummaryMail" update="multi-app-daily-summary-checkbox-selection-container" global="false" />
          </h:panelGroup>

        </p:panel>
        <!--  SETTING FOR DYNAMIC APPLICATIONS -->

        <h:panelGrid id="application-email-setting" columns="1" rendered="#{!data.settingForAllApp}" styleClass="ui-g-12 u-padding-0 application-email-setting-container">
          <ui:repeat value="#{data.emailSettings}" var="appSetting" step="1">
            <p:panel header="#{appSetting.appDisplayName}" id="application-name" styleClass="application-email-setting">
              <h:panelGrid columns="2" rowClasses="application-email-setting-row" styleClass="application-email-setting-row">
                <!-- MAIL NOTIFICATION ON TASK ASSIGNMENT -->
                <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/mailNotificationOnTaskAssign')}" for="mail-notification-on-task-assign" />
                <p:inputSwitch id="mail-notification-on-task-assign" value="#{appSetting.emailSendOnNewWorkTasks}" />

                <!-- FURTHER MAILS FROM APPLICATION -->
                <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/furtherEmailFromApp')}" for="further-mails-from-application" />
                <p:inputSwitch id="further-mails-from-application" value="#{appSetting.customMailEnabled}" />

                <!--  DAILY SUMMARY -->
                <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/dailySummary')}" for="daily-summary" />
                <p:inputSwitch id="daily-summary" value="#{appSetting.enableDailySummary}">
                   <p:ajax event="change" update="daily-summary-checkbox-selection-container" listener="#{logic.updateDailyList}" oncomplete="changeWidthDailySummaryPanel()"/>
                </p:inputSwitch>
              </h:panelGrid>

              <h:panelGroup id="daily-summary-checkbox-selection-container" layout="block">
                <p:selectCheckboxMenu id="daily-summary-checkbox" value="#{appSetting.emailSendDailyTaskSummary}" 
                  onShow="changeWidthDailySummaryPanel();" onHide="updateDailySummaryMail();" 
                  label="#{empty appSetting.emailSendDailyTaskSummary ? ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/day'):ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/selectedDay', [appSetting.emailSendDailyTaskSummary.size()])}"
                  styleClass="daily-summary-checkbox" rendered="#{appSetting.enableDailySummary}" panelStyleClass="width:100%">
                  <f:selectItems value="#{data.dailySummaryList}"  var="day" itemLabel="#{day.getLocalizedName(ivy.session.getContentLocale())}" itemValue="#{day}"/>
                </p:selectCheckboxMenu>
                <p:remoteCommand name="updateDailySummaryMail" update="daily-summary-checkbox-selection-container" global="false" />
              </h:panelGroup>
            </p:panel>
            <br />
          </ui:repeat>
        </h:panelGrid>
      </h:panelGrid>
    </h:panelGroup>
  </div>
      <h:panelGroup layout="block" styleClass="ui-dialog-footer u-dialog-footer u-email-dialog-footer email-dialog-footer">
      <p:commandButton id="save-settings"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}" actionListener="#{logic.saveEmailSettings}"
        update="email-messages" 
        oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('#{cc.attrs.dialogName}').hide();updateGrowlEmail();}" />
      <p:spacer width="5px" />
      <p:commandButton id="cancel-settings" type="button"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" 
        onclick="PF('#{cc.attrs.dialogName}').hide();" styleClass="portal-cancel-button" />
    </h:panelGroup>
</cc:implementation>

</html>
