<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:pm="http://primefaces.org/mobile"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:jsf="http://xmlns.jcp.org/jsf"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="statisticChartList" required="true" />
</cc:interface>

<cc:implementation>
  <h:form id="chart-management-form">

    <p:remoteCommand id="init-filter-command" name="initFilter" autoRun="true"
      update="statistic-filter" global="false"
      action="#{statisticChartCreationBean.updateFilters(data.statisticFilter, data.oldStatisticFilter)}"
      oncomplete="updateChartModels();" />

    <p:remoteCommand id="update-chart-models-command" name="updateChartModels" update= "chart-list" global="false"
      oncomplete="updateTaskByPriorityModel(); updateCaseByStateModel(); updateTaskByExpiryModel(); updateElapsedTimeByCaseCategory(); updateCaseByFinishedTaskModel(); updateCaseByFinishedTimeModel();" />
    <p:remoteCommand id="clear-chart-models-command" name="clearChartModels" update="chart-list" global="false"
      action="#{statisticChartCreationBean.clearChartModels()}" />
    <p:remoteCommand id="update-task-by-priority-model-command" name="updateTaskByPriorityModel"
      action="#{statisticChartCreationBean.updateTaskByPriorityModel(data.statisticFilter)}"
      update="edit-statistic-container" global="false" />
    <p:remoteCommand id="update-case-by-state-model-command" name="updateCaseByStateModel"
      action="#{statisticChartCreationBean.updateCaseByStateModel(data.statisticFilter)}"
      update="edit-statistic-container" global="false" />
    <p:remoteCommand id="update-task-by-expiry-model-command" name="updateTaskByExpiryModel"
      action="#{statisticChartCreationBean.updateTaskByExpiryModel(data.statisticFilter)}"
      update="edit-statistic-container" global="false" />
    <p:remoteCommand id="update-elapsed-time-by-case-category-command" name="updateElapsedTimeByCaseCategory"
      action="#{statisticChartCreationBean.updateElapsedTimeByCaseCategory(data.statisticFilter)}"
      update="edit-statistic-container" global="false" />
    <p:remoteCommand id="update-case-by-finished-task-model-command" name="updateCaseByFinishedTaskModel"
      action="#{statisticChartCreationBean.updateCaseByFinishedTaskModel(data.statisticFilter)}"
      update="edit-statistic-container" global="false" />
    <p:remoteCommand id="update-case-by-finished-time-model-command" name="updateCaseByFinishedTimeModel"
      action="#{statisticChartCreationBean.updateCaseByFinishedTimeModel(data.statisticFilter)}"
      update="edit-statistic-container" global="false" />

    <p:growl autoUpdate="true" globalOnly="true" showDetail="true" showSummary="true" />
    <h:panelGrid id="edit-statistic-container" columns="2" styleClass="edit-statistic-container">
      <h:panelGroup id="chart-list" layout="block" styleClass="chart-list">
        <c:set var="taskByPriorityModel" value="#{statisticChartCreationBean.taskByPriorityModel}" />
        <h:panelGroup id="task-by-priority-chart" layout="block" styleClass="chart-container" rendered="#{taskByPriorityModel ne null}">
          <p:outputLabel id="task-by-priority-label" styleClass="label"
           value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chartType/taskByPriority')}" />
          <p:commandLink id="create-task-by-priority-link" styleClass="add-link fa fa-plus-circle" global="false"
            value=" #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/taskByPriority/addToDashboardLink')}">
            <p:ajax event="click" update="add-chart-dialog" resetValues="true" global="false"
              listener="#{logic.updateBeforeAddTaskByPriority}" oncomplete="PF('add-chart-dialog').show();" />
          </p:commandLink>
          <p:chart type="donut" model="#{taskByPriorityModel}" styleClass="statistic-chart" />
        </h:panelGroup>

        <c:set var="caseByStateModel" value="#{statisticChartCreationBean.caseByStateModel}" />
        <h:panelGroup id="case-by-state-chart" layout="block" styleClass="chart-container" rendered="#{caseByStateModel ne null}">
          <p:outputLabel id="case-by-state-label" styleClass="label"
            value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chartType/caseByState')}" />
          <p:commandLink id="create-case-by-state-link" styleClass="add-link fa fa-plus-circle" global="false"
            value=" #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/taskByPriority/addToDashboardLink')}">
            <p:ajax event="click" update="add-chart-dialog" resetValues="true" global="false"
              listener="#{logic.updateBeforeAddCaseByState}" oncomplete="PF('add-chart-dialog').show();" />
          </p:commandLink>
          <p:chart type="donut" model="#{caseByStateModel}" styleClass="statistic-chart" />
        </h:panelGroup>

        <c:set var="taskByExpiryModel" value="#{statisticChartCreationBean.taskByExpiryModel}" />
        <h:panelGroup id="task-by-expiry-chart" layout="block" styleClass="chart-container" rendered="#{taskByExpiryModel ne null}">
          <p:outputLabel id="task-by-expiry-label" styleClass="label"
            value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chartType/taskByExpiry')}" />
          <p:commandLink id="create-task-by-expiry-link" styleClass="add-link fa fa-plus-circle" global="false"
            value=" #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/taskByPriority/addToDashboardLink')}">
            <p:ajax event="click" update="add-chart-dialog" resetValues="true" global="false"
              listener="#{logic.updateBeforeAddTaskByExpiry}" oncomplete="PF('add-chart-dialog').show();" />
          </p:commandLink>
          <p:chart type="bar" model="#{taskByExpiryModel}" styleClass="statistic-chart" />
        </h:panelGroup>

        <c:set var="elapsedTimeModel" value="#{statisticChartCreationBean.elapsedTimeModel}" />
        <h:panelGroup id="elapsed-time-by-case-category" layout="block" styleClass="chart-container" rendered="#{elapsedTimeModel ne null}">
          <p:outputLabel id="elapsed-time-by-case-category-label" styleClass="label"
            value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chartType/elapsedTimeByCaseCategory')}" />
          <p:commandLink id="create-elapsed-time-link" styleClass="add-link fa fa-plus-circle" global="false"
            value=" #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/taskByPriority/addToDashboardLink')}">
            <p:ajax event="click" update="add-chart-dialog" resetValues="true" global="false"
              listener="#{logic.updateBeforeAddElapsedTime}" oncomplete="PF('add-chart-dialog').show();" />
          </p:commandLink>
          <p:chart type="donut" model="#{elapsedTimeModel}" styleClass="statistic-chart" />
        </h:panelGroup>

        <c:set var="caseByFinishedTaskModel" value="#{statisticChartCreationBean.caseByFinishedTaskModel}" />
        <h:panelGroup id="case-by-finished-task-chart" layout="block" styleClass="chart-container" rendered="#{caseByFinishedTaskModel ne null}">
          <p:outputLabel id="case-by-finished-task-label" styleClass="label"
            value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chartType/caseByFinishedTask')}" />
          <p:commandLink id="create-case-by-finished-task-link" styleClass="add-link fa fa-plus-circle" global="false"
            value=" #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/taskByPriority/addToDashboardLink')}">
            <p:ajax event="click" update="add-chart-dialog" resetValues="true" global="false"
              listener="#{logic.updateBeforeAddCaseByFinishedTask}" oncomplete="PF('add-chart-dialog').show();" />
          </p:commandLink>
          <p:chart type="donut" model="#{caseByFinishedTaskModel}" styleClass="statistic-chart" />
        </h:panelGroup>

        <c:set var="caseByFinishedTimeModel" value="#{statisticChartCreationBean.caseByFinishedTimeModel}" />
        <h:panelGroup id="case-by-finished-time-chart" layout="block" styleClass="chart-container" rendered="#{caseByFinishedTimeModel ne null}">
          <p:outputLabel id="case-by-finished-time-label" styleClass="label"
            value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chartType/caseByFinishedTime')}" />
          <p:commandLink id="create-case-by-finished-time-link" styleClass="add-link fa fa-plus-circle" global="false"
            value=" #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/taskByPriority/addToDashboardLink')}">
            <p:ajax event="click" update="add-chart-dialog" resetValues="true" global="false"
              listener="#{logic.updateBeforeAddCaseByFinishedTime}" oncomplete="PF('add-chart-dialog').show();" />
          </p:commandLink>
          <p:chart type="donut" model="#{caseByFinishedTimeModel}" styleClass="statistic-chart" />
        </h:panelGroup>
      </h:panelGroup>

      <h:panelGroup layout="block" styleClass="filter-container">
        <ic:ch.ivy.addon.portalkit.component.statistic.StatisticFilters id="statistic-filter"
          filter="#{data.statisticFilter}" updateListener="#{statisticChartCreationBean.updateFilters(data.statisticFilter, data.oldStatisticFilter)}" />
      </h:panelGroup>
    </h:panelGrid>

    <p:dialog id="add-chart-dialog" widgetVar="add-chart-dialog" styleClass="add-chart-dialog"
      header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/addChartDialogHeader')}"
      modal="true" closeOnEscape="true" width="auto" resizable="false">
      <c:if test="#{data == null or data.isAllowedToCreateChart}">
          <p:messages autoUpdate="true" for="chart-name-input" />
          <h:form id="add-statistic-form">
            <h:panelGrid columns="2" styleClass="add-statistic-panel" columnClasses="add-statistic-panel-column-1, add-statistic-panel-column-2 ">
              <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/name')}" for="chart-name-input" />
              <p:inputText id="chart-name-input" value="#{data.chartName}" required="true" />
            </h:panelGrid>
            <h:panelGroup layout="block" class="u-dialog-footer ui-dialog-footer">
              <p:commandButton id="chart-save-command" styleClass="" 
                value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/ok')}"
                process="chart-name-input" update="chart-name-input"
                actionListener="#{logic.createStatisticChart(cc.attrs.statisticChartList)}"
                oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('add-chart-dialog').hide();}"/>
              <p:spacer width="5px" />
              <p:commandButton type="button" styleClass="portal-cancel-button"
                value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}">
                <p:ajax event="click" global="false" update="chart-name-input" listener="#{logic.clearChartInput}" oncomplete="PF('add-chart-dialog').hide();" />
              </p:commandButton>
            </h:panelGroup>
          </h:form>
      </c:if>
      <c:if test="#{data != null and !data.isAllowedToCreateChart}">
          <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/notAllowedToCreateChart')}" />
          <h:panelGroup layout="block" class="u-dialog-footer ui-dialog-footer">
            <p:commandButton type="button"
                value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/ok')}" onclick="PF('add-chart-dialog').hide();" />
          </h:panelGroup>
      </c:if>
    </p:dialog>
  </h:form>
</cc:implementation>
</html>