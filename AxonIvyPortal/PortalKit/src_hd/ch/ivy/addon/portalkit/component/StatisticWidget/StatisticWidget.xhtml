<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:jsf="http://xmlns.jcp.org/jsf"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="compactMode" default="true" type="java.lang.Boolean" />
  <cc:attribute name="statisticChartList" required="true" />
  <cc:attribute name="showTaskListImmediately" default="false" />
</cc:interface>

<cc:implementation>
  <h:outputScript library="js" name="statistic-widget.js" />
  <h:outputScript library="chartjs-plugin" name="chartjs-plugin-datalabels.min.js"/>

  <f:event listener="#{logic.setCompactMode(cc.attrs.compactMode)}" type="preRenderComponent" />
  <div id="#{cc.clientId}" class="widget statistic-widget-container #{!cc.attrs.compactMode ? '':'statistic-widget-compact-mode-container'}">
    <h:panelGroup id="header" layout="block" styleClass="widget-header">
      <div class="widget-header-main #{data.createMode ? 'creation-mode':''}">
        <h:outputText styleClass="widget-header-main-title" 
          value="#{ivy.cms.co(!data.createMode ? '/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/statistics' : '/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/createNewStatistic')}" />
        <h:panelGroup id="statistic-widget-header" layout="block" rendered="#{data.isDisplayShowAllChartLink and cc.attrs.compactMode}"
          styleClass="widget-header-main-menu">
          <cc:renderFacet name="headerToolbar" />
        </h:panelGroup>
      </div>

      <h:panelGroup id="create-chart-header" layout="block" rendered="#{!cc.attrs.compactMode}"
        styleClass="statistic-actions-panel ui-g #{data.createMode ? 'creation-mode':''}">
        <h:panelGroup layout="block" rendered="#{!data.createMode}" styleClass="ui-g-12 u-padding-0">
          <p:commandLink id="create-chart-link" actionListener="#{logic.switchCreateMode}" update="widget-container create-chart-header header"
            rendered="#{!data.isDrilldownElapsedTime and !data.isDrilldownExpiryChart and data.canCreateNewCharts}" styleClass="u-hidden-md-down">
            <i class="fa fa-plus" />
            <p:spacer width="3px" />
            <h:outputText id="create-chart-link-label" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/addChart')}" />
            <p:spacer width="10px" />
          </p:commandLink>
          <p:commandLink id="restore-default-chart-link" onclick="PF('restore-confirmation-dialog').show();"
            rendered="#{!data.isDrilldownElapsedTime and !data.isDrilldownExpiryChart 
          and data.hasDefaultChart and data.canCreateNewCharts}">
            <i class="fa fa-refresh" />
            <p:spacer width="3px" />
            <h:outputText id="restore-default-chart-link-label"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/restoreDefaultChartHeader')}" />
          </p:commandLink>
          <p:commandLink id="back-from-drilldown-link" actionListener="#{logic.switchDrilldownMode}" rendered="#{data.isDrilldownElapsedTime}"
            update="#{p:component('widget-container')} create-chart-header">
            <i class="fa fa-reply-all" />
            <p:spacer width="3px" />
            <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/back')}" />
          </p:commandLink>
          <p:commandLink id="back-from-drilldown-expiry-chart-link" actionListener="#{logic.switchDrilldownExpiryChartMode}"
            rendered="#{data.isDrilldownExpiryChart}" update="#{p:component('widget-container')} create-chart-header">
            <i class="fa fa-reply-all" />
            <p:spacer width="3px" />
            <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/back')}" />
          </p:commandLink>
          <h:outputText rendered="#{data.canAnalyzeTask and !data.isDrilldownElapsedTime 
            and !data.isDrilldownExpiryChart and data.canCreateNewCharts}" styleClass="u-hidden-md-down">
          	<p:spacer width="10px" styleClass="u-hidden-md-down"/>
          	<h:outputText value="|" styleClass="u-hidden-md-down"/>
          	<p:spacer width="10px" styleClass="u-hidden-md-down"/>
          </h:outputText> 

          <p:commandLink id="task-analysis-page-navigation-link" actionListener="#{logic.navigateToTaskAnalysisPage}"
            rendered="#{data.canAnalyzeTask and !data.isDrilldownElapsedTime and !data.isDrilldownExpiryChart}" styleClass="task-analysis-page-navigation-link u-hidden-md-down">
            <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/taskAnalysis/taskAnalysis')}" />
          </p:commandLink>
        </h:panelGroup>
        <h:panelGroup layout="block" rendered="#{data.createMode}">
          <div class="ui-g-12 u-padding-0">
            <p:commandLink id="back-from-chart-creation" action="#{statisticChartCreationBean.clearChartModels()}"
              styleClass="back-button Fright" actionListener="#{logic.switchCreateMode}"
              update="create-chart-header header widget-container" global="false">
              <i class="fa fa-reply-all" />
              <p:spacer width="3px" />
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/back')}"/>
            </p:commandLink>
          </div>
        </h:panelGroup>
      </h:panelGroup>
    </h:panelGroup>

    <h:panelGroup id="widget-container" layout="block"
      styleClass="ui-g statistic-widget js-statistic-widget-container #{data.compactMode? 'compact-mode': ''}">

      <h:panelGroup id="statistic-dashboard-container" layout="block"
        styleClass="ui-g-12 u-padding-0 statistic-dashboard-container #{data.isDrilldownElapsedTime ? 'elapsed-time-detail-container-width' : 'statistic-dashboard-container-width'}"
        rendered="#{!data.createMode}">
        <ic:ch.ivy.addon.portalkit.component.statistic.StatisticDashboardWidget id="statistic-dashboard-widget"
          showTaskListImmediately="#{cc.attrs.showTaskListImmediately}" compactMode="#{data.compactMode}"
          statisticChartList="#{data.statisticChartList}" drilldownListener="#{logic.drilldownElapsedTimeListener}"
          drillDownExpiryChartListener="#{logic.drillDownExpiryListener()}" isDrilldownElapsedTime="#{data.isDrilldownElapsedTime}"
          isDrilldownExpiryChart="#{data.isDrilldownExpiryChart}" isBackFromDrilldown="#{data.isBackFromDrilldown}" />
      </h:panelGroup>

      <h:panelGroup id="chart-list-container" layout="block" styleClass="chart-list-container ui-g-12 u-padding-0"
        rendered="#{!data.compactMode and data.createMode}">
        <ic:ch.ivy.addon.portalkit.component.statistic.ChartCreationWidget id="chart-creation-widget" statisticChartList="#{data.statisticChartList}" />
      </h:panelGroup>

      <h:form rendered="#{!data.compactMode and data.createMode}">
        <p:remoteCommand id="reload-chart-list" name="reloadCharts" global="false" async="true" immediate="true"
          process="@this" partialSubmit="true" action="#{logic.reloadStatisticList()}" />
      </h:form>
    </h:panelGroup>
  </div>
  <p:confirmDialog id="restore-confirmation-dialog" message="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/restoreDefaultChart')}"
    header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/restoreDefaultChartHeader')}" widgetVar="restore-confirmation-dialog"
    appendTo="@(body)" severity="alert" rendered="#{!cc.attrs.compactMode}" responsive="true">
    <p:commandButton id="confirm-restore" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/yes')}" update="widget-container"
      oncomplete="PF('restore-confirmation-dialog').hide();" actionListener="#{logic.restoreDefault}" />
    <p:commandButton value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/no')}" onclick="PF('restore-confirmation-dialog').hide();"
      type="button" styleClass="portal-cancel-button" />
  </p:confirmDialog>


</cc:implementation>
</html>