<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:pm="http://primefaces.org/mobile"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:jsf="http://xmlns.jcp.org/jsf"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:fn="http://java.sun.com/jsp/jstl/functions"
  xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="processListStyleClass" />
  <cc:attribute name="mobileMode" default="false" />
  <cc:attribute name="title" default="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/processes')}" />
  <cc:attribute name="hideHeader" default="false" type="java.lang.Boolean" />
  <cc:attribute name="hideExpressCreation" default="false" />
</cc:interface>

<cc:implementation>
  <h:outputScript library="js" name="process-widget.js" />
  <div id="#{cc.clientId}" class="widget process-widget">
    <h:panelGroup id="header" styleClass="widget-header expanded" layout="block" rendered="#{!cc.attrs.hideHeader}">
      <h:panelGroup class="widget-header-main" rendered="#{!processWidgetBean.mobileMode}">
        <span class="widget-header-main-title">#{cc.attrs.title}</span>
        <h:panelGroup styleClass="widget-header-main-menu">
          <cc:renderFacet name="headerToolbar" />
        </h:panelGroup>
      </h:panelGroup>
      <h:panelGroup layout="block"
        styleClass="#{processWidgetBean.mobileMode ? 'mobile-widget-process-header-sub' : 'widget-header-sub'}">
        <ic:ch.ivy.addon.portalkit.component.Filter id="process-search" listener="processWidget.filter()" ajax="false"
          placeholder="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/processName')}"
          styleClass="js-filter-process-widget-list-item" />
      </h:panelGroup>
      <p:selectOneMenu id="dictionary-process-group-selection" widgetVar="dictionary-process-group-selection"
        rendered="#{processWidgetBean.mobileMode}" styleClass="mobile-process-list-dictionary-group-selection"
        panelStyleClass="hide-disabled">
        <f:selectItem itemValue="express"
          itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/expressWorkflowGroupTitle')}"
          itemDisabled="#{empty processWidgetBean.expressProcesses}" />
        <f:selectItems value="#{processWidgetBean.processesByAlphabet.entrySet().toArray()}" var="dictionaryCharacter"
          itemValue="#{dictionaryCharacter.key}"
          itemLabel="#{dictionaryCharacter.key eq 'SPECIAL_CHARACTER'? ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/specialCharacterGroup') : dictionaryCharacter.key}" />
        <p:ajax event="change" oncomplete="jumpToProcessGroup();" global="false" immediate="true" update="@none" />
      </p:selectOneMenu>
    </h:panelGroup>

    <h:panelGroup id="process-widget-action" styleClass="process-widget-action process-navigation-container">
      <h:form id="axon-express-form" rendered="#{not processWidgetBean.mobileMode and !cc.attrs.hideExpressCreation}"
        styleClass="process-button-position process-action-button action-create-experss-workflow">
        <h:panelGroup layout="block" rendered="#{processWidgetBean.canCreateExpessWorkflow()}">
          <p:commandLink id="create-express-workflow"
            value="#{processWidgetBean.createExpressWorkflowProcessStart.name}"
            actionListener="#{processWidgetBean.startProcess(processWidgetBean.getCreateExpessWorkflowLink())}" />
        </h:panelGroup>
      </h:form>
      <br/>
      <span class="expand-collapse-btns">
        <p:commandLink id="expand-all-btn"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/expandAll')}" onclick="expandOrCollapseAllCategories(true); return false;"
        />
        <p:spacer width="10" />
        <p:commandLink id="collapse-all-btn"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/collapseAll')}" onclick="expandOrCollapseAllCategories(false); return false;"
        />
      </span>
      <span>
        <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/goTo')}"/>
        <ui:repeat value="#{processWidgetBean.getAllAlphabeticalCharacters()}" var="character" >
          <p:commandLink value="#{character}" disabled="#{!processWidgetBean.processesByAlphabet.containsKey(character.toString())}" onclick="jumpToProcessGroupByCharacter(event); return;" />
          <p:spacer width="5" />
        </ui:repeat>
      </span>
    </h:panelGroup>
    <h:panelGroup id="process-list" layout="block" styleClass="widget-content #{cc.attrs.processListStyleClass}">
      <ui:fragment id="full-process-list">
        <p:fieldset id="express-fieldset" legend="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/expressWorkflowGroupTitle')}"
          toggleable="true" styleClass="process-group js-process-index-group js-process-group-express"
          rendered="#{not empty processWidgetBean.expressProcesses}">
          <h:panelGroup id="express-process-container" layout="block" styleClass="#{cc.attrs.processListStyleClass}">
            <ui:repeat var="expressProcess" value="#{processWidgetBean.expressProcesses}">
              <h:form id="express-process-item-form"
                styleClass="process-start-list-item-wrapper js-process-start-list-item process-start-list-item #{processWidgetBean.mobileMode ? 'mobile-process-start-list-item' : ''} express-workflow">
                <p:commandLink id="process-item" actionListener="#{processWidgetBean.startExpressProcess(expressProcess)}" target="_self"
                  styleClass="process-item">
                  <ui:include src="ProcessItem.xhtml">
                    <ui:param name="processName" value="#{expressProcess.processName}" />
                    <ui:param name="processType" value="process-item" />
                    <ui:param name="isExpress" value="true" />
                  </ui:include>
                </p:commandLink>
                <h:panelGroup rendered="#{!processWidgetBean.mobileMode}">
                  <ui:include src="ProcessItemExpressActions.xhtml">
                    <ui:param name="processType" value="process" />
                  </ui:include>
                </h:panelGroup>
              </h:form>
            </ui:repeat>
          </h:panelGroup>
        </p:fieldset>
        <ui:repeat id="process-group-alphabet" var="entryProcess"
          value="#{processWidgetBean.processesByAlphabet.entrySet().toArray()}">
          <p:fieldset id="alphabet-process-index-fieldset"
            legend="#{entryProcess.key eq 'SPECIAL_CHARACTER'? ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/specialCharacterGroup') : entryProcess.key}"
            toggleable="true" styleClass="process-group js-process-index-group js-process-group-#{entryProcess.key}">
            <h:panelGroup id="none-express-process-container" layout="block" styleClass="#{cc.attrs.processListStyleClass}">
              <ui:repeat id="none-express-processes" varStatus="status" var="process" value="#{entryProcess.value}">
                <h:form id="process-item-form"
                  styleClass="process-start-list-item-wrapper js-process-start-list-item process-start-list-item">
                  <ui:include src="ProcessItemLink.xhtml">
                    <ui:param name="processName" value="#{process.name}" />
                    <ui:param name="processLink" value="#{process.getLink().getRelativeEncoded()}" />
                  </ui:include>
                </h:form>
              </ui:repeat>
            </h:panelGroup>
          </p:fieldset>
        </ui:repeat>
        <h:outputText id="no-found-processes"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/noProcesses')}"
          styleClass="no-process-message js-no-found-processes u-display-none" />
      </ui:fragment>
    </h:panelGroup>
  </div>
  
  <p:dialog id="remove-express-workflow-dialog" widgetVar="remove-express-workflow-dialog"
    header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/deleteExpressWorkflowHeader')}"
    closeOnEscape="true" modal="true" dynamic="true" appendTo="@(body)" resizable="false">
    <h:form id="delete-workflow-form">
      <h:outputText escape="false"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/deleteExpressWorkflowConfirmation')}" />
      <br />
      <h:outputText value="#{processWidgetBean.deletedExpressProcess.processName}" styleClass="FontBold" />
      <div class="ui-dialog-footer u-dialog-footer">
        <p:commandButton global="false" process="@this" update="#{cc.clientId}:process-list"
          actionListener="#{processWidgetBean.deleteExpressWorkflow}"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/ok')}"
          oncomplete="PF('remove-express-workflow-dialog').hide();" />
        <p:spacer width="5" />
        <p:commandButton onclick="PF('remove-express-workflow-dialog').hide()" styleClass="portal-cancel-button"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" type="button" />
      </div>
    </h:form>
  </p:dialog>
  <script>
      function jumpToProcessGroup() {
        document.getElementsByClassName("js-process-group-" + PF('dictionary-process-group-selection').value)[0]
            .scrollIntoView();
        PF('dictionary-process-group-selection').hide();

        var processHeaderHeight = document.getElementsByClassName("process-widget")[0]
            .getElementsByClassName("widget-header")[0].offsetHeight;
        document.getElementsByClassName("process-widget")[0].scrollTop -= processHeaderHeight;
      }
    </script>
</cc:implementation>
</html>