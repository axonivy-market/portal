<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:cc="http://xmlns.jcp.org/jsf/composite"
  xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" 
  xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="processListStyleClass" />
  <cc:attribute name="title" default="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/processes')}" />
  <cc:attribute name="hideHeader" default="false" type="java.lang.Boolean" />
  <cc:attribute name="hideExpressCreation" default="false" />
  <cc:attribute name="hideProcessNavigation" default="false"></cc:attribute>
</cc:interface>

<cc:implementation>
  <h:outputScript library="js" name="process-widget.js" />
  <div class="ui-g">
    <div id="#{cc.clientId}" class="widget process-widget ui-g-12">
      <!-- Process header -->
      <div class="process-header js-process-header">
        <h:panelGroup id="header" styleClass="widget-header expanded ui-g-12 u-padding-0" layout="block" rendered="#{!cc.attrs.hideHeader}">
          <h:panelGroup layout="block" styleClass="ui-g-8 ui-sm-4">
            <div class="process-header-title-container">
              <span class="process-header-title">#{cc.attrs.title}</span>
            </div>
          </h:panelGroup>
        </h:panelGroup>

        <h:panelGroup id="process-widget-action" styleClass="process-widget-action u-text-align-center ui-g-12 u-no-padding-top">
          <h:panelGroup styleClass="Fleft ui-g-3 ui-lg-3 ui-md-5 ui-sm-12 process-widget-action-filter">
            <ic:ch.ivy.addon.portalkit.component.Filter id="process-search" listener="processWidget.filter()" ajax="false"
              placeholder="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/processFilterPlaceHolder')}"
              styleClass="js-filter-process-widget-list-item" />
          </h:panelGroup>
          
          <div class="Fleft process-widget-action-link">
            <h:panelGroup styleClass="Fright u-hidden-md-down add-external-link-command">
              <p:commandLink id="add-external-link-command"
                actionListener="#{externalLinkBean.addNewExternalLink(cc.clientId)}"
                update="#{cc.clientId}:add-external-link-dialog" oncomplete="PF('add-external-link-dialog').show()">
                <i class="fa fa-external-link Fleft add-external-link-icon" aria-hidden="true" />
                <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/addExternalLink')}" />
              </p:commandLink>
              <ui:include src="ExternalLinkDialog.xhtml" />
            </h:panelGroup>
            <h:panelGroup id="create-express-form" rendered="#{!cc.attrs.hideExpressCreation}"
              styleClass="process-button-position process-action-button action-create-experss-workflow u-hidden-md-down Fright MarRight10">
              <p:commandLink id="create-express-workflow" rendered="#{processWidgetBean.canCreateExpessWorkflow()}"
                actionListener="#{processWidgetBean.startExpressWorkflowCreationLink()}">
                <i class="icon ivyicon-startup-launch Fleft" />
                <h:outputText value="#{processWidgetBean.createExpressWorkflowProcessStart.name}" />
              </p:commandLink>
            </h:panelGroup>
          </div>
        </h:panelGroup>
      </div>

      <!-- Process body -->
      <h:panelGroup id="process-list" layout="block" styleClass="widget-content process-start-list-container js-process-start-list-container ui-g-12">
        <ui:fragment id="full-process-list">
          <ui:repeat id="process-group-alphabet" var="entryProcess" value="#{processWidgetBean.processesByAlphabet.entrySet().toArray()}">
            <p:fieldset id="alphabet-process-index-fieldset"
              legend="#{entryProcess.key eq 'SPECIAL_CHARACTER' ? ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/specialCharacterGroup') : entryProcess.key}"
              toggleable="true" styleClass="fieldset-no-border process-group js-process-index-group js-process-group-#{entryProcess.key}">
              <h:panelGroup id="process-container" layout="block" styleClass="ui-g">
                <ui:repeat id="processes" varStatus="status" var="process" value="#{entryProcess.value}">
                  <div class="ui-g-4 ui-lg-4 ui-md-6 ui-sm-12 u-no-padding-top u-no-padding-left js-process-start-list-item">
                    <h:form id="process-item-form"
                      styleClass="process-start-list-item #{processWidgetBean.isExpressProcess(process) ? 'express-workflow' : ''}
                      #{processWidgetBean.isExternalLink(process) ? 'js-external-link-process-item' : ''}">
                      <ui:include src="ProcessItemLink.xhtml">
                        <ui:param name="process" value="#{process}" />
                      </ui:include>
                    </h:form>
                  </div>
                </ui:repeat>
              </h:panelGroup>
            </p:fieldset>
          </ui:repeat>

          <h:outputText id="no-found-processes" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/noProcesses')}"
            styleClass="no-process-message js-no-found-processes u-display-none" />
        </ui:fragment>
      </h:panelGroup>
      <!-- Process navigator -->
      <h:panelGroup id="process-nav" styleClass="process-nav js-process-nav" rendered="#{!cc.attrs.hideProcessNavigation}">
        <p:commandLink id="expand-all-btn" onclick="expandOrCollapseAllCategories(true); return false;"
          styleClass="expand-collapse-btn process-nav-item expand" />
        <p:commandLink id="collapse-all-btn" onclick="expandOrCollapseAllCategories(false); return false;"
          styleClass="expand-collapse-btn process-nav-item collapse" />

        <ui:repeat value="#{processWidgetBean.getAllAlphabeticalCharacters().entrySet().toArray()}" var="character">
          <p:commandLink value="#{character.value}" styleClass="process-nav-item js-process-starts-with-#{character.key}"
            onclick="jumpToProcessGroupByCharacter(event)" global="false" />
        </ui:repeat>
      </h:panelGroup>
    </div>
  </div>

  <p:dialog id="remove-express-workflow-dialog" widgetVar="remove-express-workflow-dialog"
    header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/deleteProcessItemHeader')}" closeOnEscape="true" modal="true"
    dynamic="true" appendTo="@(body)" resizable="false" responsive="true">
    <h:form id="delete-workflow-form">
      <h:outputText escape="false" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/deleteProcessItemConfirmation')}" />
      <br />
      <h:outputText value="#{processWidgetBean.deletedExpressProcess.getName()}" styleClass="FontBold" />
      <div class="ui-dialog-footer u-dialog-footer">
        <p:commandButton global="false" process="@this" update="#{cc.clientId}:process-list"
          actionListener="#{processWidgetBean.deleteExpressWorkflow}" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/ok')}"
          oncomplete="PF('remove-express-workflow-dialog').hide();" />
        <p:spacer width="5" />
        <p:commandButton onclick="PF('remove-express-workflow-dialog').hide()" styleClass="portal-cancel-button"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" type="button" />
      </div>
    </h:form>
  </p:dialog>

  <script>
      var processWidget = new ProcessWidget();
      $(function() {
      	processWidget.setupScrollbar();
      });
      function jumpToProcessGroup() {
        document.getElementsByClassName("js-process-group-" + PF('dictionary-process-group-selection').value)[0]
            .scrollIntoViewIfNeeded();
        PF('dictionary-process-group-selection').hide();
		
        var processHeaderHeight = document.getElementsByClassName("process-widget")[0]
            .getElementsByClassName("widget-header")[0].offsetHeight;
        document.getElementsByClassName("process-widget")[0].scrollTop -= processHeaderHeight;
        
      }
    </script>
</cc:implementation>
</html>