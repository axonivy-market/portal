<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:pm="http://primefaces.org/mobile" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
  xmlns:jsf="http://xmlns.jcp.org/jsf">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="caseItem" type="ch.ivy.addon.portalkit.bo.RemoteCase" />
  <cc:attribute name="destroyCaseActionListener"
    method-signature="void actionListener(ch.ivy.addon.portalkit.bo.RemoteCase)" />
  <cc:attribute name="update" default="" required="false" />
  <cc:attribute name="showDestroyButton" default="false" type="java.lang.Boolean" />
  <cc:attribute name="isSelected" default="false" type="java.lang.Boolean" />
  <cc:attribute name="oncomplete" />
</cc:interface>

<cc:implementation>

  <c:set var="caseItem" value="#{cc.attrs.caseItem}" />
  <c:set var="isSelected" value="#{data.expandedCaseId eq null and cc.attrs.isSelected}" />
  <c:set var="isExpanded" value="#{caseItem.id eq data.expandedCaseId or isSelected}" />

  <!-- This remote command needs to be run when being display as the first time to set the id of the expanded case -->
  <p:remoteCommand actionListener="#{logic.setExpandedCaseId(caseItem.id)}" autoRun="#{isSelected}" />

  <div id="#{cc.clientId}"
    class="widget-content-list-item u-shadow-effect js-case-item #{isExpanded ? 'mod-expanded' : ''} case-list-item case-list-item-position u-shadow-effect ">
    <h:panelGroup class="case-header-container u-unselectable u-hover-effect" layout="block" >
      <div class="case-show-detail-container #{isExpanded ? 'case-header-padding' : ''}" >
        <p:commandLink styleClass="case-header-data js-case-item-header"
          actionListener="#{logic.setExpandedCaseId(caseItem.id)}" update="#{p:component('case-list')}">
          <div class="case-state">
            <h:panelGroup styleClass="fa fa-circle in-progress-case" rendered="#{caseItem.state eq 'CREATED' or caseItem.state eq 'RUNNING'}"/>
            <h:panelGroup styleClass="fa fa-circle done-case" rendered="#{caseItem.state eq 'DONE'}"/>
          </div>
          <div>
            <div id="#{cc.clientId}:case-header-data-top" class="case-info-header">##{caseItem.id}
              #{caseBean.getState(caseItem).toUpperCase()}</div>
            <div id="#{cc.clientId}:case-header-data-middle" class="case-info-content">#{empty
              caseItem.getName() ? ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/CasesNameIsNot') :
              caseItem.getName()}</div>
            <div id="#{cc.clientId}:case-header-data-bottom" class="case-info-footer">
              <span jsf:rendered="#{not isExpanded}">#{ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/Created')}:
                <h:outputText value="#{caseItem.startTimestamp}">
                  <f:convertDateTime dateStyle="long" type="date" locale="#{ivy.session.getContentLocale()}" />
                </h:outputText> <h:outputText
                  value=" / #{ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/lastModified')}: "
                  rendered="#{caseItem.endTimestamp ne null}" /> <h:outputText value="#{caseItem.endTimestamp}">
                  <f:convertDateTime dateStyle="long" type="date" locale="#{ivy.session.getContentLocale()}" />
                </h:outputText>
              </span> <span jsf:rendered="#{isExpanded}">#{caseItem.getDescription()}</span>
            </div>
          </div>
        </p:commandLink>
      </div>
      <div class="case-header-action">
        <p:commandLink id="destroy-case"
          rendered="#{(not empty cc.attrs.destroyCaseActionListener) and cc.attrs.showDestroyButton and caseItem.state ne 'DONE'}"
          update="#{cc.attrs.update}" actionListener="#{cc.attrs.destroyCaseActionListener}" styleClass="case-command"
          process="@this" oncomplete="#{cc.attrs.oncomplete}">
          <span class="fa fa-remove" />
          <h:outputLabel value="#{ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/Destroy')}" />
        </p:commandLink>
      </div>
    </h:panelGroup>

    <h:panelGroup layout="block" rendered="#{isExpanded}" styleClass="case-body js-case-item-body">
      <div class="grid">
        <cc:insertChildren />
      </div>
    </h:panelGroup>
  </div>
</cc:implementation>
</html>