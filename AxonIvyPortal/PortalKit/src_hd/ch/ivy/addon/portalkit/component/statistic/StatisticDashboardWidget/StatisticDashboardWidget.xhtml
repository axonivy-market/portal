<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:pm="http://primefaces.org/mobile"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:jsf="http://xmlns.jcp.org/jsf"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="compactMode" default="true" type="java.lang.Boolean" />
  <cc:attribute name="statisticChartList" required="true" />
  <cc:facet name="emptyDataPlace" shortDescription="user can override empty message with this place" />
</cc:interface>

<cc:implementation>
  <f:event listener="#{logic.initialize(cc.attrs.statisticChartList)}" type="preRenderComponent" />
  <h:panelGroup id="statistic-dashboard-expand-mode" layout="block" rendered="#{!cc.attrs.compactMode and data.hasStatistic}" styleClass="statistic-dashboard-expand-mode">
    <ui:repeat id="statistic-chart-repeater" var="chart" value="#{data.statisticChartList}">
      <c:set var="index" value="#{data.statisticChartList.indexOf(chart)}" />
      <p:panel id="chart-panel" styleClass="dashboard-chart-panel">
        <f:facet name="header">
          <h:outputLabel id="chart-name" styleClass="chart-name" value="#{chart.name}" for="chart-#{chart.id}" />
          <h:panelGroup layout="block" styleClass="chart-actions-container">
            <p:commandLink styleClass="fa fa-arrow-down chart-action"
              actionListener="#{logic.moveDown(chart)}"
              update="@([id$='statistic-dashboard-container'])"
              rendered="#{index &lt; data.statisticChartList.size() - 2}" />
            <p:commandLink styleClass="fa fa-arrow-up chart-action"
              actionListener="#{logic.moveUp(chart)}"
              update="@([id$='statistic-dashboard-container'])"
              rendered="#{index &gt; 1}" />
            <p:commandLink styleClass="fa fa-arrow-left chart-action"
              actionListener="#{logic.moveLeft(chart)}"
              update="@([id$='statistic-dashboard-container'])"
              rendered="#{index % 2 != 0}" />
            <p:commandLink styleClass="fa fa-arrow-right chart-action"
              actionListener="#{logic.moveRight(chart)}"
              update="@([id$='statistic-dashboard-container'])"
              rendered="#{index % 2 == 0 and index != data.statisticChartList.size() -1}" />

            <p:commandLink id="delete-chart-link" styleClass="fa fa-close chart-action">
             <p:ajax event="click" listener="#{logic.selectChart(chart)}" oncomplete="PF('delete-confirmation-dialog').show();" />
            </p:commandLink>
          </h:panelGroup>
        </f:facet>

        <p:chart type="donut" styleClass="statistic-chart"
          model="#{chart.donutChartModel}"
          rendered="#{statisticDashboardBean.isTaskByPriority(chart)}">
          <f:attribute name="selectedChartId" value="#{chart.id}" />
          <p:ajax event="itemSelect" listener="#{logic.drilldownTaskByPriority}" />
        </p:chart>

        <p:chart type="bar" styleClass="statistic-chart"
          model="#{chart.barChartModel}"
          rendered="#{statisticDashboardBean.isTaskByExpiry(chart)}">
          <f:attribute name="selectedChartId" value="#{chart.id}" />
          <p:ajax event="itemSelect" listener="#{logic.drilldownTaskByExpiry}" />
        </p:chart>

        <p:chart type="donut" styleClass="statistic-chart"
          model="#{chart.donutChartModel}"
          rendered="#{statisticDashboardBean.isCaseByState(chart)}">
          <f:attribute name="selectedChartId" value="#{chart.id}" />
          <p:ajax event="itemSelect" listener="#{logic.drilldownCaseByState}" />
        </p:chart>

        <p:chart type="pie" styleClass="statistic-chart"
          model="#{chart.pieChartModel}"
          rendered="#{statisticDashboardBean.isElapsedTimeByCaseCategory(chart)}" />
      </p:panel>
    </ui:repeat>
  </h:panelGroup>
  <p:carousel id="statistic-carousel" styleClass="statistic-carousel" circular="true" numVisible="1"
    value="#{data.statisticChartList}" var="chart" pageLinks="0" rendered="#{cc.attrs.compactMode and data.hasStatistic}">
    <p:panelGrid columns="2" columnClasses="label, value">
      <p:panel>
        <p:chart type="donut" styleClass="statistic-chart"
          model="#{chart.donutChartModel}"
          rendered="#{statisticDashboardBean.isTaskByPriority(chart)}">
          <f:attribute name="selectedChartId" value="#{chart.id}" />
          <p:ajax event="itemSelect" listener="#{logic.drilldownTaskByPriority}" />
        </p:chart>

        <p:chart type="bar" styleClass="statistic-chart"
          model="#{chart.barChartModel}"
          rendered="#{statisticDashboardBean.isTaskByExpiry(chart)}">
          <f:attribute name="selectedChartId" value="#{chart.id}" />
          <p:ajax event="itemSelect" listener="#{logic.drilldownTaskByExpiry}" />
        </p:chart>

        <p:chart type="donut" styleClass="statistic-chart"
          model="#{chart.donutChartModel}"
          rendered="#{statisticDashboardBean.isCaseByState(chart)}">
          <f:attribute name="selectedChartId" value="#{chart.id}" />
          <p:ajax event="itemSelect" listener="#{logic.drilldownCaseByState}" />
        </p:chart>

        <p:chart type="pie" styleClass="statistic-chart"
          model="#{chart.pieChartModel}"
          rendered="#{statisticDashboardBean.isElapsedTimeByCaseCategory(chart)}" />
      </p:panel>
    </p:panelGrid>
  </p:carousel>
  <h:panelGroup id="statistic-widget-empty-state"
      styleClass="statistic-widget-empty-message #{!cc.attrs.compactMode ? 'not-compact-mode': ''}" layout="block"
      rendered="#{!data.hasStatistic}">
      <h:panelGroup layout="block" rendered="#{empty cc.facets.emptyDataPlace}">
        <p:outputLabel escape="false"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/emptystate/defaultEmptyMessages')}" />
      </h:panelGroup>
      <cc:renderFacet name="emptyDataPlace" />
    </h:panelGroup>

  <p:confirmDialog id="delete-confirmation-dialog"
    message="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/components/statisticWidget/chartDeletionConfirmation')}"
    header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/components/statisticWidget/chartDeletionConfirmationHeader')}"
    widgetVar="delete-confirmation-dialog" appendTo="@(body)" severity="alert">
    <p:commandButton id="confirm-delete" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/yes')}"
      actionListener="#{logic.deleteChart()}" styleClass="portal-ok-button"
      oncomplete="PF('delete-confirmation-dialog').hide();"
      update="@([id$='statistic-dashboard-container']) @([id$='statistic-widget-empty-state']) " />
    <p:commandButton value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/no')}"
      onclick="PF('delete-confirmation-dialog').hide();" type="button" styleClass="portal-cancel-button" />
  </p:confirmDialog>
</cc:implementation>
</html>