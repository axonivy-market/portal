<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:jsf="http://xmlns.jcp.org/jsf">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="actionLinkId" />
  <cc:attribute name="panelWidgetVar" />
  <cc:attribute name="isAdhocExcluded" default="false" type="java.lang.Boolean" shortDescription="exclude adhoc from side steps" />
  <cc:attribute name="isDisabled" default="false" type="java.lang.Boolean" />
  <cc:attribute name="task" type="ch.ivyteam.ivy.workflow.ITask" />
  <cc:attribute name="componentToUpdate" default="" />
  <cc:attribute name="buttonStyleClass" />
  <cc:attribute name="renderedAdditionalAction" shortDescription="Control display adhoc and side steps" />
  <cc:attribute name="selectedTask" shortDescription="Task is selected for reset or delegate" type="ch.ivyteam.ivy.workflow.ITask"/>
</cc:interface>

<cc:implementation>
  <c:set var="task" value="#{cc.attrs.task}" />

  <p:commandButton id="#{cc.attrs.actionLinkId}" onstart="event.stopPropagation();" global="false" disabled="#{cc.attrs.isDisabled}"
    actionListener="#{sideStepBean.getSideSteps(task.getId(), task.case.getId(), cc.attrs.isAdhocExcluded)}" styleClass="action-button task-action-item #{cc.attrs.buttonStyleClass}"
    value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/more')}" icon="fa fa-ellipsis-v"
    iconPos="left" update="side-steps-panel" />

  <p:overlayPanel id="side-steps-panel" widgetVar="#{cc.attrs.panelWidgetVar}" for="#{cc.attrs.actionLinkId}" my="left top" at="left bottom" appendTo="@(body)"
    styleClass="options-panel" dynamic="true" rendered="#{!cc.attrs.isDisabled}">

    <p:commandLink id="task-reset-command" onstart="event.stopPropagation();" rendered="#{taskActionBean.showResetTask}" disabled="#{!taskActionBean.canReset(task)}"
      styleClass="option-item" actionListener="#{logic.resetTask(task)}" update="@parent #{cc.attrs.componentToUpdate}">
      <i class="option-action-icon tmi-box-arrow-left" />
      <span class="option-item-label">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/reset')}</span>
    </p:commandLink>

    <p:commandLink id="task-delegate-command" disabled="#{!taskActionBean.canDelegate(task)}" rendered="#{taskActionBean.showDelegateTask}"
      styleClass="option-item" onstart="event.stopPropagation();" oncomplete="PF('task-delegate-dialog').show()"
      update="@parent #{cc.attrs.componentToUpdate} @widgetVar(task-delegate-dialog)" global="false">
      <i class="option-action-icon tmi-box-arrow-right" />
      <span class="option-item-label">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskInformation/delegate')}</span>
      <p:ajax event="click" oncomplete="#{cc.attrs.selectedTask}; initDataToDelegate();" global="false" process="@this" immediate="true" />
    </p:commandLink>

    <p:commandLink id="task-reserve-command" disabled="#{!taskActionBean.canPark(task)}" rendered="#{taskActionBean.showReserveTask}" onstart="event.stopPropagation();"
      styleClass="option-item" actionListener="#{logic.parkTask(task)}" update="@parent #{cc.attrs.componentToUpdate}">
      <i class="option-action-icon tmi-box-arrow-toinside" />
      <span class="option-item-label">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/reserve')}</span>
    </p:commandLink>
    
    <h:panelGroup id="task-additional-actions" layout="block" rendered="#{cc.attrs.renderedAdditionalAction}">
      <p:separator styleClass="u-separator" />
      <p:commandLink rendered="#{empty sideStepBean.currentSideSteps}" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseDetails/noSideSteps')}"
        styleClass="option-item" />
      <ui:repeat var="sideStep" value="#{sideStepBean.currentSideSteps}">
        <p:commandLink id="adhoc-side-step-item" styleClass="option-item" value="#{sideStep.name}" global="false" rendered="#{sideStep.isAdhoc()}"
          actionListener="#{sideStepBean.startAdhoc(sideStep, task.getId())}" process="@this" />
  
        <p:commandLink id="option-item" styleClass="option-item" value="#{sideStep.name}" global="false" rendered="#{not sideStep.isAdhoc()}"
          actionListener="#{sideStepBean.startSideStep(sideStep)}" process="@this" />
      </ui:repeat>
    </h:panelGroup>
  </p:overlayPanel>
</cc:implementation>
</html>