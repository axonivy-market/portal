<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:jsf="http://xmlns.jcp.org/jsf">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="task" type="ch.ivyteam.ivy.workflow.ITask" />
  <cc:attribute name="priorityComponentToUpdate" />
  <cc:attribute name="componentToUpdate" />
  <cc:attribute name="styleClass" />
</cc:interface>

<cc:implementation>
  <c:set var="task" value="#{cc.attrs.task}" />
  <c:set var="state" value="#{cc.attrs.task.state}" />
  <!-- PANEL GENERAL INFORMATION -->

  <div class="ui-g-12 task-first-column-label u-no-padding-left u-no-padding-top">
    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/ID')}" />
      </div>
      <div id="task-id" class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <h:outputText value="#{task.getId()}" />
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/PRIORITY')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <h:panelGroup styleClass="task-details-priority">
          <ui:fragment rendered="#{taskActionBean.canChangePriority(task)}">
            <h:form id="priority-form" styleClass="task-priority-form">
              <p:inplace id="edit-priority-inplace" effectSpeed="fast" styleClass="edit-priority-inplace"
                saveLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}" cancelLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
                editor="true">
                <f:facet name="output">
                  <h:panelGroup id="priority-icon">
                    <h:panelGroup styleClass="fa fa-circle task-priority-#{task.priority.toString().toLowerCase()} task-details-data-priority-icon" />
                    <h:outputText value="#{taskBean.getPriority(task.priority)}" />
                  </h:panelGroup>
                </f:facet>
                <p:ajax event="save" update="priority-form" />
                <p:selectOneMenu id="priority-select-menu" value="#{task.originalPriority}" styleClass="task-details-priority" rendered="#{!task.isExpired()}">
                  <f:selectItems value="#{task.getPriority().values()}" var="priority" itemLabel="#{taskBean.getPriority(priority)}" itemValue="#{priority}" />
                </p:selectOneMenu>
                <p:selectOneMenu id="expiry-priority-select-menu" value="#{task.expiryPriority}" styleClass="task-details-priority" rendered="#{task.isExpired()}">
                  <f:selectItems value="#{task.getPriority().values()}" var="priority" itemLabel="#{taskBean.getPriority(priority)}" itemValue="#{priority}" />
                </p:selectOneMenu>
              </p:inplace>
            </h:form>
          </ui:fragment>
          <ui:fragment rendered="#{not taskActionBean.canChangePriority(task)}">
            <h:panelGroup styleClass="fa fa-circle task-priority-#{task.priority.toString().toLowerCase()} task-details-data-priority-icon" />
            <h:outputText value="#{taskBean.getPriority(task.priority)}" styleClass="DispInlBlock" />
          </ui:fragment>
        </h:panelGroup>
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/STATE')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <h:panelGroup id="task-detail-state" styleClass="state-cell default-task-cell">
          <h:panelGroup id="task-detail-state-open" rendered="#{state == 'SUSPENDED' or state == 'UNASSIGNED'}" styleClass="fa fa-play-circle task-state-open " />
          <h:panelGroup id="task-detail-state-in-progress" rendered="#{state == 'RESUMED' or state == 'CREATED'}" styleClass="fa fa-play-circle task-state-in-progress" />
          <h:panelGroup id="task-detail-state-done" rendered="#{state == 'DONE'}" styleClass="fa fa-check-circle task-state-done " />
          <h:panelGroup id="task-detail-state-reserved" rendered="#{state == 'PARKED'}" styleClass="fa fa-pause-circle task-state-reserved " />
          <h:panelGroup id="task-detail-state-destroyed" rendered="#{state == 'DESTROYED' or state == 'ZOMBIE'}"
            styleClass="fa fa-exclamation-circle task-state-zombie-destroyed" />
          <h:panelGroup id="task-detail-state-delayed" rendered="#{state == 'DELAYED'}"
            styleClass="icon ivyicon-alarm-bell-timer task-state-delaye" />
          <h:panelGroup id="task-detail-state-system"
            rendered="#{state != 'SUSPENDED' and state != 'UNASSIGNED' and state != 'RESUMED' and state != 'CREATED'
            and state != 'DONE' and state != 'PARKED' and state != 'DESTROYED' and state != 'ZOMBIE'
            and state != 'DELAYED'}"
            styleClass="fa fa-cog task-state-system " />
          <h:outputText value="#{state}" styleClass="task-detail-state" />
        </h:panelGroup>
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/workingUser')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <ic:ch.ivy.addon.portalkit.component.UserFullnameDisplayText id="task-worker" fullname="#{task.getWorkerUser().getDisplayName()}" username="#{task.getWorkerUserName()}" />
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/ACTIVATOR')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <ic:ch.ivy.addon.portalkit.component.UserFullnameDisplayText id="task-activator" fullname="#{task.getActivator().getDisplayName()}" username="#{task.getActivatorName()}" />
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/afterEscalation')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <ic:ch.ivy.addon.portalkit.component.UserFullnameDisplayText id="task-expiry-activator" fullname="#{task.getExpiryActivator().getDisplayName()}" username="#{task.getExpiryActivatorName()}" />
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/taskCategory')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4 u-truncate-text">
        <h:outputText id="task-category" value="#{task.categoryPath}" />
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/businessCase')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4 u-truncate-text">
        <p:commandLink id="related-case" styleClass="task-business-case" value="##{task.getCase().getBusinessCase().id} #{taskBean.displayCaseName(task)}" actionListener="#{logic.navigateToRelatedCase}">
          <f:attribute name="caseView" value="#{task.getCase().getBusinessCase()}" />
        </p:commandLink>
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/technicalCase')}" rendered="true" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4 u-truncate-text">
        <p:commandLink id="related-technical-case" value="#{taskBean.getTechnicalCaseDisplayName(task)}" actionListener="#{logic.navigateToRelatedCase}"
          rendered="#{task.getCase().getId() != task.getCase().getBusinessCase().getId()}">
          <f:attribute name="caseView" value="#{task.getCase()}" />
        </p:commandLink>
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/CaseCategory')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4 u-truncate-text">
        <h:outputText id="case-category" value="#{task.getCase().getBusinessCase().categoryPath}" />
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/create')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <h:outputText id="start-date" value="#{task.startTimestamp}">
          <f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
        </h:outputText>
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText id="expiry-task-time" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/EXPIRY_TIME')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <ui:fragment rendered="#{taskBean.isNotDone(task)}">
          <h:form id="expiry-form">
            <p:inplace id="edit-inplace" styleClass="expiry-edit-inplace" editor="true" saveLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}"
              cancelLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" label="#{formattingNullWrapperBean.format(task.expiryTimestamp)}"
              rendered="#{taskActionBean.canChangeExpiry(task)}">
              <p:ajax event="save" listener="#{logic.updateDeadline(task)}" update="expiry-form #{cc.attrs.componentToUpdate}" />
              <p:calendar id="expiry-calendar" styleClass="task-details-data-expiry" value="#{task.expiryTimestamp}" pattern="#{dateTimePatternBean.configuredPattern}"
                locale="#{localeBean.locale}">
                <f:validator validatorId="taskExpiryTimestampValidator" />
              </p:calendar>
            </p:inplace>
            <p:growl id="expiry-form-message" for="expiry-calendar"/>
          </h:form>
          <h:outputText id="no-expiry-available"
            value="#{empty task.expiryTimestamp ? ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/notAvailable') : task.expiryTimestamp}"
            rendered="#{!taskActionBean.canChangeExpiry(task)}">
            <f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
          </h:outputText>
        </ui:fragment>
        <ui:fragment rendered="#{taskBean.isDone(task)}">
          <h:outputText rendered="#{task.expiryTimestamp ne null}" value="#{task.expiryTimestamp}">
            <f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
          </h:outputText>
          <h:outputText rendered="#{task.expiryTimestamp eq null}" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/notAvailable')}" />
        </ui:fragment>
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/delayedUntil')}" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <h:form id="delay-form">
          <p:inplace id="delay-date" styleClass="delay-edit-inplace" editor="true"
            saveLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}"
            cancelLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
            label="#{formattingNullWrapperBean.format(task.getDelayTimestamp())}"
            disabled="#{!taskActionBean.canChangeDelayTimestamp(task)}">
            <p:ajax event="save" listener="#{logic.updateDelayTimestamp(task)}"
              update="delay-form #{cc.clientId}:task-detail-state #{cc.attrs.componentToUpdate}"
              resetValues="true" />
            <p:calendar id="delay-date-calendar" styleClass="delay-date-calendar" value="#{task.delayTimestamp}"
              pattern="#{dateTimePatternBean.configuredPattern}" locale="#{localeBean.locale}" >
              <f:validator validatorId="taskDelayTimestampValidator"/>
            </p:calendar>
          </p:inplace>
          <p:growl id="delay-form-message" for="delay-date-calendar"/>
        </h:form>
      </div>
    </div>

    <div class="ui-g">
      <div class="ui-xl-2 ui-lg-4 ui-md-4 ui-sm-5 ui-g-2 u-no-padding-left">
        <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/completedOn')}" rendered="true" />
      </div>
      <div class="ui-xl-10 ui-lg-8 ui-md-8 ui-sm-7 ui-g-4">
        <h:outputText value="#{task.endTimestamp}" rendered="#{not empty task.endTimestamp}">
          <f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
        </h:outputText>
      </div>
    </div>

  <ic:ch.ivy.addon.portalkit.component.TaskItemDescription id="task-detail-description" task="#{task}" />
  </div>

  <p:tooltip for="task-category" value="#{task.categoryPath}" trackMouse="true" hideEvent="mouseleave click"/>
  <p:tooltip for="case-category" value="#{task.getCase().getBusinessCase().categoryPath}" trackMouse="true" hideEvent="mouseleave click"/>
  <p:tooltip for="related-case"
    value="##{task.getCase().getBusinessCase().id} #{task.getCase().getBusinessCase().name} (#{caseBean.getState(task.getCase().getBusinessCase()).toUpperCase()})"
    trackMouse="true" hideEvent="mouseleave click"/>
  <p:tooltip for="related-technical-case" value="##{task.getCase().id} #{task.getCase().name} (#{caseBean.getState(task.getCase()).toUpperCase()})" trackMouse="true" hideEvent="mouseleave click"/>
  <p:tooltip for="no-expiry-available expiry-task-time" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/taskExpiryDisable')}" trackMouse="true" hideEvent="mouseleave click"
    rendered="#{taskBean.isNotDone(task) and taskActionBean.notHaveExpiryHandleLogic(task)}" />

</cc:implementation>
</html>