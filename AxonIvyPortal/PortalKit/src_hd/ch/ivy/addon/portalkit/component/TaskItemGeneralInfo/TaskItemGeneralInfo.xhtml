<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://java.sun.com/jsp/jstl/core">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="task" type="ch.ivyteam.ivy.workflow.ITask" />
  <cc:attribute name="priorityComponentToUpdate" />
  <cc:attribute name="componentToUpdate" />
  <cc:attribute name="styleClass" />
</cc:interface>

<cc:implementation>
  <div id="task-data" class="task-details-item js-task-details-item js-data-column #{cc.attrs.styleClass}">
    <div class="grid-item-header">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/data')}</div>
    <div class="Separator" />
    <h:panelGrid columns="2" columnClasses="task-details-data-1st-column, task-details-data-2nd-column"
      rowClasses="task-details-row-space">
      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/PRIORITY')}" />
      <h:panelGroup styleClass="task-details-priority">
        <ui:fragment rendered="#{taskActionBean.canChangePriority(task)}">
          <h:form id="priority-form">
            <p:inplace id="edit-priority-inplace" effectSpeed="fast"
              saveLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}"
              cancelLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" editor="true">
              <f:facet name="output">
                <h:panelGroup id="priority-icon">
                  <h:panelGroup rendered="#{task.priority == 'LOW'}"
                    styleClass="fa fa-circle task-priority-low task-details-data-priority-icon" />
                  <h:panelGroup rendered="#{task.priority == 'NORMAL'}"
                    styleClass="fa fa-circle task-priority-normal task-details-data-priority-icon" />
                  <h:panelGroup rendered="#{task.priority == 'HIGH'}"
                    styleClass="fa fa-circle task-priority-high task-details-data-priority-icon" />
                  <h:panelGroup rendered="#{task.priority == 'EXCEPTION'}"
                    styleClass="fa fa-circle task-priority-exception task-details-data-priority-icon" />
                  <h:outputText value="#{taskBean.getPriority(task.priority)}" />
                </h:panelGroup>
              </f:facet>
              <p:ajax event="save" update="priority-form #{cc.attrs.priorityComponentToUpdate}" />
              <p:selectOneMenu id="priority-select-menu" value="#{task.originalPriority}" styleClass="task-details-priority"
                rendered="#{!task.isExpired()}">
                <f:selectItems value="#{task.getPriority().values()}" var="priority"
                  itemLabel="#{taskBean.getPriority(priority)}" itemValue="#{priority}" />
              </p:selectOneMenu>
              <p:selectOneMenu id="expiry-priority-select-menu" value="#{task.expiryPriority}" styleClass="task-details-priority"
                rendered="#{task.isExpired()}">
                <f:selectItems value="#{task.getPriority().values()}" var="priority"
                  itemLabel="#{taskBean.getPriority(priority)}" itemValue="#{priority}" />
              </p:selectOneMenu>
            </p:inplace>
          </h:form>
        </ui:fragment>
        <ui:fragment rendered="#{not taskActionBean.canChangePriority(task)}">
          <h:panelGroup rendered="#{task.originalPriority == 'LOW'}"
            styleClass="fa fa-circle task-priority-low task-details-data-priority-icon" />
          <h:panelGroup rendered="#{task.originalPriority == 'NORMAL'}"
            styleClass="fa fa-circle task-priority-normal task-details-data-priority-icon" />
          <h:panelGroup rendered="#{task.originalPriority == 'HIGH'}"
            styleClass="fa fa-circle task-priority-high task-details-data-priority-icon" />
          <h:panelGroup rendered="#{task.originalPriority == 'EXCEPTION'}"
            styleClass="fa fa-circle task-priority-exception task-details-data-priority-icon" />
          <h:outputText value="#{taskBean.getPriority(task.originalPriority)}" styleClass="DispInlBlock" />
        </ui:fragment>
      </h:panelGroup>

      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/workingUser')}" />
      <ic:ch.ivy.addon.portalkit.component.UserFullnameDisplayText fullname="#{task.getWorkerUser().getDisplayName()}"
        username="#{task.getWorkerUserName()}" />

      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/ACTIVATOR')}" />
      <ic:ch.ivy.addon.portalkit.component.UserFullnameDisplayText fullname="#{task.getActivator().getDisplayName()}"
        username="#{task.getActivatorName()}" />

      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/afterEscalation')}" />
      <ic:ch.ivy.addon.portalkit.component.UserFullnameDisplayText fullname="#{task.getExpiryActivator().getDisplayName()}"
        username="#{task.getExpiryActivatorName()}" />
      
      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/taskCategory')}" />
      <h:outputText id="task-category" value="#{task.categoryPath}" />

      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/businessCase')}" />
      <p:commandLink id="related-case" value="#{taskBean.displayCaseName(task)}"
        actionListener="#{logic.navigateToRelatedCase(task.getCase().getBusinessCase())}" />
      
      <h:outputText value="#{ivy.cms.co('/Dialogs/ch/ivy/addon/portalkit/component/CaseWidget/CaseCategory')}" />
      <h:outputText id="case-category" value="#{task.getCase().getBusinessCase().categoryPath}" />

      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/technicalCase')}"
        rendered="#{task.getCase().getId() != task.getCase().getBusinessCase().getId()}" />
      <p:commandLink id="related-technical-case" value="#{taskBean.getTechnicalCaseDisplayName(task)}"
        actionListener="#{logic.navigateToRelatedCase(task.getCase())}"
        rendered="#{task.getCase().getId() != task.getCase().getBusinessCase().getId()}" />

      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/create')}" />
      <h:outputText id="start-date" value="#{task.startTimestamp}">
        <f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
      </h:outputText>


      <h:outputText id="expiryLabel"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/EXPIRY_TIME')}" />

      <ui:fragment rendered="#{taskBean.isNotDone(task)}">
        <h:form id="expiry-form">
          <p:inplace id="edit-inplace" editor="true"
            saveLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}"
            cancelLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
            label="#{formattingNullWrapperBean.format(task.expiryTimestamp)}"
            rendered="#{taskActionBean.canChangeExpiry(task)}">
            <p:ajax event="save" listener="#{logic.updateDeadline(task)}" update="expiry-form #{cc.attrs.componentToUpdate}" />
            <p:calendar id="expiry-calendar" styleClass="task-details-data-expiry" value="#{task.expiryTimestamp}"
              pattern="#{dateTimePatternBean.configuredPattern}" locale="#{localeBean.locale}">
              <f:validator validatorId="taskExpiryTimestampValidator" />
            </p:calendar>
          </p:inplace>
        </h:form>
        <h:outputText id="noExpiryAvailable"
          value="#{empty task.expiryTimestamp ? ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/notAvailable') : task.expiryTimestamp}"
          rendered="#{!taskActionBean.canChangeExpiry(task)}">
          <f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
        </h:outputText>
      </ui:fragment>
      <ui:fragment rendered="#{taskBean.isDone(task)}">
        <h:outputText rendered="#{task.expiryTimestamp ne null}" value="#{task.expiryTimestamp}">
          <f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
        </h:outputText>
        <h:outputText rendered="#{task.expiryTimestamp eq null}"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/notAvailable')}" />
      </ui:fragment>

      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/delayedUntil')}" />
      <h:outputText id="delay-date"
        value="#{empty task.getDelayTimestamp() ? ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/notAvailable') : task.getDelayTimestamp()}" />

      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/completedOn')}"
        rendered="#{not empty task.endTimestamp}" />
      <h:outputText value="#{task.endTimestamp}" rendered="#{not empty task.endTimestamp}">
        <f:convertDateTime pattern="#{dateTimePatternBean.configuredPattern}" />
      </h:outputText>
    </h:panelGrid>
    <p:tooltip for="task-category" value="#{task.categoryPath}" trackMouse="true" />
    <p:tooltip for="case-category" value="#{task.getCase().getBusinessCase().categoryPath}" trackMouse="true" />
    <p:tooltip for="related-case"
      value="##{task.getCase().getBusinessCase().id} #{task.getCase().getBusinessCase().name} (#{caseBean.getState(task.getCase().getBusinessCase()).toUpperCase()})"
      trackMouse="true" />
    <p:tooltip for="related-technical-case"
      value="##{task.getCase().id} #{task.getCase().name} (#{caseBean.getState(task.getCase()).toUpperCase()})"
      trackMouse="true" />
    <p:tooltip for="noExpiryAvailable expiryLabel"
      value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDetails/taskExpiryDisable')}" trackMouse="true"
      rendered="#{taskBean.isNotDone(task) and taskActionBean.notHaveExpiryHandleLogic(task)}" />
  </div>
</cc:implementation>
</html>