[Ivy]
1600AC95D2CA7CEA 9.2.0 #module
>Proto >Proto Collection #zClass
Ss0 StatisticDashboardWidgetProcess Big #zClass
Ss0 RD #cInfo
Ss0 #process
Ct0 Component Big #zClass
Ct0 B #cInfo
Ss0 Ct0 S10 'Sub 1' #zField
Ss0 @TextInP .type .type #zField
Ss0 @TextInP .processKind .processKind #zField
Ss0 @AnnotationInP-0n ai ai #zField
Ss0 @MessageFlowInP-0n messageIn messageIn #zField
Ss0 @MessageFlowOutP-0n messageOut messageOut #zField
Ss0 @TextInP .xml .xml #zField
Ss0 @TextInP .responsibility .responsibility #zField
Ss0 @UdInit f11 '' #zField
Ss0 @UdProcessEnd f14 '' #zField
Ss0 @UdProcessEnd f2 '' #zField
Ss0 @UdMethod f16 '' #zField
Ss0 @UdMethod f17 '' #zField
Ss0 @UdProcessEnd f18 '' #zField
Ss0 @GridStep f19 '' #zField
Ss0 @PushWFArc f20 '' #zField
Ss0 @UdMethod f25 '' #zField
Ss0 @GridStep f26 '' #zField
Ss0 @PushWFArc f27 '' #zField
Ss0 @UdProcessEnd f28 '' #zField
Ss0 @PushWFArc f29 '' #zField
Ss0 @GridStep f30 '' #zField
Ss0 @CallSub f7 '' #zField
Ss0 @GridStep f36 '' #zField
Ss0 @PushWFArc f38 '' #zField
Ss0 @CallSub f42 '' #zField
Ss0 @UdMethod f32 '' #zField
Ss0 @UdProcessEnd f33 '' #zField
Ss0 @PushWFArc f34 '' #zField
Ss0 @Alternative f39 '' #zField
Ss0 @PushWFArc f37 '' #zField
Ss0 @UdProcessEnd f46 '' #zField
Ss0 @UdProcessEnd f48 '' #zField
Ss0 @UdProcessEnd f52 '' #zField
Ss0 @GridStep f53 '' #zField
Ss0 @PushWFArc f55 '' #zField
Ss0 @PushWFArc f47 '' #zField
Ss0 @UdMethod f63 '' #zField
Ss0 @GridStep f65 '' #zField
Ss0 @UdProcessEnd f66 '' #zField
Ss0 @UdMethod f70 '' #zField
Ss0 @Alternative f62 '' #zField
Ss0 @Alternative f3 '' #zField
Ss0 @PushWFArc f1 '' #zField
Ss0 @GridStep f5 '' #zField
Ss0 @PushWFArc f61 '' #zField
Ss0 @PushWFArc f0 '' #zField
Ss0 @GridStep f4 '' #zField
Ss0 @PushWFArc f64 '' #zField
Ss0 @PushWFArc f80 '' #zField
Ss0 @PushWFArc f77 '' #zField
Ss0 @PushWFArc f69 '' #zField
Ss0 @GridStep f72 '' #zField
Ss0 @PushWFArc f79 '' #zField
Ss0 @PushWFArc f81 '' #zField
Ss0 @PushWFArc f31 '' #zField
Ss0 @UdMethod f83 '' #zField
Ss0 @PushWFArc f84 '' #zField
Ss0 @UdMethod f6 '' #zField
Ss0 @PushWFArc f8 '' #zField
Ss0 @UdMethod f9 '' #zField
Ss0 @PushWFArc f10 '' #zField
Ss0 @UdMethod f35 '' #zField
Ss0 @PushWFArc f40 '' #zField
Ss0 @UdMethod f41 '' #zField
Ss0 @PushWFArc f43 '' #zField
Ss0 @UdMethod f44 '' #zField
Ss0 @PushWFArc f45 '' #zField
Ss0 @GridStep f49 '' #zField
Ss0 @PushWFArc f51 '' #zField
Ss0 @PushWFArc f50 '' #zField
Ss0 @PushWFArc f54 '' #zField
Ss0 @PushWFArc f56 '' #zField
Ss0 @PushWFArc f57 '' #zField
Ss0 @PushWFArc f12 '' #zField
Ss0 @GridStep f13 '' #zField
Ss0 @PushWFArc f15 '' #zField
Ss0 @PushWFArc f21 '' #zField
Ss0 @GridStep f22 '' #zField
Ss0 @PushWFArc f23 '' #zField
Ss0 @PushWFArc f24 '' #zField
Ss0 @Alternative f59 '' #zField
Ss0 @PushWFArc f60 '' #zField
Ss0 @PushWFArc f68 '' #zField
Ss0 @PushWFArc f67 '' #zField
>Proto Ss0 Ss0 StatisticDashboardWidgetProcess #zField
Ct0 @TextInP .type .type #zField
Ct0 @TextInP .processKind .processKind #zField
Ct0 @TextInP .xml .xml #zField
Ct0 @TextInP .responsibility .responsibility #zField
Ct0 @CallSub f74 '' #zField
Ct0 @GridStep f73 '' #zField
Ct0 @CallSub f60 '' #zField
Ct0 @PushTrueWFOutG-01 g2 '' #zField
Ct0 @PushWFArc f2 '' #zField
Ct0 @PushWFArc f0 '' #zField
Ct0 @PushWFArc f3 '' #zField
Ct0 @PushTrueWFInG-01 g1 '' #zField
Ct0 @PushWFArc f4 '' #zField
>Proto Ct0 Ct0 Component #zField
Ss0 S10 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Fetch Default Charts</name>
    </language>
</elementInfo>
' #txt
Ss0 S10 872 266 128 44 -56 -8 #rect
Ss0 f11 guid 1604F11B5BA97CC5 #txt
Ss0 f11 method start() #txt
Ss0 f11 inParameterDecl '<> param;' #txt
Ss0 f11 inParameterMapAction 'out.isFinishLoadCharts=false;
' #txt
Ss0 f11 outParameterDecl '<> result;' #txt
Ss0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>start()</name>
        <nameStyle>7,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f11 123 51 26 26 -16 15 #rect
Ss0 f14 275 51 26 26 0 12 #rect
Ss0 f2 1467 275 26 26 0 12 #rect
Ss0 f16 guid 16052B0B212D3060 #txt
Ss0 f16 method moveLeft(ch.ivy.addon.portalkit.statistics.StatisticChart) #txt
Ss0 f16 inParameterDecl '<ch.ivy.addon.portalkit.statistics.StatisticChart statisticChart> param;' #txt
Ss0 f16 inParameterMapAction 'out.selectedStatisticChart=param.statisticChart;
' #txt
Ss0 f16 outParameterDecl '<> result;' #txt
Ss0 f16 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>moveLeft(StatisticChart)</name>
        <nameStyle>24,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f16 691 659 26 26 -65 15 #rect
Ss0 f17 guid 16052B0B70AD24B1 #txt
Ss0 f17 method moveRight(ch.ivy.addon.portalkit.statistics.StatisticChart) #txt
Ss0 f17 inParameterDecl '<ch.ivy.addon.portalkit.statistics.StatisticChart statisticChart> param;' #txt
Ss0 f17 inParameterMapAction 'out.selectedStatisticChart=param.statisticChart;
' #txt
Ss0 f17 outParameterDecl '<> result;' #txt
Ss0 f17 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>moveRight(StatisticChart)</name>
        <nameStyle>25,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f17 691 755 26 26 -70 15 #rect
Ss0 f18 1123 659 26 26 0 12 #rect
Ss0 f19 actionTable 'out=in;
' #txt
Ss0 f19 actionCode 'import ch.ivy.addon.portalkit.service.StatisticService;
import ch.ivy.addon.portalkit.statistics.StatisticChart;

StatisticService service = new StatisticService();

for(StatisticChart chart : in.statisticChartList) {
		int newPosition = in.statisticChartList.indexOf(chart);
		if (chart.position != newPosition) {
			chart.setPosition(newPosition);
			service.save(chart);
		}
}' #txt
Ss0 f19 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Update charts position</name>
        <nameStyle>22
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f19 928 650 128 44 -61 -8 #rect
Ss0 f20 expr out #txt
Ss0 f20 1056 672 1123 672 #arcP
Ss0 f25 guid 16052B8CCBF953C6 #txt
Ss0 f25 method deleteChart() #txt
Ss0 f25 inParameterDecl '<> param;' #txt
Ss0 f25 outParameterDecl '<> result;' #txt
Ss0 f25 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>deleteChart(StatisticChart)</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f25 115 659 26 26 -72 15 #rect
Ss0 f26 actionTable 'out=in;
' #txt
Ss0 f26 actionCode 'import ch.ivy.addon.portalkit.statistics.StatisticChart;
import ch.ivy.addon.portalkit.service.StatisticService;

StatisticService service = new StatisticService();

in.statisticChartList.remove(in.selectedStatisticChart);
service.delete(in.selectedStatisticChart.id);

for(StatisticChart chart : in.statisticChartList) {
      chart.setPosition(in.statisticChartList.indexOf(chart));
	service.save(chart);
}' #txt
Ss0 f26 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Delete chart</name>
        <nameStyle>12
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f26 256 650 112 44 -33 -8 #rect
Ss0 f27 expr out #txt
Ss0 f27 141 672 256 672 #arcP
Ss0 f28 475 659 26 26 0 12 #rect
Ss0 f29 expr out #txt
Ss0 f29 368 672 475 672 #arcP
Ss0 f30 actionTable 'out=in;
' #txt
Ss0 f30 actionCode 'import java.util.ArrayList;
import ch.ivy.addon.portalkit.service.StatisticService;

StatisticService service = new StatisticService();
if (in.statisticChartList.size() != 0) {
	in.hasStatistic = true;
	if(in.selectedItemOfDrilldown.isEmpty()){
		service.generateChartModelForStatisticCharts(in.statisticChartList);
	}
} else {
	in.hasStatistic = false;
}

in.isFinishLoadCharts = true;
in.prevStatisticList = new ArrayList(in.statisticChartList);
in.defaultCharts.clear();' #txt
Ss0 f30 security system #txt
Ss0 f30 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Generate dashboard chart</name>
        <nameStyle>24,5
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f30 1208 264 144 48 -72 -8 #rect
Ss0 f7 processCall 'Functional Processes/Navigator:viewTaskForAnalytic(String,ch.ivyteam.ivy.workflow.query.TaskQuery)' #txt
Ss0 f7 requestActionDecl '<String chartName,ch.ivyteam.ivy.workflow.query.TaskQuery taskQuery> param;' #txt
Ss0 f7 requestMappingAction 'param.chartName=in.taskListName;
param.taskQuery=in.taskQuery;
' #txt
Ss0 f7 responseActionDecl 'ch.ivy.addon.portalkit.component.statistic.StatisticDashboardWidget.StatisticDashboardWidgetData out;
' #txt
Ss0 f7 responseMappingAction 'out=in;
' #txt
Ss0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Navigator</name>
        <nameStyle>9,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f7 488 402 112 44 -26 -8 #rect
Ss0 f36 actionTable 'out=in;
' #txt
Ss0 f36 actionCode 'import ch.ivy.addon.portalkit.service.StatisticService;
import ch.ivy.addon.portalkit.ivydata.service.impl.LanguageService;
import ch.ivy.addon.portalkit.ivydata.service.impl.LanguageService;
import org.apache.commons.lang3.StringUtils;
import ch.ivy.addon.portalkit.datamodel.TaskLazyDataModel;
import ch.ivy.addon.portalkit.service.StatisticService;
import ch.ivy.addon.portalkit.statistics.StatisticChartQueryUtils;
import ch.ivy.addon.portalkit.statistics.StatisticChart;

if (StatisticService.selectMonthOfYear(in.selectedItemOfDrilldown))  {
	in.previousSelectedMonth = in.selectedItemOfDrilldown;
} else if (StatisticService.selectWeekOfMonth(in.selectedItemOfDrilldown))  {
	in.previousSelectedWeek = in.selectedItemOfDrilldown;
} else if (StatisticService.selectDayOfWeek(in.selectedItemOfDrilldown)) {
	in.previousSelectedDay = in.selectedItemOfDrilldown;
}

StatisticService service = new StatisticService();
in.chartNameOfCurrentLanguage = service.getDisplayNameInUserLanguageForChart(in.selectedStatisticChart).getValue();

in.taskListName = in.chartNameOfCurrentLanguage + " - " + in.selectedItemOfDrilldown;
if (StatisticService.selectHourOfDay(in.selectedItemOfDrilldown)) {
	in.taskListName += " " + ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/statistic/chart/taskByExpiry/hour");
}
in.selectedItemOfDrilldown = StringUtils.EMPTY;
' #txt
Ss0 f36 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Build task query</name>
        <nameStyle>16
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f36 296 250 112 44 -43 -8 #rect
Ss0 f38 expr out #txt
Ss0 f38 408 272 544 402 #arcP
Ss0 f38 1 544 272 #addKink
Ss0 f38 0 0.7876935071335653 0 0 #arcLabel
Ss0 f42 processCall 'Functional Processes/Navigator:viewCaseForAnalytic(String,ch.ivyteam.ivy.workflow.query.CaseQuery)' #txt
Ss0 f42 requestActionDecl '<String chartName,ch.ivyteam.ivy.workflow.query.CaseQuery caseQuery> param;' #txt
Ss0 f42 requestMappingAction 'param.chartName=in.chartNameOfCurrentLanguage;
param.caseQuery=in.caseQuery;
' #txt
Ss0 f42 responseActionDecl 'ch.ivy.addon.portalkit.component.statistic.StatisticDashboardWidget.StatisticDashboardWidgetData out;
' #txt
Ss0 f42 responseMappingAction 'out=in;
' #txt
Ss0 f42 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Navigator</name>
        <nameStyle>9,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f42 344 474 112 44 -26 -8 #rect
Ss0 f32 guid 160E2C0243084AFE #txt
Ss0 f32 method selectChart(ch.ivy.addon.portalkit.statistics.StatisticChart) #txt
Ss0 f32 inParameterDecl '<ch.ivy.addon.portalkit.statistics.StatisticChart chart> param;' #txt
Ss0 f32 inParameterMapAction 'out.selectedStatisticChart=param.chart;
' #txt
Ss0 f32 outParameterDecl '<> result;' #txt
Ss0 f32 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>selectChart(StatisticChart)</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f32 115 755 26 26 -72 15 #rect
Ss0 f33 475 755 26 26 0 12 #rect
Ss0 f34 expr out #txt
Ss0 f34 141 768 475 768 #arcP
Ss0 f39 216 256 32 32 0 16 #rect
Ss0 f37 expr in #txt
Ss0 f37 outCond 'in.showTaskListImmediately || in.isDrilldownToTaskList' #txt
Ss0 f37 248 272 296 272 #arcP
Ss0 f46 539 195 26 26 0 12 #rect
Ss0 f48 486 563 26 26 0 12 #rect
Ss0 f52 1107 531 26 26 0 12 #rect
Ss0 f53 actionTable 'out=in;
' #txt
Ss0 f53 actionCode 'import ch.ivy.addon.portalkit.service.StatisticService;

in.isFinishLoadCharts = false;

if (StatisticService.selectMonthOfYear(in.selectedItemOfDrilldown))  {
	in.previousSelectedMonth = in.selectedItemOfDrilldown;
} else if (StatisticService.selectWeekOfMonth(in.selectedItemOfDrilldown))  {
	in.previousSelectedWeek = in.selectedItemOfDrilldown;
} else if (StatisticService.selectDayOfWeek(in.selectedItemOfDrilldown)) {
	in.previousSelectedDay = in.selectedItemOfDrilldown;
}
' #txt
Ss0 f53 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set data</name>
    </language>
</elementInfo>
' #txt
Ss0 f53 832 522 112 44 -22 -8 #rect
Ss0 f55 expr out #txt
Ss0 f55 944 544 1107 544 #arcP
Ss0 f47 expr in #txt
Ss0 f47 232 256 539 208 #arcP
Ss0 f47 1 232 208 #addKink
Ss0 f47 1 0.30783775632694704 0 0 #arcLabel
Ss0 f63 guid 168FFD6C153F13B5 #txt
Ss0 f63 method generateChartModel() #txt
Ss0 f63 inParameterDecl '<> param;' #txt
Ss0 f63 outParameterDecl '<> result;' #txt
Ss0 f63 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>generateChartModel</name>
    </language>
</elementInfo>
' #txt
Ss0 f63 699 275 26 26 -58 21 #rect
Ss0 f65 actionTable 'out=in;
' #txt
Ss0 f65 actionCode 'import java.util.ArrayList;
import org.apache.commons.collections.CollectionUtils;
import ch.ivy.addon.portalkit.statistics.StatisticChart;
import ch.ivy.addon.portalkit.service.StatisticService;

if (in.statisticChartList.size() != 0) {
	StatisticService service = new StatisticService();
	service.generateChartModelForStatisticCharts(in.statisticChartList);
	in.hasStatistic = true;
} else {
	in.hasStatistic = false;
}

in.prevStatisticList = new ArrayList(in.statisticChartList);
in.isFinishLoadCharts = true;
in.defaultCharts.clear();
' #txt
Ss0 f65 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Generate compact chart</name>
    </language>
</elementInfo>
' #txt
Ss0 f65 1208 200 144 48 -67 -8 #rect
Ss0 f66 1219 51 26 26 0 12 #rect
Ss0 f70 guid 16F16B7D136FCEC1 #txt
Ss0 f70 method initialize(java.util.List<ch.ivy.addon.portalkit.statistics.StatisticChart>,Boolean,Boolean,Boolean,Boolean) #txt
Ss0 f70 inParameterDecl '<java.util.List<ch.ivy.addon.portalkit.statistics.StatisticChart> statisticChartList,Boolean showTaskListImmediately,Boolean isBackFromDrilldown,Boolean isCompactMode,Boolean isDrilldownExpiryChart> param;' #txt
Ss0 f70 inParameterMapAction 'out.isBackFromDrilldown=param.isBackFromDrilldown;
out.isCompactMode=param.isCompactMode;
out.showTaskListImmediately=param.showTaskListImmediately;
out.statisticChartList=param.statisticChartList;
' #txt
Ss0 f70 outParameterDecl '<> result;' #txt
Ss0 f70 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>initialize</name>
        <nameStyle>10,5
</nameStyle>
    </language>
</elementInfo>
' #txt
Ss0 f70 699 51 26 26 -27 16 #rect
Ss0 f62 784 48 32 32 0 16 #rect
Ss0 f3 1064 272 32 32 0 16 #rect
Ss0 f1 1000 288 1064 288 #arcP
Ss0 f5 actionTable 'out=in;
' #txt
Ss0 f5 actionCode 'import java.util.ArrayList;
import org.apache.commons.lang3.StringUtils;
import ch.ivy.addon.portalkit.jsf.ManagedBeans;
import ch.ivy.addon.portalkit.bean.StatisticDashboardBean;
import ch.ivy.addon.portalkit.statistics.StatisticChart;
import ch.ivy.addon.portalkit.service.StatisticService;

StatisticService service = new StatisticService();
	
if (in.isBackFromDrilldown) {
	in.selectedItemOfDrilldown = null;
	in.isFinishLoadCharts = false;
	
	in.statisticChartList = service.findStatisticChartsByUserId(ivy.session.getSessionUser().getId());
}

if (!in.isDrilldownExpiryChart) {
	in.hasStatistic = false;
}

/* isReloadChartContent is a flag to reload the ChartJS canvas on UI 
	 If isFinishLoadCharts is true, we will reload the ChartJS canvas to draw new canva based on new data
	 If statisticChartList is changed, we need to reload ChartJS canvas due to we have to rebuild chart
 	 Always set new value for isReloadChartContent when re-rendering component
*/
StatisticDashboardBean statisticDashboardBean = ManagedBeans.get("statisticDashboardBean") as StatisticDashboardBean;
in.isReloadChartContent = statisticDashboardBean.isChartModelNotInitialized(in.statisticChartList) || !in.isFinishLoadCharts || !service.isSame(in.prevStatisticList, in.statisticChartList);

if (in.isReloadChartContent && StringUtils.isEmpty(in.selectedItemOfDrilldown)) {
	// In case, isReloadChartContent indicator is true and not drilldown to expiry chart, we need to generate a placeholder chart to show on UI
	// It will make comfortable when user is waiting for drawing canvas
	service.generatePlaceholderForChart(in.statisticChartList);
	in.isFinishLoadCharts = false;
} else if (StringUtils.isNotEmpty(in.selectedItemOfDrilldown)) {
	// Drilldown to expiry chart, no need to build placeholder chart because we don''t call database
	// Directly generate ChartJS canva, so we dont need to reload page
	StatisticChart newChart = service.drilldownExpiryChart(in.selectedItemOfDrilldown,in.selectedStatisticChart,in.previousSelectedMonth, in.previousSelectedWeek);
	service.drilldownExpiryChart(in.selectedItemOfDrilldown,in.selectedStatisticChart,in.previousSelectedMonth, in.previousSelectedWeek);
	in.statisticChartList.clear();
	in.statisticChartList.add(in.selectedStatisticChart);
	in.statisticChartList.add(newChart);

	in.isFinishLoadCharts = true;
	in.prevStatisticList = new ArrayList(in.statisticChartList);
	in.isReloadChartContent = false;
}


' #txt
Ss0 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Create a placeholder for dashboard</name>
    </language>
</elementInfo>
' #txt
Ss0 f5 888 42 208 44 -97 -8 #rect
Ss0 f61 1096 64 1219 64 #arcP
Ss0 f0 149 64 275 64 #arcP
Ss0 f4 actionTable 'out=in;
' #txt
Ss0 f4 actionCode 'import javax.faces.context.FacesContext;
import ch.ivy.addon.portalkit.bean.StatisticDashboardBean;
import ch.ivy.addon.portalkit.statistics.StatisticChart;
import java.util.ArrayList;

if (in.statisticChartList.isEmpty()) {
	FacesContext context = FacesContext.getCurrentInstance();
	StatisticDashboardBean statisticDashboardBean = context.getApplication()
		.evaluateExpressionGet(context, "#{statisticDashboardBean}", StatisticDashboardBean.class) as StatisticDashboardBean;
	StatisticChart emptyChart = statisticDashboardBean.createDefaultEmptyChart();
	in.statisticChartList = new ArrayList<StatisticChart>();
	in.statisticChartList.add(emptyChart);
}' #txt
Ss0 f4 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Check user has charts</name>
    </language>
</elementInfo>
' #txt
Ss0 f4 1208 360 144 48 -61 -8 #rect
Ss0 f64 1352 384 1480 301 #arcP
Ss0 f64 1 1480 384 #addKink
Ss0 f64 1 0.03651860630634248 0 0 #arcLabel
Ss0 f80 expr out #txt
Ss0 f80 1352 288 1467 288 #arcP
Ss0 f80 0 0.8471095959837521 0 0 #arcLabel
Ss0 f77 1352 224 1480 275 #arcP
Ss0 f77 1 1480 224 #addKink
Ss0 f77 0 0.05614676741636741 0 0 #arcLabel
Ss0 f69 725 64 784 64 #arcP
Ss0 f72 actionTable 'out=in;
' #txt
Ss0 f72 actionCode 'import ch.ivy.addon.portalkit.util.BeanUtils;
import ch.ivy.addon.portalkit.service.StatisticService;
import java.util.ArrayList;
import ch.ivy.addon.portalkit.service.DummyStatisticService;

StatisticService service = new StatisticService();
in.isGuide = ch.ivy.addon.portalkit.bo.GuidePool.instance().guide(ivy.session.getSessionUserName()).isGuideShown();
if (in.isGuide) {
	in.statisticChartList = [DummyStatisticService.createDummyChartForGuide()];
}

/* isReloadChartContent is a flag to reload the ChartJS canvas on UI 
	 If isFinishLoadCharts is true, we will reload the ChartJS canvas to draw new canva based on new data
	 If statisticChartList is changed, we need to reload ChartJS canvas due to we have to rebuild chart
 	 Always set new value for isReloadChartContent when re-rendering component
*/
in.isReloadChartContent = !in.isFinishLoadCharts || !service.isSame(in.prevStatisticList, in.statisticChartList);

if (in.isReloadChartContent) {
	// In case, isReloadChartContent indicator is true and not drilldown to expiry chart, we need to generate a placeholder chart to show on UI
	// It will make comfortable when user is waiting for drawing canvas
	service.generatePlaceholderForChart(in.statisticChartList);
	in.isFinishLoadCharts = false;
}' #txt
Ss0 f72 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Create a placeholder for carousel</name>
    </language>
</elementInfo>
' #txt
Ss0 f72 888 112 208 48 -91 -8 #rect
Ss0 f79 expr in #txt
Ss0 f79 outCond in.isCompactMode #txt
Ss0 f79 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>compact mode</name>
    </language>
</elementInfo>
' #txt
Ss0 f79 800 80 888 136 #arcP
Ss0 f79 1 800 136 #addKink
Ss0 f79 0 1.0 35 17 #arcLabel
Ss0 f81 1096 136 1232 77 #arcP
Ss0 f81 1 1232 136 #addKink
Ss0 f81 0 0.6983191969457467 0 0 #arcLabel
Ss0 f31 expr in #txt
Ss0 f31 816 64 888 64 #arcP
Ss0 f83 guid 172118B5A5BCDFA3 #txt
Ss0 f83 method drilldownTaskByPriority(String,ch.ivyteam.ivy.workflow.query.TaskQuery) #txt
Ss0 f83 inParameterDecl '<String taskListName,ch.ivyteam.ivy.workflow.query.TaskQuery taskQuery> param;' #txt
Ss0 f83 inParameterMapAction 'out.taskListName=param.taskListName;
out.taskQuery=param.taskQuery;
' #txt
Ss0 f83 outParameterDecl '<> result;' #txt
Ss0 f83 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>drilldownTaskByPriority(String,TaskQuery)</name>
    </language>
</elementInfo>
' #txt
Ss0 f83 115 411 26 26 -64 12 #rect
Ss0 f84 141 424 488 424 #arcP
Ss0 f84 0 0.5039194664928536 0 0 #arcLabel
Ss0 f6 guid 17211FB704E994CF #txt
Ss0 f6 method drilldownCaseByState(ch.ivy.addon.portalkit.statistics.StatisticChart,ch.ivyteam.ivy.workflow.query.CaseQuery) #txt
Ss0 f6 inParameterDecl '<ch.ivy.addon.portalkit.statistics.StatisticChart selectedStatisticChart,ch.ivyteam.ivy.workflow.query.CaseQuery caseQuery> param;' #txt
Ss0 f6 inParameterMapAction 'out.caseQuery=param.caseQuery;
out.selectedStatisticChart=param.selectedStatisticChart;
' #txt
Ss0 f6 outParameterDecl '<> result;' #txt
Ss0 f6 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>drilldownCaseByState(StatisticChart,CaseQuery)</name>
    </language>
</elementInfo>
' #txt
Ss0 f6 115 483 26 26 -64 14 #rect
Ss0 f8 141 496 344 496 #arcP
Ss0 f8 0 0.5123943661971831 0 0 #arcLabel
Ss0 f9 guid 172122396A7D2B17 #txt
Ss0 f9 method drilldownElapsedTime(ch.ivy.addon.portalkit.statistics.StatisticChart,String) #txt
Ss0 f9 inParameterDecl '<ch.ivy.addon.portalkit.statistics.StatisticChart selectedStatisticChart,String selectedCaseCategory> param;' #txt
Ss0 f9 inParameterMapAction 'out.selectedCaseCategory=param.selectedCaseCategory;
out.selectedStatisticChart=param.selectedStatisticChart;
' #txt
Ss0 f9 outParameterDecl '<> result;' #txt
Ss0 f9 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>drilldownElapsedTime(StatisticChart,String)</name>
    </language>
</elementInfo>
' #txt
Ss0 f9 115 563 26 26 -64 18 #rect
Ss0 f10 141 576 486 576 #arcP
Ss0 f35 guid 172124FE5841FB53 #txt
Ss0 f35 method onSelectDrilldownTaskByExpiry(Boolean,String,ch.ivy.addon.portalkit.statistics.StatisticChart,ch.ivyteam.ivy.workflow.query.TaskQuery) #txt
Ss0 f35 inParameterDecl '<Boolean isDrilldownToTaskList,String selectedItemOfDrilldown,ch.ivy.addon.portalkit.statistics.StatisticChart selectedStatisticChart,ch.ivyteam.ivy.workflow.query.TaskQuery taskQuery> param;' #txt
Ss0 f35 inParameterMapAction 'out.isDrilldownToTaskList=param.isDrilldownToTaskList;
out.selectedItemOfDrilldown=param.selectedItemOfDrilldown;
out.selectedStatisticChart=param.selectedStatisticChart;
out.taskQuery=param.taskQuery;
' #txt
Ss0 f35 outParameterDecl '<> result;' #txt
Ss0 f35 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>onSelectDrilldownTaskByExpiry(Boolean,String,StatisticChart,TaskQuery)</name>
    </language>
</elementInfo>
' #txt
Ss0 f35 115 259 26 26 -63 28 #rect
Ss0 f40 141 272 216 272 #arcP
Ss0 f41 guid 1721265AF851FB22 #txt
Ss0 f41 method toTaskByExpiryTaskList(String,ch.ivy.addon.portalkit.statistics.StatisticChart,ch.ivyteam.ivy.workflow.query.TaskQuery) #txt
Ss0 f41 inParameterDecl '<String selectedItemOfDrilldown,ch.ivy.addon.portalkit.statistics.StatisticChart selectedStatisticChart,ch.ivyteam.ivy.workflow.query.TaskQuery taskQuery> param;' #txt
Ss0 f41 inParameterMapAction 'out.selectedItemOfDrilldown=param.selectedItemOfDrilldown;
out.selectedStatisticChart=param.selectedStatisticChart;
out.taskQuery=param.taskQuery;
' #txt
Ss0 f41 outParameterDecl '<> result;' #txt
Ss0 f41 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>toTaskByExpiryTaskList(String,StatisticChart,TaskQuery)</name>
    </language>
</elementInfo>
' #txt
Ss0 f41 115 339 26 26 -66 11 #rect
Ss0 f43 141 352 352 294 #arcP
Ss0 f43 1 352 352 #addKink
Ss0 f43 0 0.6935149083325024 0 0 #arcLabel
Ss0 f44 guid 1721272BDEB5A469 #txt
Ss0 f44 method drilldownTaskByExpiry(ch.ivy.addon.portalkit.statistics.StatisticChart,String) #txt
Ss0 f44 inParameterDecl '<ch.ivy.addon.portalkit.statistics.StatisticChart selectedStatisticChart,String selectedItemOfDrilldown> param;' #txt
Ss0 f44 inParameterMapAction 'out.selectedItemOfDrilldown=param.selectedItemOfDrilldown;
out.selectedStatisticChart=param.selectedStatisticChart;
' #txt
Ss0 f44 outParameterDecl '<> result;' #txt
Ss0 f44 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>drilldownTaskByExpiry(StatisticChart,String)</name>
    </language>
</elementInfo>
' #txt
Ss0 f44 691 531 26 26 -55 20 #rect
Ss0 f45 717 544 832 544 #arcP
Ss0 f49 actionTable 'out=in;
' #txt
Ss0 f49 actionCode 'import ch.ivy.addon.portalkit.service.DummyStatisticService;
import java.util.ArrayList;
import ch.ivy.addon.portalkit.service.StatisticService;

StatisticService service = new StatisticService();
service.fetchStatisticColor();
in.statisticChartList = [DummyStatisticService.createDummyChartForGuide()];
in.prevStatisticList = new ArrayList(in.statisticChartList);' #txt
Ss0 f49 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Create dummy chart</name>
    </language>
</elementInfo>
' #txt
Ss0 f49 1224 426 112 44 -53 -8 #rect
Ss0 f51 expr in #txt
Ss0 f51 outCond in.isGuide #txt
Ss0 f51 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>isGuide</name>
    </language>
</elementInfo>
' #txt
Ss0 f51 1080 304 1224 448 #arcP
Ss0 f51 1 1088 448 #addKink
Ss0 f51 1 0.2734375 0 -14 #arcLabel
Ss0 f50 expr in #txt
Ss0 f50 outCond in.statisticChartList.isEmpty() #txt
Ss0 f50 1080 304 1208 384 #arcP
Ss0 f50 1 1096 384 #addKink
Ss0 f54 expr in #txt
Ss0 f54 outCond 'in.isFinishLoadCharts && new ch.ivy.addon.portalkit.service.StatisticService().isSame(in.prevStatisticList, in.statisticChartList)' #txt
Ss0 f54 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>haven''t data changed in Statistics</name>
    </language>
</elementInfo>
' #txt
Ss0 f54 1084 300 1480 301 #arcP
Ss0 f54 1 1096 336 #addKink
Ss0 f54 2 1480 336 #addKink
Ss0 f56 expr in #txt
Ss0 f56 outCond in.isCompactMode #txt
Ss0 f56 1083 275 1208 224 #arcP
Ss0 f56 1 1096 224 #addKink
Ss0 f57 expr in #txt
Ss0 f57 1096 288 1208 288 #arcP
Ss0 f12 1336 448 1480 301 #arcP
Ss0 f12 1 1480 448 #addKink
Ss0 f12 0 0.6951177187602995 0 0 #arcLabel
Ss0 f13 actionTable 'out=in;
' #txt
Ss0 f13 actionCode 'import java.util.Collections;

int currentIndex = out.statisticChartList.indexOf(out.selectedStatisticChart);
if (currentIndex > 0) {
	Collections.swap(out.statisticChartList, currentIndex, currentIndex - 1);
}
' #txt
Ss0 f13 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Move left</name>
    </language>
</elementInfo>
' #txt
Ss0 f13 776 650 112 44 -23 -8 #rect
Ss0 f15 expr out #txt
Ss0 f15 717 672 776 672 #arcP
Ss0 f15 0 0.6448097490615718 0 0 #arcLabel
Ss0 f21 888 672 928 672 #arcP
Ss0 f21 0 0.6448097490615718 0 0 #arcLabel
Ss0 f22 actionTable 'out=in;
' #txt
Ss0 f22 actionCode 'import java.util.Collections;

int currentIndex = in.statisticChartList.indexOf(in.selectedStatisticChart);
if (currentIndex < in.statisticChartList.size()) {
	Collections.swap(in.statisticChartList, currentIndex, currentIndex + 1);
}' #txt
Ss0 f22 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Move right</name>
    </language>
</elementInfo>
' #txt
Ss0 f22 776 746 112 44 -27 -8 #rect
Ss0 f23 expr out #txt
Ss0 f23 717 768 776 768 #arcP
Ss0 f23 0 0.7583859937504577 0 0 #arcLabel
Ss0 f24 888 768 992 694 #arcP
Ss0 f24 1 992 768 #addKink
Ss0 f24 0 0.7583859937504577 0 0 #arcLabel
Ss0 f59 792 272 32 32 0 16 #rect
Ss0 f60 725 288 792 288 #arcP
Ss0 f68 expr in #txt
Ss0 f68 outCond in.isFinishLoadCharts #txt
Ss0 f68 808 272 1080 272 #arcP
Ss0 f68 1 808 232 #addKink
Ss0 f68 2 1080 232 #addKink
Ss0 f67 expr in #txt
Ss0 f67 824 288 872 288 #arcP
>Proto Ss0 .type ch.ivy.addon.portalkit.component.statistic.StatisticDashboardWidget.StatisticDashboardWidgetData #txt
>Proto Ss0 .processKind HTML_DIALOG #txt
>Proto Ss0 -8 -8 16 16 16 26 #rect
Ct0 f74 processCall 'Functional Processes/DefaultChartColors:defaultChartColors()' #txt
Ct0 f74 requestActionDecl '<> param;' #txt
Ct0 f74 responseMappingAction 'out=in;
out.chartColors=result.chartColors;
' #txt
Ct0 f74 responseActionCode 'import ch.ivy.addon.portalkit.service.StatisticService;

StatisticService service = new StatisticService();
service.setStatisticsColors(result.chartColors);' #txt
Ct0 f74 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>DefaultChartColors</name>
    </language>
</elementInfo>
' #txt
Ct0 f74 192 138 112 44 -53 -8 #rect
Ct0 f73 actionTable 'out=in;
' #txt
Ct0 f73 actionCode 'import ch.ivy.addon.portalkit.service.StatisticService;
import ch.ivy.addon.portalkit.statistics.StatisticChart;
import java.util.ArrayList;

StatisticService service = new StatisticService();
in.statisticChartList = service.updateExistedChartsWithNewCharts(in.statisticChartList, in.defaultCharts);
' #txt
Ct0 f73 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add to chart list</name>
    </language>
</elementInfo>
' #txt
Ct0 f73 568 138 112 44 -41 -8 #rect
Ct0 f60 processCall 'Functional Processes/DefaultChart:createDefaultChart()' #txt
Ct0 f60 requestActionDecl '<> param;' #txt
Ct0 f60 responseActionDecl 'ch.ivy.addon.portalkit.component.StatisticWidget.StatisticWidgetData out;
' #txt
Ct0 f60 responseMappingAction 'out=in;
out.defaultCharts=result.charts;
' #txt
Ct0 f60 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>DefaultChart</name>
        <nameStyle>12,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ct0 f60 376 138 112 44 -34 -8 #rect
Ct0 g2 779 147 26 26 0 5 #rect
Ct0 f2 680 160 779 160 #arcP
Ct0 f0 304 160 376 160 #arcP
Ct0 f3 488 160 568 160 #arcP
Ct0 g1 75 147 26 26 -47 5 #rect
Ct0 f4 101 160 192 160 #arcP
>Proto Ct0 0 0 32 24 18 0 #rect
>Proto Ct0 @|BIcon #fIcon
Ss0 f19 mainOut f20 tail #connect
Ss0 f20 head f18 mainIn #connect
Ss0 f25 mainOut f27 tail #connect
Ss0 f27 head f26 mainIn #connect
Ss0 f26 mainOut f29 tail #connect
Ss0 f29 head f28 mainIn #connect
Ss0 f36 mainOut f38 tail #connect
Ss0 f38 head f7 mainIn #connect
Ss0 f32 mainOut f34 tail #connect
Ss0 f34 head f33 mainIn #connect
Ss0 f39 out f37 tail #connect
Ss0 f37 head f36 mainIn #connect
Ss0 f53 mainOut f55 tail #connect
Ss0 f55 head f52 mainIn #connect
Ss0 f39 out f47 tail #connect
Ss0 f47 head f46 mainIn #connect
Ss0 S10 g2 f1 tail #connect
Ss0 f1 head f3 in #connect
Ss0 f5 mainOut f61 tail #connect
Ss0 f61 head f66 mainIn #connect
Ss0 f11 mainOut f0 tail #connect
Ss0 f0 head f14 mainIn #connect
Ss0 f4 mainOut f64 tail #connect
Ss0 f64 head f2 mainIn #connect
Ss0 f30 mainOut f80 tail #connect
Ss0 f80 head f2 mainIn #connect
Ss0 f65 mainOut f77 tail #connect
Ss0 f77 head f2 mainIn #connect
Ss0 f70 mainOut f69 tail #connect
Ss0 f69 head f62 in #connect
Ss0 f62 out f79 tail #connect
Ss0 f79 head f72 mainIn #connect
Ss0 f72 mainOut f81 tail #connect
Ss0 f81 head f66 mainIn #connect
Ss0 f62 out f31 tail #connect
Ss0 f31 head f5 mainIn #connect
Ss0 f83 mainOut f84 tail #connect
Ss0 f84 head f7 mainIn #connect
Ss0 f6 mainOut f8 tail #connect
Ss0 f8 head f42 mainIn #connect
Ss0 f9 mainOut f10 tail #connect
Ss0 f10 head f48 mainIn #connect
Ss0 f35 mainOut f40 tail #connect
Ss0 f40 head f39 in #connect
Ss0 f41 mainOut f43 tail #connect
Ss0 f43 head f36 mainIn #connect
Ss0 f44 mainOut f45 tail #connect
Ss0 f45 head f53 mainIn #connect
Ss0 f3 out f51 tail #connect
Ss0 f51 head f49 mainIn #connect
Ss0 f3 out f50 tail #connect
Ss0 f50 head f4 mainIn #connect
Ss0 f3 out f54 tail #connect
Ss0 f54 head f2 mainIn #connect
Ss0 f3 out f56 tail #connect
Ss0 f56 head f65 mainIn #connect
Ss0 f3 out f57 tail #connect
Ss0 f57 head f30 mainIn #connect
Ss0 f49 mainOut f12 tail #connect
Ss0 f12 head f2 mainIn #connect
Ss0 f16 mainOut f15 tail #connect
Ss0 f15 head f13 mainIn #connect
Ss0 f13 mainOut f21 tail #connect
Ss0 f21 head f19 mainIn #connect
Ss0 f17 mainOut f23 tail #connect
Ss0 f23 head f22 mainIn #connect
Ss0 f22 mainOut f24 tail #connect
Ss0 f24 head f19 mainIn #connect
Ss0 f63 mainOut f60 tail #connect
Ss0 f60 head f59 in #connect
Ss0 f59 out f68 tail #connect
Ss0 f68 head f3 in #connect
Ss0 f59 out f67 tail #connect
Ss0 f67 head S10 g1 #connect
Ct0 f73 mainOut f2 tail #connect
Ct0 f2 head g2 m #connect
Ct0 f74 mainOut f0 tail #connect
Ct0 f0 head f60 mainIn #connect
Ct0 f60 mainOut f3 tail #connect
Ct0 f3 head f73 mainIn #connect
Ct0 g1 m f4 tail #connect
Ct0 f4 head f74 mainIn #connect
Ct0 0 0 928 328 0 #ivRect
