<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://xmlns.jcp.org/jsf/core"      
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:ic="http://ivyteam.ch/jsf/component"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:pm="http://primefaces.org/mobile"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
      
  <cc:interface componentType="IvyComponent">
  	  <cc:attribute name="case" type="ch.ivy.addon.portalkit.bo.RemoteCase"/>
  	  <cc:attribute name="documents" type="java.util.ArrayList"/>
  </cc:interface>
  
  <cc:implementation>
    <div class="grid-item" jsf:id="#{cc.clientId}">
    	<c:set value="#{cc.attrs.case}" var="case"/>
    	<c:set var="documents" value="#{cc.attrs.documents}"/>
        <h2 class="grid-item-header">
          #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseDetails/documents')}
        </h2>
        <div class="grid-item-content">
          <h:panelGroup layout="block" id="case-details-documents" styleClass="grid-item-content-list">
            <div jsf:rendered="#{empty documents}" class="grid-item-content-list-item">
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseDetails/noDocuments')}" />           
            </div>
            <ui:repeat var="document" value="#{documents}">
              <div class="grid-item-content-list-item mod-has-action">
                <p:commandLink ajax="false">
                  <p:fileDownload value="#{logic.downloadDocument(document,case)}"/>
                  <i class="fa fa-file-pdf-o task-details-document-download-icon" />
                  <h:outputText value="#{document.name}" />
                </p:commandLink>
                <p:commandLink actionListener="#{logic.setDataToDelete(document, case)}" styleClass="fa fa-trash-o Fright"
                  oncomplete="PF('document-deletion-dialog-#{case.id}').show()" />
              </div>
            </ui:repeat>
          </h:panelGroup>
        </div>
        <h:panelGroup layout="block" styleClass="grid-item-footer">
          <p:commandLink id="add-document-command" process="@this" actionListener="#{data.setRemoteCase(case)}" oncomplete="PF('document-upload-dialog-#{case.id}').show()">
            <i class="fa fa-plus-circle grid-item-footer-icon" />
            <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseDetails/addDocument')}" />
          </p:commandLink>
        </h:panelGroup>
        
        <p:dialog id="document-upload-dialog-#{case.id}"
			widgetVar="document-upload-dialog-#{case.id}" appendTo="@(body)"
			header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseDetails/addDocument')}"
			modal="true" resizable="false" showEffect="fade" hideEffect="fade"
			width="800">
			<p:messages id="upload-messages" />
			<h:outputText
				value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseDetails/addDocumentHelpText')}" />
			<p:fileUpload styleClass="document-upload" id="document-upload-panel"
				fileUploadListener="#{logic.uploadDocument}" mode="advanced"
				dragDropSupport="true" multiple="true"
				update="upload-messages case-details-documents"
				label="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/choose')}"
				uploadLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/upload')}"
				cancelLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" />

			<f:facet name="footer">
				<p:commandButton id="document-upload-close-command" type="button"
					value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/close')}"
					onclick="PF('document-upload-dialog-#{case.id}').hide(); scrollDocumentsToBottom()" />
			</f:facet>
		</p:dialog>
		
		<p:confirmDialog
			widgetVar="document-deletion-dialog-#{case.id}"
			message="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/confirmForDelete')}"
			header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/confirmation')}"
			appendTo="@(body)" severity="alert">
			<p:commandButton styleClass="document-deletion-command"
				id="document-deletion-command"
				value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/yes')}"
				process="@this" update="case-details-documents"
				actionListener="#{logic.deleteDocument}"
				oncomplete="PF('document-deletion-dialog-#{case.id}').hide()" />
			<p:commandButton id="document-deletion-cancellation-command"
				type="button"
				value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/no')}"
				onclick="PF('document-deletion-dialog-#{case.id}').hide()" />
		</p:confirmDialog>
      </div>
  </cc:implementation>
</html>