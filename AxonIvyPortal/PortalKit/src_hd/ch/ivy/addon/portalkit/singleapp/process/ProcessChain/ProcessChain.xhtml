<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:pm="http://primefaces.org/mobile">

<cc:interface componentType="IvyComponent">
	<cc:attribute name="componentId" type="java.lang.String" default="process-chain-component-id" />
	<cc:attribute name="steps" shortDescription="List of step in the process chain" />
	<cc:attribute name="actualStepIndex" type="java.lang.Integer" default="4" shortDescription="Actual step index or current step index" />
	<cc:attribute name="type" type="java.lang.String" default="LINE" shortDescription="type of process chain: CIRCLE, LINE, HORIZONTAL" />
	<cc:attribute name="isShowAllSteps" type="java.lang.Boolean" default="true" />

	<cc:attribute name="stages" type="java.util.List&lt;ch.ivyteam.ivy.casemap.runtime.model.IStage&gt;" />
	<cc:attribute name="currentIndex" type="java.lang.Integer" />
</cc:interface>

<cc:implementation>
	<!-- Process chain of axon express -->
	<c:set var="isCircleType" value="#{cc.attrs.type eq 'CIRCLE'}" />
	<c:set var="isLineType" value="#{cc.attrs.type eq 'LINE'}" />
	<c:set var="isHorizontalType" value="#{cc.attrs.type eq 'HORIZONTAL'}" />
	<h:panelGroup id="#{cc.attrs.componentId}" class="process-chain #{isCircleType ? 'circle-process-chain' : (isLineType ? 'line-process-chain' : 'horizontal-process-chain')}">
		<c:forEach items="#{cc.attrs.steps}" var="stepName" varStatus="counter">
			<c:set var="isFirstStep" value="#{counter.index eq 0}" />
			<c:set var="isLastStep" value="#{counter.index eq (cc.attrs.steps.size() - 1)}" />
			<c:set var="isCurrentStep" value="#{counter.index eq cc.attrs.actualStepIndex}" />
			<c:set var="isPreCurrentStep" value="#{counter.index eq (cc.attrs.actualStepIndex - 1)}" />
			<c:set var="isNextCurrentStep" value="#{counter.index eq (cc.attrs.actualStepIndex + 1)}" />

			<c:set var="isVisitedStep" value="#{cc.attrs.actualStepIndex > counter.index}" />
			<c:set var="isCurrentStepPassedThreeSteps" value="#{cc.attrs.actualStepIndex > 2}" />
			<c:set var="isStepNeedMoreThreeSteps" value="#{counter.index lt (cc.attrs.steps.size()-2)}" />
			<c:set var="isShowAllSteps" value="#{cc.attrs.isShowAllSteps}" />
			<c:set var="isHideNextSteps" value="#{(isFirstStep and isCurrentStepPassedThreeSteps) or (isNextCurrentStep and isStepNeedMoreThreeSteps)}" />
			<c:set var="isDisplayedStep" value="#{isFirstStep or isLastStep or isCurrentStep or isNextCurrentStep or isPreCurrentStep}" />
			<c:set var="processStepTypeCssClass" value="#{isCurrentStep ? 'current' :  isVisitedStep ? 'visited' : 'waiting'}" />
			<c:if test="#{isCircleType}">
				<h:panelGroup layout="block" id="step-info-#{counter.index}" rendered="#{isShowAllSteps or isDisplayedStep}"
					class="circle-process-step #{isHideNextSteps and !isShowAllSteps ? 'hide-steps' : ''} #{processStepTypeCssClass}">
					<span class="circle-step-title">${stepName}</span>
					<h:panelGroup layout="block" id="step-count-container-#{counter.index}" styleClass="circle-step-count-container">
						<span>#{counter.index + 1}</span>
					</h:panelGroup>
				</h:panelGroup>
			</c:if>

			<c:if test="#{isHorizontalType}">
				<h:panelGroup layout="block" id="step-info-#{counter.index}" rendered="#{isShowAllSteps or isDisplayedStep}"
					class="horizontal-process-step #{isHideNextSteps and !isShowAllSteps ? 'hide-steps' : ''} #{processStepTypeCssClass}">
					<h:panelGroup layout="block" id="step-count-container-#{counter.index}" styleClass="horizontal-step-count-container">
						<span>#{counter.index + 1}</span>
					</h:panelGroup>
					<span class="horizontal-step-title">${stepName}</span>
				</h:panelGroup>
			</c:if>

			<c:if test="#{isLineType}">
				<c:set var="isHideLeftSteps" value="#{isPreCurrentStep and isCurrentStepPassedThreeSteps}" />
				<c:set var="isHideRightSteps" value="#{isNextCurrentStep and isStepNeedMoreThreeSteps}" />
				<h:panelGroup rendered="#{isHideLeftSteps and !isShowAllSteps}" layout="block" id="hide-steps-#{counter.index}" styleClass="line-process-step hide-left-steps" />
				<h:panelGroup rendered="#{isShowAllSteps or isDisplayedStep}" layout="block" id="step-info-#{counter.index}"
					class="line-process-step #{isCurrentStep ? 'current' : isVisitedStep ? 'visited' : 'waiting'}">
					<span class="line-step-title">${stepName}</span>
					<h:panelGroup layout="block" id="step-count-container-#{counter.index}" styleClass="line-step-count-container" />
				</h:panelGroup>
				<h:panelGroup rendered="#{isHideRightSteps and !isShowAllSteps}" layout="block" id="many-steps-#{counter.index}" styleClass="line-process-step hide-right-steps" />
			</c:if>
			<p:tooltip for="step-info-#{counter.index}" value="#{stepName}" trackMouse="true" />
		</c:forEach>
	</h:panelGroup>

	<!-- Stages breadcrumb for CaseMap -->
	<h:panelGroup id="stage-breadcrumb" class="stages-chain">
		<c:forEach items="#{cc.attrs.stages}" var="stage" varStatus="counter">
			<h:panelGroup layout="block" id="stage-info-#{counter.index}"
				class="process-step #{cc.attrs.currentIndex eq counter.index ? 'current' :  cc.attrs.currentIndex > counter.index ? 'visited' : 'waiting'}">
				<span class="stage-title"><i class="#{stage.icon.cssClass eq '' ? 'fa fa-square' : stage.icon.cssClass}" /><br /> <span class="stage-name">#{stage.name}</span></span>
			</h:panelGroup>
			<p:tooltip for="stage-info-#{counter.index}" value="#{stage.name}" trackMouse="true" />
			<c:if test="#{cc.attrs.stages.size() gt counter.index+1}">
				<div class="process-flow">
					<div class="flow-txt">
						<div class="#{stage.isTerminating()  ? 'none' : 'visible'}" />
					</div>
				</div>
			</c:if>
		</c:forEach>
	</h:panelGroup>
</cc:implementation>

</html>