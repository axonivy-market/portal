[Ivy]
146C8E81DE07F973 3.20 #module
>Proto >Proto Collection #zClass
Te0 TaskService Big #zClass
Te0 B #cInfo
Te0 #process
Te0 @TextInP .resExport .resExport #zField
Te0 @TextInP .type .type #zField
Te0 @TextInP .processKind .processKind #zField
Te0 @AnnotationInP-0n ai ai #zField
Te0 @TextInP .xml .xml #zField
Te0 @TextInP .responsibility .responsibility #zField
Te0 @EndSub f3 '' #zField
Te0 @StartSub f10 '' #zField
Te0 @GridStep f19 '' #zField
Te0 @CallSub f22 '' #zField
Te0 @GridStep f18 '' #zField
Te0 @GridStep f15 '' #zField
Te0 @StartSub f17 '' #zField
Te0 @GridStep f28 '' #zField
Te0 @CallSub f33 '' #zField
Te0 @StartSub f62 '' #zField
Te0 @GridStep f56 '' #zField
Te0 @PushWFArc f73 '' #zField
Te0 @GridStep f81 '' #zField
Te0 @GridStep f83 '' #zField
Te0 @StartSub f84 '' #zField
Te0 @CallSub f85 '' #zField
Te0 @PushWFArc f89 '' #zField
Te0 @PushWFArc f91 '' #zField
Te0 @StartSub f96 '' #zField
Te0 @GridStep f101 '' #zField
Te0 @CallSub f103 '' #zField
Te0 @PushWFArc f104 '' #zField
Te0 @GridStep f105 '' #zField
Te0 @CallSub f144 '' #zField
Te0 @PushWFArc f40 '' #zField
Te0 @Alternative f148 '' #zField
Te0 @PushWFArc f145 '' #zField
Te0 @PushWFArc f21 '' #zField
Te0 @PushWFArc f64 '' #zField
Te0 @PushWFArc f88 '' #zField
Te0 @PushWFArc f108 '' #zField
Te0 @CallSub f147 '' #zField
Te0 @GridStep f150 '' #zField
Te0 @StartSub f151 '' #zField
Te0 @GridStep f152 '' #zField
Te0 @Alternative f153 '' #zField
Te0 @GridStep f155 '' #zField
Te0 @GridStep f156 '' #zField
Te0 @GridStep f157 '' #zField
Te0 @CallSub f159 '' #zField
Te0 @Alternative f160 '' #zField
Te0 @PushWFArc f162 '' #zField
Te0 @PushWFArc f164 '' #zField
Te0 @PushWFArc f165 '' #zField
Te0 @PushWFArc f166 '' #zField
Te0 @PushWFArc f169 '' #zField
Te0 @PushWFArc f170 '' #zField
Te0 @PushWFArc f172 '' #zField
Te0 @CallSub f176 '' #zField
Te0 @PushWFArc f177 '' #zField
Te0 @PushWFArc f74 '' #zField
Te0 @PushWFArc f53 '' #zField
Te0 @CallSub f54 '' #zField
Te0 @GridStep f55 '' #zField
Te0 @Alternative f57 '' #zField
Te0 @StartSub f58 '' #zField
Te0 @Alternative f60 '' #zField
Te0 @CallSub f65 '' #zField
Te0 @GridStep f66 '' #zField
Te0 @GridStep f67 '' #zField
Te0 @GridStep f68 '' #zField
Te0 @PushWFArc f70 '' #zField
Te0 @PushWFArc f72 '' #zField
Te0 @PushWFArc f75 '' #zField
Te0 @PushWFArc f76 '' #zField
Te0 @PushWFArc f118 '' #zField
Te0 @PushWFArc f120 '' #zField
Te0 @GridStep f121 '' #zField
Te0 @PushWFArc f95 '' #zField
Te0 @CallSub f12 '' #zField
Te0 @StartSub f59 '' #zField
Te0 @Alternative f61 '' #zField
Te0 @GridStep f106 '' #zField
Te0 @GridStep f110 '' #zField
Te0 @GridStep f111 '' #zField
Te0 @CallSub f112 '' #zField
Te0 @Alternative f113 '' #zField
Te0 @GridStep f114 '' #zField
Te0 @GridStep f115 '' #zField
Te0 @PushWFArc f122 '' #zField
Te0 @PushWFArc f125 '' #zField
Te0 @PushWFArc f126 '' #zField
Te0 @PushWFArc f127 '' #zField
Te0 @PushWFArc f129 '' #zField
Te0 @PushWFArc f131 '' #zField
Te0 @PushWFArc f133 '' #zField
Te0 @PushWFArc f134 '' #zField
Te0 @PushWFArc f135 '' #zField
Te0 @Alternative f136 '' #zField
Te0 @CallSub f137 '' #zField
Te0 @GridStep f138 '' #zField
Te0 @CallSub f139 '' #zField
Te0 @GridStep f141 '' #zField
Te0 @GridStep f142 '' #zField
Te0 @StartSub f143 '' #zField
Te0 @Alternative f146 '' #zField
Te0 @GridStep f149 '' #zField
Te0 @GridStep f154 '' #zField
Te0 @PushWFArc f175 '' #zField
Te0 @PushWFArc f179 '' #zField
Te0 @PushWFArc f180 '' #zField
Te0 @PushWFArc f181 '' #zField
Te0 @PushWFArc f183 '' #zField
Te0 @PushWFArc f185 '' #zField
Te0 @PushWFArc f187 '' #zField
Te0 @PushWFArc f188 '' #zField
Te0 @PushWFArc f189 '' #zField
Te0 @CallSub f191 '' #zField
Te0 @Alternative f192 '' #zField
Te0 @Alternative f193 '' #zField
Te0 @GridStep f194 '' #zField
Te0 @GridStep f195 '' #zField
Te0 @StartSub f196 '' #zField
Te0 @CallSub f197 '' #zField
Te0 @GridStep f198 '' #zField
Te0 @GridStep f199 '' #zField
Te0 @GridStep f200 '' #zField
Te0 @PushWFArc f202 '' #zField
Te0 @PushWFArc f204 '' #zField
Te0 @PushWFArc f205 '' #zField
Te0 @PushWFArc f206 '' #zField
Te0 @PushWFArc f208 '' #zField
Te0 @PushWFArc f210 '' #zField
Te0 @PushWFArc f212 '' #zField
Te0 @PushWFArc f213 '' #zField
Te0 @PushWFArc f214 '' #zField
Te0 @StartSub f0 '' #zField
Te0 @GridStep f8 '' #zField
Te0 @CallSub f11 '' #zField
Te0 @GridStep f26 '' #zField
Te0 @PushWFArc f31 '' #zField
Te0 @GridStep f32 '' #zField
Te0 @StartSub f34 '' #zField
Te0 @GridStep f35 '' #zField
Te0 @CallSub f36 '' #zField
Te0 @PushWFArc f37 '' #zField
Te0 @PushWFArc f38 '' #zField
Te0 @PushWFArc f42 '' #zField
Te0 @PushWFArc f44 '' #zField
Te0 @PushWFArc f13 '' #zField
Te0 @PushWFArc f6 '' #zField
Te0 @PushWFArc f7 '' #zField
Te0 @PushWFArc f14 '' #zField
Te0 @PushWFArc f1 '' #zField
Te0 @PushWFArc f4 '' #zField
Te0 @PushWFArc f2 '' #zField
Te0 @PushWFArc f5 '' #zField
Te0 @PushWFArc f9 '' #zField
Te0 @PushWFArc f16 '' #zField
Te0 @Alternative f20 '' #zField
Te0 @PushWFArc f24 '' #zField
Te0 @PushWFArc f30 '' #zField
Te0 @Alternative f39 '' #zField
Te0 @PushWFArc f47 '' #zField
Te0 @Alternative f49 '' #zField
Te0 @PushWFArc f50 '' #zField
Te0 @PushWFArc f51 '' #zField
Te0 @Alternative f63 '' #zField
Te0 @PushWFArc f69 '' #zField
Te0 @PushWFArc f71 '' #zField
Te0 @Alternative f79 '' #zField
Te0 @PushWFArc f80 '' #zField
Te0 @PushWFArc f82 '' #zField
Te0 @PushWFArc f93 '' #zField
Te0 @PushWFArc f99 '' #zField
Te0 @PushWFArc f45 '' #zField
Te0 @GridStep f78 '' #zField
Te0 @PushWFArc f87 '' #zField
Te0 @PushWFArc f90 '' #zField
Te0 @GridStep f97 '' #zField
Te0 @PushWFArc f98 '' #zField
Te0 @PushWFArc f92 '' #zField
Te0 @PushWFArc f48 '' #zField
Te0 @GridStep f100 '' #zField
Te0 @PushWFArc f102 '' #zField
Te0 @PushWFArc f107 '' #zField
Te0 @PushWFArc f109 '' #zField
Te0 @GridStep f52 '' #zField
Te0 @PushWFArc f116 '' #zField
Te0 @PushWFArc f117 '' #zField
Te0 @PushWFArc f77 '' #zField
Te0 @GridStep f119 '' #zField
Te0 @PushWFArc f123 '' #zField
Te0 @PushWFArc f124 '' #zField
Te0 @PushWFArc f86 '' #zField
Te0 @CallSub f128 '' #zField
Te0 @GridStep f130 '' #zField
Te0 @GridStep f132 '' #zField
Te0 @GridStep f140 '' #zField
Te0 @Alternative f158 '' #zField
Te0 @StartSub f161 '' #zField
Te0 @GridStep f163 '' #zField
Te0 @GridStep f167 '' #zField
Te0 @Alternative f171 '' #zField
Te0 @CallSub f173 '' #zField
Te0 @Alternative f174 '' #zField
Te0 @GridStep f178 '' #zField
Te0 @PushWFArc f182 '' #zField
Te0 @PushWFArc f184 '' #zField
Te0 @PushWFArc f186 '' #zField
Te0 @PushWFArc f190 '' #zField
Te0 @PushWFArc f201 '' #zField
Te0 @PushWFArc f203 '' #zField
Te0 @PushWFArc f207 '' #zField
Te0 @PushWFArc f209 '' #zField
Te0 @PushWFArc f211 '' #zField
Te0 @PushWFArc f215 '' #zField
Te0 @PushWFArc f216 '' #zField
Te0 @PushWFArc f217 '' #zField
Te0 @PushWFArc f218 '' #zField
Te0 @PushWFArc f219 '' #zField
Te0 @CallSub f220 '' #zField
Te0 @GridStep f221 '' #zField
Te0 @GridStep f222 '' #zField
Te0 @GridStep f223 '' #zField
Te0 @Alternative f224 '' #zField
Te0 @StartSub f225 '' #zField
Te0 @GridStep f226 '' #zField
Te0 @GridStep f227 '' #zField
Te0 @Alternative f228 '' #zField
Te0 @CallSub f229 '' #zField
Te0 @Alternative f230 '' #zField
Te0 @GridStep f231 '' #zField
Te0 @PushWFArc f232 '' #zField
Te0 @PushWFArc f233 '' #zField
Te0 @PushWFArc f234 '' #zField
Te0 @PushWFArc f235 '' #zField
Te0 @PushWFArc f236 '' #zField
Te0 @PushWFArc f237 '' #zField
Te0 @PushWFArc f238 '' #zField
Te0 @PushWFArc f239 '' #zField
Te0 @PushWFArc f240 '' #zField
Te0 @PushWFArc f241 '' #zField
Te0 @PushWFArc f242 '' #zField
Te0 @PushWFArc f243 '' #zField
Te0 @PushWFArc f244 '' #zField
Te0 @PushWFArc f245 '' #zField
Te0 @PushWFArc f246 '' #zField
Te0 @PushWFArc f247 '' #zField
Te0 @PushWFArc f94 '' #zField
Te0 @GridStep f248 '' #zField
Te0 @PushWFArc f29 '' #zField
Te0 @GridStep f252 '' #zField
Te0 @PushWFArc f43 '' #zField
Te0 @GridStep f259 '' #zField
Te0 @PushWFArc f27 '' #zField
Te0 @PushWFArc f262 '' #zField
Te0 @PushWFArc f255 '' #zField
Te0 @PushWFArc f168 '' #zField
Te0 @PushWFArc f258 '' #zField
Te0 @GridStep f260 '' #zField
Te0 @PushWFArc f261 '' #zField
Te0 @PushWFArc f23 '' #zField
Te0 @GridStep f250 '' #zField
Te0 @PushWFArc f251 '' #zField
Te0 @PushWFArc f263 '' #zField
Te0 @GridStep f46 '' #zField
Te0 @PushWFArc f249 '' #zField
Te0 @PushWFArc f41 '' #zField
Te0 @GridStep f256 '' #zField
Te0 @PushWFArc f257 '' #zField
Te0 @PushWFArc f254 '' #zField
Te0 @StartSub f25 '' #zField
Te0 @GridStep f253 '' #zField
Te0 @CallSub f264 '' #zField
Te0 @GridStep f265 '' #zField
Te0 @PushWFArc f266 '' #zField
Te0 @PushWFArc f267 '' #zField
Te0 @PushWFArc f268 '' #zField
Te0 @PushWFArc f269 '' #zField
Te0 @Alternative f270 '' #zField
Te0 @GridStep f271 '' #zField
Te0 @GridStep f272 '' #zField
Te0 @GridStep f273 '' #zField
Te0 @CallSub f274 '' #zField
Te0 @GridStep f275 '' #zField
Te0 @CallSub f276 '' #zField
Te0 @GridStep f277 '' #zField
Te0 @Alternative f278 '' #zField
Te0 @StartSub f279 '' #zField
Te0 @Alternative f280 '' #zField
Te0 @GridStep f281 '' #zField
Te0 @PushWFArc f282 '' #zField
Te0 @PushWFArc f283 '' #zField
Te0 @PushWFArc f284 '' #zField
Te0 @PushWFArc f285 '' #zField
Te0 @PushWFArc f286 '' #zField
Te0 @PushWFArc f287 '' #zField
Te0 @PushWFArc f288 '' #zField
Te0 @PushWFArc f289 '' #zField
Te0 @PushWFArc f290 '' #zField
Te0 @PushWFArc f291 '' #zField
Te0 @PushWFArc f292 '' #zField
Te0 @PushWFArc f293 '' #zField
Te0 @PushWFArc f294 '' #zField
Te0 @PushWFArc f295 '' #zField
Te0 @PushWFArc f296 '' #zField
Te0 @StartSub f297 '' #zField
Te0 @GridStep f298 '' #zField
Te0 @Alternative f299 '' #zField
Te0 @CallSub f300 '' #zField
Te0 @GridStep f301 '' #zField
Te0 @Alternative f302 '' #zField
Te0 @Alternative f303 '' #zField
Te0 @GridStep f304 '' #zField
Te0 @GridStep f305 '' #zField
Te0 @GridStep f306 '' #zField
Te0 @GridStep f307 '' #zField
Te0 @CallSub f308 '' #zField
Te0 @PushWFArc f309 '' #zField
Te0 @PushWFArc f310 '' #zField
Te0 @PushWFArc f311 '' #zField
Te0 @PushWFArc f312 '' #zField
Te0 @PushWFArc f313 '' #zField
Te0 @PushWFArc f314 '' #zField
Te0 @PushWFArc f315 '' #zField
Te0 @PushWFArc f316 '' #zField
Te0 @PushWFArc f317 '' #zField
Te0 @PushWFArc f318 '' #zField
Te0 @PushWFArc f319 '' #zField
Te0 @PushWFArc f320 '' #zField
Te0 @PushWFArc f321 '' #zField
Te0 @PushWFArc f322 '' #zField
Te0 @PushWFArc f323 '' #zField
>Proto Te0 Te0 TaskService #zField
Te0 f3 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f3 1347 995 26 26 14 0 #rect
Te0 f3 @|EndSubIcon #fIcon
Te0 f10 inParamDecl '<ch.ivy.addon.portalkit.persistence.domain.Server ivyServer,java.lang.Long taskId> param;' #txt
Te0 f10 inParamTable 'out.server=param.ivyServer;
out.taskId=param.taskId;
' #txt
Te0 f10 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,ch.ivy.addon.portalkit.bo.RemoteTask task> result;
' #txt
Te0 f10 outParamTable 'result.errors=in.errors;
result.task=in.task;
' #txt
Te0 f10 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f10 callSignature resetTask(ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Te0 f10 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f10 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>resetTask
(Server,Long)</name>
        <nameStyle>23,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f10 51 51 26 26 14 0 #rect
Te0 f10 @|StartSubIcon #fIcon
Te0 f19 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f19 actionTable 'out=in;
' #txt
Te0 f19 actionCode 'import ch.ivy.ws.addon.WsException;
for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Te0 f19 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f19 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions</desc>
    </language>
</elementInfo>
' #txt
Te0 f19 46 404 36 24 20 -2 #rect
Te0 f19 @|StepIcon #fIcon
Te0 f22 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f22 processCall ServiceIntegrators/TaskServiceIntegrator:resetTask(Boolean,ch.ivy.addon.portalkit.persistence.domain.Server,String,Long) #txt
Te0 f22 doCall true #txt
Te0 f22 requestActionDecl '<java.lang.Boolean isUrlBuiltFromSystemProperties,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint,java.lang.Long taskId> param;
' #txt
Te0 f22 requestMappingAction 'param.isUrlBuiltFromSystemProperties=in.isMultiServer;
param.server=in.server;
param.endpoint=in.endpoint;
param.taskId=in.taskId;
' #txt
Te0 f22 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f22 responseMappingAction 'out=in;
out.errors=result.errors;
out.ivyTask=result.task;
' #txt
Te0 f22 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>resetTask</name>
        <nameStyle>9,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f22 46 268 36 24 20 -2 #rect
Te0 f22 @|CallSubIcon #fIcon
Te0 f18 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f18 actionTable 'out=in;
' #txt
Te0 f18 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f18 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f18 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f18 46 116 36 24 20 -2 #rect
Te0 f18 @|StepIcon #fIcon
Te0 f15 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f15 actionTable 'out=in;
' #txt
Te0 f15 actionCode 'import ch.ivy.ws.addon.WsException;
for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Te0 f15 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f15 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions</desc>
    </language>
</elementInfo>
' #txt
Te0 f15 302 404 36 24 20 -2 #rect
Te0 f15 @|StepIcon #fIcon
Te0 f17 inParamDecl '<ch.ivy.ws.addon.IvySecurityMember ivySecurityMember,ch.ivy.addon.portalkit.persistence.domain.Server ivyServer,java.lang.Long taskId> param;' #txt
Te0 f17 inParamTable 'out.ivySecurityMember=param.ivySecurityMember;
out.server=param.ivyServer;
out.taskId=param.taskId;
' #txt
Te0 f17 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,ch.ivy.addon.portalkit.bo.RemoteTask task> result;
' #txt
Te0 f17 outParamTable 'result.errors=in.errors;
result.task=in.task;
' #txt
Te0 f17 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f17 callSignature delegateTask(ch.ivy.ws.addon.IvySecurityMember,ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Te0 f17 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f17 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>delegateTask
(IvySecurityMember,Server,Long)</name>
        <nameStyle>44,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f17 307 51 26 26 14 0 #rect
Te0 f17 @|StartSubIcon #fIcon
Te0 f28 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f28 actionTable 'out=in;
' #txt
Te0 f28 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f28 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f28 302 116 36 24 20 -2 #rect
Te0 f28 @|StepIcon #fIcon
Te0 f33 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f33 processCall ServiceIntegrators/TaskServiceIntegrator:delegateTask(Boolean,ch.ivy.addon.portalkit.persistence.domain.Server,ch.ivy.ws.addon.IvySecurityMember,String,Long) #txt
Te0 f33 doCall true #txt
Te0 f33 requestActionDecl '<java.lang.Boolean isUrlBuiltFromSystemProperties,ch.ivy.addon.portalkit.persistence.domain.Server server,ch.ivy.ws.addon.IvySecurityMember ivySecurityMember,java.lang.String endpoint,java.lang.Long taskId> param;
' #txt
Te0 f33 requestMappingAction 'param.isUrlBuiltFromSystemProperties=in.isMultiServer;
param.server=in.server;
param.ivySecurityMember=in.ivySecurityMember;
param.endpoint=in.endpoint;
param.taskId=in.taskId;
' #txt
Te0 f33 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f33 responseMappingAction 'out=in;
out.errors=result.errors;
out.ivyTask=result.task;
' #txt
Te0 f33 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>delegateTask</name>
        <nameStyle>12,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f33 302 268 36 24 20 -2 #rect
Te0 f33 @|CallSubIcon #fIcon
Te0 f62 inParamDecl '<java.lang.Long serverId,ch.ivy.ws.addon.TaskSearchCriteria taskSearchCriteria,java.lang.Integer startIndex,java.lang.Integer count> param;' #txt
Te0 f62 inParamTable 'out.count=param.count;
out.serverId=param.#serverId;
out.startIndex=param.startIndex;
out.taskSearchCriteria=param.taskSearchCriteria;
' #txt
Te0 f62 outParamDecl '<List<ch.ivy.addon.portalkit.bo.RemoteTask> allTasks,List<ch.ivy.ws.addon.WsException> errors,List<ch.ivy.addon.portalkit.bo.RemoteTask> tasks> result;
' #txt
Te0 f62 outParamTable 'result.allTasks=in.allTasks;
result.errors=in.errors;
result.tasks=in.tasks;
' #txt
Te0 f62 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f62 callSignature findTasksByCriteria(Long,ch.ivy.ws.addon.TaskSearchCriteria,Integer,Integer) #txt
Te0 f62 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f62 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findTasksByCriteria
(TaskSearchCriteria, startIndex, count)</name>
        <nameStyle>59,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f62 579 51 26 26 -65 -48 #rect
Te0 f62 @|StartSubIcon #fIcon
Te0 f56 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f56 actionTable 'out=in;
' #txt
Te0 f56 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
Long serverId = in.#serverId;
if (#serverId is initialized && serverId != 0) {
	in.servers = Arrays.asList(serverService.findById(serverId));
} else {
	in.servers = serverService.findActiveServers();
}' #txt
Te0 f56 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f56 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f56 574 116 36 24 20 -2 #rect
Te0 f56 @|StepIcon #fIcon
Te0 f73 expr out #txt
Te0 f73 592 77 592 116 #arcP
Te0 f81 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f81 actionTable 'out=in;
' #txt
Te0 f81 actionCode 'import ch.ivy.ws.addon.WsException;
for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Te0 f81 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f81 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions</desc>
    </language>
</elementInfo>
' #txt
Te0 f81 1014 244 36 24 20 -2 #rect
Te0 f81 @|StepIcon #fIcon
Te0 f83 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f83 actionTable 'out=in;
' #txt
Te0 f83 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f83 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f83 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f83 1014 116 36 24 20 -2 #rect
Te0 f83 @|StepIcon #fIcon
Te0 f84 inParamDecl '<java.lang.String userName,ch.ivy.addon.portalkit.persistence.domain.Server ivyServer,java.lang.Long taskId> param;' #txt
Te0 f84 inParamTable 'out.server=param.ivyServer;
out.taskId=param.taskId;
out.userName=param.userName;
' #txt
Te0 f84 outParamDecl '<java.lang.String workerUserName,List<ch.ivy.ws.addon.WsException> errors,java.lang.Boolean canUserResumeTask> result;
' #txt
Te0 f84 outParamTable 'result.workerUserName=in.workerUserName;
result.errors=in.errors;
result.canUserResumeTask=in.canUserResumeTask;
' #txt
Te0 f84 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f84 callSignature canUserResumeTask(String,ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Te0 f84 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f84 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>canUserResumeTask
(String,Server,Long)</name>
        <nameStyle>38,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f84 1019 51 26 26 14 0 #rect
Te0 f84 @|StartSubIcon #fIcon
Te0 f85 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f85 processCall ServiceIntegrators/TaskServiceIntegrator:canUserResumeTask(ch.ivy.addon.portalkit.persistence.domain.Server,String,String,Long) #txt
Te0 f85 doCall true #txt
Te0 f85 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String userName,java.lang.String endpoint,java.lang.Long taskId> param;
' #txt
Te0 f85 requestMappingAction 'param.server=in.server;
param.userName=in.userName;
param.endpoint=in.endpoint;
param.taskId=in.taskId;
' #txt
Te0 f85 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f85 responseMappingAction 'out=in;
out.canUserResumeTask=result.canUserResumeTask;
out.errors=result.errors;
out.workerUserName=result.workerUserName;
' #txt
Te0 f85 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>TaskServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f85 1014 180 36 24 20 -2 #rect
Te0 f85 @|CallSubIcon #fIcon
Te0 f89 expr out #txt
Te0 f89 1032 204 1032 244 #arcP
Te0 f91 expr out #txt
Te0 f91 1032 140 1032 180 #arcP
Te0 f96 inParamDecl '<java.lang.String noteContent,java.lang.String username,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long taskId> param;' #txt
Te0 f96 inParamTable 'out.noteContent=param.noteContent;
out.server=param.server;
out.taskId=param.taskId;
out.userName=param.username;
' #txt
Te0 f96 outParamDecl '<ch.ivy.ws.addon.IvyNote note,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f96 outParamTable 'result.note=in.note;
result.errors=in.errors;
' #txt
Te0 f96 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f96 callSignature createNote(String,String,ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Te0 f96 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f96 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>createNote
(String,String,Server,Long)</name>
        <nameStyle>38,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f96 1227 51 26 26 14 0 #rect
Te0 f96 @|StartSubIcon #fIcon
Te0 f101 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f101 actionTable 'out=in;
' #txt
Te0 f101 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f101 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f101 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f101 1222 132 36 24 20 -2 #rect
Te0 f101 @|StepIcon #fIcon
Te0 f103 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f103 processCall ServiceIntegrators/TaskServiceIntegrator:createNote(String,String,ch.ivy.addon.portalkit.persistence.domain.Server,String,Long) #txt
Te0 f103 doCall true #txt
Te0 f103 requestActionDecl '<java.lang.String endpoint,java.lang.String username,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String noteContent,java.lang.Long taskId> param;
' #txt
Te0 f103 requestMappingAction 'param.endpoint=in.endpoint;
param.username=in.userName;
param.server=in.server;
param.noteContent=in.noteContent;
param.taskId=in.taskId;
' #txt
Te0 f103 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f103 responseMappingAction 'out=in;
out.errors=result.errors;
out.note=result.note;
' #txt
Te0 f103 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CreateNoteServiceIntegrator</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f103 1222 196 36 24 20 -2 #rect
Te0 f103 @|CallSubIcon #fIcon
Te0 f104 expr out #txt
Te0 f104 1240 156 1240 196 #arcP
Te0 f105 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f105 actionTable 'out=in;
' #txt
Te0 f105 actionCode 'import ch.ivy.ws.addon.WsException;
for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Te0 f105 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f105 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f105 1222 260 36 24 14 9 #rect
Te0 f105 @|StepIcon #fIcon
Te0 f144 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f144 processCall 'Functional Processes/ErrorHandler:handle(List<ch.ivy.ws.addon.WsException>)' #txt
Te0 f144 doCall true #txt
Te0 f144 requestActionDecl '<java.util.List<ch.ivy.ws.addon.WsException> exceptions> param;
' #txt
Te0 f144 requestMappingAction 'param.exceptions=in.errors;
' #txt
Te0 f144 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f144 responseMappingAction 'out=in;
' #txt
Te0 f144 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>handle errors if any</name>
        <nameStyle>20,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f144 1342 948 36 24 20 -2 #rect
Te0 f144 @|CallSubIcon #fIcon
Te0 f40 expr out #txt
Te0 f40 1360 972 1360 995 #arcP
Te0 f148 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f148 1346 866 28 28 14 0 #rect
Te0 f148 @|AlternativeIcon #fIcon
Te0 f145 expr out #txt
Te0 f145 64 428 1346 880 #arcP
Te0 f145 1 64 880 #addKink
Te0 f145 1 0.3372157085423557 0 0 #arcLabel
Te0 f21 expr out #txt
Te0 f21 320 428 1347 879 #arcP
Te0 f21 1 320 832 #addKink
Te0 f21 0 0.8445206008999235 0 0 #arcLabel
Te0 f64 expr out #txt
Te0 f64 1032 268 1351 875 #arcP
Te0 f64 1 1032 688 #addKink
Te0 f64 1 0.2885922078745302 0 0 #arcLabel
Te0 f88 expr out #txt
Te0 f88 1240 284 1354 872 #arcP
Te0 f88 1 1240 704 #addKink
Te0 f88 1 0.325354739952554 0 0 #arcLabel
Te0 f108 expr out #txt
Te0 f108 1240 220 1240 260 #arcP
Te0 f147 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f147 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f147 doCall true #txt
Te0 f147 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Te0 f147 requestMappingAction 'param.server=in.server;
' #txt
Te0 f147 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f147 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Te0 f147 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get applications 
of server</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f147 774 356 36 24 20 -2 #rect
Te0 f147 @|CallSubIcon #fIcon
Te0 f150 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f150 actionTable 'out=in;
' #txt
Te0 f150 actionCode 'import ch.ivy.addon.portalkit.service.ServerService;

in.listIterator = in.servers.listIterator();' #txt
Te0 f150 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f150 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>init iterate servers</name>
        <nameStyle>20,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f150 774 116 36 24 20 -2 #rect
Te0 f150 @|StepIcon #fIcon
Te0 f151 inParamDecl '<java.util.List<ch.ivy.addon.portalkit.persistence.domain.Server> servers,ch.ivy.ws.addon.TaskSearchCriteria taskSearchCriteria,java.lang.Integer startIndex,java.lang.Integer count> param;' #txt
Te0 f151 inParamTable 'out.count=param.count;
out.servers=param.servers;
out.startIndex=param.startIndex;
out.taskSearchCriteria=param.taskSearchCriteria;
' #txt
Te0 f151 outParamDecl '<List<ch.ivy.addon.portalkit.bo.RemoteTask> allTasks,List<ch.ivy.ws.addon.WsException> errors,List<ch.ivy.addon.portalkit.bo.RemoteTask> tasks> result;
' #txt
Te0 f151 outParamTable 'result.allTasks=in.allTasks;
result.errors=in.errors;
result.tasks=in.tasks;
' #txt
Te0 f151 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f151 callSignature findTasksByCriteriaAndServers(List<ch.ivy.addon.portalkit.persistence.domain.Server>,ch.ivy.ws.addon.TaskSearchCriteria,Integer,Integer) #txt
Te0 f151 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f151 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findTasksByCriteriaAndServers
(TaskSearchCriteria, servers, startIndex, count)</name>
        <nameStyle>78,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f151 779 51 26 26 -49 -44 #rect
Te0 f151 @|StartSubIcon #fIcon
Te0 f152 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f152 actionTable 'out=in;
' #txt
Te0 f152 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (!in.apps.isEmpty()) {
	in.taskSearchCriteria.involvedApplications = in.apps.clear();
}' #txt
Te0 f152 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f152 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Te0 f152 878 228 36 24 20 -2 #rect
Te0 f152 @|StepIcon #fIcon
Te0 f153 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f153 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has apps?</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f153 778 498 28 28 14 0 #rect
Te0 f153 @|AlternativeIcon #fIcon
Te0 f155 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f155 actionTable 'out=in;
' #txt
Te0 f155 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.taskSearchCriteria.involvedUsername, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

in.taskSearchCriteria.involvedApplications = in.apps;' #txt
Te0 f155 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f155 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f155 774 436 36 24 21 -9 #rect
Te0 f155 @|StepIcon #fIcon
Te0 f156 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f156 actionTable 'out=in;
' #txt
Te0 f156 actionCode 'import ch.ivy.addon.portalkit.support.UrlDetector;
import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.bo.RemoteTask;
import ch.ivy.addon.portalkit.mapper.RemoteTaskMapper;

String host = "";
if (in.isMultiServer) {
	UrlDetector detector = new UrlDetector();
	host = detector.getHost(in.server.path);
}

List<RemoteTask> remoteTasks = RemoteTaskMapper.mapTasks(in.ivyTasks, host);
for (RemoteTask remoteTask : remoteTasks) {
	Application app = new Application();
	app.setServerId(in.server.id);
	app.setServer(in.server);
	remoteTask.setApplicationRegister(app);
}
in.tasks.addAll(remoteTasks);

List<RemoteTask> allRemoteTasks = RemoteTaskMapper.mapTasks(in.allIvyTasks, host);
for (RemoteTask remoteTask : allRemoteTasks) {
	Application app = new Application();
	app.setServerId(in.server.id);
	app.setServer(in.server);
	remoteTask.setApplicationRegister(app);
}
in.allTasks.addAll(allRemoteTasks);' #txt
Te0 f156 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f156 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add tasks</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f156 774 724 36 24 20 -2 #rect
Te0 f156 @|StepIcon #fIcon
Te0 f157 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f157 actionTable 'out=in;
' #txt
Te0 f157 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Te0 f157 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f157 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f157 774 228 36 24 20 -2 #rect
Te0 f157 @|StepIcon #fIcon
Te0 f159 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f159 processCall ServiceIntegrators/TaskServiceIntegrator:findTasksByCriteria(Boolean,ch.ivy.addon.portalkit.persistence.domain.Server,ch.ivy.ws.addon.TaskSearchCriteria,String,Integer,Integer) #txt
Te0 f159 doCall true #txt
Te0 f159 requestActionDecl '<java.lang.Boolean isUrlBuiltFromSystemProperties,ch.ivy.addon.portalkit.persistence.domain.Server server,ch.ivy.ws.addon.TaskSearchCriteria taskSearchCriteria,java.lang.String endpoint,java.lang.Integer startIndex,java.lang.Integer count> param;
' #txt
Te0 f159 requestMappingAction 'param.isUrlBuiltFromSystemProperties=in.isMultiServer;
param.server=in.server;
param.taskSearchCriteria=in.taskSearchCriteria;
param.endpoint=in.endpoint;
param.startIndex=in.startIndex;
param.count=in.count;
' #txt
Te0 f159 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f159 responseMappingAction 'out=in;
out.allIvyTasks=result.allTasks;
out.ivyTasks=result.tasks;
out.tempErrors=result.errors;
' #txt
Te0 f159 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>SearchTasks</name>
        <nameStyle>11,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f159 776 668 32 24 20 -2 #rect
Te0 f159 @|CallSubIcon #fIcon
Te0 f160 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f160 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f160 778 170 28 28 22 -21 #rect
Te0 f160 @|AlternativeIcon #fIcon
Te0 f162 expr out #txt
Te0 f162 810 736 896 252 #arcP
Te0 f162 1 896 736 #addKink
Te0 f162 1 0.41082947714321383 0 0 #arcLabel
Te0 f164 expr out #txt
Te0 f164 896 228 806 184 #arcP
Te0 f164 1 896 184 #addKink
Te0 f164 1 0.251489130890622 0 0 #arcLabel
Te0 f165 expr out #txt
Te0 f165 792 460 792 498 #arcP
Te0 f166 expr in #txt
Te0 f166 806 512 896 252 #arcP
Te0 f166 1 896 512 #addKink
Te0 f166 0 0.8799989356997663 0 0 #arcLabel
Te0 f169 expr out #txt
Te0 f169 792 77 792 116 #arcP
Te0 f170 expr out #txt
Te0 f170 792 140 792 170 #arcP
Te0 f172 expr in #txt
Te0 f172 outCond in.listIterator.hasNext() #txt
Te0 f172 792 198 792 228 #arcP
Te0 f176 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f176 processCall MultiPortal/TaskService:findTasksByCriteriaAndServers(List<ch.ivy.addon.portalkit.persistence.domain.Server>,ch.ivy.ws.addon.TaskSearchCriteria,Integer,Integer) #txt
Te0 f176 doCall true #txt
Te0 f176 requestActionDecl '<java.util.List<ch.ivy.addon.portalkit.persistence.domain.Server> servers,ch.ivy.ws.addon.TaskSearchCriteria taskSearchCriteria,java.lang.Integer startIndex,java.lang.Integer count> param;
' #txt
Te0 f176 requestMappingAction 'param.servers=in.servers;
param.taskSearchCriteria=in.taskSearchCriteria;
param.startIndex=in.startIndex;
param.count=in.count;
' #txt
Te0 f176 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f176 responseMappingAction 'out=in;
out.allTasks=result.allTasks;
out.errors=result.errors;
out.tasks=result.tasks;
' #txt
Te0 f176 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>TaskService</name>
        <nameStyle>11,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f176 574 188 36 24 20 -2 #rect
Te0 f176 @|CallSubIcon #fIcon
Te0 f177 expr out #txt
Te0 f177 592 140 592 188 #arcP
Te0 f74 expr out #txt
Te0 f74 592 212 1347 879 #arcP
Te0 f74 1 592 800 #addKink
Te0 f74 1 0.14309408299440282 0 0 #arcLabel
Te0 f53 expr in #txt
Te0 f53 778 184 1348 878 #arcP
Te0 f53 1 704 184 #addKink
Te0 f53 2 704 768 #addKink
Te0 f53 2 0.9863728673860209 0 0 #arcLabel
Te0 f54 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f54 processCall ServiceIntegrators/TaskServiceIntegrator:countTasksByCriteria(ch.ivy.addon.portalkit.persistence.domain.Server,ch.ivy.ws.addon.TaskSearchCriteria,String) #txt
Te0 f54 doCall true #txt
Te0 f54 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server,ch.ivy.ws.addon.TaskSearchCriteria taskSearchCriteria,java.lang.String endpoint> param;
' #txt
Te0 f54 requestMappingAction 'param.server=in.server;
param.taskSearchCriteria=in.taskSearchCriteria;
param.endpoint=in.endpoint;
' #txt
Te0 f54 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f54 responseMappingAction 'out=in;
out.taskCountOfOneServer=result.taskCount;
out.tempErrors=result.errors;
' #txt
Te0 f54 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CountTasks</name>
        <nameStyle>10,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f54 1534 604 36 24 20 -2 #rect
Te0 f54 @|CallSubIcon #fIcon
Te0 f55 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f55 actionTable 'out=in;
' #txt
Te0 f55 actionCode 'in.taskCount += in.taskCountOfOneServer;' #txt
Te0 f55 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f55 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add task count</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f55 1534 660 36 24 20 -2 #rect
Te0 f55 @|StepIcon #fIcon
Te0 f57 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f57 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f57 1538 170 28 28 22 -21 #rect
Te0 f57 @|AlternativeIcon #fIcon
Te0 f58 inParamDecl '<java.lang.Long serverId,ch.ivy.ws.addon.TaskSearchCriteria taskSearchCriteria> param;' #txt
Te0 f58 inParamTable 'out.serverId=param.#serverId;
out.taskSearchCriteria=param.#taskSearchCriteria;
' #txt
Te0 f58 outParamDecl '<java.lang.Long taskCount,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f58 outParamTable 'result.taskCount=in.taskCount;
result.errors=in.errors;
' #txt
Te0 f58 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f58 callSignature countTasksByCriteria(Long,ch.ivy.ws.addon.TaskSearchCriteria) #txt
Te0 f58 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f58 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>countTasksByCriteria
(Long,TaskSearchCriteria)</name>
        <nameStyle>46,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f58 1539 51 26 26 -49 -44 #rect
Te0 f58 @|StartSubIcon #fIcon
Te0 f60 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f60 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has apps?</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f60 1538 482 28 28 14 0 #rect
Te0 f60 @|AlternativeIcon #fIcon
Te0 f65 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f65 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f65 doCall true #txt
Te0 f65 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Te0 f65 requestMappingAction 'param.server=in.server;
' #txt
Te0 f65 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f65 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Te0 f65 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get applications 
of server</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f65 1534 356 36 24 20 -2 #rect
Te0 f65 @|CallSubIcon #fIcon
Te0 f66 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f66 actionTable 'out=in;
' #txt
Te0 f66 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Te0 f66 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f66 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f66 1534 228 36 24 20 -2 #rect
Te0 f66 @|StepIcon #fIcon
Te0 f67 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f67 actionTable 'out=in;
' #txt
Te0 f67 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.taskSearchCriteria.involvedUsername, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

in.taskSearchCriteria.involvedApplications = in.apps;' #txt
Te0 f67 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f67 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f67 1534 420 36 24 22 -9 #rect
Te0 f67 @|StepIcon #fIcon
Te0 f68 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f68 actionTable 'out=in;
' #txt
Te0 f68 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (!in.apps.isEmpty()) {
	in.taskSearchCriteria.involvedApplications = in.apps.clear();
}' #txt
Te0 f68 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f68 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Te0 f68 1638 228 36 24 20 -2 #rect
Te0 f68 @|StepIcon #fIcon
Te0 f70 expr out #txt
Te0 f70 1570 672 1656 252 #arcP
Te0 f70 1 1656 672 #addKink
Te0 f70 1 0.41082947714321383 0 0 #arcLabel
Te0 f72 expr out #txt
Te0 f72 1656 228 1566 184 #arcP
Te0 f72 1 1656 184 #addKink
Te0 f72 1 0.251489130890622 0 0 #arcLabel
Te0 f75 expr out #txt
Te0 f75 1552 444 1552 482 #arcP
Te0 f76 expr in #txt
Te0 f76 1566 496 1656 252 #arcP
Te0 f76 1 1656 496 #addKink
Te0 f76 0 0.8799989356997663 0 0 #arcLabel
Te0 f118 expr in #txt
Te0 f118 outCond in.listIterator.hasNext() #txt
Te0 f118 1552 198 1552 228 #arcP
Te0 f120 expr in #txt
Te0 f120 1538 184 1366 872 #arcP
Te0 f120 1 1481 184 #addKink
Te0 f120 2 1481 720 #addKink
Te0 f120 2 0.41034644898445616 0 0 #arcLabel
Te0 f121 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f121 actionTable 'out=in;
' #txt
Te0 f121 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
Long serverId = in.#serverId;
if (#serverId is initialized && serverId != 0) {
	in.servers = Arrays.asList(serverService.findById(serverId));
} else {
	in.servers = serverService.findActiveServers();
}
in.listIterator = in.servers.listIterator();' #txt
Te0 f121 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f121 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f121 1534 108 36 24 20 -2 #rect
Te0 f121 @|StepIcon #fIcon
Te0 f95 expr out #txt
Te0 f95 1552 132 1552 170 #arcP
Te0 f12 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f12 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f12 doCall true #txt
Te0 f12 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Te0 f12 requestMappingAction 'param.server=in.server;
' #txt
Te0 f12 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f12 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Te0 f12 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get applications 
of server</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f12 1806 356 36 24 20 -2 #rect
Te0 f12 @|CallSubIcon #fIcon
Te0 f59 inParamDecl '<java.lang.String jsonQuery,java.lang.String userName,List<java.lang.String> apps,java.lang.Long serverId> param;' #txt
Te0 f59 inParamTable 'out.apps=param.apps;
out.hasNoSelectedApp=param.apps.isEmpty();
out.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
out.userName=param.userName;
' #txt
Te0 f59 outParamDecl '<java.util.List<ch.ivy.ws.addon.CategoryData> categories,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f59 outParamTable 'result.categories=in.categories;
result.errors=in.errors;
' #txt
Te0 f59 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f59 callSignature findCategories(String,String,List<String>,Long) #txt
Te0 f59 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f59 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findCategories(String,String,List&lt;String&gt;,Long)</name>
        <nameStyle>47,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f59 1811 51 26 26 -50 -39 #rect
Te0 f59 @|StartSubIcon #fIcon
Te0 f61 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f61 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f61 1810 170 28 28 22 -21 #rect
Te0 f61 @|AlternativeIcon #fIcon
Te0 f106 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f106 actionTable 'out=in;
' #txt
Te0 f106 actionCode 'import java.util.Set;
import java.util.HashSet;

Set categories = new HashSet(in.categories);
in.categories.clear();
in.categories.addAll(categories);' #txt
Te0 f106 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f106 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add categories</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f106 1806 652 36 24 20 -2 #rect
Te0 f106 @|StepIcon #fIcon
Te0 f110 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f110 actionTable 'out=in;
' #txt
Te0 f110 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Te0 f110 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f110 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f110 1806 228 36 24 20 -2 #rect
Te0 f110 @|StepIcon #fIcon
Te0 f111 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f111 actionTable 'out=in;
' #txt
Te0 f111 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.userName, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}
' #txt
Te0 f111 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f111 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f111 1806 420 36 24 21 -7 #rect
Te0 f111 @|StepIcon #fIcon
Te0 f112 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f112 processCall ServiceIntegrators/TaskServiceIntegrator:findCategories(String,String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Te0 f112 doCall true #txt
Te0 f112 requestActionDecl '<java.lang.String jsonQuery,java.lang.String userName,List<java.lang.String> apps,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Te0 f112 requestMappingAction 'param.jsonQuery=in.jsonQuery;
param.userName=in.userName;
param.apps=in.apps;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Te0 f112 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f112 responseMappingAction 'out=in;
out.categories=in.categories.addAll(result.categories);
out.tempErrors=result.errors;
' #txt
Te0 f112 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>FindCategories</name>
        <nameStyle>14,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f112 1806 596 36 24 20 -2 #rect
Te0 f112 @|CallSubIcon #fIcon
Te0 f113 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f113 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has apps?</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f113 1810 474 28 28 14 0 #rect
Te0 f113 @|AlternativeIcon #fIcon
Te0 f114 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f114 actionTable 'out=in;
' #txt
Te0 f114 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (in.hasNoSelectedApp) {
	in.apps.clear();
}' #txt
Te0 f114 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f114 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Te0 f114 1950 228 36 24 20 -2 #rect
Te0 f114 @|StepIcon #fIcon
Te0 f115 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f115 actionTable 'out=in;
' #txt
Te0 f115 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
Long serverId = in.server.#id;
if (#serverId is initialized && serverId != 0) {
	in.servers = Arrays.asList(serverService.findById(serverId));
} else {
	in.servers = serverService.findActiveServers();
}
in.listIterator = in.servers.listIterator();' #txt
Te0 f115 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f115 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f115 1806 108 36 24 20 -2 #rect
Te0 f115 @|StepIcon #fIcon
Te0 f122 expr out #txt
Te0 f122 1842 664 1968 252 #arcP
Te0 f122 1 1968 664 #addKink
Te0 f122 1 0.3622224354814317 0 0 #arcLabel
Te0 f125 expr out #txt
Te0 f125 1968 228 1838 184 #arcP
Te0 f125 1 1968 184 #addKink
Te0 f125 1 0.251489130890622 0 0 #arcLabel
Te0 f126 expr out #txt
Te0 f126 1824 444 1824 474 #arcP
Te0 f127 expr in #txt
Te0 f127 1838 488 1968 252 #arcP
Te0 f127 1 1968 488 #addKink
Te0 f127 0 0.8799989356997663 0 0 #arcLabel
Te0 f129 expr out #txt
Te0 f129 1824 620 1824 652 #arcP
Te0 f131 expr in #txt
Te0 f131 outCond in.listIterator.hasNext() #txt
Te0 f131 1824 198 1824 228 #arcP
Te0 f133 expr out #txt
Te0 f133 1824 77 1824 108 #arcP
Te0 f134 expr out #txt
Te0 f134 1824 132 1824 170 #arcP
Te0 f135 expr in #txt
Te0 f135 1810 184 1374 880 #arcP
Te0 f135 1 1761 184 #addKink
Te0 f135 2 1761 880 #addKink
Te0 f135 2 0.4929090123375711 0 0 #arcLabel
Te0 f136 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f136 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f136 3122 170 28 28 22 -21 #rect
Te0 f136 @|AlternativeIcon #fIcon
Te0 f137 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f137 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f137 doCall true #txt
Te0 f137 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Te0 f137 requestMappingAction 'param.server=in.server;
' #txt
Te0 f137 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f137 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Te0 f137 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get applications 
of server</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f137 3118 356 36 24 20 -2 #rect
Te0 f137 @|CallSubIcon #fIcon
Te0 f138 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f138 actionTable 'out=in;
' #txt
Te0 f138 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Te0 f138 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f138 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f138 3118 228 36 24 20 -2 #rect
Te0 f138 @|StepIcon #fIcon
Te0 f139 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f139 processCall ServiceIntegrators/TaskServiceIntegrator:analyzePriorityStatistic(String,String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Te0 f139 doCall true #txt
Te0 f139 requestActionDecl '<java.lang.String jsonQuery,java.lang.String userName,List<java.lang.String> apps,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Te0 f139 requestMappingAction 'param.jsonQuery=in.jsonQuery;
param.userName=in.userName;
param.apps=in.apps;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Te0 f139 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f139 responseMappingAction 'out=in;
out.tempErrors=result.errors;
out.tempPriorityStatistic=result.priorityStatistic;
' #txt
Te0 f139 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AnalyzePriorityStatistic</name>
        <nameStyle>24,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f139 3118 596 36 24 20 -2 #rect
Te0 f139 @|CallSubIcon #fIcon
Te0 f141 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f141 actionTable 'out=in;
' #txt
Te0 f141 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (in.hasNoSelectedApp) {
	in.apps.clear();
}' #txt
Te0 f141 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f141 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Te0 f141 3246 228 36 24 20 -2 #rect
Te0 f141 @|StepIcon #fIcon
Te0 f142 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f142 actionTable 'out=in;
' #txt
Te0 f142 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.userName, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}' #txt
Te0 f142 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f142 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f142 3118 420 36 24 21 -7 #rect
Te0 f142 @|StepIcon #fIcon
Te0 f143 inParamDecl '<java.lang.String jsonQuery,List<java.lang.String> apps,java.lang.Long serverId,java.lang.String userName> param;' #txt
Te0 f143 inParamTable 'out.apps=param.apps;
out.hasNoSelectedApp=param.apps.isEmpty();
out.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
out.userName=param.userName;
' #txt
Te0 f143 outParamDecl '<ch.ivy.ws.addon.PriorityStatistic priorityStatistic,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f143 outParamTable 'result.priorityStatistic=in.priorityStatistic;
result.errors=in.errors;
' #txt
Te0 f143 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f143 callSignature analyzePriorityStatistic(String,List<String>,Long,String) #txt
Te0 f143 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f143 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>analyzePriorityStatistic(String,List&lt;String&gt;,Long,String)</name>
    </language>
</elementInfo>
' #txt
Te0 f143 3123 51 26 26 -50 -39 #rect
Te0 f143 @|StartSubIcon #fIcon
Te0 f146 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f146 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has apps?</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f146 3122 482 28 28 14 0 #rect
Te0 f146 @|AlternativeIcon #fIcon
Te0 f149 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f149 actionTable 'out=in;
' #txt
Te0 f149 actionCode 'if (in.tempErrors.isEmpty()) {
	in.priorityStatistic.low += in.tempPriorityStatistic.low;
	in.priorityStatistic.normal += in.tempPriorityStatistic.normal;
	in.priorityStatistic.high += in.tempPriorityStatistic.high;
	in.priorityStatistic.exception += in.tempPriorityStatistic.exception;
}' #txt
Te0 f149 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f149 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add statistic</name>
        <nameStyle>13,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f149 3118 652 36 24 20 -2 #rect
Te0 f149 @|StepIcon #fIcon
Te0 f154 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f154 actionTable 'out=in;
' #txt
Te0 f154 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
Long serverId = in.server.#id;
if (#serverId is initialized && serverId != 0) {
	in.servers = Arrays.asList(serverService.findById(serverId));
} else {
	in.servers = serverService.findActiveServers();
}
in.listIterator = in.servers.listIterator();' #txt
Te0 f154 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f154 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f154 3118 108 36 24 20 -2 #rect
Te0 f154 @|StepIcon #fIcon
Te0 f175 expr out #txt
Te0 f175 3154 664 3264 252 #arcP
Te0 f175 1 3264 664 #addKink
Te0 f175 1 0.3622224354814317 0 0 #arcLabel
Te0 f179 expr out #txt
Te0 f179 3264 228 3150 184 #arcP
Te0 f179 1 3264 184 #addKink
Te0 f179 1 0.251489130890622 0 0 #arcLabel
Te0 f180 expr out #txt
Te0 f180 3136 444 3136 482 #arcP
Te0 f181 expr in #txt
Te0 f181 3150 496 3264 252 #arcP
Te0 f181 1 3264 496 #addKink
Te0 f181 0 0.8799989356997663 0 0 #arcLabel
Te0 f183 expr out #txt
Te0 f183 3136 620 3136 652 #arcP
Te0 f185 expr in #txt
Te0 f185 outCond in.listIterator.hasNext() #txt
Te0 f185 3136 198 3136 228 #arcP
Te0 f187 expr out #txt
Te0 f187 3136 77 3136 108 #arcP
Te0 f188 expr out #txt
Te0 f188 3136 132 3136 170 #arcP
Te0 f189 expr in #txt
Te0 f189 3122 184 1374 880 #arcP
Te0 f189 1 3008 184 #addKink
Te0 f189 2 3008 880 #addKink
Te0 f189 2 0.1177291472607177 0 0 #arcLabel
Te0 f191 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f191 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f191 doCall true #txt
Te0 f191 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Te0 f191 requestMappingAction 'param.server=in.server;
' #txt
Te0 f191 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f191 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Te0 f191 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get applications 
of server</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f191 3478 356 36 24 20 -2 #rect
Te0 f191 @|CallSubIcon #fIcon
Te0 f192 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f192 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has apps?</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f192 3482 482 28 28 14 0 #rect
Te0 f192 @|AlternativeIcon #fIcon
Te0 f193 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f193 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f193 3482 170 28 28 22 -21 #rect
Te0 f193 @|AlternativeIcon #fIcon
Te0 f194 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f194 actionTable 'out=in;
' #txt
Te0 f194 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Te0 f194 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f194 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f194 3478 228 36 24 20 -2 #rect
Te0 f194 @|StepIcon #fIcon
Te0 f195 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f195 actionTable 'out=in;
' #txt
Te0 f195 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.userName, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}
' #txt
Te0 f195 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f195 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f195 3478 420 36 24 21 -18 #rect
Te0 f195 @|StepIcon #fIcon
Te0 f196 inParamDecl '<java.lang.String jsonQuery,List<java.lang.String> apps,java.lang.Long serverId,java.lang.String userName> param;' #txt
Te0 f196 inParamTable 'out.apps=param.apps;
out.hasNoSelectedApp=param.apps.isEmpty();
out.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
out.userName=param.userName;
' #txt
Te0 f196 outParamDecl '<java.util.List<ch.ivy.ws.addon.ExpiryStatistic> expiryStatistic,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f196 outParamTable 'result.expiryStatistic=in.expiryStatistic;
result.errors=in.errors;
' #txt
Te0 f196 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f196 callSignature analyzeExpiryStatistic(String,List<String>,Long,String) #txt
Te0 f196 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f196 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>analyzeExpiryStatistic(String,List&lt;String&gt;,Long,String)</name>
        <nameStyle>55,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f196 3483 51 26 26 -50 -39 #rect
Te0 f196 @|StartSubIcon #fIcon
Te0 f197 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f197 processCall ServiceIntegrators/TaskServiceIntegrator:analyzeExpiryStatistic(String,String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Te0 f197 doCall true #txt
Te0 f197 requestActionDecl '<java.lang.String jsonQuery,java.lang.String userName,List<java.lang.String> apps,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Te0 f197 requestMappingAction 'param.jsonQuery=in.jsonQuery;
param.userName=in.userName;
param.apps=in.apps;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Te0 f197 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f197 responseMappingAction 'out=in;
out.tempErrors=result.errors;
out.tempExpiryStatistic=result.expiryStatistic;
' #txt
Te0 f197 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AnalyzeExpiryStatistic</name>
        <nameStyle>22,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f197 3478 596 36 24 20 -2 #rect
Te0 f197 @|CallSubIcon #fIcon
Te0 f198 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f198 actionTable 'out=in;
' #txt
Te0 f198 actionCode 'if (in.tempErrors.isEmpty()) {
	in.expiryStatistic.add(in.tempExpiryStatistic);
}' #txt
Te0 f198 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f198 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add statistic</name>
        <nameStyle>13,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f198 3478 652 36 24 20 -2 #rect
Te0 f198 @|StepIcon #fIcon
Te0 f199 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f199 actionTable 'out=in;
' #txt
Te0 f199 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
Long serverId = in.server.#id;
if (#serverId is initialized && serverId != 0) {
	in.servers = Arrays.asList(serverService.findById(serverId));
} else {
	in.servers = serverService.findActiveServers();
}
in.listIterator = in.servers.listIterator();' #txt
Te0 f199 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f199 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f199 3478 108 36 24 20 -2 #rect
Te0 f199 @|StepIcon #fIcon
Te0 f200 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f200 actionTable 'out=in;
' #txt
Te0 f200 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (in.hasNoSelectedApp) {
	in.apps.clear();
}' #txt
Te0 f200 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f200 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Te0 f200 3606 228 36 24 20 -2 #rect
Te0 f200 @|StepIcon #fIcon
Te0 f202 expr out #txt
Te0 f202 3514 664 3624 252 #arcP
Te0 f202 1 3624 664 #addKink
Te0 f202 1 0.3395443488573781 0 0 #arcLabel
Te0 f204 expr out #txt
Te0 f204 3624 228 3510 184 #arcP
Te0 f204 1 3624 184 #addKink
Te0 f204 1 0.19087308919428908 0 0 #arcLabel
Te0 f205 expr out #txt
Te0 f205 3496 444 3496 482 #arcP
Te0 f206 expr in #txt
Te0 f206 3510 496 3624 252 #arcP
Te0 f206 1 3624 496 #addKink
Te0 f206 0 0.8288430891547728 0 0 #arcLabel
Te0 f208 expr out #txt
Te0 f208 3496 620 3496 652 #arcP
Te0 f210 expr in #txt
Te0 f210 outCond in.listIterator.hasNext() #txt
Te0 f210 3496 198 3496 228 #arcP
Te0 f212 expr out #txt
Te0 f212 3496 77 3496 108 #arcP
Te0 f213 expr out #txt
Te0 f213 3496 132 3496 170 #arcP
Te0 f214 expr in #txt
Te0 f214 3482 184 1374 880 #arcP
Te0 f214 1 3392 184 #addKink
Te0 f214 2 3392 880 #addKink
Te0 f214 1 0.2277635497779572 0 0 #arcLabel
Te0 f0 inParamDecl '<java.lang.String userName,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long taskId> param;' #txt
Te0 f0 inParamTable 'out.server=param.server;
out.taskId=param.taskId;
out.userName=param.userName;
' #txt
Te0 f0 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,ch.ivy.addon.portalkit.bo.RemoteTask task> result;
' #txt
Te0 f0 outParamTable 'result.errors=in.errors;
result.task=in.task;
' #txt
Te0 f0 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f0 callSignature parkTask(String,ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Te0 f0 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>parkTask
(String,Server,Long)</name>
        <nameStyle>29,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f0 4083 51 26 26 14 0 #rect
Te0 f0 @|StartSubIcon #fIcon
Te0 f8 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f8 actionTable 'out=in;
' #txt
Te0 f8 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f8 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f8 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f8 4078 124 36 24 20 -2 #rect
Te0 f8 @|StepIcon #fIcon
Te0 f11 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f11 processCall ServiceIntegrators/TaskServiceIntegrator:parkTask(Boolean,ch.ivy.addon.portalkit.persistence.domain.Server,String,String,Long) #txt
Te0 f11 doCall true #txt
Te0 f11 requestActionDecl '<java.lang.Boolean isUrlBuiltFromSystemProperties,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String userName,java.lang.String endpoint,java.lang.Long taskId> param;
' #txt
Te0 f11 requestMappingAction 'param.isUrlBuiltFromSystemProperties=in.isMultiServer;
param.server=in.server;
param.userName=in.userName;
param.endpoint=in.endpoint;
param.taskId=in.taskId;
' #txt
Te0 f11 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f11 responseMappingAction 'out=in;
out.ivyTask=result.task;
' #txt
Te0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>TaskServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f11 4078 248 36 24 20 -2 #rect
Te0 f11 @|CallSubIcon #fIcon
Te0 f26 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f26 actionTable 'out=in;
' #txt
Te0 f26 actionCode 'import ch.ivy.ws.addon.WsException;
for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Te0 f26 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f26 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f26 4078 372 36 24 20 -2 #rect
Te0 f26 @|StepIcon #fIcon
Te0 f31 expr out #txt
Te0 f31 4096 396 1374 880 #arcP
Te0 f31 1 4096 880 #addKink
Te0 f31 1 0.383363698121514 0 0 #arcLabel
Te0 f32 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f32 actionTable 'out=in;
' #txt
Te0 f32 actionCode 'import ch.ivy.ws.addon.WsException;

for (WsException e : in.errors) {
	e.server = in.server.name;
}' #txt
Te0 f32 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f32 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>finalize</name>
        <nameStyle>8,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f32 4310 268 36 24 20 -2 #rect
Te0 f32 @|StepIcon #fIcon
Te0 f34 inParamDecl '<ch.ivy.ws.addon.IvyTask task,java.lang.Long serverId> param;' #txt
Te0 f34 inParamTable 'out.ivyTask=param.task;
out.server=new ch.ivy.addon.portalkit.service.ServerService().findById(param.serverId);
' #txt
Te0 f34 outParamDecl '<> result;
' #txt
Te0 f34 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f34 callSignature save(ch.ivy.ws.addon.IvyTask,Long) #txt
Te0 f34 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f34 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>save(IvyTask,Long)</name>
    </language>
</elementInfo>
' #txt
Te0 f34 4315 51 26 26 14 0 #rect
Te0 f34 @|StartSubIcon #fIcon
Te0 f35 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f35 actionTable 'out=in;
' #txt
Te0 f35 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f35 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f35 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>init ws endpoint</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f35 4310 124 36 24 20 -2 #rect
Te0 f35 @|StepIcon #fIcon
Te0 f36 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f36 processCall ServiceIntegrators/TaskServiceIntegrator:save(String,ch.ivy.addon.portalkit.persistence.domain.Server,ch.ivy.ws.addon.IvyTask) #txt
Te0 f36 doCall true #txt
Te0 f36 requestActionDecl '<java.lang.String endpoint,ch.ivy.addon.portalkit.persistence.domain.Server server,ch.ivy.ws.addon.IvyTask task> param;
' #txt
Te0 f36 requestMappingAction 'param.endpoint=in.endpoint;
param.server=in.server;
param.task=in.ivyTask;
' #txt
Te0 f36 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f36 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
Te0 f36 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>TaskServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f36 4310 188 36 24 20 -2 #rect
Te0 f36 @|CallSubIcon #fIcon
Te0 f37 expr out #txt
Te0 f37 4328 212 4328 268 #arcP
Te0 f38 expr out #txt
Te0 f38 4328 77 4328 124 #arcP
Te0 f42 expr out #txt
Te0 f42 4328 148 4328 188 #arcP
Te0 f44 expr out #txt
Te0 f44 4328 292 1374 880 #arcP
Te0 f44 1 4328 880 #addKink
Te0 f44 1 0.39100529100529113 0 0 #arcLabel
Te0 f13 expr out #txt
Te0 f13 64 77 64 116 #arcP
Te0 f6 expr out #txt
Te0 f6 320 77 320 116 #arcP
Te0 f7 expr out #txt
Te0 f7 1240 77 1240 132 #arcP
Te0 f14 expr out #txt
Te0 f14 4096 77 4096 124 #arcP
Te0 f1 expr out #txt
Te0 f1 792 380 792 436 #arcP
Te0 f4 expr out #txt
Te0 f4 1032 77 1032 116 #arcP
Te0 f2 expr out #txt
Te0 f2 1552 380 1552 420 #arcP
Te0 f5 expr out #txt
Te0 f5 1824 380 1824 420 #arcP
Te0 f9 expr out #txt
Te0 f9 3136 380 3136 420 #arcP
Te0 f16 expr out #txt
Te0 f16 3496 380 3496 420 #arcP
Te0 f20 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f20 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f20 778 290 28 28 14 0 #rect
Te0 f20 @|AlternativeIcon #fIcon
Te0 f24 expr out #txt
Te0 f24 792 252 792 290 #arcP
Te0 f30 expr in #txt
Te0 f30 outCond in.taskSearchCriteria.involvedApplications.isEmpty() #txt
Te0 f30 792 318 792 356 #arcP
Te0 f39 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f39 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f39 1538 290 28 28 14 0 #rect
Te0 f39 @|AlternativeIcon #fIcon
Te0 f47 expr in #txt
Te0 f47 outCond in.taskSearchCriteria.involvedApplications.isEmpty() #txt
Te0 f47 1552 318 1552 356 #arcP
Te0 f49 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f49 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f49 1810 290 28 28 14 0 #rect
Te0 f49 @|AlternativeIcon #fIcon
Te0 f50 expr out #txt
Te0 f50 1824 252 1824 290 #arcP
Te0 f51 expr in #txt
Te0 f51 outCond in.hasNoSelectedApp #txt
Te0 f51 1824 318 1824 356 #arcP
Te0 f63 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f63 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f63 3122 290 28 28 14 0 #rect
Te0 f63 @|AlternativeIcon #fIcon
Te0 f69 expr out #txt
Te0 f69 3136 252 3136 290 #arcP
Te0 f71 expr in #txt
Te0 f71 outCond in.hasNoSelectedApp #txt
Te0 f71 3136 318 3136 356 #arcP
Te0 f79 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f79 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f79 3482 290 28 28 14 0 #rect
Te0 f79 @|AlternativeIcon #fIcon
Te0 f80 expr out #txt
Te0 f80 3496 252 3496 290 #arcP
Te0 f82 expr in #txt
Te0 f82 outCond in.hasNoSelectedApp #txt
Te0 f82 3496 318 3496 356 #arcP
Te0 f93 expr in #txt
Te0 f93 1360 894 1360 948 #arcP
Te0 f99 expr out #txt
Te0 f99 1552 252 1552 290 #arcP
Te0 f45 expr out #txt
Te0 f45 1552 77 1552 108 #arcP
Te0 f78 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f78 actionTable 'out=in;
' #txt
Te0 f78 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f78 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f78 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f78 774 564 36 24 20 -2 #rect
Te0 f78 @|StepIcon #fIcon
Te0 f87 expr in #txt
Te0 f87 outCond 'in.apps.size() > 0' #txt
Te0 f87 792 526 792 564 #arcP
Te0 f90 expr in #txt
Te0 f90 778 304 774 576 #arcP
Te0 f90 1 736 304 #addKink
Te0 f90 2 736 576 #addKink
Te0 f90 1 0.4861111111111111 0 0 #arcLabel
Te0 f97 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f97 actionTable 'out=in;
' #txt
Te0 f97 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f97 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f97 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f97 1534 548 36 24 20 -2 #rect
Te0 f97 @|StepIcon #fIcon
Te0 f98 expr in #txt
Te0 f98 outCond 'in.apps.size() > 0' #txt
Te0 f98 1552 510 1552 548 #arcP
Te0 f92 expr in #txt
Te0 f92 1538 304 1534 560 #arcP
Te0 f92 1 1505 304 #addKink
Te0 f92 2 1505 560 #addKink
Te0 f92 1 0.4930555555555556 0 0 #arcLabel
Te0 f48 expr out #txt
Te0 f48 1552 572 1552 604 #arcP
Te0 f100 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f100 actionTable 'out=in;
' #txt
Te0 f100 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f100 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f100 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f100 1806 532 36 24 20 -2 #rect
Te0 f100 @|StepIcon #fIcon
Te0 f102 expr in #txt
Te0 f102 outCond 'in.apps.size() > 0' #txt
Te0 f102 1824 502 1824 532 #arcP
Te0 f107 expr out #txt
Te0 f107 1824 556 1824 596 #arcP
Te0 f109 expr in #txt
Te0 f109 1810 304 1806 544 #arcP
Te0 f109 1 1777 304 #addKink
Te0 f109 2 1777 544 #addKink
Te0 f109 1 0.4930555555555556 0 0 #arcLabel
Te0 f52 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f52 actionTable 'out=in;
' #txt
Te0 f52 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f52 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f52 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f52 3118 548 36 24 20 -2 #rect
Te0 f52 @|StepIcon #fIcon
Te0 f116 expr in #txt
Te0 f116 outCond 'in.apps.size() > 0' #txt
Te0 f116 3136 510 3136 548 #arcP
Te0 f117 expr in #txt
Te0 f117 3122 304 3118 560 #arcP
Te0 f117 1 3072 304 #addKink
Te0 f117 2 3072 560 #addKink
Te0 f117 1 0.4930555555555556 0 0 #arcLabel
Te0 f77 expr out #txt
Te0 f77 3136 572 3136 596 #arcP
Te0 f119 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f119 actionTable 'out=in;
' #txt
Te0 f119 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f119 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f119 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f119 3478 548 36 24 20 -2 #rect
Te0 f119 @|StepIcon #fIcon
Te0 f123 expr in #txt
Te0 f123 outCond 'in.apps.size() > 0' #txt
Te0 f123 3496 510 3496 548 #arcP
Te0 f124 expr in #txt
Te0 f124 3482 304 3478 560 #arcP
Te0 f124 1 3448 304 #addKink
Te0 f124 2 3448 560 #addKink
Te0 f124 1 0.4930555555555556 0 0 #arcLabel
Te0 f86 expr out #txt
Te0 f86 3496 572 3496 596 #arcP
Te0 f128 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f128 processCall ServiceIntegrators/TaskServiceIntegrator:findPersonalCategories(String,String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Te0 f128 doCall true #txt
Te0 f128 requestActionDecl '<java.lang.String jsonQuery,java.lang.String userName,List<java.lang.String> apps,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Te0 f128 requestMappingAction 'param.jsonQuery=in.jsonQuery;
param.userName=in.userName;
param.apps=in.apps;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Te0 f128 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f128 responseMappingAction 'out=in;
out.categories=in.categories.addAll(result.categories);
out.tempErrors=result.errors;
' #txt
Te0 f128 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>FindCategories</name>
        <nameStyle>14,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f128 2126 588 36 24 20 -2 #rect
Te0 f128 @|CallSubIcon #fIcon
Te0 f130 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f130 actionTable 'out=in;
' #txt
Te0 f130 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.userName, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}
' #txt
Te0 f130 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f130 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f130 2126 412 36 24 21 -7 #rect
Te0 f130 @|StepIcon #fIcon
Te0 f132 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f132 actionTable 'out=in;
' #txt
Te0 f132 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Te0 f132 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f132 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f132 2126 220 36 24 20 -2 #rect
Te0 f132 @|StepIcon #fIcon
Te0 f140 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f140 actionTable 'out=in;
' #txt
Te0 f140 actionCode 'import java.util.Set;
import java.util.HashSet;

Set categories = new HashSet(in.categories);
in.categories.clear();
in.categories.addAll(categories);' #txt
Te0 f140 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f140 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add categories</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f140 2126 644 36 24 20 -2 #rect
Te0 f140 @|StepIcon #fIcon
Te0 f158 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f158 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f158 2130 282 28 28 14 0 #rect
Te0 f158 @|AlternativeIcon #fIcon
Te0 f161 inParamDecl '<java.lang.String jsonQuery,java.lang.String userName,List<java.lang.String> apps,java.lang.Long serverId> param;' #txt
Te0 f161 inParamTable 'out.apps=param.apps;
out.hasNoSelectedApp=param.apps.isEmpty();
out.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
out.userName=param.userName;
' #txt
Te0 f161 outParamDecl '<java.util.List<ch.ivy.ws.addon.CategoryData> categories,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f161 outParamTable 'result.categories=in.categories;
result.errors=in.errors;
' #txt
Te0 f161 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f161 callSignature findPersonalCategories(String,String,List<String>,Long) #txt
Te0 f161 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f161 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findPersonalCategories(String,String,List&lt;String&gt;,Long)</name>
        <nameStyle>55,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f161 2131 51 26 26 -50 -39 #rect
Te0 f161 @|StartSubIcon #fIcon
Te0 f163 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f163 actionTable 'out=in;
' #txt
Te0 f163 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
Long serverId = in.server.#id;
if (#serverId is initialized && serverId != 0) {
	in.servers = Arrays.asList(serverService.findById(serverId));
} else {
	in.servers = serverService.findActiveServers();
}
in.listIterator = in.servers.listIterator();' #txt
Te0 f163 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f163 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f163 2126 100 36 24 20 -2 #rect
Te0 f163 @|StepIcon #fIcon
Te0 f167 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f167 actionTable 'out=in;
' #txt
Te0 f167 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f167 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f167 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f167 2126 524 36 24 20 -2 #rect
Te0 f167 @|StepIcon #fIcon
Te0 f171 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f171 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has apps?</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f171 2130 466 28 28 14 0 #rect
Te0 f171 @|AlternativeIcon #fIcon
Te0 f173 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f173 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f173 doCall true #txt
Te0 f173 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Te0 f173 requestMappingAction 'param.server=in.server;
' #txt
Te0 f173 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f173 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Te0 f173 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get applications 
of server</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f173 2126 348 36 24 20 -2 #rect
Te0 f173 @|CallSubIcon #fIcon
Te0 f174 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f174 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f174 2130 162 28 28 22 -21 #rect
Te0 f174 @|AlternativeIcon #fIcon
Te0 f178 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f178 actionTable 'out=in;
' #txt
Te0 f178 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (in.hasNoSelectedApp) {
	in.apps.clear();
}' #txt
Te0 f178 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f178 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Te0 f178 2270 220 36 24 20 -2 #rect
Te0 f178 @|StepIcon #fIcon
Te0 f182 expr out #txt
Te0 f182 2162 656 2288 244 #arcP
Te0 f182 1 2288 656 #addKink
Te0 f182 1 0.3622224354814317 0 0 #arcLabel
Te0 f184 expr out #txt
Te0 f184 2288 220 2158 176 #arcP
Te0 f184 1 2288 176 #addKink
Te0 f184 1 0.251489130890622 0 0 #arcLabel
Te0 f186 expr out #txt
Te0 f186 2144 436 2144 466 #arcP
Te0 f190 expr in #txt
Te0 f190 2158 480 2288 244 #arcP
Te0 f190 1 2288 480 #addKink
Te0 f190 0 0.8799989356997663 0 0 #arcLabel
Te0 f201 expr out #txt
Te0 f201 2144 612 2144 644 #arcP
Te0 f203 expr in #txt
Te0 f203 outCond in.listIterator.hasNext() #txt
Te0 f203 2144 190 2144 220 #arcP
Te0 f207 expr out #txt
Te0 f207 2144 77 2144 100 #arcP
Te0 f209 expr out #txt
Te0 f209 2144 124 2144 162 #arcP
Te0 f211 expr out #txt
Te0 f211 2144 372 2144 412 #arcP
Te0 f215 expr out #txt
Te0 f215 2144 244 2144 282 #arcP
Te0 f216 expr in #txt
Te0 f216 outCond in.hasNoSelectedApp #txt
Te0 f216 2144 310 2144 348 #arcP
Te0 f217 expr in #txt
Te0 f217 outCond 'in.apps.size() > 0' #txt
Te0 f217 2144 494 2144 524 #arcP
Te0 f218 expr out #txt
Te0 f218 2144 548 2144 588 #arcP
Te0 f219 expr in #txt
Te0 f219 2130 296 2126 536 #arcP
Te0 f219 1 2099 296 #addKink
Te0 f219 2 2099 536 #addKink
Te0 f219 1 0.4930555555555556 0 0 #arcLabel
Te0 f220 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f220 processCall ServiceIntegrators/TaskServiceIntegrator:findGroupCategories(String,String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Te0 f220 doCall true #txt
Te0 f220 requestActionDecl '<java.lang.String jsonQuery,java.lang.String userName,List<java.lang.String> apps,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Te0 f220 requestMappingAction 'param.jsonQuery=in.jsonQuery;
param.userName=in.userName;
param.apps=in.apps;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Te0 f220 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f220 responseMappingAction 'out=in;
out.categories=in.categories.addAll(result.categories);
out.tempErrors=result.errors;
' #txt
Te0 f220 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>FindCategories</name>
        <nameStyle>14,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f220 2406 580 36 24 20 -2 #rect
Te0 f220 @|CallSubIcon #fIcon
Te0 f221 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f221 actionTable 'out=in;
' #txt
Te0 f221 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.userName, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}
' #txt
Te0 f221 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f221 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f221 2406 404 36 24 21 -7 #rect
Te0 f221 @|StepIcon #fIcon
Te0 f222 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f222 actionTable 'out=in;
' #txt
Te0 f222 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Te0 f222 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f222 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f222 2406 212 36 24 20 -2 #rect
Te0 f222 @|StepIcon #fIcon
Te0 f223 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f223 actionTable 'out=in;
' #txt
Te0 f223 actionCode 'import java.util.Set;
import java.util.HashSet;

Set categories = new HashSet(in.categories);
in.categories.clear();
in.categories.addAll(categories);' #txt
Te0 f223 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f223 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add categories</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f223 2406 636 36 24 20 -2 #rect
Te0 f223 @|StepIcon #fIcon
Te0 f224 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f224 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f224 2410 274 28 28 14 0 #rect
Te0 f224 @|AlternativeIcon #fIcon
Te0 f225 inParamDecl '<java.lang.String jsonQuery,java.lang.String userName,List<java.lang.String> apps,java.lang.Long serverId> param;' #txt
Te0 f225 inParamTable 'out.apps=param.apps;
out.hasNoSelectedApp=param.apps.isEmpty();
out.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
out.userName=param.userName;
' #txt
Te0 f225 outParamDecl '<java.util.List<ch.ivy.ws.addon.CategoryData> categories,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f225 outParamTable 'result.categories=in.categories;
result.errors=in.errors;
' #txt
Te0 f225 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f225 callSignature findGroupCategories(String,String,List<String>,Long) #txt
Te0 f225 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f225 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findGroupCategories(String,String,List&lt;String&gt;,Long)</name>
        <nameStyle>52,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f225 2411 51 26 26 -50 -39 #rect
Te0 f225 @|StartSubIcon #fIcon
Te0 f226 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f226 actionTable 'out=in;
' #txt
Te0 f226 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
Long serverId = in.server.#id;
if (#serverId is initialized && serverId != 0) {
	in.servers = Arrays.asList(serverService.findById(serverId));
} else {
	in.servers = serverService.findActiveServers();
}
in.listIterator = in.servers.listIterator();' #txt
Te0 f226 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f226 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f226 2406 100 36 24 20 -2 #rect
Te0 f226 @|StepIcon #fIcon
Te0 f227 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f227 actionTable 'out=in;
' #txt
Te0 f227 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f227 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f227 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f227 2406 516 36 24 20 -2 #rect
Te0 f227 @|StepIcon #fIcon
Te0 f228 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f228 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has apps?</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f228 2410 458 28 28 14 0 #rect
Te0 f228 @|AlternativeIcon #fIcon
Te0 f229 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f229 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f229 doCall true #txt
Te0 f229 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Te0 f229 requestMappingAction 'param.server=in.server;
' #txt
Te0 f229 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f229 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Te0 f229 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get applications 
of server</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f229 2406 340 36 24 20 -2 #rect
Te0 f229 @|CallSubIcon #fIcon
Te0 f230 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f230 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f230 2410 154 28 28 22 -21 #rect
Te0 f230 @|AlternativeIcon #fIcon
Te0 f231 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f231 actionTable 'out=in;
' #txt
Te0 f231 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (in.hasNoSelectedApp) {
	in.apps.clear();
}' #txt
Te0 f231 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f231 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Te0 f231 2574 212 36 24 20 -2 #rect
Te0 f231 @|StepIcon #fIcon
Te0 f232 expr out #txt
Te0 f232 2442 648 2592 236 #arcP
Te0 f232 1 2592 648 #addKink
Te0 f232 1 0.3622224354814317 0 0 #arcLabel
Te0 f233 expr out #txt
Te0 f233 2592 212 2438 168 #arcP
Te0 f233 1 2592 168 #addKink
Te0 f233 1 0.251489130890622 0 0 #arcLabel
Te0 f234 expr out #txt
Te0 f234 2424 428 2424 458 #arcP
Te0 f235 expr in #txt
Te0 f235 2438 472 2592 236 #arcP
Te0 f235 1 2592 472 #addKink
Te0 f235 0 0.8799989356997663 0 0 #arcLabel
Te0 f236 expr out #txt
Te0 f236 2424 604 2424 636 #arcP
Te0 f237 expr in #txt
Te0 f237 outCond in.listIterator.hasNext() #txt
Te0 f237 2424 182 2424 212 #arcP
Te0 f238 expr out #txt
Te0 f238 2424 77 2424 100 #arcP
Te0 f239 expr out #txt
Te0 f239 2424 124 2424 154 #arcP
Te0 f240 expr out #txt
Te0 f240 2424 364 2424 404 #arcP
Te0 f241 expr out #txt
Te0 f241 2424 236 2424 274 #arcP
Te0 f242 expr in #txt
Te0 f242 outCond in.hasNoSelectedApp #txt
Te0 f242 2424 302 2424 340 #arcP
Te0 f243 expr in #txt
Te0 f243 outCond 'in.apps.size() > 0' #txt
Te0 f243 2424 486 2424 516 #arcP
Te0 f244 expr out #txt
Te0 f244 2424 540 2424 580 #arcP
Te0 f245 expr in #txt
Te0 f245 2410 288 2406 528 #arcP
Te0 f245 1 2378 288 #addKink
Te0 f245 2 2378 528 #addKink
Te0 f245 1 0.4930555555555556 0 0 #arcLabel
Te0 f246 expr in #txt
Te0 f246 2130 176 1374 880 #arcP
Te0 f246 1 2048 176 #addKink
Te0 f246 2 2048 880 #addKink
Te0 f246 2 0.11428571428571428 0 0 #arcLabel
Te0 f247 expr in #txt
Te0 f247 2410 168 1374 880 #arcP
Te0 f247 1 2336 168 #addKink
Te0 f247 2 2336 880 #addKink
Te0 f247 2 0.21333333333333335 0 0 #arcLabel
Te0 f94 expr out #txt
Te0 f94 1552 628 1552 660 #arcP
Te0 f248 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f248 actionTable 'out=in;
' #txt
Te0 f248 actionCode 'import ch.ivy.addon.portalkit.support.UrlDetector;
import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.mapper.RemoteTaskMapper;

String host = "";
if (in.isMultiServer) {
	UrlDetector detector = new UrlDetector();
	host = detector.getHost(in.server.path);
}

in.task = RemoteTaskMapper.mapTask(in.ivyTask, host);
Application app = new Application();
app.setServerId(in.server.id);
app.setServer(in.server);
in.task.setApplicationRegister(app);' #txt
Te0 f248 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f248 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>map to remote task</name>
        <nameStyle>18
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f248 46 338 36 24 20 -2 #rect
Te0 f248 @|StepIcon #fIcon
Te0 f29 expr out #txt
Te0 f29 64 362 64 404 #arcP
Te0 f252 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f252 actionTable 'out=in;
' #txt
Te0 f252 actionCode 'import ch.ivy.addon.portalkit.support.UrlDetector;
import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.mapper.RemoteTaskMapper;

String host = "";
if (in.isMultiServer) {
	UrlDetector detector = new UrlDetector();
	host = detector.getHost(in.server.path);
}

in.task = RemoteTaskMapper.mapTask(in.ivyTask, host);
Application app = new Application();
app.setServerId(in.server.id);
app.setServer(in.server);
in.task.setApplicationRegister(app);' #txt
Te0 f252 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f252 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>map to remote task</name>
        <nameStyle>18
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f252 301 331 36 24 20 -2 #rect
Te0 f252 @|StepIcon #fIcon
Te0 f43 expr out #txt
Te0 f43 319 355 320 404 #arcP
Te0 f259 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f259 actionTable 'out=in;
' #txt
Te0 f259 actionCode 'import ch.ivy.addon.portalkit.support.UrlDetector;
import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.mapper.RemoteTaskMapper;

String host = "";
if (in.isMultiServer) {
	UrlDetector detector = new UrlDetector();
	host = detector.getHost(in.server.path);
}

in.task = RemoteTaskMapper.mapTask(in.ivyTask, host);
Application app = new Application();
app.setServerId(in.server.id);
app.setServer(in.server);
in.task.setApplicationRegister(app);' #txt
Te0 f259 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f259 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>map to remote task</name>
        <nameStyle>18
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f259 4079 315 36 24 20 -2 #rect
Te0 f259 @|StepIcon #fIcon
Te0 f27 expr out #txt
Te0 f27 4097 339 4096 372 #arcP
Te0 f262 expr out #txt
Te0 f262 64 292 64 338 #arcP
Te0 f255 expr out #txt
Te0 f255 320 292 319 331 #arcP
Te0 f168 expr out #txt
Te0 f168 792 692 792 724 #arcP
Te0 f258 expr out #txt
Te0 f258 4096 272 4097 315 #arcP
Te0 f260 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f260 actionTable 'out=in;
' #txt
Te0 f260 actionCode 'import ch.ivy.addon.portalkit.service.ServerService;

ServerService service = new ServerService();
in.isMultiServer = service.isMultiServers();' #txt
Te0 f260 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f260 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Is multi server</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f260 47 194 36 24 20 -2 #rect
Te0 f260 @|StepIcon #fIcon
Te0 f261 expr out #txt
Te0 f261 64 140 65 194 #arcP
Te0 f23 expr out #txt
Te0 f23 65 218 64 268 #arcP
Te0 f250 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f250 actionTable 'out=in;
' #txt
Te0 f250 actionCode 'import ch.ivy.addon.portalkit.service.ServerService;

ServerService service = new ServerService();
in.isMultiServer = service.isMultiServers();' #txt
Te0 f250 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f250 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Is multi server</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f250 302 194 36 24 20 -2 #rect
Te0 f250 @|StepIcon #fIcon
Te0 f251 expr out #txt
Te0 f251 320 140 320 194 #arcP
Te0 f263 expr out #txt
Te0 f263 320 218 320 268 #arcP
Te0 f46 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f46 actionTable 'out=in;
' #txt
Te0 f46 actionCode 'import ch.ivy.addon.portalkit.service.ServerService;

ServerService service = new ServerService();
in.isMultiServer = service.isMultiServers();' #txt
Te0 f46 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f46 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Is multi server</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f46 773 615 36 24 20 -2 #rect
Te0 f46 @|StepIcon #fIcon
Te0 f249 expr out #txt
Te0 f249 792 588 791 615 #arcP
Te0 f41 expr out #txt
Te0 f41 791 639 792 668 #arcP
Te0 f256 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f256 actionTable 'out=in;
' #txt
Te0 f256 actionCode 'import ch.ivy.addon.portalkit.service.ServerService;

ServerService service = new ServerService();
in.isMultiServer = service.isMultiServers();' #txt
Te0 f256 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f256 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Is multi server</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f256 4077 188 36 24 20 -2 #rect
Te0 f256 @|StepIcon #fIcon
Te0 f257 expr out #txt
Te0 f257 4096 148 4095 188 #arcP
Te0 f254 expr out #txt
Te0 f254 4095 212 4096 248 #arcP
Te0 f25 inParamDecl '<java.lang.String name,java.lang.String value,java.lang.Long taskId,ch.ivy.addon.portalkit.persistence.domain.Server server> param;' #txt
Te0 f25 inParamTable 'out.name=param.name;
out.server=param.server;
out.taskId=param.taskId;
out.value=param.value;
' #txt
Te0 f25 outParamDecl '<java.util.List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f25 outParamTable 'result.errors=in.errors;
' #txt
Te0 f25 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f25 callSignature setAdditionalProperty(String,String,Long,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f25 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f25 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>setAdditionalProperty
(String,String,IvyTask,Long)</name>
        <nameStyle>50,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f25 4539 52 26 26 14 0 #rect
Te0 f25 @|StartSubIcon #fIcon
Te0 f253 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f253 actionTable 'out=in;
' #txt
Te0 f253 actionCode 'import ch.ivy.ws.addon.WsException;

for (WsException e : in.errors) {
	e.server = in.server.name;
}' #txt
Te0 f253 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f253 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>finalize</name>
        <nameStyle>8,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f253 4534 269 36 24 20 -2 #rect
Te0 f253 @|StepIcon #fIcon
Te0 f264 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f264 processCall ServiceIntegrators/TaskServiceIntegrator:setAdditionalProperty(ch.ivy.addon.portalkit.persistence.domain.Server,String,String,String,Long) #txt
Te0 f264 doCall true #txt
Te0 f264 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint,java.lang.String name,java.lang.String value,java.lang.Long taskId> param;
' #txt
Te0 f264 requestMappingAction 'param.server=in.server;
param.endpoint=in.endpoint;
param.name=in.name;
param.value=in.value;
param.taskId=in.taskId;
' #txt
Te0 f264 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f264 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
Te0 f264 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>TaskServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f264 4534 189 36 24 20 -2 #rect
Te0 f264 @|CallSubIcon #fIcon
Te0 f265 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f265 actionTable 'out=in;
' #txt
Te0 f265 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f265 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f265 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>init ws endpoint</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f265 4534 125 36 24 20 -2 #rect
Te0 f265 @|StepIcon #fIcon
Te0 f266 expr out #txt
Te0 f266 4552 213 4552 269 #arcP
Te0 f267 expr out #txt
Te0 f267 4552 149 4552 189 #arcP
Te0 f268 expr out #txt
Te0 f268 4552 78 4552 125 #arcP
Te0 f269 expr out #txt
Te0 f269 4552 293 1374 880 #arcP
Te0 f269 1 4552 880 #addKink
Te0 f269 0 0.7385410347342349 0 0 #arcLabel
Te0 f270 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f270 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has apps?</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f270 2737 458 28 28 14 0 #rect
Te0 f270 @|AlternativeIcon #fIcon
Te0 f271 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f271 actionTable 'out=in;
' #txt
Te0 f271 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f271 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f271 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f271 2733 516 36 24 20 -2 #rect
Te0 f271 @|StepIcon #fIcon
Te0 f272 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f272 actionTable 'out=in;
' #txt
Te0 f272 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (in.hasNoSelectedApp) {
	in.apps.clear();
}' #txt
Te0 f272 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f272 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Te0 f272 2933 212 36 24 20 -2 #rect
Te0 f272 @|StepIcon #fIcon
Te0 f273 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f273 actionTable 'out=in;
' #txt
Te0 f273 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.userName, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}
' #txt
Te0 f273 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f273 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f273 2733 404 36 24 21 -7 #rect
Te0 f273 @|StepIcon #fIcon
Te0 f274 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f274 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f274 doCall true #txt
Te0 f274 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Te0 f274 requestMappingAction 'param.server=in.server;
' #txt
Te0 f274 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f274 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Te0 f274 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get applications 
of server</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f274 2733 340 36 24 20 -2 #rect
Te0 f274 @|CallSubIcon #fIcon
Te0 f275 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f275 actionTable 'out=in;
' #txt
Te0 f275 actionCode 'import java.util.Set;
import java.util.HashSet;

Set categories = new HashSet(in.categories);
in.categories.clear();
in.categories.addAll(categories);' #txt
Te0 f275 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f275 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add categories</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f275 2733 636 36 24 20 -2 #rect
Te0 f275 @|StepIcon #fIcon
Te0 f276 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f276 processCall ServiceIntegrators/TaskServiceIntegrator:findUnassignedCategories(String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Te0 f276 doCall true #txt
Te0 f276 requestActionDecl '<java.lang.String jsonQuery,List<java.lang.String> apps,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Te0 f276 requestMappingAction 'param.jsonQuery=in.jsonQuery;
param.apps=in.apps;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Te0 f276 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f276 responseMappingAction 'out=in;
out.categories=in.categories.addAll(result.categories);
out.tempErrors=result.errors;
' #txt
Te0 f276 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>FindCategories</name>
        <nameStyle>14,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f276 2733 580 36 24 20 -2 #rect
Te0 f276 @|CallSubIcon #fIcon
Te0 f277 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f277 actionTable 'out=in;
' #txt
Te0 f277 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
Long serverId = in.server.#id;
if (#serverId is initialized && serverId != 0) {
	in.servers = Arrays.asList(serverService.findById(serverId));
} else {
	in.servers = serverService.findActiveServers();
}
in.listIterator = in.servers.listIterator();' #txt
Te0 f277 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f277 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f277 2733 100 36 24 20 -2 #rect
Te0 f277 @|StepIcon #fIcon
Te0 f278 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f278 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f278 2737 154 28 28 22 -21 #rect
Te0 f278 @|AlternativeIcon #fIcon
Te0 f279 inParamDecl '<java.lang.String jsonQuery,List<java.lang.String> apps,java.lang.Long serverId> param;' #txt
Te0 f279 inParamTable 'out.apps=param.apps;
out.hasNoSelectedApp=param.apps.isEmpty();
out.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
' #txt
Te0 f279 outParamDecl '<java.util.List<ch.ivy.ws.addon.CategoryData> categories,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f279 outParamTable 'result.categories=in.categories;
result.errors=in.errors;
' #txt
Te0 f279 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f279 callSignature findUnassignedCategories(String,List<String>,Long) #txt
Te0 f279 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f279 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findUnassignedCategories(String,List&lt;String&gt;,Long)</name>
    </language>
</elementInfo>
' #txt
Te0 f279 2738 51 26 26 -50 -39 #rect
Te0 f279 @|StartSubIcon #fIcon
Te0 f280 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f280 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f280 2737 274 28 28 14 0 #rect
Te0 f280 @|AlternativeIcon #fIcon
Te0 f281 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f281 actionTable 'out=in;
' #txt
Te0 f281 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Te0 f281 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f281 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f281 2733 212 36 24 20 -2 #rect
Te0 f281 @|StepIcon #fIcon
Te0 f282 expr out #txt
Te0 f282 2751 540 2751 580 #arcP
Te0 f283 expr in #txt
Te0 f283 outCond in.listIterator.hasNext() #txt
Te0 f283 2751 182 2751 212 #arcP
Te0 f284 expr in #txt
Te0 f284 2737 288 2733 528 #arcP
Te0 f284 1 2704 288 #addKink
Te0 f284 2 2704 528 #addKink
Te0 f284 1 0.4930555555555556 0 0 #arcLabel
Te0 f285 expr in #txt
Te0 f285 outCond 'in.apps.size() > 0' #txt
Te0 f285 2751 486 2751 516 #arcP
Te0 f286 expr out #txt
Te0 f286 2769 648 2951 236 #arcP
Te0 f286 1 2951 648 #addKink
Te0 f286 1 0.3622224354814317 0 0 #arcLabel
Te0 f287 expr in #txt
Te0 f287 outCond in.hasNoSelectedApp #txt
Te0 f287 2751 302 2751 340 #arcP
Te0 f288 expr out #txt
Te0 f288 2751 428 2751 458 #arcP
Te0 f289 expr out #txt
Te0 f289 2951 212 2765 168 #arcP
Te0 f289 1 2951 168 #addKink
Te0 f289 1 0.251489130890622 0 0 #arcLabel
Te0 f290 expr out #txt
Te0 f290 2751 236 2751 274 #arcP
Te0 f291 expr out #txt
Te0 f291 2751 77 2751 100 #arcP
Te0 f292 expr out #txt
Te0 f292 2751 124 2751 154 #arcP
Te0 f293 expr in #txt
Te0 f293 2765 472 2951 236 #arcP
Te0 f293 1 2951 472 #addKink
Te0 f293 0 0.8799989356997663 0 0 #arcLabel
Te0 f294 expr out #txt
Te0 f294 2751 604 2751 636 #arcP
Te0 f295 expr out #txt
Te0 f295 2751 364 2751 404 #arcP
Te0 f296 expr in #txt
Te0 f296 2737 168 1374 880 #arcP
Te0 f296 1 2656 168 #addKink
Te0 f296 2 2656 880 #addKink
Te0 f296 1 0.7513873294614658 0 0 #arcLabel
Te0 f297 inParamDecl '<java.lang.String jsonQuery,List<java.lang.String> apps,java.lang.Long serverId,java.lang.String userName> param;' #txt
Te0 f297 inParamTable 'out.apps=param.apps;
out.hasNoSelectedApp=param.apps.isEmpty();
out.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
out.userName=param.userName;
' #txt
Te0 f297 outParamDecl '<java.util.List<ch.ivy.ws.addon.ElapsedTimeStatistic> elapsedTimeStatistic,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Te0 f297 outParamTable 'result.elapsedTimeStatistic=in.elapsedTimeStatistic;
result.errors=in.errors;
' #txt
Te0 f297 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f297 callSignature analyzeElapsedTimeStatistic(String,List<String>,Long,String) #txt
Te0 f297 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f297 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>analyzeElapsedTimeStatistic(String,List&lt;String&gt;,Long,String)</name>
        <nameStyle>60,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f297 3828 48 26 26 -50 -39 #rect
Te0 f297 @|StartSubIcon #fIcon
Te0 f298 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f298 actionTable 'out=in;
' #txt
Te0 f298 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
Long serverId = in.server.#id;
if (#serverId is initialized && serverId != 0) {
	in.servers = Arrays.asList(serverService.findById(serverId));
} else {
	in.servers = serverService.findActiveServers();
}
in.listIterator = in.servers.listIterator();' #txt
Te0 f298 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f298 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f298 3823 105 36 24 20 -2 #rect
Te0 f298 @|StepIcon #fIcon
Te0 f299 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f299 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f299 3827 287 28 28 14 0 #rect
Te0 f299 @|AlternativeIcon #fIcon
Te0 f300 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f300 processCall ServiceIntegrators/TaskServiceIntegrator:analyzeElapsedTimeStatistic(String,String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Te0 f300 doCall true #txt
Te0 f300 requestActionDecl '<java.lang.String jsonQuery,java.lang.String userName,List<java.lang.String> apps,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Te0 f300 requestMappingAction 'param.jsonQuery=in.jsonQuery;
param.userName=in.userName;
param.apps=in.apps;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Te0 f300 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f300 responseMappingAction 'out=in;
out.tempElapsedTimeStatistic=result.elapsedTimeStatistic;
out.tempErrors=result.errors;
' #txt
Te0 f300 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AnalyzeElapsedTimeStatistic</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f300 3823 593 36 24 20 -2 #rect
Te0 f300 @|CallSubIcon #fIcon
Te0 f301 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f301 actionTable 'out=in;
' #txt
Te0 f301 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Te0 f301 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f301 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f301 3823 225 36 24 20 -2 #rect
Te0 f301 @|StepIcon #fIcon
Te0 f302 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f302 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f302 3827 167 28 28 22 -21 #rect
Te0 f302 @|AlternativeIcon #fIcon
Te0 f303 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f303 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has apps?</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f303 3827 479 28 28 14 0 #rect
Te0 f303 @|AlternativeIcon #fIcon
Te0 f304 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f304 actionTable 'out=in;
' #txt
Te0 f304 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.userName, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}
' #txt
Te0 f304 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f304 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f304 3823 417 36 24 21 -18 #rect
Te0 f304 @|StepIcon #fIcon
Te0 f305 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f305 actionTable 'out=in;
' #txt
Te0 f305 actionCode 'if (in.tempErrors.isEmpty()) {
	in.elapsedTimeStatistic.add(in.tempElapsedTimeStatistic);
}' #txt
Te0 f305 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f305 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add statistic</name>
        <nameStyle>13,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f305 3823 649 36 24 20 -2 #rect
Te0 f305 @|StepIcon #fIcon
Te0 f306 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f306 actionTable 'out=in;
' #txt
Te0 f306 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (in.hasNoSelectedApp) {
	in.apps.clear();
}' #txt
Te0 f306 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f306 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Te0 f306 3951 225 36 24 20 -2 #rect
Te0 f306 @|StepIcon #fIcon
Te0 f307 actionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f307 actionTable 'out=in;
' #txt
Te0 f307 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.TASK.toString();' #txt
Te0 f307 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f307 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f307 3823 545 36 24 20 -2 #rect
Te0 f307 @|StepIcon #fIcon
Te0 f308 type ch.ivyteam.wf.processes.TaskServiceData #txt
Te0 f308 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Te0 f308 doCall true #txt
Te0 f308 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Te0 f308 requestMappingAction 'param.server=in.server;
' #txt
Te0 f308 responseActionDecl 'ch.ivyteam.wf.processes.TaskServiceData out;
' #txt
Te0 f308 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Te0 f308 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get applications 
of server</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Te0 f308 3823 353 36 24 20 -2 #rect
Te0 f308 @|CallSubIcon #fIcon
Te0 f309 expr in #txt
Te0 f309 3827 301 3823 557 #arcP
Te0 f309 1 3776 301 #addKink
Te0 f309 2 3776 557 #addKink
Te0 f309 1 0.4930555555555556 0 0 #arcLabel
Te0 f310 expr out #txt
Te0 f310 3969 225 3855 181 #arcP
Te0 f310 1 3969 181 #addKink
Te0 f310 1 0.19087308919428908 0 0 #arcLabel
Te0 f311 expr out #txt
Te0 f311 3841 569 3841 593 #arcP
Te0 f312 expr in #txt
Te0 f312 outCond 'in.apps.size() > 0' #txt
Te0 f312 3841 507 3841 545 #arcP
Te0 f313 expr out #txt
Te0 f313 3841 441 3841 479 #arcP
Te0 f314 expr in #txt
Te0 f314 outCond in.listIterator.hasNext() #txt
Te0 f314 3841 195 3841 225 #arcP
Te0 f315 expr out #txt
Te0 f315 3841 377 3841 417 #arcP
Te0 f316 expr out #txt
Te0 f316 3841 129 3841 167 #arcP
Te0 f317 expr out #txt
Te0 f317 3841 249 3841 287 #arcP
Te0 f318 expr in #txt
Te0 f318 3855 493 3969 249 #arcP
Te0 f318 1 3969 493 #addKink
Te0 f318 0 0.8288430891547728 0 0 #arcLabel
Te0 f319 expr out #txt
Te0 f319 3859 661 3969 249 #arcP
Te0 f319 1 3969 661 #addKink
Te0 f319 1 0.3395443488573781 0 0 #arcLabel
Te0 f320 expr in #txt
Te0 f320 outCond in.hasNoSelectedApp #txt
Te0 f320 3841 315 3841 353 #arcP
Te0 f321 expr out #txt
Te0 f321 3841 74 3841 105 #arcP
Te0 f322 expr out #txt
Te0 f322 3841 617 3841 649 #arcP
Te0 f323 expr in #txt
Te0 f323 3827 181 1374 880 #arcP
Te0 f323 1 3712 181 #addKink
Te0 f323 2 3712 880 #addKink
Te0 f323 2 0.3593429158110883 0 0 #arcLabel
>Proto Te0 .type ch.ivyteam.wf.processes.TaskServiceData #txt
>Proto Te0 .processKind CALLABLE_SUB #txt
>Proto Te0 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <swimlaneLabel>RESET TASK</swimlaneLabel>
        <swimlaneLabel>DELEGATE TASK</swimlaneLabel>
        <swimlaneLabel>SEARCH TASKS</swimlaneLabel>
        <swimlaneLabel>CAN USER RESUME TASK</swimlaneLabel>
        <swimlaneLabel>CREATE NOTE</swimlaneLabel>
        <swimlaneLabel>COUNT TASKS BY CRITERIA</swimlaneLabel>
        <swimlaneLabel>FIND CATEGORIES</swimlaneLabel>
        <swimlaneLabel>STATISTIC</swimlaneLabel>
        <swimlaneLabel>SAVE</swimlaneLabel>
        <swimlaneLabel></swimlaneLabel>
    </language>
    <swimlaneSize>248</swimlaneSize>
    <swimlaneSize>272</swimlaneSize>
    <swimlaneSize>472</swimlaneSize>
    <swimlaneSize>200</swimlaneSize>
    <swimlaneSize>256</swimlaneSize>
    <swimlaneSize>280</swimlaneSize>
    <swimlaneSize>1016</swimlaneSize>
    <swimlaneSize>1120</swimlaneSize>
    <swimlaneSize>288</swimlaneSize>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
</elementInfo>
' #txt
>Proto Te0 0 0 32 24 18 0 #rect
>Proto Te0 @|BIcon #fIcon
Te0 f62 mainOut f73 tail #connect
Te0 f73 head f56 mainIn #connect
Te0 f85 mainOut f89 tail #connect
Te0 f89 head f81 mainIn #connect
Te0 f83 mainOut f91 tail #connect
Te0 f91 head f85 mainIn #connect
Te0 f101 mainOut f104 tail #connect
Te0 f104 head f103 mainIn #connect
Te0 f103 mainOut f108 tail #connect
Te0 f108 head f105 mainIn #connect
Te0 f144 mainOut f40 tail #connect
Te0 f40 head f3 mainIn #connect
Te0 f19 mainOut f145 tail #connect
Te0 f145 head f148 in #connect
Te0 f15 mainOut f21 tail #connect
Te0 f21 head f148 in #connect
Te0 f81 mainOut f64 tail #connect
Te0 f64 head f148 in #connect
Te0 f105 mainOut f88 tail #connect
Te0 f88 head f148 in #connect
Te0 f156 mainOut f162 tail #connect
Te0 f162 head f152 mainIn #connect
Te0 f152 mainOut f164 tail #connect
Te0 f164 head f160 in #connect
Te0 f155 mainOut f165 tail #connect
Te0 f165 head f153 in #connect
Te0 f166 head f152 mainIn #connect
Te0 f151 mainOut f169 tail #connect
Te0 f169 head f150 mainIn #connect
Te0 f150 mainOut f170 tail #connect
Te0 f170 head f160 in #connect
Te0 f160 out f172 tail #connect
Te0 f172 head f157 mainIn #connect
Te0 f56 mainOut f177 tail #connect
Te0 f177 head f176 mainIn #connect
Te0 f176 mainOut f74 tail #connect
Te0 f74 head f148 in #connect
Te0 f160 out f53 tail #connect
Te0 f53 head f148 in #connect
Te0 f55 mainOut f70 tail #connect
Te0 f70 head f68 mainIn #connect
Te0 f68 mainOut f72 tail #connect
Te0 f72 head f57 in #connect
Te0 f67 mainOut f75 tail #connect
Te0 f75 head f60 in #connect
Te0 f76 head f68 mainIn #connect
Te0 f54 mainOut f94 tail #connect
Te0 f94 head f55 mainIn #connect
Te0 f57 out f118 tail #connect
Te0 f118 head f66 mainIn #connect
Te0 f57 out f120 tail #connect
Te0 f120 head f148 in #connect
Te0 f121 mainOut f95 tail #connect
Te0 f95 head f57 in #connect
Te0 f106 mainOut f122 tail #connect
Te0 f122 head f114 mainIn #connect
Te0 f114 mainOut f125 tail #connect
Te0 f125 head f61 in #connect
Te0 f111 mainOut f126 tail #connect
Te0 f126 head f113 in #connect
Te0 f127 head f114 mainIn #connect
Te0 f112 mainOut f129 tail #connect
Te0 f129 head f106 mainIn #connect
Te0 f61 out f131 tail #connect
Te0 f131 head f110 mainIn #connect
Te0 f59 mainOut f133 tail #connect
Te0 f133 head f115 mainIn #connect
Te0 f115 mainOut f134 tail #connect
Te0 f134 head f61 in #connect
Te0 f61 out f135 tail #connect
Te0 f135 head f148 in #connect
Te0 f149 mainOut f175 tail #connect
Te0 f175 head f141 mainIn #connect
Te0 f141 mainOut f179 tail #connect
Te0 f179 head f136 in #connect
Te0 f142 mainOut f180 tail #connect
Te0 f180 head f146 in #connect
Te0 f181 head f141 mainIn #connect
Te0 f139 mainOut f183 tail #connect
Te0 f183 head f149 mainIn #connect
Te0 f136 out f185 tail #connect
Te0 f185 head f138 mainIn #connect
Te0 f143 mainOut f187 tail #connect
Te0 f187 head f154 mainIn #connect
Te0 f154 mainOut f188 tail #connect
Te0 f188 head f136 in #connect
Te0 f136 out f189 tail #connect
Te0 f189 head f148 in #connect
Te0 f198 mainOut f202 tail #connect
Te0 f202 head f200 mainIn #connect
Te0 f200 mainOut f204 tail #connect
Te0 f204 head f193 in #connect
Te0 f195 mainOut f205 tail #connect
Te0 f205 head f192 in #connect
Te0 f206 head f200 mainIn #connect
Te0 f197 mainOut f208 tail #connect
Te0 f208 head f198 mainIn #connect
Te0 f193 out f210 tail #connect
Te0 f210 head f194 mainIn #connect
Te0 f196 mainOut f212 tail #connect
Te0 f212 head f199 mainIn #connect
Te0 f199 mainOut f213 tail #connect
Te0 f213 head f193 in #connect
Te0 f193 out f214 tail #connect
Te0 f214 head f148 in #connect
Te0 f26 mainOut f31 tail #connect
Te0 f31 head f148 in #connect
Te0 f36 mainOut f37 tail #connect
Te0 f37 head f32 mainIn #connect
Te0 f34 mainOut f38 tail #connect
Te0 f38 head f35 mainIn #connect
Te0 f35 mainOut f42 tail #connect
Te0 f42 head f36 mainIn #connect
Te0 f32 mainOut f44 tail #connect
Te0 f44 head f148 in #connect
Te0 f10 mainOut f13 tail #connect
Te0 f13 head f18 mainIn #connect
Te0 f17 mainOut f6 tail #connect
Te0 f6 head f28 mainIn #connect
Te0 f96 mainOut f7 tail #connect
Te0 f7 head f101 mainIn #connect
Te0 f0 mainOut f14 tail #connect
Te0 f14 head f8 mainIn #connect
Te0 f147 mainOut f1 tail #connect
Te0 f1 head f155 mainIn #connect
Te0 f84 mainOut f4 tail #connect
Te0 f4 head f83 mainIn #connect
Te0 f65 mainOut f2 tail #connect
Te0 f2 head f67 mainIn #connect
Te0 f12 mainOut f5 tail #connect
Te0 f5 head f111 mainIn #connect
Te0 f137 mainOut f9 tail #connect
Te0 f9 head f142 mainIn #connect
Te0 f191 mainOut f16 tail #connect
Te0 f16 head f195 mainIn #connect
Te0 f157 mainOut f24 tail #connect
Te0 f24 head f20 in #connect
Te0 f20 out f30 tail #connect
Te0 f30 head f147 mainIn #connect
Te0 f39 out f47 tail #connect
Te0 f47 head f65 mainIn #connect
Te0 f110 mainOut f50 tail #connect
Te0 f50 head f49 in #connect
Te0 f49 out f51 tail #connect
Te0 f51 head f12 mainIn #connect
Te0 f138 mainOut f69 tail #connect
Te0 f69 head f63 in #connect
Te0 f63 out f71 tail #connect
Te0 f71 head f137 mainIn #connect
Te0 f194 mainOut f80 tail #connect
Te0 f80 head f79 in #connect
Te0 f79 out f82 tail #connect
Te0 f82 head f191 mainIn #connect
Te0 f148 out f93 tail #connect
Te0 f93 head f144 mainIn #connect
Te0 f66 mainOut f99 tail #connect
Te0 f99 head f39 in #connect
Te0 f58 mainOut f45 tail #connect
Te0 f45 head f121 mainIn #connect
Te0 f153 out f87 tail #connect
Te0 f87 head f78 mainIn #connect
Te0 f153 out f166 tail #connect
Te0 f20 out f90 tail #connect
Te0 f90 head f78 mainIn #connect
Te0 f60 out f98 tail #connect
Te0 f98 head f97 mainIn #connect
Te0 f60 out f76 tail #connect
Te0 f39 out f92 tail #connect
Te0 f92 head f97 mainIn #connect
Te0 f97 mainOut f48 tail #connect
Te0 f48 head f54 mainIn #connect
Te0 f113 out f102 tail #connect
Te0 f102 head f100 mainIn #connect
Te0 f113 out f127 tail #connect
Te0 f100 mainOut f107 tail #connect
Te0 f107 head f112 mainIn #connect
Te0 f49 out f109 tail #connect
Te0 f109 head f100 mainIn #connect
Te0 f146 out f116 tail #connect
Te0 f116 head f52 mainIn #connect
Te0 f146 out f181 tail #connect
Te0 f63 out f117 tail #connect
Te0 f117 head f52 mainIn #connect
Te0 f52 mainOut f77 tail #connect
Te0 f77 head f139 mainIn #connect
Te0 f192 out f123 tail #connect
Te0 f123 head f119 mainIn #connect
Te0 f192 out f206 tail #connect
Te0 f79 out f124 tail #connect
Te0 f124 head f119 mainIn #connect
Te0 f119 mainOut f86 tail #connect
Te0 f86 head f197 mainIn #connect
Te0 f140 mainOut f182 tail #connect
Te0 f182 head f178 mainIn #connect
Te0 f178 mainOut f184 tail #connect
Te0 f184 head f174 in #connect
Te0 f130 mainOut f186 tail #connect
Te0 f186 head f171 in #connect
Te0 f190 head f178 mainIn #connect
Te0 f128 mainOut f201 tail #connect
Te0 f201 head f140 mainIn #connect
Te0 f174 out f203 tail #connect
Te0 f203 head f132 mainIn #connect
Te0 f161 mainOut f207 tail #connect
Te0 f207 head f163 mainIn #connect
Te0 f163 mainOut f209 tail #connect
Te0 f209 head f174 in #connect
Te0 f173 mainOut f211 tail #connect
Te0 f211 head f130 mainIn #connect
Te0 f132 mainOut f215 tail #connect
Te0 f215 head f158 in #connect
Te0 f158 out f216 tail #connect
Te0 f216 head f173 mainIn #connect
Te0 f171 out f217 tail #connect
Te0 f217 head f167 mainIn #connect
Te0 f171 out f190 tail #connect
Te0 f167 mainOut f218 tail #connect
Te0 f218 head f128 mainIn #connect
Te0 f158 out f219 tail #connect
Te0 f219 head f167 mainIn #connect
Te0 f223 mainOut f232 tail #connect
Te0 f232 head f231 mainIn #connect
Te0 f231 mainOut f233 tail #connect
Te0 f233 head f230 in #connect
Te0 f221 mainOut f234 tail #connect
Te0 f234 head f228 in #connect
Te0 f235 head f231 mainIn #connect
Te0 f220 mainOut f236 tail #connect
Te0 f236 head f223 mainIn #connect
Te0 f230 out f237 tail #connect
Te0 f237 head f222 mainIn #connect
Te0 f225 mainOut f238 tail #connect
Te0 f238 head f226 mainIn #connect
Te0 f226 mainOut f239 tail #connect
Te0 f239 head f230 in #connect
Te0 f229 mainOut f240 tail #connect
Te0 f240 head f221 mainIn #connect
Te0 f222 mainOut f241 tail #connect
Te0 f241 head f224 in #connect
Te0 f224 out f242 tail #connect
Te0 f242 head f229 mainIn #connect
Te0 f228 out f243 tail #connect
Te0 f243 head f227 mainIn #connect
Te0 f228 out f235 tail #connect
Te0 f227 mainOut f244 tail #connect
Te0 f244 head f220 mainIn #connect
Te0 f224 out f245 tail #connect
Te0 f245 head f227 mainIn #connect
Te0 f174 out f246 tail #connect
Te0 f246 head f148 in #connect
Te0 f230 out f247 tail #connect
Te0 f247 head f148 in #connect
Te0 f248 mainOut f29 tail #connect
Te0 f29 head f19 mainIn #connect
Te0 f252 mainOut f43 tail #connect
Te0 f43 head f15 mainIn #connect
Te0 f259 mainOut f27 tail #connect
Te0 f27 head f26 mainIn #connect
Te0 f22 mainOut f262 tail #connect
Te0 f262 head f248 mainIn #connect
Te0 f33 mainOut f255 tail #connect
Te0 f255 head f252 mainIn #connect
Te0 f159 mainOut f168 tail #connect
Te0 f168 head f156 mainIn #connect
Te0 f11 mainOut f258 tail #connect
Te0 f258 head f259 mainIn #connect
Te0 f18 mainOut f261 tail #connect
Te0 f261 head f260 mainIn #connect
Te0 f260 mainOut f23 tail #connect
Te0 f23 head f22 mainIn #connect
Te0 f28 mainOut f251 tail #connect
Te0 f251 head f250 mainIn #connect
Te0 f250 mainOut f263 tail #connect
Te0 f263 head f33 mainIn #connect
Te0 f78 mainOut f249 tail #connect
Te0 f249 head f46 mainIn #connect
Te0 f46 mainOut f41 tail #connect
Te0 f41 head f159 mainIn #connect
Te0 f8 mainOut f257 tail #connect
Te0 f257 head f256 mainIn #connect
Te0 f256 mainOut f254 tail #connect
Te0 f254 head f11 mainIn #connect
Te0 f264 mainOut f266 tail #connect
Te0 f266 head f253 mainIn #connect
Te0 f25 mainOut f268 tail #connect
Te0 f268 head f265 mainIn #connect
Te0 f265 mainOut f267 tail #connect
Te0 f267 head f264 mainIn #connect
Te0 f253 mainOut f269 tail #connect
Te0 f269 head f148 in #connect
Te0 f275 mainOut f286 tail #connect
Te0 f286 head f272 mainIn #connect
Te0 f272 mainOut f289 tail #connect
Te0 f289 head f278 in #connect
Te0 f273 mainOut f288 tail #connect
Te0 f288 head f270 in #connect
Te0 f293 head f272 mainIn #connect
Te0 f276 mainOut f294 tail #connect
Te0 f294 head f275 mainIn #connect
Te0 f278 out f283 tail #connect
Te0 f283 head f281 mainIn #connect
Te0 f279 mainOut f291 tail #connect
Te0 f291 head f277 mainIn #connect
Te0 f277 mainOut f292 tail #connect
Te0 f292 head f278 in #connect
Te0 f274 mainOut f295 tail #connect
Te0 f295 head f273 mainIn #connect
Te0 f281 mainOut f290 tail #connect
Te0 f290 head f280 in #connect
Te0 f280 out f287 tail #connect
Te0 f287 head f274 mainIn #connect
Te0 f270 out f285 tail #connect
Te0 f285 head f271 mainIn #connect
Te0 f270 out f293 tail #connect
Te0 f271 mainOut f282 tail #connect
Te0 f282 head f276 mainIn #connect
Te0 f280 out f284 tail #connect
Te0 f284 head f271 mainIn #connect
Te0 f278 out f296 tail #connect
Te0 f296 head f148 in #connect
Te0 f305 mainOut f319 tail #connect
Te0 f319 head f306 mainIn #connect
Te0 f306 mainOut f310 tail #connect
Te0 f310 head f302 in #connect
Te0 f304 mainOut f313 tail #connect
Te0 f313 head f303 in #connect
Te0 f318 head f306 mainIn #connect
Te0 f300 mainOut f322 tail #connect
Te0 f322 head f305 mainIn #connect
Te0 f302 out f314 tail #connect
Te0 f314 head f301 mainIn #connect
Te0 f297 mainOut f321 tail #connect
Te0 f321 head f298 mainIn #connect
Te0 f298 mainOut f316 tail #connect
Te0 f316 head f302 in #connect
Te0 f308 mainOut f315 tail #connect
Te0 f315 head f304 mainIn #connect
Te0 f301 mainOut f317 tail #connect
Te0 f317 head f299 in #connect
Te0 f299 out f320 tail #connect
Te0 f320 head f308 mainIn #connect
Te0 f303 out f312 tail #connect
Te0 f312 head f307 mainIn #connect
Te0 f303 out f318 tail #connect
Te0 f299 out f309 tail #connect
Te0 f309 head f307 mainIn #connect
Te0 f307 mainOut f311 tail #connect
Te0 f311 head f300 mainIn #connect
Te0 f302 out f323 tail #connect
Te0 f323 head f148 in #connect
