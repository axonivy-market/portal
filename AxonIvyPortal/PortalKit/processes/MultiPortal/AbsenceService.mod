[Ivy]
[>Created: Mon May 30 11:19:40 ICT 2016]
14BDDCD00C5EA267 3.18 #module
>Proto >Proto Collection #zClass
Se0 AbsenceService Big #zClass
Se0 B #cInfo
Se0 #process
Se0 @TextInP .resExport .resExport #zField
Se0 @TextInP .type .type #zField
Se0 @TextInP .processKind .processKind #zField
Se0 @AnnotationInP-0n ai ai #zField
Se0 @TextInP .xml .xml #zField
Se0 @TextInP .responsibility .responsibility #zField
Se0 @GridStep f21 '' #zField
Se0 @GridStep f14 '' #zField
Se0 @GridStep f13 '' #zField
Se0 @Alternative f4 '' #zField
Se0 @StartSub f0 '' #zField
Se0 @Alternative f7 '' #zField
Se0 @PushWFArc f22 '' #zField
Se0 @PushWFArc f12 '' #zField
Se0 @PushWFArc f17 '' #zField
Se0 @Alternative f25 '' #zField
Se0 @GridStep f29 '' #zField
Se0 @StartSub f35 '' #zField
Se0 @GridStep f36 '' #zField
Se0 @Alternative f39 '' #zField
Se0 @PushWFArc f48 '' #zField
Se0 @PushWFArc f49 '' #zField
Se0 @PushWFArc f8 '' #zField
Se0 @PushWFArc f43 '' #zField
Se0 @GridStep f72 '' #zField
Se0 @Alternative f109 '' #zField
Se0 @GridStep f113 '' #zField
Se0 @Alternative f114 '' #zField
Se0 @StartSub f117 '' #zField
Se0 @PushWFArc f123 '' #zField
Se0 @PushWFArc f124 '' #zField
Se0 @PushWFArc f130 '' #zField
Se0 @CallSub f44 '' #zField
Se0 @PushWFArc f46 '' #zField
Se0 @PushWFArc f10 '' #zField
Se0 @CallSub f19 '' #zField
Se0 @PushWFArc f5 '' #zField
Se0 @CallSub f11 '' #zField
Se0 @PushWFArc f23 '' #zField
Se0 @PushWFArc f24 '' #zField
Se0 @Alternative f27 '' #zField
Se0 @Alternative f54 '' #zField
Se0 @StartSub f56 '' #zField
Se0 @CallSub f57 '' #zField
Se0 @GridStep f58 '' #zField
Se0 @GridStep f59 '' #zField
Se0 @GridStep f60 '' #zField
Se0 @PushWFArc f63 '' #zField
Se0 @PushWFArc f64 '' #zField
Se0 @PushWFArc f65 '' #zField
Se0 @PushWFArc f68 '' #zField
Se0 @PushWFArc f71 '' #zField
Se0 @PushWFArc f73 '' #zField
Se0 @GridStep f74 '' #zField
Se0 @PushWFArc f75 '' #zField
Se0 @PushWFArc f51 '' #zField
Se0 @GridStep f2 '' #zField
Se0 @PushWFArc f50 '' #zField
Se0 @PushWFArc f66 '' #zField
Se0 @GridStep f30 '' #zField
Se0 @PushWFArc f67 '' #zField
Se0 @PushWFArc f52 '' #zField
Se0 @GridStep f33 '' #zField
Se0 @PushWFArc f53 '' #zField
Se0 @PushWFArc f76 '' #zField
Se0 @CallSub f77 '' #zField
Se0 @PushWFArc f18 '' #zField
Se0 @CallSub f9 '' #zField
Se0 @GridStep f15 '' #zField
Se0 @PushWFArc f34 '' #zField
Se0 @PushWFArc f45 '' #zField
Se0 @PushWFArc f62 '' #zField
Se0 @CallSub f3 '' #zField
Se0 @GridStep f6 '' #zField
Se0 @PushWFArc f28 '' #zField
Se0 @PushWFArc f38 '' #zField
Se0 @PushWFArc f80 '' #zField
Se0 @PushWFArc f70 '' #zField
Se0 @GridStep f55 '' #zField
Se0 @Alternative f148 '' #zField
Se0 @EndSub f42 '' #zField
Se0 @CallSub f144 '' #zField
Se0 @PushWFArc f78 '' #zField
Se0 @PushWFArc f107 '' #zField
Se0 @PushWFArc f79 '' #zField
Se0 @PushWFArc f16 '' #zField
Se0 @PushWFArc f61 '' #zField
Se0 @PushWFArc f40 '' #zField
Se0 @GridStep f1 '' #zField
Se0 @PushWFArc f31 '' #zField
Se0 @PushWFArc f47 '' #zField
Se0 @PushWFArc f69 '' #zField
Se0 @PushWFArc f41 '' #zField
Se0 @CallSub f26 '' #zField
Se0 @GridStep f32 '' #zField
Se0 @PushWFArc f37 '' #zField
Se0 @PushWFArc f20 '' #zField
>Proto Se0 Se0 AbsenceService #zField
Se0 f21 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f21 actionTable 'out=in;
' #txt
Se0 f21 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

in.apps.clear();
' #txt
Se0 f21 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f21 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Se0 f21 182 181 36 23 19 14 #rect
Se0 f21 @|StepIcon #fIcon
Se0 f14 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f14 actionTable 'out=in;
' #txt
Se0 f14 actionCode 'import ch.ivy.ws.addon.Absence;
import ch.ivy.addon.portalkit.mapper.ServerApplicationMapper;
import ch.ivy.addon.portalkit.mapper.RemoteAbsenceMapper;
import ch.ivy.addon.portalkit.bo.RemoteAbsence;
import java.util.ArrayList;
import ch.ivy.addon.portalkit.bo.ServerApplication;

if (in.tempErrors.isEmpty() && !in.absencesGroupedByUserNames.isEmpty()) {
	for (Absence absence : in.absencesGroupedByUserNames) {
		in.absences.addAll(absence.getAbsences());
	}
	
	List<RemoteAbsence> remoteAbsences = RemoteAbsenceMapper.mapToRemoteAbsences(in.absences);
	in.remoteAbsences.addAll(remoteAbsences);
	
	List<ServerApplication> tempAppList = ServerApplicationMapper.mapToServerApplications(in.apps,in.server.id);
	in.absenceApplications.addAll(tempAppList);
}

' #txt
Se0 f14 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f14 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add absences</name>
        <nameStyle>12,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f14 46 524 36 24 -10 19 #rect
Se0 f14 @|StepIcon #fIcon
Se0 f13 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f13 actionTable 'out=in;
' #txt
Se0 f13 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

in.apps.clear();


UserService userService = new UserService();
java.util.List<String> applicationsUserCanWorkOn = userService.findApplicationNamesUserCanWorkOn(in.username, in.server.id);
in.apps = AbsenceAndSubstituteUtils.getAbsencesSettingSupportedApps(applicationsUserCanWorkOn, in.server.getApplications());
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.ABSENCE.toString();
' #txt
Se0 f13 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f13 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps
ws endpoint</name>
        <nameStyle>26,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f13 46 340 36 24 21 -18 #rect
Se0 f13 @|StepIcon #fIcon
Se0 f4 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f4 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f4 50 146 28 28 22 -21 #rect
Se0 f4 @|AlternativeIcon #fIcon
Se0 f0 inParamDecl '<java.lang.String user> param;' #txt
Se0 f0 inParamTable 'out.username=param.user;
' #txt
Se0 f0 outParamDecl '<java.util.List<ch.ivy.addon.portalkit.bo.ServerApplication> serverApplications,java.util.List<ch.ivy.ws.addon.WsException> errors,List<ch.ivy.addon.portalkit.bo.RemoteAbsence> remoteAbsences> result;
' #txt
Se0 f0 outParamTable 'result.serverApplications=in.absenceApplications;
result.errors=in.errors;
result.remoteAbsences=in.remoteAbsences;
' #txt
Se0 f0 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f0 callSignature getAbsences(String) #txt
Se0 f0 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>getAbsences
(String)</name>
        <nameStyle>20,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f0 51 35 26 26 14 0 #rect
Se0 f0 @|StartSubIcon #fIcon
Se0 f7 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>any apps active?</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f7 50 402 28 28 9 -35 #rect
Se0 f7 @|AlternativeIcon #fIcon
Se0 f22 expr out #txt
Se0 f22 82 536 200 203 #arcP
Se0 f22 1 200 536 #addKink
Se0 f22 1 0.4321413036724042 0 0 #arcLabel
Se0 f12 expr in #txt
Se0 f12 78 416 200 203 #arcP
Se0 f12 1 200 416 #addKink
Se0 f12 1 0.5115178601655154 0 0 #arcLabel
Se0 f17 expr out #txt
Se0 f17 200 180 78 160 #arcP
Se0 f17 1 200 160 #addKink
Se0 f17 1 0.31135433052386374 0 0 #arcLabel
Se0 f25 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f25 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>any apps active?</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f25 570 402 28 28 13 -34 #rect
Se0 f25 @|AlternativeIcon #fIcon
Se0 f29 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f29 actionTable 'out=in;
' #txt
Se0 f29 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

in.apps.clear();' #txt
Se0 f29 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f29 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Se0 f29 702 181 36 23 19 14 #rect
Se0 f29 @|StepIcon #fIcon
Se0 f35 inParamDecl '<List<ch.ivy.addon.portalkit.bo.RemoteAbsence> absences,java.lang.String user> param;' #txt
Se0 f35 inParamTable 'out.remoteAbsences=param.absences;
out.username=param.user;
' #txt
Se0 f35 outParamDecl '<java.util.List<ch.ivy.addon.portalkit.bo.ServerApplication> removeApplications,java.util.List<ch.ivy.ws.addon.WsException> errors,List<ch.ivy.addon.portalkit.bo.RemoteAbsence> remoteAbsences> result;
' #txt
Se0 f35 outParamTable 'result.errors=in.errors;
result.remoteAbsences=in.remoteAbsences;
' #txt
Se0 f35 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f35 callSignature setAbsence(List<ch.ivy.addon.portalkit.bo.RemoteAbsence>,String) #txt
Se0 f35 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f35 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>setAbsence</name>
        <nameStyle>10,5,7
</nameStyle>
        <desc>Param list:

-remoteAbsences : list of absences to update for passed user
-userName : user whose absences to update/delete</desc>
    </language>
</elementInfo>
' #txt
Se0 f35 571 35 26 26 14 0 #rect
Se0 f35 @|StartSubIcon #fIcon
Se0 f36 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f36 actionTable 'out=in;
' #txt
Se0 f36 actionCode 'import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;


in.apps.clear();
UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.username,in.server.id);
in.apps = AbsenceAndSubstituteUtils.getAbsencesSettingSupportedApps(apps, in.server.getApplications());
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}
' #txt
Se0 f36 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f36 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps
ws endpoint</name>
        <nameStyle>26,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f36 566 340 36 24 21 -17 #rect
Se0 f36 @|StepIcon #fIcon
Se0 f39 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f39 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f39 570 146 28 28 22 -21 #rect
Se0 f39 @|AlternativeIcon #fIcon
Se0 f48 expr in #txt
Se0 f48 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f48 598 416 720 203 #arcP
Se0 f48 1 720 416 #addKink
Se0 f48 0 0.5491803278688525 0 9 #arcLabel
Se0 f49 expr out #txt
Se0 f49 720 180 598 160 #arcP
Se0 f49 1 720 160 #addKink
Se0 f49 1 0.31135433052386374 0 0 #arcLabel
Se0 f8 expr out #txt
Se0 f8 64 364 64 402 #arcP
Se0 f43 expr out #txt
Se0 f43 584 364 584 402 #arcP
Se0 f72 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f72 actionTable 'out=in;
' #txt
Se0 f72 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

in.apps.clear();' #txt
Se0 f72 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f72 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Se0 f72 982 181 36 23 19 14 #rect
Se0 f72 @|StepIcon #fIcon
Se0 f109 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f109 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f109 850 146 28 28 22 -21 #rect
Se0 f109 @|AlternativeIcon #fIcon
Se0 f113 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f113 actionTable 'out=in;
' #txt
Se0 f113 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.username,in.server.id);
in.apps = AbsenceAndSubstituteUtils.getAbsencesSettingSupportedApps(apps, in.server.getApplications());
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.ABSENCE.toString();' #txt
Se0 f113 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f113 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps
ws endpoint</name>
        <nameStyle>26,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f113 846 340 36 24 21 -17 #rect
Se0 f113 @|StepIcon #fIcon
Se0 f114 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f114 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>any apps active?</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f114 850 402 28 28 13 -34 #rect
Se0 f114 @|AlternativeIcon #fIcon
Se0 f117 inParamDecl '<java.util.List<ch.ivy.addon.portalkit.bo.ServerApplication> applications,java.lang.String user> param;' #txt
Se0 f117 inParamTable 'out.absenceApplications=param.applications;
out.username=param.user;
' #txt
Se0 f117 outParamDecl '<java.util.List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Se0 f117 outParamTable 'result.errors=in.errors;
' #txt
Se0 f117 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f117 callSignature deleteAbsence(List<ch.ivy.addon.portalkit.bo.ServerApplication>,String) #txt
Se0 f117 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f117 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>deleteAbsence</name>
        <nameStyle>13,5,7
</nameStyle>
        <desc>Param list:

-removeApplications : list of application to delete all absences of passed user
-userName : user whose absences to update/delete</desc>
    </language>
</elementInfo>
' #txt
Se0 f117 851 35 26 26 14 0 #rect
Se0 f117 @|StartSubIcon #fIcon
Se0 f123 expr in #txt
Se0 f123 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f123 878 416 1000 203 #arcP
Se0 f123 1 1000 416 #addKink
Se0 f123 0 0.5491803278688525 0 9 #arcLabel
Se0 f124 expr out #txt
Se0 f124 1000 180 878 160 #arcP
Se0 f124 1 1000 160 #addKink
Se0 f124 1 0.31135433052386374 0 0 #arcLabel
Se0 f130 expr out #txt
Se0 f130 864 364 864 402 #arcP
Se0 f44 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f44 processCall ServiceIntegrators/UserServiceIntegrator:getAbsences(String,String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Se0 f44 doCall true #txt
Se0 f44 requestActionDecl '<java.lang.String endpoint,java.lang.String userName,List<java.lang.String> applicationNames,ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Se0 f44 requestMappingAction 'param.endpoint=in.endpoint;
param.userName=in.username;
param.applicationNames=in.apps;
param.server=in.server;
' #txt
Se0 f44 responseActionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f44 responseMappingAction 'out=in;
out.absencesGroupedByUserNames=result.absences;
out.tempErrors=result.errors;
' #txt
Se0 f44 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>getAbsences
(String,String,List&lt;String&gt;,Server)</name>
        <nameStyle>47,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f44 46 460 36 24 20 -2 #rect
Se0 f44 @|CallSubIcon #fIcon
Se0 f46 expr in #txt
Se0 f46 outCond in.apps.size()>0 #txt
Se0 f46 64 430 64 460 #arcP
Se0 f10 expr out #txt
Se0 f10 64 484 64 524 #arcP
Se0 f19 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f19 processCall ServiceIntegrators/UserServiceIntegrator:setAbsences(String,String,ch.ivy.addon.portalkit.persistence.domain.Server,List<ch.ivy.ws.addon.IvyAbsence>) #txt
Se0 f19 doCall true #txt
Se0 f19 requestActionDecl '<java.lang.String endpoint,java.lang.String userName,ch.ivy.addon.portalkit.persistence.domain.Server server,List<ch.ivy.ws.addon.IvyAbsence> absences> param;
' #txt
Se0 f19 requestMappingAction 'param.endpoint=in.endpoint;
param.userName=in.username;
param.server=in.server;
param.absences=in.absences;
' #txt
Se0 f19 responseActionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f19 responseMappingAction 'out=in;
out.tempErrors=result.errors;
' #txt
Se0 f19 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>setAbsences
(String,String,Server,
List&lt;IvyAbsence&gt;)</name>
        <nameStyle>52,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f19 566 532 36 24 20 5 #rect
Se0 f19 @|CallSubIcon #fIcon
Se0 f5 expr out #txt
Se0 f5 584 556 720 203 #arcP
Se0 f5 1 584 568 #addKink
Se0 f5 2 720 568 #addKink
Se0 f5 2 0.1331716295875694 0 0 #arcLabel
Se0 f11 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f11 processCall ServiceIntegrators/UserServiceIntegrator:deleteAbsenes(String,String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Se0 f11 doCall true #txt
Se0 f11 requestActionDecl '<java.lang.String endpoint,java.lang.String userName,List<java.lang.String> applicationNames,ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Se0 f11 requestMappingAction 'param.endpoint=in.endpoint;
param.userName=in.username;
param.applicationNames=in.apps;
param.server=in.server;
' #txt
Se0 f11 responseActionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f11 responseMappingAction 'out=in;
out.tempErrors=result.errors;
' #txt
Se0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>deleteAbsenes
(String,String,List&lt;String&gt;,Server)</name>
        <nameStyle>49,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f11 846 476 36 24 20 -2 #rect
Se0 f11 @|CallSubIcon #fIcon
Se0 f23 expr in #txt
Se0 f23 outCond in.apps.size()>0 #txt
Se0 f23 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f23 864 430 864 476 #arcP
Se0 f23 0 0.43333333333333335 15 0 #arcLabel
Se0 f24 expr out #txt
Se0 f24 864 500 1000 203 #arcP
Se0 f24 1 864 584 #addKink
Se0 f24 2 1000 584 #addKink
Se0 f24 2 0.28073549517324276 0 0 #arcLabel
Se0 f27 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f27 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>any apps active?</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f27 314 402 28 28 10 -33 #rect
Se0 f27 @|AlternativeIcon #fIcon
Se0 f54 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f54 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f54 314 146 28 28 22 -21 #rect
Se0 f54 @|AlternativeIcon #fIcon
Se0 f56 inParamDecl '<> param;' #txt
Se0 f56 outParamDecl '<java.util.List<ch.ivy.addon.portalkit.bo.ServerApplication> serverApplications,java.util.List<ch.ivy.ws.addon.WsException> errors,List<ch.ivy.addon.portalkit.bo.RemoteAbsence> remoteAbsences> result;
' #txt
Se0 f56 outParamTable 'result.serverApplications=in.absenceApplications;
result.errors=in.errors;
result.remoteAbsences=in.remoteAbsences;
' #txt
Se0 f56 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f56 callSignature getAbsencesOfAllUsers() #txt
Se0 f56 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f56 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>getAbsencesOfAllUsers()</name>
    </language>
</elementInfo>
' #txt
Se0 f56 315 35 26 26 14 0 #rect
Se0 f56 @|StartSubIcon #fIcon
Se0 f57 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f57 processCall ServiceIntegrators/UserServiceIntegrator:getAbsencesOfAllUsers(String,List<String>,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Se0 f57 doCall true #txt
Se0 f57 requestActionDecl '<java.lang.String endpoint,List<java.lang.String> applicationNames,ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Se0 f57 requestMappingAction 'param.endpoint=in.endpoint;
param.applicationNames=in.apps;
param.server=in.server;
' #txt
Se0 f57 responseActionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f57 responseMappingAction 'out=in;
out.absencesGroupedByUserNames=result.absences;
out.tempErrors=result.errors;
' #txt
Se0 f57 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>getAbsencesOfAllUsers
(String,List&lt;String&gt;,Server)</name>
        <nameStyle>50,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f57 310 460 36 24 20 -2 #rect
Se0 f57 @|CallSubIcon #fIcon
Se0 f58 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f58 actionTable 'out=in;
' #txt
Se0 f58 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

in.apps.clear();


UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.username,in.server.id);
in.apps = AbsenceAndSubstituteUtils.getAbsencesSettingSupportedApps(apps, in.server.getApplications());

if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.ABSENCE.toString();
' #txt
Se0 f58 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f58 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Allive Apps
ws endpoint</name>
        <nameStyle>27,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f58 310 340 36 24 21 -18 #rect
Se0 f58 @|StepIcon #fIcon
Se0 f59 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f59 actionTable 'out=in;
' #txt
Se0 f59 actionCode 'import ch.ivy.addon.portalkit.mapper.ServerApplicationMapper;
import ch.ivy.addon.portalkit.mapper.RemoteAbsenceMapper;
import ch.ivy.addon.portalkit.bo.RemoteAbsence;
import ch.ivy.addon.portalkit.bo.ServerApplication;

if (!in.absencesGroupedByUserNames.isEmpty()) {
	List<RemoteAbsence> remoteAbsences = new RemoteAbsenceMapper().convert(in.absencesGroupedByUserNames);
	in.remoteAbsences.addAll(remoteAbsences);
	List<ServerApplication> tempAppList = ServerApplicationMapper.mapToServerApplications(in.apps,in.server.id);
	in.absenceApplications.addAll(tempAppList);
}

' #txt
Se0 f59 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f59 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add absences</name>
        <nameStyle>12,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f59 310 524 36 24 -10 19 #rect
Se0 f59 @|StepIcon #fIcon
Se0 f60 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f60 actionTable 'out=in;
' #txt
Se0 f60 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

in.apps.clear();
' #txt
Se0 f60 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f60 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Se0 f60 446 181 36 23 19 14 #rect
Se0 f60 @|StepIcon #fIcon
Se0 f63 expr out #txt
Se0 f63 346 536 464 203 #arcP
Se0 f63 1 464 536 #addKink
Se0 f63 1 0.4321413036724042 0 0 #arcLabel
Se0 f64 expr in #txt
Se0 f64 342 416 464 203 #arcP
Se0 f64 1 464 416 #addKink
Se0 f64 1 0.5115178601655154 0 0 #arcLabel
Se0 f65 expr out #txt
Se0 f65 464 180 342 160 #arcP
Se0 f65 1 464 160 #addKink
Se0 f65 1 0.31135433052386374 0 0 #arcLabel
Se0 f68 expr out #txt
Se0 f68 328 364 328 402 #arcP
Se0 f71 expr in #txt
Se0 f71 outCond in.apps.size()>0 #txt
Se0 f71 328 430 328 460 #arcP
Se0 f73 expr out #txt
Se0 f73 328 484 328 524 #arcP
Se0 f74 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f74 actionTable 'out=in;
' #txt
Se0 f74 actionCode 'import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
in.listIterator = serverService.findActiveServers().listIterator();' #txt
Se0 f74 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f74 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get all servers</name>
        <nameStyle>15,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f74 46 92 36 24 20 -2 #rect
Se0 f74 @|StepIcon #fIcon
Se0 f75 expr out #txt
Se0 f75 64 61 64 92 #arcP
Se0 f51 expr out #txt
Se0 f51 64 116 64 146 #arcP
Se0 f2 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f2 actionTable 'out=in;
' #txt
Se0 f2 actionCode 'import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
in.listIterator = serverService.findActiveServers().listIterator();' #txt
Se0 f2 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f2 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get all servers</name>
        <nameStyle>15,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f2 310 92 36 24 20 -2 #rect
Se0 f2 @|StepIcon #fIcon
Se0 f50 expr out #txt
Se0 f50 328 61 328 92 #arcP
Se0 f66 expr out #txt
Se0 f66 328 116 328 146 #arcP
Se0 f30 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f30 actionTable 'out=in;
' #txt
Se0 f30 actionCode 'import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
in.listIterator = serverService.findActiveServers().listIterator();' #txt
Se0 f30 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f30 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get all servers</name>
        <nameStyle>15,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f30 566 100 36 24 20 -2 #rect
Se0 f30 @|StepIcon #fIcon
Se0 f67 expr out #txt
Se0 f67 584 61 584 100 #arcP
Se0 f52 expr out #txt
Se0 f52 584 124 584 146 #arcP
Se0 f33 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f33 actionTable 'out=in;
' #txt
Se0 f33 actionCode 'import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
in.listIterator = serverService.findActiveServers().listIterator();' #txt
Se0 f33 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f33 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get all servers</name>
        <nameStyle>15,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f33 846 92 36 24 20 -2 #rect
Se0 f33 @|StepIcon #fIcon
Se0 f53 expr out #txt
Se0 f53 864 61 864 92 #arcP
Se0 f76 expr out #txt
Se0 f76 864 116 864 146 #arcP
Se0 f77 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f77 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Se0 f77 doCall true #txt
Se0 f77 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Se0 f77 requestMappingAction 'param.server=in.server;
' #txt
Se0 f77 responseActionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f77 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Se0 f77 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>ApplicationService</name>
        <nameStyle>18,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f77 46 276 36 24 20 -2 #rect
Se0 f77 @|CallSubIcon #fIcon
Se0 f18 expr out #txt
Se0 f18 64 300 64 340 #arcP
Se0 f9 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f9 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Se0 f9 doCall true #txt
Se0 f9 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Se0 f9 requestMappingAction 'param.server=in.server;
' #txt
Se0 f9 responseActionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f9 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Se0 f9 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>ApplicationService</name>
    </language>
</elementInfo>
' #txt
Se0 f9 310 276 36 24 20 -2 #rect
Se0 f9 @|CallSubIcon #fIcon
Se0 f15 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f15 actionTable 'out=in;
' #txt
Se0 f15 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;


in.server = in.listIterator.next() as Server;' #txt
Se0 f15 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f15 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f15 310 212 36 24 20 -2 #rect
Se0 f15 @|StepIcon #fIcon
Se0 f34 expr out #txt
Se0 f34 328 236 328 276 #arcP
Se0 f45 expr in #txt
Se0 f45 outCond in.listIterator.hasNext() #txt
Se0 f45 328 174 328 212 #arcP
Se0 f62 expr out #txt
Se0 f62 328 300 328 340 #arcP
Se0 f3 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f3 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Se0 f3 doCall true #txt
Se0 f3 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Se0 f3 requestMappingAction 'param.server=in.server;
' #txt
Se0 f3 responseActionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f3 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Se0 f3 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>ApplicationService</name>
    </language>
</elementInfo>
' #txt
Se0 f3 846 276 36 24 20 -2 #rect
Se0 f3 @|CallSubIcon #fIcon
Se0 f6 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f6 actionTable 'out=in;
' #txt
Se0 f6 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;


in.server = in.listIterator.next() as Server;' #txt
Se0 f6 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f6 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f6 846 212 36 24 20 -2 #rect
Se0 f6 @|StepIcon #fIcon
Se0 f28 expr out #txt
Se0 f28 864 236 864 276 #arcP
Se0 f38 expr in #txt
Se0 f38 outCond in.listIterator.hasNext() #txt
Se0 f38 864 174 864 212 #arcP
Se0 f80 expr out #txt
Se0 f80 864 300 864 340 #arcP
Se0 f70 expr in #txt
Se0 f70 outCond in.listIterator.hasNext() #txt
Se0 f70 584 174 584 212 #arcP
Se0 f55 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f55 actionTable 'out=in;
' #txt
Se0 f55 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;


in.server = in.listIterator.next() as Server;' #txt
Se0 f55 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f55 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f55 566 212 36 24 20 -2 #rect
Se0 f55 @|StepIcon #fIcon
Se0 f148 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f148 386 618 28 28 14 0 #rect
Se0 f148 @|AlternativeIcon #fIcon
Se0 f42 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f42 387 715 26 26 14 0 #rect
Se0 f42 @|EndSubIcon #fIcon
Se0 f144 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f144 processCall 'Functional Processes/ErrorHandler:handle(List<ch.ivy.ws.addon.WsException>)' #txt
Se0 f144 doCall true #txt
Se0 f144 requestActionDecl '<java.util.List<ch.ivy.ws.addon.WsException> exceptions> param;
' #txt
Se0 f144 requestMappingAction 'param.exceptions=in.errors;
' #txt
Se0 f144 responseActionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f144 responseMappingAction 'out=in;
' #txt
Se0 f144 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>handle errors if any</name>
        <nameStyle>20,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f144 382 660 36 24 20 -2 #rect
Se0 f144 @|CallSubIcon #fIcon
Se0 f78 expr out #txt
Se0 f78 400 684 400 715 #arcP
Se0 f107 expr in #txt
Se0 f107 400 646 400 660 #arcP
Se0 f79 expr in #txt
Se0 f79 50 160 386 632 #arcP
Se0 f79 1 22 160 #addKink
Se0 f79 2 22 632 #addKink
Se0 f79 1 0.4697017091790999 0 0 #arcLabel
Se0 f16 expr in #txt
Se0 f16 314 160 388 630 #arcP
Se0 f16 1 280 160 #addKink
Se0 f16 2 280 608 #addKink
Se0 f16 1 0.4874073146919169 0 0 #arcLabel
Se0 f61 expr in #txt
Se0 f61 570 160 412 630 #arcP
Se0 f61 1 544 160 #addKink
Se0 f61 2 544 608 #addKink
Se0 f61 1 0.42732834113028234 0 0 #arcLabel
Se0 f40 expr in #txt
Se0 f40 850 160 414 632 #arcP
Se0 f40 1 824 160 #addKink
Se0 f40 2 824 632 #addKink
Se0 f40 1 0.4352348872079136 0 0 #arcLabel
Se0 f1 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f1 actionTable 'out=in;
' #txt
Se0 f1 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Se0 f1 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f1 46 212 36 24 20 -2 #rect
Se0 f1 @|StepIcon #fIcon
Se0 f31 expr in #txt
Se0 f31 outCond in.listIterator.hasNext() #txt
Se0 f31 64 174 64 212 #arcP
Se0 f47 expr out #txt
Se0 f47 64 236 64 276 #arcP
Se0 f69 expr out #txt
Se0 f69 584 236 584 276 #arcP
Se0 f41 expr out #txt
Se0 f41 584 300 584 340 #arcP
Se0 f26 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f26 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Se0 f26 doCall true #txt
Se0 f26 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Se0 f26 requestMappingAction 'param.server=in.server;
' #txt
Se0 f26 responseActionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f26 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Se0 f26 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>ApplicationService</name>
    </language>
</elementInfo>
' #txt
Se0 f26 566 276 36 24 20 -2 #rect
Se0 f26 @|CallSubIcon #fIcon
Se0 f32 actionDecl 'ch.ivyteam.wf.processes.AbsenceServiceData out;
' #txt
Se0 f32 actionTable 'out=in;
' #txt
Se0 f32 actionCode 'import ch.ivy.addon.portalkit.mapper.RemoteAbsenceMapper;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;


PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.ABSENCE.toString();

if(in.remoteAbsences.size() > 0){
	in.remoteAbsencesInput = RemoteAbsenceMapper.setAbsencesToAllApplication(in.apps,in.remoteAbsences);
	in.absences = RemoteAbsenceMapper.mapToIvyAbsences(in.remoteAbsencesInput);
}
' #txt
Se0 f32 type ch.ivyteam.wf.processes.AbsenceServiceData #txt
Se0 f32 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Absences need to set
and endpoint</name>
        <nameStyle>37
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f32 566 468 36 24 20 -2 #rect
Se0 f32 @|StepIcon #fIcon
Se0 f37 expr in #txt
Se0 f37 outCond in.apps.size()>0 #txt
Se0 f37 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Se0 f37 584 430 584 468 #arcP
Se0 f37 0 0.43333333333333335 15 0 #arcLabel
Se0 f20 expr out #txt
Se0 f20 584 492 584 532 #arcP
Se0 f20 0 0.43333333333333335 15 0 #arcLabel
>Proto Se0 .type ch.ivyteam.wf.processes.AbsenceServiceData #txt
>Proto Se0 .processKind CALLABLE_SUB #txt
>Proto Se0 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <swimlaneLabel>Absence</swimlaneLabel>
        <swimlaneLabel></swimlaneLabel>
    </language>
    <swimlaneSize>1720</swimlaneSize>
    <swimlaneColor>-6684775</swimlaneColor>
</elementInfo>
' #txt
>Proto Se0 0 0 32 24 18 0 #rect
>Proto Se0 @|BIcon #fIcon
Se0 f14 mainOut f22 tail #connect
Se0 f22 head f21 mainIn #connect
Se0 f12 head f21 mainIn #connect
Se0 f21 mainOut f17 tail #connect
Se0 f17 head f4 in #connect
Se0 f48 head f29 mainIn #connect
Se0 f29 mainOut f49 tail #connect
Se0 f49 head f39 in #connect
Se0 f13 mainOut f8 tail #connect
Se0 f8 head f7 in #connect
Se0 f36 mainOut f43 tail #connect
Se0 f43 head f25 in #connect
Se0 f123 head f72 mainIn #connect
Se0 f72 mainOut f124 tail #connect
Se0 f124 head f109 in #connect
Se0 f113 mainOut f130 tail #connect
Se0 f130 head f114 in #connect
Se0 f7 out f46 tail #connect
Se0 f46 head f44 mainIn #connect
Se0 f7 out f12 tail #connect
Se0 f44 mainOut f10 tail #connect
Se0 f10 head f14 mainIn #connect
Se0 f19 mainOut f5 tail #connect
Se0 f5 head f29 mainIn #connect
Se0 f114 out f23 tail #connect
Se0 f23 head f11 mainIn #connect
Se0 f114 out f123 tail #connect
Se0 f11 mainOut f24 tail #connect
Se0 f24 head f72 mainIn #connect
Se0 f59 mainOut f63 tail #connect
Se0 f63 head f60 mainIn #connect
Se0 f64 head f60 mainIn #connect
Se0 f60 mainOut f65 tail #connect
Se0 f65 head f54 in #connect
Se0 f58 mainOut f68 tail #connect
Se0 f68 head f27 in #connect
Se0 f27 out f71 tail #connect
Se0 f71 head f57 mainIn #connect
Se0 f27 out f64 tail #connect
Se0 f57 mainOut f73 tail #connect
Se0 f73 head f59 mainIn #connect
Se0 f0 mainOut f75 tail #connect
Se0 f75 head f74 mainIn #connect
Se0 f74 mainOut f51 tail #connect
Se0 f51 head f4 in #connect
Se0 f56 mainOut f50 tail #connect
Se0 f50 head f2 mainIn #connect
Se0 f2 mainOut f66 tail #connect
Se0 f66 head f54 in #connect
Se0 f35 mainOut f67 tail #connect
Se0 f67 head f30 mainIn #connect
Se0 f30 mainOut f52 tail #connect
Se0 f52 head f39 in #connect
Se0 f117 mainOut f53 tail #connect
Se0 f53 head f33 mainIn #connect
Se0 f33 mainOut f76 tail #connect
Se0 f76 head f109 in #connect
Se0 f77 mainOut f18 tail #connect
Se0 f18 head f13 mainIn #connect
Se0 f15 mainOut f34 tail #connect
Se0 f34 head f9 mainIn #connect
Se0 f54 out f45 tail #connect
Se0 f45 head f15 mainIn #connect
Se0 f9 mainOut f62 tail #connect
Se0 f62 head f58 mainIn #connect
Se0 f55 mainOut f69 tail #connect
Se0 f69 head f26 mainIn #connect
Se0 f39 out f70 tail #connect
Se0 f70 head f55 mainIn #connect
Se0 f26 mainOut f41 tail #connect
Se0 f41 head f36 mainIn #connect
Se0 f6 mainOut f28 tail #connect
Se0 f28 head f3 mainIn #connect
Se0 f109 out f38 tail #connect
Se0 f38 head f6 mainIn #connect
Se0 f3 mainOut f80 tail #connect
Se0 f80 head f113 mainIn #connect
Se0 f144 mainOut f78 tail #connect
Se0 f78 head f42 mainIn #connect
Se0 f148 out f107 tail #connect
Se0 f107 head f144 mainIn #connect
Se0 f79 head f148 in #connect
Se0 f54 out f16 tail #connect
Se0 f16 head f148 in #connect
Se0 f39 out f61 tail #connect
Se0 f61 head f148 in #connect
Se0 f109 out f40 tail #connect
Se0 f40 head f148 in #connect
Se0 f31 head f1 mainIn #connect
Se0 f47 head f77 mainIn #connect
Se0 f4 out f31 tail #connect
Se0 f4 out f79 tail #connect
Se0 f1 mainOut f47 tail #connect
Se0 f25 out f37 tail #connect
Se0 f37 head f32 mainIn #connect
Se0 f25 out f48 tail #connect
Se0 f32 mainOut f20 tail #connect
Se0 f20 head f19 mainIn #connect
