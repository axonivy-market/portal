[Ivy]
14715F955CC5A35F 3.23 #module
>Proto >Proto Collection #zClass
Ce0 CaseService Big #zClass
Ce0 B #cInfo
Ce0 #process
Ce0 @TextInP .resExport .resExport #zField
Ce0 @TextInP .type .type #zField
Ce0 @TextInP .processKind .processKind #zField
Ce0 @AnnotationInP-0n ai ai #zField
Ce0 @TextInP .xml .xml #zField
Ce0 @TextInP .responsibility .responsibility #zField
Ce0 @StartSub f24 '' #zField
Ce0 @StartSub f33 '' #zField
Ce0 @GridStep f35 '' #zField
Ce0 @PushWFArc f36 '' #zField
Ce0 @GridStep f40 '' #zField
Ce0 @PushWFArc f41 '' #zField
Ce0 @GridStep f44 '' #zField
Ce0 @CallSub f10 '' #zField
Ce0 @PushWFArc f20 '' #zField
Ce0 @PushWFArc f28 '' #zField
Ce0 @CallSub f25 '' #zField
Ce0 @PushWFArc f26 '' #zField
Ce0 @StartSub f3 '' #zField
Ce0 @CallSub f37 '' #zField
Ce0 @GridStep f15 '' #zField
Ce0 @GridStep f38 '' #zField
Ce0 @PushWFArc f46 '' #zField
Ce0 @PushWFArc f47 '' #zField
Ce0 @StartSub f48 '' #zField
Ce0 @CallSub f50 '' #zField
Ce0 @GridStep f53 '' #zField
Ce0 @GridStep f54 '' #zField
Ce0 @PushWFArc f59 '' #zField
Ce0 @PushWFArc f61 '' #zField
Ce0 @StartSub f63 '' #zField
Ce0 @GridStep f64 '' #zField
Ce0 @GridStep f67 '' #zField
Ce0 @CallSub f68 '' #zField
Ce0 @PushWFArc f73 '' #zField
Ce0 @PushWFArc f76 '' #zField
Ce0 @Alternative f148 '' #zField
Ce0 @EndSub f80 '' #zField
Ce0 @CallSub f144 '' #zField
Ce0 @PushWFArc f81 '' #zField
Ce0 @PushWFArc f107 '' #zField
Ce0 @PushWFArc f16 '' #zField
Ce0 @PushWFArc f31 '' #zField
Ce0 @PushWFArc f27 '' #zField
Ce0 @PushWFArc f1 '' #zField
Ce0 @StartSub f5 '' #zField
Ce0 @CallSub f52 '' #zField
Ce0 @GridStep f34 '' #zField
Ce0 @GridStep f88 '' #zField
Ce0 @PushWFArc f87 '' #zField
Ce0 @PushWFArc f30 '' #zField
Ce0 @PushWFArc f60 '' #zField
Ce0 @PushWFArc f65 '' #zField
Ce0 @StartSub f75 '' #zField
Ce0 @CallSub f84 '' #zField
Ce0 @Alternative f85 '' #zField
Ce0 @GridStep f86 '' #zField
Ce0 @GridStep f89 '' #zField
Ce0 @GridStep f90 '' #zField
Ce0 @GridStep f91 '' #zField
Ce0 @GridStep f92 '' #zField
Ce0 @PushWFArc f96 '' #zField
Ce0 @PushWFArc f98 '' #zField
Ce0 @PushWFArc f101 '' #zField
Ce0 @PushWFArc f103 '' #zField
Ce0 @PushWFArc f105 '' #zField
Ce0 @PushWFArc f106 '' #zField
Ce0 @CallSub f93 '' #zField
Ce0 @PushWFArc f109 '' #zField
Ce0 @CallSub f99 '' #zField
Ce0 @StartSub f108 '' #zField
Ce0 @GridStep f110 '' #zField
Ce0 @GridStep f112 '' #zField
Ce0 @PushWFArc f117 '' #zField
Ce0 @PushWFArc f118 '' #zField
Ce0 @PushWFArc f32 '' #zField
Ce0 @PushWFArc f120 '' #zField
Ce0 @CallSub f169 '' #zField
Ce0 @GridStep f170 '' #zField
Ce0 @GridStep f173 '' #zField
Ce0 @StartSub f174 '' #zField
Ce0 @PushWFArc f178 '' #zField
Ce0 @PushWFArc f179 '' #zField
Ce0 @PushWFArc f181 '' #zField
Ce0 @CallSub f123 '' #zField
Ce0 @GridStep f124 '' #zField
Ce0 @GridStep f125 '' #zField
Ce0 @StartSub f126 '' #zField
Ce0 @PushWFArc f132 '' #zField
Ce0 @PushWFArc f133 '' #zField
Ce0 @PushWFArc f135 '' #zField
Ce0 @GridStep f138 '' #zField
Ce0 @StartSub f139 '' #zField
Ce0 @CallSub f140 '' #zField
Ce0 @GridStep f141 '' #zField
Ce0 @PushWFArc f167 '' #zField
Ce0 @PushWFArc f168 '' #zField
Ce0 @PushWFArc f183 '' #zField
Ce0 @StartSub f0 '' #zField
Ce0 @GridStep f2 '' #zField
Ce0 @GridStep f4 '' #zField
Ce0 @CallSub f8 '' #zField
Ce0 @GridStep f9 '' #zField
Ce0 @GridStep f11 '' #zField
Ce0 @Alternative f12 '' #zField
Ce0 @CallSub f13 '' #zField
Ce0 @GridStep f14 '' #zField
Ce0 @PushWFArc f18 '' #zField
Ce0 @PushWFArc f21 '' #zField
Ce0 @PushWFArc f22 '' #zField
Ce0 @PushWFArc f29 '' #zField
Ce0 @PushWFArc f77 '' #zField
Ce0 @PushWFArc f82 '' #zField
Ce0 @PushWFArc f83 '' #zField
Ce0 @PushWFArc f121 '' #zField
Ce0 @PushWFArc f122 '' #zField
Ce0 @PushWFArc f6 '' #zField
Ce0 @PushWFArc f39 '' #zField
Ce0 @PushWFArc f42 '' #zField
Ce0 @PushWFArc f43 '' #zField
Ce0 @PushWFArc f45 '' #zField
Ce0 @PushWFArc f49 '' #zField
Ce0 @Alternative f7 '' #zField
Ce0 @PushWFArc f17 '' #zField
Ce0 @PushWFArc f19 '' #zField
Ce0 @GridStep f55 '' #zField
Ce0 @PushWFArc f56 '' #zField
Ce0 @PushWFArc f57 '' #zField
Ce0 @PushWFArc f58 '' #zField
Ce0 @Alternative f62 '' #zField
Ce0 @PushWFArc f66 '' #zField
Ce0 @PushWFArc f23 '' #zField
Ce0 @GridStep f69 '' #zField
Ce0 @PushWFArc f71 '' #zField
Ce0 @PushWFArc f70 '' #zField
Ce0 @PushWFArc f51 '' #zField
Ce0 @PushWFArc f72 '' #zField
Ce0 @GridStep f74 '' #zField
Ce0 @CallSub f78 '' #zField
Ce0 @GridStep f79 '' #zField
Ce0 @StartSub f94 '' #zField
Ce0 @PushWFArc f95 '' #zField
Ce0 @PushWFArc f97 '' #zField
Ce0 @PushWFArc f100 '' #zField
Ce0 @PushWFArc f102 '' #zField
Ce0 @Alternative f104 '' #zField
Ce0 @GridStep f111 '' #zField
Ce0 @GridStep f113 '' #zField
Ce0 @StartSub f114 '' #zField
Ce0 @CallSub f115 '' #zField
Ce0 @Alternative f116 '' #zField
Ce0 @GridStep f119 '' #zField
Ce0 @CallSub f127 '' #zField
Ce0 @GridStep f128 '' #zField
Ce0 @GridStep f129 '' #zField
Ce0 @GridStep f130 '' #zField
Ce0 @PushWFArc f131 '' #zField
Ce0 @PushWFArc f134 '' #zField
Ce0 @PushWFArc f136 '' #zField
Ce0 @PushWFArc f142 '' #zField
Ce0 @PushWFArc f143 '' #zField
Ce0 @PushWFArc f145 '' #zField
Ce0 @PushWFArc f146 '' #zField
Ce0 @PushWFArc f147 '' #zField
Ce0 @PushWFArc f149 '' #zField
Ce0 @PushWFArc f150 '' #zField
Ce0 @PushWFArc f151 '' #zField
Ce0 @PushWFArc f152 '' #zField
Ce0 @GridStep f153 '' #zField
Ce0 @StartSub f154 '' #zField
Ce0 @GridStep f155 '' #zField
Ce0 @GridStep f156 '' #zField
Ce0 @Alternative f157 '' #zField
Ce0 @CallSub f158 '' #zField
Ce0 @Alternative f159 '' #zField
Ce0 @CallSub f160 '' #zField
Ce0 @GridStep f161 '' #zField
Ce0 @GridStep f162 '' #zField
Ce0 @GridStep f163 '' #zField
Ce0 @PushWFArc f164 '' #zField
Ce0 @PushWFArc f165 '' #zField
Ce0 @PushWFArc f166 '' #zField
Ce0 @PushWFArc f171 '' #zField
Ce0 @PushWFArc f172 '' #zField
Ce0 @PushWFArc f175 '' #zField
Ce0 @PushWFArc f176 '' #zField
Ce0 @PushWFArc f177 '' #zField
Ce0 @PushWFArc f180 '' #zField
Ce0 @PushWFArc f184 '' #zField
Ce0 @PushWFArc f185 '' #zField
Ce0 @PushWFArc f186 '' #zField
Ce0 @StartSub f187 '' #zField
Ce0 @CallSub f188 '' #zField
Ce0 @CallSub f189 '' #zField
Ce0 @Alternative f190 '' #zField
Ce0 @GridStep f191 '' #zField
Ce0 @GridStep f192 '' #zField
Ce0 @GridStep f193 '' #zField
Ce0 @GridStep f194 '' #zField
Ce0 @GridStep f195 '' #zField
Ce0 @GridStep f196 '' #zField
Ce0 @Alternative f197 '' #zField
Ce0 @PushWFArc f198 '' #zField
Ce0 @PushWFArc f199 '' #zField
Ce0 @PushWFArc f200 '' #zField
Ce0 @PushWFArc f201 '' #zField
Ce0 @PushWFArc f203 '' #zField
Ce0 @PushWFArc f204 '' #zField
Ce0 @PushWFArc f205 '' #zField
Ce0 @PushWFArc f206 '' #zField
Ce0 @PushWFArc f207 '' #zField
Ce0 @PushWFArc f208 '' #zField
Ce0 @PushWFArc f209 '' #zField
Ce0 @PushWFArc f210 '' #zField
Ce0 @GridStep f211 '' #zField
Ce0 @PushWFArc f212 '' #zField
Ce0 @PushWFArc f137 '' #zField
Ce0 @PushWFArc f202 '' #zField
Ce0 @GridStep f213 '' #zField
Ce0 @PushWFArc f214 '' #zField
Ce0 @PushWFArc f182 '' #zField
>Proto Ce0 Ce0 CaseService #zField
Ce0 f24 inParamDecl '<ch.ivy.addon.portalkit.bo.RemoteCase remoteCase> param;' #txt
Ce0 f24 inParamTable 'out.remoteCase=param.remoteCase;
' #txt
Ce0 f24 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,ch.ivy.addon.portalkit.bo.RemoteCase remoteCase> result;
' #txt
Ce0 f24 outParamTable 'result.errors=in.errors;
result.remoteCase=in.remoteCase;
' #txt
Ce0 f24 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f24 callSignature loadCaseAdditionalProperties(ch.ivy.addon.portalkit.bo.RemoteCase) #txt
Ce0 f24 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f24 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>loadCaseAdditionalProperties(RemoteCase)</name>
        <nameStyle>40,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f24 795 35 26 26 -84 20 #rect
Ce0 f24 @|StartSubIcon #fIcon
Ce0 f33 inParamDecl '<ch.ivy.addon.portalkit.bo.RemoteCase remoteCases> param;' #txt
Ce0 f33 inParamTable 'out.remoteCase=param.remoteCases;
' #txt
Ce0 f33 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Ce0 f33 outParamTable 'result.errors=in.errors;
' #txt
Ce0 f33 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f33 callSignature saveCaseAdditionalProperties(ch.ivy.addon.portalkit.bo.RemoteCase) #txt
Ce0 f33 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f33 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>saveCaseAdditionalProperties
(RemoteCase)</name>
        <nameStyle>41,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f33 1003 35 26 26 14 0 #rect
Ce0 f33 @|StartSubIcon #fIcon
Ce0 f35 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f35 actionTable 'out=in;
' #txt
Ce0 f35 actionCode 'import ch.ivy.ws.addon.IvyAdditionalProperty;

in.additionalProperties.clear();

for (String pName : in.remoteCase.getAdditionalPropertyNames()) {
	if (!pName.equals(ivy.cms.co("/ch.ivy.addon.portalkit/variables/portalkit_serveradress"))) {
     IvyAdditionalProperty p = new IvyAdditionalProperty();
     p.setKey(pName);  p.setValue(in.remoteCase.getAdditionalProperty(pName));
     in.additionalProperties.add(p);
  }
  else {
	   in.endpoint = in.remoteCase.getAdditionalProperty(pName);
	}
}' #txt
Ce0 f35 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f35 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>prepare properties</name>
        <nameStyle>18,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f35 998 108 36 24 20 -2 #rect
Ce0 f35 @|StepIcon #fIcon
Ce0 f36 expr out #txt
Ce0 f36 1016 61 1016 108 #arcP
Ce0 f40 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f40 actionTable 'out=in;
' #txt
Ce0 f40 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.remoteCase.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f40 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f40 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f40 790 108 36 24 20 -2 #rect
Ce0 f40 @|StepIcon #fIcon
Ce0 f41 expr out #txt
Ce0 f41 808 61 808 108 #arcP
Ce0 f44 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f44 actionTable 'out=in;
' #txt
Ce0 f44 actionCode 'import ch.ivy.ws.addon.IvyAdditionalProperty;

if (in.errors.isEmpty()) {
  for (IvyAdditionalProperty property : in.additionalProperties) {
	  in.remoteCase.setAdditionalProperty(property.getKey(), property.getValue());	
	}
}' #txt
Ce0 f44 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f44 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>set addtional properties
 to case</name>
        <nameStyle>33,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f44 790 236 36 24 20 -2 #rect
Ce0 f44 @|StepIcon #fIcon
Ce0 f10 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f10 processCall ServiceIntegrators/CaseServiceIntegrator:getAdditionalProperties(String,Long,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f10 doCall true #txt
Ce0 f10 requestActionDecl '<java.lang.String endpoint,java.lang.Long caseId,ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f10 requestMappingAction 'param.endpoint=in.endpoint;
param.caseId=in.remoteCase.getId();
param.server=in.remoteCase.server;
' #txt
Ce0 f10 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f10 responseMappingAction 'out=in;
out.additionalProperties=result.additionalProperties;
out.errors=result.errors;
' #txt
Ce0 f10 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f10 790 172 36 24 20 -2 #rect
Ce0 f10 @|CallSubIcon #fIcon
Ce0 f20 expr out #txt
Ce0 f20 808 196 808 236 #arcP
Ce0 f28 expr out #txt
Ce0 f28 808 132 808 172 #arcP
Ce0 f25 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f25 processCall ServiceIntegrators/CaseServiceIntegrator:setAdditionalProperties(String,Long,ch.ivy.addon.portalkit.persistence.domain.Server,List<ch.ivy.ws.addon.IvyAdditionalProperty>) #txt
Ce0 f25 doCall true #txt
Ce0 f25 requestActionDecl '<java.lang.String endpoint,java.lang.Long caseId,ch.ivy.addon.portalkit.persistence.domain.Server server,List<ch.ivy.ws.addon.IvyAdditionalProperty> additionalProperties> param;
' #txt
Ce0 f25 requestMappingAction 'param.endpoint=in.endpoint;
param.caseId=in.remoteCase.getId();
param.server=in.server;
param.additionalProperties=in.additionalProperties;
' #txt
Ce0 f25 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f25 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
Ce0 f25 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f25 998 188 36 24 20 -2 #rect
Ce0 f25 @|CallSubIcon #fIcon
Ce0 f26 expr out #txt
Ce0 f26 1016 132 1016 188 #arcP
Ce0 f3 inParamDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long caseId> param;' #txt
Ce0 f3 inParamTable 'out.caseId=param.caseId;
out.server=param.server;
' #txt
Ce0 f3 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,List<ch.ivy.ws.addon.IvyDocument> documents> result;
' #txt
Ce0 f3 outParamTable 'result.errors=in.errors;
result.documents=in.documents;
' #txt
Ce0 f3 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f3 callSignature findDocuments(ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Ce0 f3 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f3 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findDocuments
(Server,Long)</name>
        <nameStyle>27,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f3 1235 43 26 26 14 0 #rect
Ce0 f3 @|StartSubIcon #fIcon
Ce0 f37 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f37 processCall ServiceIntegrators/CaseServiceIntegrator:findDocuments(String,Long,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f37 doCall true #txt
Ce0 f37 requestActionDecl '<java.lang.String endpoint,java.lang.Long caseId,ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f37 requestMappingAction 'param.endpoint=in.endpoint;
param.caseId=in.caseId;
param.server=in.server;
' #txt
Ce0 f37 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f37 responseMappingAction 'out=in;
out.documents=result.documents;
out.errors=result.errors;
' #txt
Ce0 f37 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f37 1230 196 36 24 20 -2 #rect
Ce0 f37 @|CallSubIcon #fIcon
Ce0 f15 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f15 actionTable 'out=in;
' #txt
Ce0 f15 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f15 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f15 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f15 1230 132 36 24 20 -2 #rect
Ce0 f15 @|StepIcon #fIcon
Ce0 f38 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f38 actionTable 'out=in;
' #txt
Ce0 f38 actionCode 'import ch.ivy.ws.addon.WsException;

for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Ce0 f38 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f38 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f38 1230 260 36 24 20 -2 #rect
Ce0 f38 @|StepIcon #fIcon
Ce0 f46 expr out #txt
Ce0 f46 1248 220 1248 260 #arcP
Ce0 f47 expr out #txt
Ce0 f47 1248 156 1248 196 #arcP
Ce0 f48 inParamDecl '<java.lang.String userName,java.lang.String documentName,javax.activation.DataHandler documentContent,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long caseId> param;' #txt
Ce0 f48 inParamTable 'out.caseId=param.caseId;
out.documentContent=param.documentContent;
out.documentName=param.documentName;
out.server=param.server;
out.username=param.userName;
' #txt
Ce0 f48 outParamDecl '<ch.ivy.ws.addon.IvyDocument document,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Ce0 f48 outParamTable 'result.document=in.document;
result.errors=in.errors;
' #txt
Ce0 f48 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f48 callSignature uploadDocument(String,String,javax.activation.DataHandler,ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Ce0 f48 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f48 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>uploadDocument
(String,DataHandler,Server,Long)</name>
        <nameStyle>47,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f48 1443 43 26 26 14 0 #rect
Ce0 f48 @|StartSubIcon #fIcon
Ce0 f50 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f50 processCall ServiceIntegrators/CaseServiceIntegrator:uploadDocument(String,String,javax.activation.DataHandler,String,Long,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f50 doCall true #txt
Ce0 f50 requestActionDecl '<java.lang.String userName,java.lang.String documentName,javax.activation.DataHandler documentContent,java.lang.String endpoint,java.lang.Long caseId,ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f50 requestMappingAction 'param.userName=in.username;
param.documentName=in.documentName;
param.documentContent=in.documentContent;
param.endpoint=in.endpoint;
param.caseId=in.caseId;
param.server=in.server;
' #txt
Ce0 f50 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f50 responseMappingAction 'out=in;
out.document=result.document;
out.errors=result.errors;
' #txt
Ce0 f50 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f50 1438 196 36 24 20 -2 #rect
Ce0 f50 @|CallSubIcon #fIcon
Ce0 f53 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f53 actionTable 'out=in;
' #txt
Ce0 f53 actionCode 'import ch.ivy.ws.addon.WsException;

for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Ce0 f53 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f53 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f53 1438 260 36 24 20 -2 #rect
Ce0 f53 @|StepIcon #fIcon
Ce0 f54 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f54 actionTable 'out=in;
' #txt
Ce0 f54 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f54 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f54 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f54 1438 132 36 24 20 -2 #rect
Ce0 f54 @|StepIcon #fIcon
Ce0 f59 expr out #txt
Ce0 f59 1456 220 1456 260 #arcP
Ce0 f61 expr out #txt
Ce0 f61 1456 156 1456 196 #arcP
Ce0 f63 inParamDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long documentId,java.lang.Long caseId> param;' #txt
Ce0 f63 inParamTable 'out.caseId=param.caseId;
out.documentId=param.documentId;
out.server=param.server;
' #txt
Ce0 f63 outParamDecl '<javax.activation.DataHandler documentContent,List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Ce0 f63 outParamTable 'result.documentContent=in.documentContent;
result.errors=in.errors;
' #txt
Ce0 f63 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f63 callSignature downloadDocument(ch.ivy.addon.portalkit.persistence.domain.Server,Long,Long) #txt
Ce0 f63 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f63 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>downloadDocument
(Server,Long,Long)</name>
        <nameStyle>35,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f63 1683 43 26 26 14 0 #rect
Ce0 f63 @|StartSubIcon #fIcon
Ce0 f64 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f64 actionTable 'out=in;
' #txt
Ce0 f64 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f64 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f64 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f64 1678 132 36 24 20 -2 #rect
Ce0 f64 @|StepIcon #fIcon
Ce0 f67 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f67 actionTable 'out=in;
' #txt
Ce0 f67 actionCode 'import ch.ivy.ws.addon.WsException;

for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Ce0 f67 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f67 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f67 1678 260 36 24 20 -2 #rect
Ce0 f67 @|StepIcon #fIcon
Ce0 f68 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f68 processCall ServiceIntegrators/CaseServiceIntegrator:downloadDocument(String,Long,Long,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f68 doCall true #txt
Ce0 f68 requestActionDecl '<java.lang.String endpoint,java.lang.Long documentId,java.lang.Long caseId,ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f68 requestMappingAction 'param.endpoint=in.endpoint;
param.documentId=in.documentId;
param.caseId=in.caseId;
param.server=in.server;
' #txt
Ce0 f68 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f68 responseMappingAction 'out=in;
out.documentContent=result.documentContent;
out.errors=result.errors;
' #txt
Ce0 f68 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f68 1678 196 36 24 20 -2 #rect
Ce0 f68 @|CallSubIcon #fIcon
Ce0 f73 expr out #txt
Ce0 f73 1696 220 1696 260 #arcP
Ce0 f76 expr out #txt
Ce0 f76 1696 156 1696 196 #arcP
Ce0 f148 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f148 1002 818 28 28 14 0 #rect
Ce0 f148 @|AlternativeIcon #fIcon
Ce0 f80 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f80 1003 907 26 26 14 0 #rect
Ce0 f80 @|EndSubIcon #fIcon
Ce0 f144 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f144 processCall 'Functional Processes/ErrorHandler:handle(List<ch.ivy.ws.addon.WsException>)' #txt
Ce0 f144 doCall true #txt
Ce0 f144 requestActionDecl '<java.util.List<ch.ivy.ws.addon.WsException> exceptions> param;
' #txt
Ce0 f144 requestMappingAction 'param.exceptions=in.errors;
' #txt
Ce0 f144 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f144 responseMappingAction 'out=in;
' #txt
Ce0 f144 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>handle errors if any</name>
        <nameStyle>20,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f144 998 860 36 24 20 -2 #rect
Ce0 f144 @|CallSubIcon #fIcon
Ce0 f81 expr out #txt
Ce0 f81 1016 884 1016 907 #arcP
Ce0 f107 expr in #txt
Ce0 f107 1016 846 1016 860 #arcP
Ce0 f16 expr out #txt
Ce0 f16 808 260 1002 832 #arcP
Ce0 f16 1 808 832 #addKink
Ce0 f16 1 0.5175178126055271 0 0 #arcLabel
Ce0 f31 expr out #txt
Ce0 f31 1016 212 1016 818 #arcP
Ce0 f31 0 0.788046227337837 0 0 #arcLabel
Ce0 f27 expr out #txt
Ce0 f27 1248 284 1030 832 #arcP
Ce0 f27 1 1248 832 #addKink
Ce0 f27 1 0.3899443733485098 0 0 #arcLabel
Ce0 f1 expr out #txt
Ce0 f1 1456 284 1030 832 #arcP
Ce0 f1 1 1456 832 #addKink
Ce0 f1 1 0.35114049847714135 0 0 #arcLabel
Ce0 f5 inParamDecl '<ch.ivy.addon.portalkit.bo.RemoteCase remoteCase> param;' #txt
Ce0 f5 inParamTable 'out.remoteCase=param.remoteCase;
' #txt
Ce0 f5 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Ce0 f5 outParamTable 'result.errors=in.errors;
' #txt
Ce0 f5 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f5 callSignature destroyCase(ch.ivy.addon.portalkit.bo.RemoteCase) #txt
Ce0 f5 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>destroyCase(RemoteCase)</name>
        <nameStyle>23,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f5 2283 43 26 26 14 0 #rect
Ce0 f5 @|StartSubIcon #fIcon
Ce0 f52 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f52 processCall ServiceIntegrators/CaseServiceIntegrator:destroyCase(ch.ivy.addon.portalkit.persistence.domain.Server,String,Long) #txt
Ce0 f52 doCall true #txt
Ce0 f52 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server sever,java.lang.String endpoint,java.lang.Long caseId> param;
' #txt
Ce0 f52 requestMappingAction 'param.sever=in.server;
param.endpoint=in.endpoint;
param.caseId=in.remoteCase.getId();
' #txt
Ce0 f52 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f52 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
Ce0 f52 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f52 2278 156 36 24 20 -2 #rect
Ce0 f52 @|CallSubIcon #fIcon
Ce0 f34 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f34 actionTable 'out=in;
' #txt
Ce0 f34 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.server = in.remoteCase.server;
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f34 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f34 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f34 2278 108 36 24 19 -2 #rect
Ce0 f34 @|StepIcon #fIcon
Ce0 f88 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f88 actionTable 'out=in;
' #txt
Ce0 f88 actionCode 'import ch.ivy.ws.addon.WsException;

for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Ce0 f88 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f88 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f88 2278 236 36 24 20 -2 #rect
Ce0 f88 @|StepIcon #fIcon
Ce0 f87 expr out #txt
Ce0 f87 2296 132 2296 156 #arcP
Ce0 f30 expr out #txt
Ce0 f30 2296 260 1030 832 #arcP
Ce0 f30 1 2296 832 #addKink
Ce0 f30 1 0.4305774399179245 0 0 #arcLabel
Ce0 f60 expr out #txt
Ce0 f60 2296 69 2296 108 #arcP
Ce0 f65 expr out #txt
Ce0 f65 2296 180 2296 236 #arcP
Ce0 f75 inParamDecl '<java.lang.Long serverId,java.lang.Integer startIndex,java.lang.Integer count,ch.ivy.ws.addon.CaseSearchCriteria caseSearchCriteria> param;' #txt
Ce0 f75 inParamTable 'out.caseSearchCriteria=param.caseSearchCriteria;
out.count=param.count;
out.serverId=param.#serverId;
out.startIndex=param.startIndex;
' #txt
Ce0 f75 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,List<ch.ivy.addon.portalkit.bo.RemoteCase> cases> result;
' #txt
Ce0 f75 outParamTable 'result.errors=in.errors;
result.cases=in.cases;
' #txt
Ce0 f75 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f75 callSignature findCasesByCriteria(Long,Integer,Integer,ch.ivy.ws.addon.CaseSearchCriteria) #txt
Ce0 f75 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f75 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findCasesByCriteria
(Long,Long,CaseSearchCriteria)</name>
        <nameStyle>50,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f75 307 51 26 26 14 0 #rect
Ce0 f75 @|StartSubIcon #fIcon
Ce0 f84 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f84 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f84 doCall true #txt
Ce0 f84 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f84 requestMappingAction 'param.server=in.server;
' #txt
Ce0 f84 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f84 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Ce0 f84 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>ApplicationService</name>
    </language>
</elementInfo>
' #txt
Ce0 f84 302 340 36 24 20 -2 #rect
Ce0 f84 @|CallSubIcon #fIcon
Ce0 f85 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f85 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f85 306 154 28 28 22 -21 #rect
Ce0 f85 @|AlternativeIcon #fIcon
Ce0 f86 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f86 actionTable 'out=in;
' #txt
Ce0 f86 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (!in.apps.isEmpty()) {
	in.caseSearchCriteria.involvedApplications = in.apps.clear();
}' #txt
Ce0 f86 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f86 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Ce0 f86 422 220 36 24 20 -2 #rect
Ce0 f86 @|StepIcon #fIcon
Ce0 f89 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f89 actionTable 'out=in;
' #txt
Ce0 f89 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Ce0 f89 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f89 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f89 302 220 36 24 20 -2 #rect
Ce0 f89 @|StepIcon #fIcon
Ce0 f90 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f90 actionTable 'out=in;
' #txt
Ce0 f90 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;
import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
List<Server> servers;
Long serverId = in.#serverId;
if (#serverId is initialized && serverId != 0) {
	servers = Arrays.asList(serverService.findById(serverId));
} else {
	servers = serverService.findActiveServers();
}

in.listIterator = servers.listIterator();' #txt
Ce0 f90 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f90 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f90 302 100 36 24 20 -2 #rect
Ce0 f90 @|StepIcon #fIcon
Ce0 f91 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f91 actionTable 'out=in;
' #txt
Ce0 f91 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.caseSearchCriteria.involvedUsername, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

in.caseSearchCriteria.involvedApplications = in.apps;' #txt
Ce0 f91 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f91 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f91 302 420 36 24 21 -18 #rect
Ce0 f91 @|StepIcon #fIcon
Ce0 f92 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f92 actionTable 'out=in;
' #txt
Ce0 f92 actionCode 'import ch.ivy.addon.portalkit.mapper.RemoteCaseMapper;

in.cases.clear();
if (in.tempErrors.isEmpty()) {
	in.cases = RemoteCaseMapper.mapCases(in.ivyCases, in.server);
}

' #txt
Ce0 f92 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f92 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add cases</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f92 302 604 36 24 20 -2 #rect
Ce0 f92 @|StepIcon #fIcon
Ce0 f96 expr out #txt
Ce0 f96 338 616 440 244 #arcP
Ce0 f96 1 440 616 #addKink
Ce0 f96 1 0.2616721854748305 0 0 #arcLabel
Ce0 f98 expr out #txt
Ce0 f98 440 220 334 168 #arcP
Ce0 f98 1 440 168 #addKink
Ce0 f98 1 0.31135433052386374 0 0 #arcLabel
Ce0 f101 expr out #txt
Ce0 f101 320 124 320 154 #arcP
Ce0 f103 expr in #txt
Ce0 f103 outCond in.listIterator.hasNext() #txt
Ce0 f103 320 182 320 220 #arcP
Ce0 f105 expr out #txt
Ce0 f105 320 77 320 100 #arcP
Ce0 f106 expr in #txt
Ce0 f106 306 168 1002 832 #arcP
Ce0 f106 1 240 168 #addKink
Ce0 f106 2 240 832 #addKink
Ce0 f106 2 0.4840228013644575 0 0 #arcLabel
Ce0 f93 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f93 processCall ServiceIntegrators/CaseServiceIntegrator:findCasesByCriteria(Integer,Integer,String,ch.ivy.addon.portalkit.persistence.domain.Server,ch.ivy.ws.addon.CaseSearchCriteria) #txt
Ce0 f93 doCall true #txt
Ce0 f93 requestActionDecl '<java.lang.Integer startIndex,java.lang.Integer count,java.lang.String endpoint,ch.ivy.addon.portalkit.persistence.domain.Server server,ch.ivy.ws.addon.CaseSearchCriteria caseSearchCriteria> param;
' #txt
Ce0 f93 requestMappingAction 'param.startIndex=in.startIndex;
param.count=in.count;
param.endpoint=in.endpoint;
param.server=in.server;
param.caseSearchCriteria=in.caseSearchCriteria;
' #txt
Ce0 f93 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f93 responseMappingAction 'out=in;
out.ivyCases=result.cases;
out.tempErrors=result.errors;
' #txt
Ce0 f93 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f93 302 548 36 24 20 -2 #rect
Ce0 f93 @|CallSubIcon #fIcon
Ce0 f109 expr out #txt
Ce0 f109 320 572 320 604 #arcP
Ce0 f99 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f99 processCall ServiceIntegrators/CaseServiceIntegrator:removeDocument(String,String,Long,Long,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f99 doCall true #txt
Ce0 f99 requestActionDecl '<java.lang.String userName,java.lang.String endpoint,java.lang.Long documentId,java.lang.Long caseId,ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f99 requestMappingAction 'param.userName=in.username;
param.endpoint=in.endpoint;
param.documentId=in.documentId;
param.caseId=in.caseId;
param.server=in.server;
' #txt
Ce0 f99 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f99 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
Ce0 f99 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f99 1926 196 36 24 20 -2 #rect
Ce0 f99 @|CallSubIcon #fIcon
Ce0 f108 inParamDecl '<java.lang.String userName,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long documentId,java.lang.Long caseId> param;' #txt
Ce0 f108 inParamTable 'out.caseId=param.caseId;
out.documentId=param.documentId;
out.server=param.server;
out.username=param.userName;
' #txt
Ce0 f108 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Ce0 f108 outParamTable 'result.errors=in.errors;
' #txt
Ce0 f108 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f108 callSignature deleteDocument(String,ch.ivy.addon.portalkit.persistence.domain.Server,Long,Long) #txt
Ce0 f108 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f108 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>deleteDocument(Server,Long,Long)</name>
        <nameStyle>32,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f108 1931 43 26 26 14 0 #rect
Ce0 f108 @|StartSubIcon #fIcon
Ce0 f110 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f110 actionTable 'out=in;
' #txt
Ce0 f110 actionCode 'import ch.ivy.ws.addon.WsException;

for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Ce0 f110 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f110 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f110 1926 260 36 24 20 -2 #rect
Ce0 f110 @|StepIcon #fIcon
Ce0 f112 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f112 actionTable 'out=in;
' #txt
Ce0 f112 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f112 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f112 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f112 1926 132 36 24 20 -2 #rect
Ce0 f112 @|StepIcon #fIcon
Ce0 f117 expr out #txt
Ce0 f117 1944 220 1944 260 #arcP
Ce0 f118 expr out #txt
Ce0 f118 1944 156 1944 196 #arcP
Ce0 f32 expr out #txt
Ce0 f32 1696 284 1030 832 #arcP
Ce0 f32 1 1696 832 #addKink
Ce0 f32 1 0.37977708879558797 0 0 #arcLabel
Ce0 f120 expr out #txt
Ce0 f120 1944 284 1030 832 #arcP
Ce0 f120 1 1944 832 #addKink
Ce0 f120 1 0.4121381559080655 0 0 #arcLabel
Ce0 f169 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f169 processCall ServiceIntegrators/CaseServiceIntegrator:createNote(String,ch.ivy.addon.portalkit.persistence.domain.Server,Long,String,String) #txt
Ce0 f169 doCall true #txt
Ce0 f169 requestActionDecl '<java.lang.String endpoint,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long caseId,java.lang.String username,java.lang.String content> param;
' #txt
Ce0 f169 requestMappingAction 'param.endpoint=in.endpoint;
param.server=in.server;
param.caseId=in.caseId;
param.username=in.username;
param.content=in.noteContent;
' #txt
Ce0 f169 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f169 responseMappingAction 'out=in;
out.errors=result.errors;
out.note=result.note;
' #txt
Ce0 f169 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f169 2558 196 36 24 20 -2 #rect
Ce0 f169 @|CallSubIcon #fIcon
Ce0 f170 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f170 actionTable 'out=in;
' #txt
Ce0 f170 actionCode 'import ch.ivy.ws.addon.WsException;

for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Ce0 f170 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f170 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f170 2558 260 36 24 20 -2 #rect
Ce0 f170 @|StepIcon #fIcon
Ce0 f173 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f173 actionTable 'out=in;
' #txt
Ce0 f173 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f173 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f173 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f173 2558 132 36 24 20 -2 #rect
Ce0 f173 @|StepIcon #fIcon
Ce0 f174 inParamDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long caseId,java.lang.String username,java.lang.String content> param;' #txt
Ce0 f174 inParamTable 'out.caseId=param.caseId;
out.noteContent=param.content;
out.server=param.server;
out.username=param.username;
' #txt
Ce0 f174 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,ch.ivy.ws.addon.IvyNote note> result;
' #txt
Ce0 f174 outParamTable 'result.errors=in.errors;
result.note=in.note;
' #txt
Ce0 f174 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f174 callSignature createNote(ch.ivy.addon.portalkit.persistence.domain.Server,Long,String,String) #txt
Ce0 f174 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f174 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>createNote
(server, caseId, username, content)</name>
        <nameStyle>46,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f174 2563 51 26 26 14 0 #rect
Ce0 f174 @|StartSubIcon #fIcon
Ce0 f178 expr out #txt
Ce0 f178 2576 220 2576 260 #arcP
Ce0 f179 expr out #txt
Ce0 f179 2576 156 2576 196 #arcP
Ce0 f181 expr out #txt
Ce0 f181 2576 284 1030 832 #arcP
Ce0 f181 1 2576 832 #addKink
Ce0 f181 1 0.4351014082699338 0 0 #arcLabel
Ce0 f123 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f123 processCall ServiceIntegrators/CaseServiceIntegrator:findNotes(String,ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Ce0 f123 doCall true #txt
Ce0 f123 requestActionDecl '<java.lang.String endpoint,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long caseId> param;
' #txt
Ce0 f123 requestMappingAction 'param.endpoint=in.endpoint;
param.server=in.server;
param.caseId=in.caseId;
' #txt
Ce0 f123 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f123 responseMappingAction 'out=in;
out.errors=result.errors;
out.notes=result.notes;
' #txt
Ce0 f123 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator
findNotes</name>
        <nameStyle>31,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f123 2910 212 36 24 20 -2 #rect
Ce0 f123 @|CallSubIcon #fIcon
Ce0 f124 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f124 actionTable 'out=in;
' #txt
Ce0 f124 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f124 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f124 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f124 2910 148 36 24 20 -2 #rect
Ce0 f124 @|StepIcon #fIcon
Ce0 f125 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f125 actionTable 'out=in;
' #txt
Ce0 f125 actionCode 'import ch.ivy.ws.addon.WsException;

for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Ce0 f125 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f125 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f125 2910 276 36 24 20 -2 #rect
Ce0 f125 @|StepIcon #fIcon
Ce0 f126 inParamDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long caseId> param;' #txt
Ce0 f126 inParamTable 'out.caseId=param.caseId;
out.server=param.server;
' #txt
Ce0 f126 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,List<ch.ivy.ws.addon.IvyNote> notes> result;
' #txt
Ce0 f126 outParamTable 'result.errors=in.errors;
result.notes=in.notes;
' #txt
Ce0 f126 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f126 callSignature findNotes(ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Ce0 f126 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f126 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findNotes
(server, caseId)</name>
        <nameStyle>26,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f126 2915 59 26 26 14 0 #rect
Ce0 f126 @|StartSubIcon #fIcon
Ce0 f132 expr out #txt
Ce0 f132 2928 236 2928 276 #arcP
Ce0 f133 expr out #txt
Ce0 f133 2928 172 2928 212 #arcP
Ce0 f135 expr out #txt
Ce0 f135 2928 300 1030 832 #arcP
Ce0 f135 1 2928 832 #addKink
Ce0 f135 1 0.44713244673167574 0 0 #arcLabel
Ce0 f138 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f138 actionTable 'out=in;
' #txt
Ce0 f138 actionCode 'import ch.ivy.addon.portalkit.mapper.RemoteCaseMapper;
import ch.ivy.ws.addon.WsException;

for(WsException error : in.errors){
	error.server = in.server.name;
}

if (in.errors.size() == 0) {
	in.remoteCase = RemoteCaseMapper.mapCase(in.ivyCase, in.server);
}' #txt
Ce0 f138 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f138 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f138 78 276 36 24 20 -2 #rect
Ce0 f138 @|StepIcon #fIcon
Ce0 f139 inParamDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.Long caseId> param;' #txt
Ce0 f139 inParamTable 'out.caseId=param.caseId;
out.server=param.server;
' #txt
Ce0 f139 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,ch.ivy.addon.portalkit.bo.RemoteCase remoteCase> result;
' #txt
Ce0 f139 outParamTable 'result.errors=in.errors;
result.remoteCase=in.remoteCase;
' #txt
Ce0 f139 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f139 callSignature findCase(ch.ivy.addon.portalkit.persistence.domain.Server,Long) #txt
Ce0 f139 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f139 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findCase
(Server,Long)</name>
        <nameStyle>22,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f139 83 51 26 26 14 0 #rect
Ce0 f139 @|StartSubIcon #fIcon
Ce0 f140 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f140 processCall ServiceIntegrators/CaseServiceIntegrator:findCase(ch.ivy.addon.portalkit.persistence.domain.Server,String,Long) #txt
Ce0 f140 doCall true #txt
Ce0 f140 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server sever,java.lang.String endpoint,java.lang.Long caseId> param;
' #txt
Ce0 f140 requestMappingAction 'param.sever=in.server;
param.endpoint=in.endpoint;
param.caseId=in.caseId;
' #txt
Ce0 f140 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f140 responseMappingAction 'out=in;
out.errors=result.errors;
out.ivyCase=result.ivyCase;
' #txt
Ce0 f140 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f140 78 196 36 24 20 -2 #rect
Ce0 f140 @|CallSubIcon #fIcon
Ce0 f141 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f141 actionTable 'out=in;
' #txt
Ce0 f141 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f141 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f141 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f141 78 132 36 24 20 -2 #rect
Ce0 f141 @|StepIcon #fIcon
Ce0 f167 expr out #txt
Ce0 f167 96 220 96 276 #arcP
Ce0 f168 expr out #txt
Ce0 f168 96 156 96 196 #arcP
Ce0 f183 expr out #txt
Ce0 f183 96 300 1002 832 #arcP
Ce0 f183 1 96 832 #addKink
Ce0 f183 1 0.4293924466338259 0 0 #arcLabel
Ce0 f0 inParamDecl '<java.lang.Long serverId,ch.ivy.ws.addon.CaseSearchCriteria caseSearchCriteria> param;' #txt
Ce0 f0 inParamTable 'out.caseSearchCriteria=param.caseSearchCriteria;
out.serverId=param.#serverId;
' #txt
Ce0 f0 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,java.lang.Long caseCount> result;
' #txt
Ce0 f0 outParamTable 'result.errors=in.errors;
result.caseCount=in.caseCount;
' #txt
Ce0 f0 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f0 callSignature countCasesByCriteria(Long,ch.ivy.ws.addon.CaseSearchCriteria) #txt
Ce0 f0 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>countCasesByCriteria
(CaseSearchCriteria)</name>
        <nameStyle>41,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f0 563 51 26 26 14 0 #rect
Ce0 f0 @|StartSubIcon #fIcon
Ce0 f2 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f2 actionTable 'out=in;
' #txt
Ce0 f2 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (!in.apps.isEmpty()) {
	in.caseSearchCriteria.involvedApplications = in.apps.clear();
}' #txt
Ce0 f2 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f2 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Ce0 f2 678 220 36 24 20 -2 #rect
Ce0 f2 @|StepIcon #fIcon
Ce0 f4 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f4 actionTable 'out=in;
' #txt
Ce0 f4 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.caseSearchCriteria.involvedUsername, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

in.caseSearchCriteria.involvedApplications = in.apps;' #txt
Ce0 f4 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f4 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f4 558 420 36 24 21 -18 #rect
Ce0 f4 @|StepIcon #fIcon
Ce0 f8 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f8 processCall ServiceIntegrators/CaseServiceIntegrator:countCasesByCriteria(ch.ivy.ws.addon.CaseSearchCriteria,String,ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f8 doCall true #txt
Ce0 f8 requestActionDecl '<ch.ivy.ws.addon.CaseSearchCriteria caseSearchCriteria,java.lang.String endpoint,ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f8 requestMappingAction 'param.caseSearchCriteria=in.caseSearchCriteria;
param.endpoint=in.endpoint;
param.server=in.server;
' #txt
Ce0 f8 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f8 responseMappingAction 'out=in;
out.caseCountOfOneServer=result.caseCount;
out.tempErrors=result.errors;
' #txt
Ce0 f8 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f8 558 548 36 24 20 -2 #rect
Ce0 f8 @|CallSubIcon #fIcon
Ce0 f9 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f9 actionTable 'out=in;
' #txt
Ce0 f9 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Ce0 f9 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f9 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f9 558 220 36 24 20 -2 #rect
Ce0 f9 @|StepIcon #fIcon
Ce0 f11 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f11 actionTable 'out=in;
' #txt
Ce0 f11 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;
import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
List<Server> servers;
Long serverId = in.#serverId;
if (#serverId is initialized && serverId != 0) {
	servers = Arrays.asList(serverService.findById(serverId));
} else {
	servers = serverService.findActiveServers();
}

in.listIterator = servers.listIterator();' #txt
Ce0 f11 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f11 558 100 36 24 20 -2 #rect
Ce0 f11 @|StepIcon #fIcon
Ce0 f12 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f12 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f12 562 154 28 28 22 -21 #rect
Ce0 f12 @|AlternativeIcon #fIcon
Ce0 f13 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f13 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f13 doCall true #txt
Ce0 f13 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f13 requestMappingAction 'param.server=in.server;
' #txt
Ce0 f13 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f13 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Ce0 f13 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>ApplicationService</name>
    </language>
</elementInfo>
' #txt
Ce0 f13 558 340 36 24 20 -2 #rect
Ce0 f13 @|CallSubIcon #fIcon
Ce0 f14 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f14 actionTable 'out=in;
' #txt
Ce0 f14 actionCode 'in.caseCount += in.caseCountOfOneServer;

' #txt
Ce0 f14 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f14 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>increase case count</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f14 558 604 36 24 20 -2 #rect
Ce0 f14 @|StepIcon #fIcon
Ce0 f18 expr out #txt
Ce0 f18 594 616 696 244 #arcP
Ce0 f18 1 696 616 #addKink
Ce0 f18 1 0.2616721854748305 0 0 #arcLabel
Ce0 f21 expr out #txt
Ce0 f21 696 220 590 168 #arcP
Ce0 f21 1 696 168 #addKink
Ce0 f21 1 0.31135433052386374 0 0 #arcLabel
Ce0 f22 expr out #txt
Ce0 f22 576 124 576 154 #arcP
Ce0 f29 expr in #txt
Ce0 f29 outCond in.listIterator.hasNext() #txt
Ce0 f29 576 182 576 220 #arcP
Ce0 f77 expr out #txt
Ce0 f77 576 77 576 100 #arcP
Ce0 f82 expr out #txt
Ce0 f82 576 572 576 604 #arcP
Ce0 f83 expr in #txt
Ce0 f83 562 168 1002 832 #arcP
Ce0 f83 1 504 168 #addKink
Ce0 f83 2 504 832 #addKink
Ce0 f83 1 0.9968566098651808 0 0 #arcLabel
Ce0 f121 expr out #txt
Ce0 f121 96 77 96 132 #arcP
Ce0 f122 expr out #txt
Ce0 f122 1248 69 1248 132 #arcP
Ce0 f6 expr out #txt
Ce0 f6 1456 69 1456 132 #arcP
Ce0 f39 expr out #txt
Ce0 f39 1696 69 1696 132 #arcP
Ce0 f42 expr out #txt
Ce0 f42 1944 69 1944 132 #arcP
Ce0 f43 expr out #txt
Ce0 f43 2576 77 2576 132 #arcP
Ce0 f45 expr out #txt
Ce0 f45 2928 85 2928 148 #arcP
Ce0 f49 expr out #txt
Ce0 f49 320 364 320 420 #arcP
Ce0 f7 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f7 306 274 28 28 14 0 #rect
Ce0 f7 @|AlternativeIcon #fIcon
Ce0 f17 expr out #txt
Ce0 f17 320 244 320 274 #arcP
Ce0 f19 expr in #txt
Ce0 f19 outCond in.caseSearchCriteria.involvedApplications.isEmpty() #txt
Ce0 f19 320 302 320 340 #arcP
Ce0 f55 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f55 actionTable 'out=in;
' #txt
Ce0 f55 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f55 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f55 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f55 302 484 36 24 20 -2 #rect
Ce0 f55 @|StepIcon #fIcon
Ce0 f56 expr out #txt
Ce0 f56 320 444 320 484 #arcP
Ce0 f56 0 0.4643737380072319 0 0 #arcLabel
Ce0 f57 expr out #txt
Ce0 f57 320 508 320 548 #arcP
Ce0 f57 0 0.4643737380072319 0 0 #arcLabel
Ce0 f58 expr in #txt
Ce0 f58 306 288 302 496 #arcP
Ce0 f58 1 272 288 #addKink
Ce0 f58 2 272 496 #addKink
Ce0 f58 1 0.49074074074074076 0 0 #arcLabel
Ce0 f62 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f62 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f62 562 274 28 28 14 0 #rect
Ce0 f62 @|AlternativeIcon #fIcon
Ce0 f66 expr out #txt
Ce0 f66 576 244 576 274 #arcP
Ce0 f23 expr in #txt
Ce0 f23 outCond in.caseSearchCriteria.involvedApplications.isEmpty() #txt
Ce0 f23 576 302 576 340 #arcP
Ce0 f69 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f69 actionTable 'out=in;
' #txt
Ce0 f69 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f69 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f69 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f69 558 484 36 24 20 -2 #rect
Ce0 f69 @|StepIcon #fIcon
Ce0 f71 expr out #txt
Ce0 f71 576 364 576 420 #arcP
Ce0 f70 expr out #txt
Ce0 f70 576 508 576 548 #arcP
Ce0 f51 expr out #txt
Ce0 f51 576 444 576 484 #arcP
Ce0 f72 expr in #txt
Ce0 f72 562 288 558 496 #arcP
Ce0 f72 1 528 288 #addKink
Ce0 f72 2 528 496 #addKink
Ce0 f72 1 0.49038461538461536 0 0 #arcLabel
Ce0 f74 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f74 actionTable 'out=in;
' #txt
Ce0 f74 actionCode 'import ch.ivy.ws.addon.WsException;

for(WsException error : in.errors){
	error.server = in.server.name;
}' #txt
Ce0 f74 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f74 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f74 3118 276 36 24 20 -2 #rect
Ce0 f74 @|StepIcon #fIcon
Ce0 f78 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f78 processCall ServiceIntegrators/CaseServiceIntegrator:saveCase(ch.ivy.addon.portalkit.persistence.domain.Server,String,ch.ivy.ws.addon.IvyCase) #txt
Ce0 f78 doCall true #txt
Ce0 f78 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server sever,java.lang.String endpoint,ch.ivy.ws.addon.IvyCase ivyCase> param;
' #txt
Ce0 f78 requestMappingAction 'param.sever=in.server;
param.endpoint=in.endpoint;
param.ivyCase=in.ivyCase;
' #txt
Ce0 f78 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f78 responseMappingAction 'out=in;
out.errors=result.errors;
' #txt
Ce0 f78 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f78 3118 196 36 24 20 -2 #rect
Ce0 f78 @|CallSubIcon #fIcon
Ce0 f79 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f79 actionTable 'out=in;
' #txt
Ce0 f79 actionCode 'import ch.ivy.addon.portalkit.service.PortalConnectorDetector;
import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();
' #txt
Ce0 f79 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f79 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get actual endpoint</name>
        <nameStyle>19,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f79 3118 132 36 24 20 -2 #rect
Ce0 f79 @|StepIcon #fIcon
Ce0 f94 inParamDecl '<java.lang.Long serverId,ch.ivy.ws.addon.IvyCase ivyCase> param;' #txt
Ce0 f94 inParamTable 'out.ivyCase=param.ivyCase;
out.server=new ch.ivy.addon.portalkit.service.ServerService().findById(param.serverId);
' #txt
Ce0 f94 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors> result;
' #txt
Ce0 f94 outParamTable 'result.errors=in.errors;
' #txt
Ce0 f94 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f94 callSignature saveCase(Long,ch.ivy.ws.addon.IvyCase) #txt
Ce0 f94 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f94 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>saveCase
(serverId, ivyCase)</name>
        <nameStyle>28,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f94 3123 51 26 26 14 0 #rect
Ce0 f94 @|StartSubIcon #fIcon
Ce0 f95 expr out #txt
Ce0 f95 3136 220 3136 276 #arcP
Ce0 f97 expr out #txt
Ce0 f97 3136 156 3136 196 #arcP
Ce0 f100 expr out #txt
Ce0 f100 3136 77 3136 132 #arcP
Ce0 f102 expr out #txt
Ce0 f102 3136 300 1030 832 #arcP
Ce0 f102 1 3136 832 #addKink
Ce0 f102 1 0.42598901421693425 0 0 #arcLabel
Ce0 f104 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f104 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f104 3386 278 28 28 14 0 #rect
Ce0 f104 @|AlternativeIcon #fIcon
Ce0 f111 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f111 actionTable 'out=in;
' #txt
Ce0 f111 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f111 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f111 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f111 3382 596 36 24 20 -2 #rect
Ce0 f111 @|StepIcon #fIcon
Ce0 f113 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f113 actionTable 'out=in;
' #txt
Ce0 f113 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;
import ch.ivy.addon.portalkit.util.PermissionUtils;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.caseSearchCriteria.involvedUsername, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

in.caseSearchCriteria.involvedApplications = in.apps;' #txt
Ce0 f113 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f113 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f113 3382 440 36 24 21 -18 #rect
Ce0 f113 @|StepIcon #fIcon
Ce0 f114 inParamDecl '<java.lang.String jsonQuery,java.util.List<java.lang.String> apps,java.lang.Long serverId,java.lang.String userName> param;' #txt
Ce0 f114 inParamTable 'out.apps=param.apps;
out.caseSearchCriteria.ignoreInvolvedUser=false;
out.caseSearchCriteria.involvedApplications=param.apps;
out.caseSearchCriteria.involvedUsername=param.userName;
out.caseSearchCriteria.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
out.serverId=param.serverId;
' #txt
Ce0 f114 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,ch.ivy.ws.addon.CaseStateStatistic caseStateStatistic> result;
' #txt
Ce0 f114 outParamTable 'result.errors=in.errors;
result.caseStateStatistic=in.caseStateStatistic;
' #txt
Ce0 f114 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f114 callSignature analyzeCaseStateStatistic(String,List<String>,Long,String) #txt
Ce0 f114 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f114 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>analyzeCaseStateStatistic(String, List&lt;String&gt;, Long, String)</name>
        <nameStyle>61,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f114 3387 55 26 26 -149 -31 #rect
Ce0 f114 @|StartSubIcon #fIcon
Ce0 f115 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f115 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f115 doCall true #txt
Ce0 f115 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f115 requestMappingAction 'param.server=in.server;
' #txt
Ce0 f115 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f115 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Ce0 f115 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>ApplicationService</name>
    </language>
</elementInfo>
' #txt
Ce0 f115 3382 344 36 24 20 -2 #rect
Ce0 f115 @|CallSubIcon #fIcon
Ce0 f116 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f116 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f116 3386 158 28 28 22 -21 #rect
Ce0 f116 @|AlternativeIcon #fIcon
Ce0 f119 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f119 actionTable 'out=in;
' #txt
Ce0 f119 actionCode 'if (in.tempErrors.isEmpty()) {
	in.caseStateStatistic.done += in.tempCaseStateStatistic.done;
	in.caseStateStatistic.failed += in.tempCaseStateStatistic.failed;
	in.caseStateStatistic.created += in.tempCaseStateStatistic.created;
	in.caseStateStatistic.running += in.tempCaseStateStatistic.running;
}' #txt
Ce0 f119 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f119 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add statistic</name>
        <nameStyle>13,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f119 3382 740 36 24 20 -2 #rect
Ce0 f119 @|StepIcon #fIcon
Ce0 f127 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f127 processCall ServiceIntegrators/CaseServiceIntegrator:analyzeCaseStateStatistic(ch.ivy.ws.addon.CaseSearchCriteria,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Ce0 f127 doCall true #txt
Ce0 f127 requestActionDecl '<ch.ivy.ws.addon.CaseSearchCriteria caseSearchCriteria,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Ce0 f127 requestMappingAction 'param.caseSearchCriteria=in.caseSearchCriteria;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Ce0 f127 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f127 responseMappingAction 'out=in;
out.tempCaseStateStatistic=result.caseStateStatistic;
out.tempErrors=result.errors;
' #txt
Ce0 f127 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f127 3382 684 36 24 20 -2 #rect
Ce0 f127 @|CallSubIcon #fIcon
Ce0 f128 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f128 actionTable 'out=in;
' #txt
Ce0 f128 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;
import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
List<Server> servers;
Long serverId = in.#serverId;
if (#serverId is initialized && serverId != 0) {
	servers = Arrays.asList(serverService.findById(serverId));
} else {
	servers = serverService.findActiveServers();
}

in.listIterator = servers.listIterator();' #txt
Ce0 f128 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f128 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f128 3382 104 36 24 20 -2 #rect
Ce0 f128 @|StepIcon #fIcon
Ce0 f129 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f129 actionTable 'out=in;
' #txt
Ce0 f129 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Ce0 f129 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f129 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f129 3382 224 36 24 20 -2 #rect
Ce0 f129 @|StepIcon #fIcon
Ce0 f130 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f130 actionTable 'out=in;
' #txt
Ce0 f130 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (!in.apps.isEmpty()) {
	in.caseSearchCriteria.involvedApplications = in.apps.clear();
}' #txt
Ce0 f130 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f130 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Ce0 f130 3502 224 36 24 20 -2 #rect
Ce0 f130 @|StepIcon #fIcon
Ce0 f131 expr out #txt
Ce0 f131 3520 224 3414 172 #arcP
Ce0 f131 1 3520 172 #addKink
Ce0 f131 1 0.31135433052386374 0 0 #arcLabel
Ce0 f134 expr out #txt
Ce0 f134 3400 128 3400 158 #arcP
Ce0 f136 expr out #txt
Ce0 f136 3418 752 3520 248 #arcP
Ce0 f136 1 3520 752 #addKink
Ce0 f136 1 0.2616721854748305 0 0 #arcLabel
Ce0 f142 expr out #txt
Ce0 f142 3400 620 3400 684 #arcP
Ce0 f142 0 0.4643737380072319 0 0 #arcLabel
Ce0 f143 expr in #txt
Ce0 f143 3386 292 3382 608 #arcP
Ce0 f143 1 3328 292 #addKink
Ce0 f143 2 3328 608 #addKink
Ce0 f143 1 0.49074074074074076 0 0 #arcLabel
Ce0 f145 expr out #txt
Ce0 f145 3400 81 3400 104 #arcP
Ce0 f146 expr out #txt
Ce0 f146 3400 248 3400 278 #arcP
Ce0 f147 expr in #txt
Ce0 f147 outCond in.caseSearchCriteria.involvedApplications.isEmpty() #txt
Ce0 f147 3400 306 3400 344 #arcP
Ce0 f149 expr in #txt
Ce0 f149 outCond in.listIterator.hasNext() #txt
Ce0 f149 3400 186 3400 224 #arcP
Ce0 f150 expr out #txt
Ce0 f150 3400 708 3400 740 #arcP
Ce0 f151 expr out #txt
Ce0 f151 3400 368 3400 440 #arcP
Ce0 f152 expr in #txt
Ce0 f152 3386 172 1030 832 #arcP
Ce0 f152 1 3296 172 #addKink
Ce0 f152 2 3296 832 #addKink
Ce0 f152 2 0.39071729957805906 0 0 #arcLabel
Ce0 f153 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f153 actionTable 'out=in;
' #txt
Ce0 f153 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Ce0 f153 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f153 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f153 3795 224 36 24 20 -2 #rect
Ce0 f153 @|StepIcon #fIcon
Ce0 f154 inParamDecl '<java.lang.String jsonQuery,java.util.List<java.lang.String> apps,java.lang.Long serverId,java.lang.String userName> param;' #txt
Ce0 f154 inParamTable 'out.apps=param.apps;
out.caseSearchCriteria.ignoreInvolvedUser=false;
out.caseSearchCriteria.involvedApplications=param.apps;
out.caseSearchCriteria.involvedUsername=param.userName;
out.caseSearchCriteria.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
out.serverId=param.serverId;
' #txt
Ce0 f154 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,java.util.List<ch.ivy.ws.addon.ElapsedTimeStatistic> elapsedTimeStatistic> result;
' #txt
Ce0 f154 outParamTable 'result.errors=in.errors;
result.elapsedTimeStatistic=in.elapsedTimeStatistic;
' #txt
Ce0 f154 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f154 callSignature analyzeElapsedTimeStatistic(String,List<String>,Long,String) #txt
Ce0 f154 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f154 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>analyzeElapsedTimeStatistic(String, List&lt;String&gt;, Long, String)</name>
        <nameStyle>63,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f154 3800 55 26 26 -174 -34 #rect
Ce0 f154 @|StartSubIcon #fIcon
Ce0 f155 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f155 actionTable 'out=in;
' #txt
Ce0 f155 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f155 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f155 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f155 3795 616 36 24 20 -2 #rect
Ce0 f155 @|StepIcon #fIcon
Ce0 f156 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f156 actionTable 'out=in;
' #txt
Ce0 f156 actionCode 'if (in.tempErrors.isEmpty()) {
	in.elapsedTimeStatistic.add(in.tempElapsedTimeStatistic);
}' #txt
Ce0 f156 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f156 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add statistic</name>
        <nameStyle>13,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f156 3795 736 36 24 20 -2 #rect
Ce0 f156 @|StepIcon #fIcon
Ce0 f157 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f157 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f157 3799 158 28 28 22 -21 #rect
Ce0 f157 @|AlternativeIcon #fIcon
Ce0 f158 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f158 processCall ServiceIntegrators/CaseServiceIntegrator:analyzeElapsedTimeStatistic(ch.ivy.ws.addon.CaseSearchCriteria,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Ce0 f158 doCall true #txt
Ce0 f158 requestActionDecl '<ch.ivy.ws.addon.CaseSearchCriteria caseSearchCriteria,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Ce0 f158 requestMappingAction 'param.caseSearchCriteria=in.caseSearchCriteria;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Ce0 f158 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f158 responseMappingAction 'out=in;
out.tempElapsedTimeStatistic=result.elapsedTimeStatistic;
out.tempErrors=result.errors;
' #txt
Ce0 f158 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f158 3795 680 36 24 20 -2 #rect
Ce0 f158 @|CallSubIcon #fIcon
Ce0 f159 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f159 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f159 3799 278 28 28 14 0 #rect
Ce0 f159 @|AlternativeIcon #fIcon
Ce0 f160 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f160 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f160 doCall true #txt
Ce0 f160 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f160 requestMappingAction 'param.server=in.server;
' #txt
Ce0 f160 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f160 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Ce0 f160 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>ApplicationService</name>
    </language>
</elementInfo>
' #txt
Ce0 f160 3795 344 36 24 20 -2 #rect
Ce0 f160 @|CallSubIcon #fIcon
Ce0 f161 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f161 actionTable 'out=in;
' #txt
Ce0 f161 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.caseSearchCriteria.involvedUsername, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

in.caseSearchCriteria.involvedApplications = in.apps;' #txt
Ce0 f161 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f161 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f161 3795 424 36 24 21 -18 #rect
Ce0 f161 @|StepIcon #fIcon
Ce0 f162 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f162 actionTable 'out=in;
' #txt
Ce0 f162 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (!in.apps.isEmpty()) {
	in.caseSearchCriteria.involvedApplications = in.apps.clear();
}' #txt
Ce0 f162 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f162 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Ce0 f162 3915 224 36 24 20 -2 #rect
Ce0 f162 @|StepIcon #fIcon
Ce0 f163 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f163 actionTable 'out=in;
' #txt
Ce0 f163 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;
import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
List<Server> servers;
Long serverId = in.#serverId;
if (#serverId is initialized && serverId != 0) {
	servers = Arrays.asList(serverService.findById(serverId));
} else {
	servers = serverService.findActiveServers();
}

in.listIterator = servers.listIterator();' #txt
Ce0 f163 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f163 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f163 3795 104 36 24 20 -2 #rect
Ce0 f163 @|StepIcon #fIcon
Ce0 f164 expr out #txt
Ce0 f164 3813 81 3813 104 #arcP
Ce0 f165 expr out #txt
Ce0 f165 3813 368 3813 424 #arcP
Ce0 f166 expr out #txt
Ce0 f166 3813 640 3813 680 #arcP
Ce0 f166 0 0.4643737380072319 0 0 #arcLabel
Ce0 f171 expr out #txt
Ce0 f171 3831 748 3933 248 #arcP
Ce0 f171 1 3933 748 #addKink
Ce0 f171 1 0.2616721854748305 0 0 #arcLabel
Ce0 f172 expr in #txt
Ce0 f172 outCond in.caseSearchCriteria.involvedApplications.isEmpty() #txt
Ce0 f172 3813 306 3813 344 #arcP
Ce0 f175 expr out #txt
Ce0 f175 3813 248 3813 278 #arcP
Ce0 f176 expr in #txt
Ce0 f176 3799 292 3795 628 #arcP
Ce0 f176 1 3744 292 #addKink
Ce0 f176 2 3744 628 #addKink
Ce0 f176 1 0.49074074074074076 0 0 #arcLabel
Ce0 f177 expr out #txt
Ce0 f177 3813 128 3813 158 #arcP
Ce0 f180 expr in #txt
Ce0 f180 outCond in.listIterator.hasNext() #txt
Ce0 f180 3813 186 3813 224 #arcP
Ce0 f184 expr out #txt
Ce0 f184 3933 224 3827 172 #arcP
Ce0 f184 1 3933 172 #addKink
Ce0 f184 1 0.31135433052386374 0 0 #arcLabel
Ce0 f185 expr out #txt
Ce0 f185 3813 704 3813 736 #arcP
Ce0 f186 expr in #txt
Ce0 f186 3799 172 1030 832 #arcP
Ce0 f186 1 3712 172 #addKink
Ce0 f186 2 3712 832 #addKink
Ce0 f186 2 0.4069349622709307 0 0 #arcLabel
Ce0 f187 inParamDecl '<java.lang.String jsonQuery,java.util.List<java.lang.String> apps,java.lang.Long serverId,java.lang.String userName> param;' #txt
Ce0 f187 inParamTable 'out.apps=param.apps;
out.caseSearchCriteria.businessCase=true;
out.caseSearchCriteria.ignoreInvolvedUser=false;
out.caseSearchCriteria.involvedApplications=param.apps;
out.caseSearchCriteria.involvedUsername=param.userName;
out.caseSearchCriteria.jsonQuery=param.jsonQuery;
out.server.id=param.serverId;
out.serverId=param.serverId;
' #txt
Ce0 f187 outParamDecl '<List<ch.ivy.ws.addon.WsException> errors,java.util.List<ch.ivy.ws.addon.CategoryData> caseCategories> result;
' #txt
Ce0 f187 outParamTable 'result.errors=in.errors;
result.caseCategories=in.caseCategories;
' #txt
Ce0 f187 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f187 callSignature findCaseCategoriesByCriteria(String,List<String>,Long,String) #txt
Ce0 f187 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f187 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findCaseCategoriesByCriteria(String, List&lt;String&gt;, Long, String)</name>
        <nameStyle>64,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f187 4184 54 26 26 -174 -34 #rect
Ce0 f187 @|StartSubIcon #fIcon
Ce0 f188 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f188 processCall MultiPortal/ApplicationService:getApplicationConfiguredOn(ch.ivy.addon.portalkit.persistence.domain.Server) #txt
Ce0 f188 doCall true #txt
Ce0 f188 requestActionDecl '<ch.ivy.addon.portalkit.persistence.domain.Server server> param;
' #txt
Ce0 f188 requestMappingAction 'param.server=in.server;
' #txt
Ce0 f188 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f188 responseMappingAction 'out=in;
out.applications=result.applications;
out.tempErrors=result.errors;
' #txt
Ce0 f188 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>ApplicationService</name>
    </language>
</elementInfo>
' #txt
Ce0 f188 4179 343 36 24 20 -2 #rect
Ce0 f188 @|CallSubIcon #fIcon
Ce0 f189 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f189 processCall ServiceIntegrators/CaseServiceIntegrator:findCaseCategoriesByCriteria(ch.ivy.ws.addon.CaseSearchCriteria,ch.ivy.addon.portalkit.persistence.domain.Server,String) #txt
Ce0 f189 doCall true #txt
Ce0 f189 requestActionDecl '<ch.ivy.ws.addon.CaseSearchCriteria caseSearchCriteria,ch.ivy.addon.portalkit.persistence.domain.Server server,java.lang.String endpoint> param;
' #txt
Ce0 f189 requestMappingAction 'param.caseSearchCriteria=in.caseSearchCriteria;
param.server=in.server;
param.endpoint=in.endpoint;
' #txt
Ce0 f189 responseActionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f189 responseMappingAction 'out=in;
out.tempCaseCategories=result.categories;
out.tempErrors=result.errors;
' #txt
Ce0 f189 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>CaseServiceIntegrator</name>
        <nameStyle>21,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f189 4179 551 36 24 20 -2 #rect
Ce0 f189 @|CallSubIcon #fIcon
Ce0 f190 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f190 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no selected apps?</name>
        <nameStyle>17
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f190 4183 277 28 28 14 0 #rect
Ce0 f190 @|AlternativeIcon #fIcon
Ce0 f191 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f191 actionTable 'out=in;
' #txt
Ce0 f191 actionCode 'import ch.ivy.addon.portalkit.enums.WebServiceEndPoint;
import ch.ivy.addon.portalkit.service.PortalConnectorDetector;

PortalConnectorDetector detector = new PortalConnectorDetector();
in.endpoint = detector.getPortalConnectorURLOf(in.server) + WebServiceEndPoint.CASE.toString();' #txt
Ce0 f191 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f191 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get ws endpoint</name>
        <nameStyle>15
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f191 4179 487 36 24 20 -2 #rect
Ce0 f191 @|StepIcon #fIcon
Ce0 f192 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f192 actionTable 'out=in;
' #txt
Ce0 f192 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;

in.server = in.listIterator.next() as Server;' #txt
Ce0 f192 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f192 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get server</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f192 4179 223 36 24 20 -2 #rect
Ce0 f192 @|StepIcon #fIcon
Ce0 f193 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f193 actionTable 'out=in;
' #txt
Ce0 f193 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Server;
import java.util.Arrays;
import ch.ivy.addon.portalkit.service.ServerService;

ServerService serverService = new ServerService();
List<Server> servers;
Long serverId = in.#serverId;
if (#serverId is initialized && serverId != 0) {
	servers = Arrays.asList(serverService.findById(serverId));
} else {
	servers = serverService.findActiveServers();
}

in.listIterator = servers.listIterator();' #txt
Ce0 f193 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f193 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get servers</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f193 4179 103 36 24 20 -2 #rect
Ce0 f193 @|StepIcon #fIcon
Ce0 f194 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f194 actionTable 'out=in;
' #txt
Ce0 f194 actionCode 'if (in.tempErrors.isEmpty()) {
	in.caseCategories.addAll(in.tempCaseCategories);
}' #txt
Ce0 f194 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f194 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add categories</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f194 4179 607 36 24 20 -2 #rect
Ce0 f194 @|StepIcon #fIcon
Ce0 f195 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f195 actionTable 'out=in;
' #txt
Ce0 f195 actionCode 'import ch.ivy.ws.addon.WsException;
for(int i = 0 ; i < in.tempErrors.size() ; i++){
	WsException w = in.tempErrors.get(i) as WsException;
	w.server = in.server.name;
	in.tempErrors.set(i,w);
	}
in.errors.addAll(in.tempErrors);

if (!in.apps.isEmpty()) {
	in.caseSearchCriteria.involvedApplications = in.apps.clear();
}' #txt
Ce0 f195 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f195 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>utils</name>
        <nameStyle>5,7
</nameStyle>
        <desc>add server name for exceptions

clear apps list</desc>
    </language>
</elementInfo>
' #txt
Ce0 f195 4299 223 36 24 20 -2 #rect
Ce0 f195 @|StepIcon #fIcon
Ce0 f196 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f196 actionTable 'out=in;
' #txt
Ce0 f196 actionCode 'import ch.ivy.addon.portalkit.persistence.domain.Application;
import ch.ivy.addon.portalkit.service.ApplicationService;
import ch.ivy.ws.addon.IvyApplication;
import ch.ivy.addon.portalkit.service.UserService;

in.apps.clear();

UserService userService = new UserService();
java.util.List<String> apps = userService.findApplicationNamesUserCanWorkOn(in.caseSearchCriteria.involvedUsername, in.server.id);
for(String appName: apps) {
	for (Application application : in.server.getApplications()) {
		if(appName.equals(application.name) && application.isVisible && !in.apps.contains(appName)){
			in.apps.add(appName);					
		}
	}
}
if (in.apps.isEmpty()) {
	ApplicationService applicationService = new ApplicationService();
	in.apps = applicationService.getApplicationNames(in.applications);
}

in.caseSearchCriteria.involvedApplications = in.apps;' #txt
Ce0 f196 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f196 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Alive Apps</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f196 4179 423 36 24 21 -18 #rect
Ce0 f196 @|StepIcon #fIcon
Ce0 f197 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f197 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>next server</name>
        <nameStyle>11,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Ce0 f197 4183 157 28 28 22 -21 #rect
Ce0 f197 @|AlternativeIcon #fIcon
Ce0 f198 expr in #txt
Ce0 f198 outCond in.listIterator.hasNext() #txt
Ce0 f198 4197 185 4197 223 #arcP
Ce0 f199 expr out #txt
Ce0 f199 4317 223 4211 171 #arcP
Ce0 f199 1 4317 171 #addKink
Ce0 f199 1 0.31135433052386374 0 0 #arcLabel
Ce0 f200 expr out #txt
Ce0 f200 4197 127 4197 157 #arcP
Ce0 f201 expr out #txt
Ce0 f201 4215 619 4317 247 #arcP
Ce0 f201 1 4317 619 #addKink
Ce0 f201 1 0.2616721854748305 0 0 #arcLabel
Ce0 f203 expr out #txt
Ce0 f203 4197 367 4197 423 #arcP
Ce0 f204 expr out #txt
Ce0 f204 4197 575 4197 607 #arcP
Ce0 f205 expr out #txt
Ce0 f205 4197 247 4197 277 #arcP
Ce0 f206 expr out #txt
Ce0 f206 4197 80 4197 103 #arcP
Ce0 f207 expr in #txt
Ce0 f207 outCond in.caseSearchCriteria.involvedApplications.isEmpty() #txt
Ce0 f207 4197 305 4197 343 #arcP
Ce0 f208 expr out #txt
Ce0 f208 4197 511 4197 551 #arcP
Ce0 f208 0 0.4643737380072319 0 0 #arcLabel
Ce0 f209 expr in #txt
Ce0 f209 4183 291 4179 499 #arcP
Ce0 f209 1 4128 291 #addKink
Ce0 f209 2 4128 499 #addKink
Ce0 f209 1 0.49074074074074076 0 0 #arcLabel
Ce0 f210 expr in #txt
Ce0 f210 4183 171 1030 832 #arcP
Ce0 f210 1 4096 171 #addKink
Ce0 f210 2 4096 832 #addKink
Ce0 f210 2 0.41806125670982003 0 0 #arcLabel
Ce0 f211 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f211 actionTable 'out=in;
' #txt
Ce0 f211 actionCode 'import ch.ivy.addon.portalkit.util.PermissionUtils;

in.caseSearchCriteria.businessCase = true;
in.caseSearchCriteria.ignoreInvolvedUser = PermissionUtils.checkReadAllCasesPermission();' #txt
Ce0 f211 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f211 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>additional filters</name>
    </language>
</elementInfo>
' #txt
Ce0 f211 3380 524 40 24 12 -30 #rect
Ce0 f211 @|StepIcon #fIcon
Ce0 f212 expr out #txt
Ce0 f212 3400 464 3400 524 #arcP
Ce0 f212 0 0.4643737380072319 0 0 #arcLabel
Ce0 f137 expr out #txt
Ce0 f137 3400 548 3400 596 #arcP
Ce0 f137 0 0.4643737380072319 0 0 #arcLabel
Ce0 f202 expr out #txt
Ce0 f202 4197 447 4197 487 #arcP
Ce0 f202 0 0.4643737380072319 0 0 #arcLabel
Ce0 f213 actionDecl 'ch.ivyteam.wf.processes.CaseServiceData out;
' #txt
Ce0 f213 actionTable 'out=in;
' #txt
Ce0 f213 actionCode 'import ch.ivy.addon.portalkit.util.PermissionUtils;

in.caseSearchCriteria.businessCase = true;
in.caseSearchCriteria.ignoreInvolvedUser = PermissionUtils.checkReadAllCasesPermission();' #txt
Ce0 f213 type ch.ivyteam.wf.processes.CaseServiceData #txt
Ce0 f213 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>additional filters</name>
    </language>
</elementInfo>
' #txt
Ce0 f213 3793 525 40 24 12 -30 #rect
Ce0 f213 @|StepIcon #fIcon
Ce0 f214 expr out #txt
Ce0 f214 3813 448 3813 525 #arcP
Ce0 f214 0 0.4643737380072319 0 0 #arcLabel
Ce0 f182 expr out #txt
Ce0 f182 3813 549 3813 616 #arcP
>Proto Ce0 .type ch.ivyteam.wf.processes.CaseServiceData #txt
>Proto Ce0 .processKind CALLABLE_SUB #txt
>Proto Ce0 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <swimlaneLabel>findCases</swimlaneLabel>
        <swimlaneLabel>addtionalProperties</swimlaneLabel>
        <swimlaneLabel>Documents</swimlaneLabel>
        <swimlaneLabel>Destroy Case</swimlaneLabel>
        <swimlaneLabel></swimlaneLabel>
    </language>
    <swimlaneSize>768</swimlaneSize>
    <swimlaneSize>432</swimlaneSize>
    <swimlaneSize>968</swimlaneSize>
    <swimlaneSize>320</swimlaneSize>
    <swimlaneColor gradient="true">-3342388</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneColor gradient="true">-1</swimlaneColor>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
</elementInfo>
' #txt
>Proto Ce0 0 0 32 24 18 0 #rect
>Proto Ce0 @|BIcon #fIcon
Ce0 f33 mainOut f36 tail #connect
Ce0 f36 head f35 mainIn #connect
Ce0 f24 mainOut f41 tail #connect
Ce0 f41 head f40 mainIn #connect
Ce0 f10 mainOut f20 tail #connect
Ce0 f20 head f44 mainIn #connect
Ce0 f40 mainOut f28 tail #connect
Ce0 f28 head f10 mainIn #connect
Ce0 f35 mainOut f26 tail #connect
Ce0 f26 head f25 mainIn #connect
Ce0 f37 mainOut f46 tail #connect
Ce0 f46 head f38 mainIn #connect
Ce0 f15 mainOut f47 tail #connect
Ce0 f47 head f37 mainIn #connect
Ce0 f50 mainOut f59 tail #connect
Ce0 f59 head f53 mainIn #connect
Ce0 f54 mainOut f61 tail #connect
Ce0 f61 head f50 mainIn #connect
Ce0 f68 mainOut f73 tail #connect
Ce0 f73 head f67 mainIn #connect
Ce0 f64 mainOut f76 tail #connect
Ce0 f76 head f68 mainIn #connect
Ce0 f144 mainOut f81 tail #connect
Ce0 f81 head f80 mainIn #connect
Ce0 f148 out f107 tail #connect
Ce0 f107 head f144 mainIn #connect
Ce0 f44 mainOut f16 tail #connect
Ce0 f16 head f148 in #connect
Ce0 f25 mainOut f31 tail #connect
Ce0 f31 head f148 in #connect
Ce0 f38 mainOut f27 tail #connect
Ce0 f27 head f148 in #connect
Ce0 f53 mainOut f1 tail #connect
Ce0 f1 head f148 in #connect
Ce0 f34 mainOut f87 tail #connect
Ce0 f87 head f52 mainIn #connect
Ce0 f88 mainOut f30 tail #connect
Ce0 f30 head f148 in #connect
Ce0 f5 mainOut f60 tail #connect
Ce0 f60 head f34 mainIn #connect
Ce0 f52 mainOut f65 tail #connect
Ce0 f65 head f88 mainIn #connect
Ce0 f92 mainOut f96 tail #connect
Ce0 f96 head f86 mainIn #connect
Ce0 f86 mainOut f98 tail #connect
Ce0 f98 head f85 in #connect
Ce0 f90 mainOut f101 tail #connect
Ce0 f101 head f85 in #connect
Ce0 f85 out f103 tail #connect
Ce0 f103 head f89 mainIn #connect
Ce0 f75 mainOut f105 tail #connect
Ce0 f105 head f90 mainIn #connect
Ce0 f85 out f106 tail #connect
Ce0 f106 head f148 in #connect
Ce0 f93 mainOut f109 tail #connect
Ce0 f109 head f92 mainIn #connect
Ce0 f99 mainOut f117 tail #connect
Ce0 f117 head f110 mainIn #connect
Ce0 f112 mainOut f118 tail #connect
Ce0 f118 head f99 mainIn #connect
Ce0 f67 mainOut f32 tail #connect
Ce0 f32 head f148 in #connect
Ce0 f110 mainOut f120 tail #connect
Ce0 f120 head f148 in #connect
Ce0 f169 mainOut f178 tail #connect
Ce0 f178 head f170 mainIn #connect
Ce0 f173 mainOut f179 tail #connect
Ce0 f179 head f169 mainIn #connect
Ce0 f170 mainOut f181 tail #connect
Ce0 f181 head f148 in #connect
Ce0 f123 mainOut f132 tail #connect
Ce0 f132 head f125 mainIn #connect
Ce0 f124 mainOut f133 tail #connect
Ce0 f133 head f123 mainIn #connect
Ce0 f125 mainOut f135 tail #connect
Ce0 f135 head f148 in #connect
Ce0 f140 mainOut f167 tail #connect
Ce0 f167 head f138 mainIn #connect
Ce0 f141 mainOut f168 tail #connect
Ce0 f168 head f140 mainIn #connect
Ce0 f138 mainOut f183 tail #connect
Ce0 f183 head f148 in #connect
Ce0 f14 mainOut f18 tail #connect
Ce0 f18 head f2 mainIn #connect
Ce0 f2 mainOut f21 tail #connect
Ce0 f21 head f12 in #connect
Ce0 f11 mainOut f22 tail #connect
Ce0 f22 head f12 in #connect
Ce0 f12 out f29 tail #connect
Ce0 f29 head f9 mainIn #connect
Ce0 f0 mainOut f77 tail #connect
Ce0 f77 head f11 mainIn #connect
Ce0 f8 mainOut f82 tail #connect
Ce0 f82 head f14 mainIn #connect
Ce0 f12 out f83 tail #connect
Ce0 f83 head f148 in #connect
Ce0 f139 mainOut f121 tail #connect
Ce0 f121 head f141 mainIn #connect
Ce0 f3 mainOut f122 tail #connect
Ce0 f122 head f15 mainIn #connect
Ce0 f48 mainOut f6 tail #connect
Ce0 f6 head f54 mainIn #connect
Ce0 f63 mainOut f39 tail #connect
Ce0 f39 head f64 mainIn #connect
Ce0 f108 mainOut f42 tail #connect
Ce0 f42 head f112 mainIn #connect
Ce0 f174 mainOut f43 tail #connect
Ce0 f43 head f173 mainIn #connect
Ce0 f126 mainOut f45 tail #connect
Ce0 f45 head f124 mainIn #connect
Ce0 f84 mainOut f49 tail #connect
Ce0 f49 head f91 mainIn #connect
Ce0 f89 mainOut f17 tail #connect
Ce0 f17 head f7 in #connect
Ce0 f7 out f19 tail #connect
Ce0 f19 head f84 mainIn #connect
Ce0 f91 mainOut f56 tail #connect
Ce0 f56 head f55 mainIn #connect
Ce0 f55 mainOut f57 tail #connect
Ce0 f57 head f93 mainIn #connect
Ce0 f7 out f58 tail #connect
Ce0 f58 head f55 mainIn #connect
Ce0 f9 mainOut f66 tail #connect
Ce0 f66 head f62 in #connect
Ce0 f62 out f23 tail #connect
Ce0 f23 head f13 mainIn #connect
Ce0 f13 mainOut f71 tail #connect
Ce0 f71 head f4 mainIn #connect
Ce0 f69 mainOut f70 tail #connect
Ce0 f70 head f8 mainIn #connect
Ce0 f4 mainOut f51 tail #connect
Ce0 f51 head f69 mainIn #connect
Ce0 f62 out f72 tail #connect
Ce0 f72 head f69 mainIn #connect
Ce0 f78 mainOut f95 tail #connect
Ce0 f95 head f74 mainIn #connect
Ce0 f79 mainOut f97 tail #connect
Ce0 f97 head f78 mainIn #connect
Ce0 f94 mainOut f100 tail #connect
Ce0 f100 head f79 mainIn #connect
Ce0 f74 mainOut f102 tail #connect
Ce0 f102 head f148 in #connect
Ce0 f119 mainOut f136 tail #connect
Ce0 f136 head f130 mainIn #connect
Ce0 f130 mainOut f131 tail #connect
Ce0 f131 head f116 in #connect
Ce0 f128 mainOut f134 tail #connect
Ce0 f134 head f116 in #connect
Ce0 f116 out f149 tail #connect
Ce0 f149 head f129 mainIn #connect
Ce0 f114 mainOut f145 tail #connect
Ce0 f145 head f128 mainIn #connect
Ce0 f127 mainOut f150 tail #connect
Ce0 f150 head f119 mainIn #connect
Ce0 f115 mainOut f151 tail #connect
Ce0 f151 head f113 mainIn #connect
Ce0 f129 mainOut f146 tail #connect
Ce0 f146 head f104 in #connect
Ce0 f104 out f147 tail #connect
Ce0 f147 head f115 mainIn #connect
Ce0 f111 mainOut f142 tail #connect
Ce0 f142 head f127 mainIn #connect
Ce0 f104 out f143 tail #connect
Ce0 f143 head f111 mainIn #connect
Ce0 f116 out f152 tail #connect
Ce0 f152 head f148 in #connect
Ce0 f156 mainOut f171 tail #connect
Ce0 f171 head f162 mainIn #connect
Ce0 f162 mainOut f184 tail #connect
Ce0 f184 head f157 in #connect
Ce0 f163 mainOut f177 tail #connect
Ce0 f177 head f157 in #connect
Ce0 f157 out f180 tail #connect
Ce0 f180 head f153 mainIn #connect
Ce0 f154 mainOut f164 tail #connect
Ce0 f164 head f163 mainIn #connect
Ce0 f158 mainOut f185 tail #connect
Ce0 f185 head f156 mainIn #connect
Ce0 f160 mainOut f165 tail #connect
Ce0 f165 head f161 mainIn #connect
Ce0 f153 mainOut f175 tail #connect
Ce0 f175 head f159 in #connect
Ce0 f159 out f172 tail #connect
Ce0 f172 head f160 mainIn #connect
Ce0 f155 mainOut f166 tail #connect
Ce0 f166 head f158 mainIn #connect
Ce0 f159 out f176 tail #connect
Ce0 f176 head f155 mainIn #connect
Ce0 f157 out f186 tail #connect
Ce0 f186 head f148 in #connect
Ce0 f194 mainOut f201 tail #connect
Ce0 f201 head f195 mainIn #connect
Ce0 f195 mainOut f199 tail #connect
Ce0 f199 head f197 in #connect
Ce0 f193 mainOut f200 tail #connect
Ce0 f200 head f197 in #connect
Ce0 f197 out f198 tail #connect
Ce0 f198 head f192 mainIn #connect
Ce0 f187 mainOut f206 tail #connect
Ce0 f206 head f193 mainIn #connect
Ce0 f189 mainOut f204 tail #connect
Ce0 f204 head f194 mainIn #connect
Ce0 f188 mainOut f203 tail #connect
Ce0 f203 head f196 mainIn #connect
Ce0 f192 mainOut f205 tail #connect
Ce0 f205 head f190 in #connect
Ce0 f190 out f207 tail #connect
Ce0 f207 head f188 mainIn #connect
Ce0 f196 mainOut f202 tail #connect
Ce0 f202 head f191 mainIn #connect
Ce0 f191 mainOut f208 tail #connect
Ce0 f208 head f189 mainIn #connect
Ce0 f190 out f209 tail #connect
Ce0 f209 head f191 mainIn #connect
Ce0 f197 out f210 tail #connect
Ce0 f210 head f148 in #connect
Ce0 f113 mainOut f212 tail #connect
Ce0 f212 head f211 mainIn #connect
Ce0 f211 mainOut f137 tail #connect
Ce0 f137 head f111 mainIn #connect
Ce0 f161 mainOut f214 tail #connect
Ce0 f214 head f213 mainIn #connect
Ce0 f213 mainOut f182 tail #connect
Ce0 f182 head f155 mainIn #connect
