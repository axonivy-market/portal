<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:pc="http://xmlns.jcp.org/jsf/composite/components">

<cc:interface componentType="IvyComponent">
  <!-- autoComplete attributes -->
  <cc:attribute name="componentId" default="role-selection"
    shortDescription="Unique identifier of this component instance. Type: String. Default value: 'role-selection'. Required: false." />
  <cc:attribute name="selectedRole" type="com.axonivy.portal.components.dto.RoleDTO" required="true"
    shortDescription="Holds the selected role value. Type: com.axonivy.portal.components.dto.RoleDTO. Required: true." />
  <cc:attribute name="fromRoleNames" type="java.util.List"
    shortDescription="List of parent role names. Only child roles of these roles are loaded. Leave empty to load all roles. Type: java.util.List&lt;String&gt;. Required: false." />
  <cc:attribute name="excludedRoleNames" type="java.util.List"
    shortDescription="List of role names to exclude from selection. Only applies when using the default completeMethod. Type: java.util.List&lt;String&gt;. Required: false." />
  <cc:attribute name="requiredMessage"
    default="#{ivy.cms.co('/Dialogs/com/axonivy/portal/components/Common/RequiredFieldMessage')}"
    shortDescription="Validation message displayed when the required field is empty. Type: String. Default value: 'This field is required'. Required: false." />
  <cc:attribute name="forceSelection" default="true"
    shortDescription="When enabled, only roles from the suggestion list can be selected. Type: boolean. Default value: true. Required: false." />
  <cc:attribute name="minQueryLength" default="1"
    shortDescription="Text displayed for roles in the dropdown and the selected value. Type: String. Default value: #{role.getDisplayName() != '' ? role.getDisplayName() : role.getMemberName()}. Required: false." />
  <cc:attribute name="scrollHeight" default="390" shortDescription="Maximum height of the autocomplete dropdown panel. Type: int. Default value: 390. Required: false." />
  <cc:attribute name="inputStyleClass" shortDescription="CSS style class applied to the role autocomplete input field. Type: String. Required: false." />
  <cc:attribute name="autoCompleteStyleClass" shortDescription="CSS style class applied to the role autocomplete component. Type: String. Required: false." />
  <cc:attribute name="autoCompletePanelStyleClass" shortDescription="CSS style class applied to the role autocomplete dropdown panel. Type: String. Required: false." />
  <cc:attribute name="completeMethod" method-signature="java.util.List completeMethod(java.lang.String)" 
    shortDescription="Custom method for loading roles. Must accept a String query and return List&lt;RoleDTO&gt;. Type: Method Expression. Default value: completeRole. Required: false."/>
  <cc:attribute name="cache" default="true"
    shortDescription="Caches autocomplete search results when enabled. Type: boolean. Default value: true. Required: false." />
  <cc:attribute name="moreText" default="#{ivy.cms.co('/Dialogs/com/axonivy/portal/components/Common/More')}..." shortDescription="Text displayed for the 'More' link when results exceed the limit. Type: String. Default value: More.... Required: false." />
  <cc:attribute name="queryDelay" default="300" shortDescription="Delay in milliseconds before sending the search query. Type: int. Default value: 300. Required: false." />
  <cc:attribute name="maxResults" default="100" type="java.lang.Integer" shortDescription="Maximum number of results displayed in the dropdown. Type: int. Default value: 100. Required: false." />
  <cc:attribute name="hasCustomizedSelectionList" default="false" shortDescription="Displays a customized selection list when enabled. Type: boolean. Default value: false. Required: false." />
  <cc:attribute name="emptyMessage" shortDescription="Message displayed when no results are available. Type: String. Default value: No results. Required: false."
    default="#{ivy.cms.co('/Labels/NoResults')}" />
  <!-- Avatar in Selection list attributes  -->
  <cc:attribute name="isShowAvatarInSelectionList" default="#{portalComponentAvatarBean.getPortalShowAvatarSettingOrDefault(true)}"
    shortDescription="Displays role avatars in the selection list when enabled. Type: boolean. Default value: true. Required: false." />
  <cc:attribute name="displayNameRenderedInSelectionList" default="true"
    shortDescription="Controls visibility of the role display name in the selection list. Type: boolean. Default value: true. Required: false." />
  <cc:attribute name="displayNameInSelectionListStyleClass"
    shortDescription="CSS style class for the role display name in the selection list. Type: String. Required: false." />
  <cc:attribute name="selectionListContainerStyleClass"
    shortDescription="CSS style class for the selection list item container. Type: String. Required: false." />

  <!-- Label attributes -->
  <cc:attribute name="label" shortDescription="Label text for the role selection component. Type: String. Required: false." />
  <cc:attribute name="floatingLabel"
    shortDescription="Displays the label using floating style. Type: boolean. Default value: false. Required: false." />
  <cc:attribute name="labelStyleClass" shortDescription="CSS style class applied to the label. Type: String. Required: false." />
  <cc:attribute name="appendOption" shortDescription="Additional information appended to the role display, such as parent role name or none. Value: NONE, PARENT_NAME. Type: String. Required: false." />
  <!-- Message attributes -->
  <cc:attribute name="isRenderedMessage" default="true"
    shortDescription="Controls whether validation messages are rendered. Type: boolean. Default value: true. Required: false." />
  <cc:attribute name="messageStyleClass" shortDescription="CSS style class applied to the validation message. Type: String. Required: false." />
</cc:interface>

<cc:implementation>
  <h:outputStylesheet library="css" name="role-selection-component.css" />

  <c:set var="completeMethod" value="#{not empty cc.attrs.completeMethod ? cc.attrs.completeMethod : roleSelectionBean.completeRoleMethod}" />

  <h:panelGroup id="#{cc.attrs.componentId}-autocomplete-panel" layout="block"
    styleClass="pl-0 flex flex-column gap-3 ui-fluid #{cc.attrs.autoCompletePanelStyleClass} #{cc.attrs.floatingLabel ? 'ui-float-label' : ''}">

    <p:outputLabel id="#{cc.attrs.componentId}-label" value="#{cc.attrs.label}" for="#{cc.attrs.componentId}"
      styleClass="#{cc.attrs.labelStyleClass}" rendered="#{not empty cc.attrs.label and !cc.attrs.floatingLabel}" />

    <p:autoComplete id="#{cc.attrs.componentId}"
      value="#{cc.attrs.selectedRole}"
      scrollHeight="#{cc.attrs.scrollHeight}"
      completeMethod="#{completeMethod}"
      required="#{cc.attrs.isRequired}"
      var="role"
      size="#{cc.attrs.size}"
      itemValue="#{role}"
      itemLabel="#{cc.attrs.itemLabel}"
      forceSelection="#{cc.attrs.forceSelection}"
      minQueryLength="#{cc.attrs.minQueryLength}"
      styleClass="#{cc.attrs.autoCompleteStyleClass}"
      autoHighlight="#{cc.attrs.hightlight}"
      converter="pojoConverter"
      cache="#{cc.attrs.cache}"
      dynamic="true"
      dropdown="true"
      disabled="#{cc.attrs.isDisabled}"
      readonly="#{cc.attrs.isReadOnly}"
      requiredMessage="#{cc.attrs.requiredMessage}"
      moreText="#{cc.attrs.moreText}"
      queryDelay="#{cc.attrs.queryDelay}"
      maxResults="#{cc.attrs.maxResults}"
      emptyMessage="#{cc.attrs.emptyMessage}"
      inputStyleClass="#{cc.attrs.inputStyleClass}">
      <p:column rendered="#{!cc.attrs.hasCustomizedSelectionList}">
        <pc:securityMemberNameAndAvatar displayName="#{cc.attrs.appendOption eq 'PARENT_NAME' ? role.roleWithParentName : role.displayName}" securityMember="#{role}" isStandAlone="false"
          isShowAvatar="#{cc.attrs.isShowAvatarInSelectionList}" displayNameRendered="#{cc.attrs.displayNameRenderedInSelectionList}"
          displayNameStyleClass="#{cc.attrs.displayNameInSelectionListStyleClass}" containerStyleClass="#{cc.attrs.selectionListContainerStyleClass}" />
      </p:column>
      <cc:insertFacet name="event" />
      <cc:insertChildren />
    </p:autoComplete>

    <p:message id="#{cc.attrs.componentId}-message"
      for="#{cc.attrs.componentId}" rendered="#{cc.attrs.isRenderedMessage}" styleClass="m-0 ml-2"/>

    <p:outputLabel id="#{cc.attrs.componentId}-floating-label"
      value="#{cc.attrs.label}"
      for="#{cc.attrs.componentId}"
      styleClass="#{cc.attrs.labelStyleClass}"
      rendered="#{cc.attrs.floatingLabel}" />
  </h:panelGroup>
  <h:outputScript name="theme-checker.js" library="js" />
  <script type="text/javascript">
    ThemeChecker.updateLayoutByTheme('#{ivyPrimefacesThemeResolver.sessionTheme}');
  </script>
</cc:implementation>
</html>