{
  "format" : "10.0.0",
  "id" : "1549F58C18A6C562",
  "config" : {
    "data" : "ch.ivy.addon.portal.generic.PortalStartData"
  },
  "elements" : [ {
      "id" : "S41",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S41-f168",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 320, "y" : 224 }
          }
        }, {
          "id" : "S41-f165",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S41-f1", "to" : "S41-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.isAuthorized" },
            { "id" : "S41-f170", "to" : "S41-f168", "label" : {
                "name" : "No",
                "segment" : 0.53
              } }
          ]
        }, {
          "id" : "S41-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f172",
          "connect" : { "id" : "S41-f3", "to" : "S41-f2" }
        }, {
          "id" : "S41-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 488, "y" : 144 }
          },
          "parentConnector" : "f196"
        }, {
          "id" : "S41-f2",
          "type" : "Script",
          "name" : "Init isAuthorized",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.enums.PortalPermission;",
                "import ch.ivy.addon.portalkit.util.PermissionUtils;",
                "in.isAuthorized = PermissionUtils.hasPortalPermission(PortalPermission.TASK_CASE_SHOW_MORE_NOTE) && in.#caseSelected is initialized;"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 192, "y" : 144 }
          },
          "connect" : { "id" : "S41-f0", "to" : "S41-f165" }
        } ],
      "visual" : {
        "at" : { "x" : 384, "y" : 2784 }
      },
      "connect" : { "id" : "f196", "to" : "f143" }
    }, {
      "id" : "S32",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S32-f167",
          "type" : "Script",
          "name" : "Init isAuthorized",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.util.PermissionUtils;",
                "import ch.ivy.addon.portalkit.enums.PortalPermission;",
                "",
                "in.isAuthorized = PermissionUtils.hasPermission(PortalPermission.STATISTIC_ANALYZE_TASK.getPermission());"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 176, "y" : 160 }
          },
          "connect" : { "id" : "S32-f170", "to" : "S32-f165" }
        }, {
          "id" : "S32-f79",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 296, "y" : 240 }
          }
        }, {
          "id" : "S32-f165",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 296, "y" : 160 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S32-f1", "to" : "S32-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.isAuthorized" },
            { "id" : "S32-f161", "to" : "S32-f79", "label" : {
                "name" : "No",
                "segment" : 0.55,
                "offset" : { "x" : 11, "y" : -13 }
              } }
          ]
        }, {
          "id" : "S32-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 160 }
          },
          "parentConnector" : "f171",
          "connect" : { "id" : "S32-f0", "to" : "S32-f167" }
        }, {
          "id" : "S32-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 448, "y" : 160 }
          },
          "parentConnector" : "f194"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 3024 }
      },
      "connect" : { "id" : "f194", "to" : "f166" }
    }, {
      "id" : "S22",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S22-f79",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S22-f1", "to" : "S22-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.isAuthorized" },
            { "id" : "S22-f212", "to" : "S22-f196", "label" : {
                "name" : "No"
              } }
          ]
        }, {
          "id" : "S22-f196",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 320, "y" : 224 }
          }
        }, {
          "id" : "S22-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f213",
          "connect" : { "id" : "S22-f3", "to" : "S22-f2" }
        }, {
          "id" : "S22-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 456, "y" : 144 }
          },
          "parentConnector" : "f217"
        }, {
          "id" : "S22-f2",
          "type" : "Script",
          "name" : "Init isAuthorized",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.enums.PortalPermission;",
                "import ch.ivy.addon.portalkit.util.PermissionUtils;",
                "in.isAuthorized = PermissionUtils.hasPortalPermission(PortalPermission.SHOW_CASE_DETAILS)",
                "  && in.#caseSelected is initialized;"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 192, "y" : 144 }
          },
          "connect" : { "id" : "S22-f0", "to" : "S22-f79" }
        } ],
      "visual" : {
        "at" : { "x" : 384, "y" : 2944 }
      },
      "connect" : { "id" : "f217", "to" : "f156" }
    }, {
      "id" : "S12",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S12-f194",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 216 }
          }
        }, {
          "id" : "S12-f218",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -24 }
          },
          "connect" : [
            { "id" : "S12-f2", "to" : "S12-g2", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.util.PermissionUtils.checkAccessFullProcessListPermission()" },
            { "id" : "S12-f196", "to" : "S12-f194", "label" : {
                "name" : "No"
              } }
          ]
        }, {
          "id" : "S12-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 152, "y" : 64 }
          },
          "parentConnector" : "f197",
          "connect" : { "id" : "S12-f0", "to" : "S12-f218" }
        }, {
          "id" : "S12-g1",
          "type" : "EmbeddedStart",
          "name" : "in 2",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f198",
          "connect" : { "id" : "S12-f1", "to" : "S12-f218" }
        }, {
          "id" : "S12-g2",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 }
          },
          "parentConnector" : "f211"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 1424 }
      },
      "connect" : { "id" : "f211", "to" : "f71" }
    }, {
      "id" : "S01",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S01-f266",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 224 }
          }
        }, {
          "id" : "S01-f264",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S01-f1", "to" : "S01-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.util.PermissionUtils.isSessionUserHasAdminRole()" },
            { "id" : "S01-f267", "to" : "S01-f266", "label" : {
                "name" : "No",
                "segment" : 0.4
              } }
          ]
        }, {
          "id" : "S01-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f191",
          "connect" : { "id" : "S01-f0", "to" : "S01-f264" }
        }, {
          "id" : "S01-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 }
          },
          "parentConnector" : "f192"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 3344 }
      },
      "connect" : { "id" : "f192", "to" : "f137" }
    }, {
      "id" : "S91",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S91-f250",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 320, "y" : 224 }
          }
        }, {
          "id" : "S91-f248",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S91-f1", "to" : "S91-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.isAuthorized" },
            { "id" : "S91-f251", "to" : "S91-f250", "label" : {
                "name" : "No",
                "segment" : 0.4
              } }
          ]
        }, {
          "id" : "S91-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f189",
          "connect" : { "id" : "S91-f3", "to" : "S91-f2" }
        }, {
          "id" : "S91-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 488, "y" : 144 }
          },
          "parentConnector" : "f190"
        }, {
          "id" : "S91-f2",
          "type" : "Script",
          "name" : "Init isAuthorized",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.ivydata.service.impl.CaseService;",
                "import ch.ivy.addon.portalkit.enums.GlobalVariable;",
                "import ch.ivy.addon.portalkit.service.GlobalSettingService;",
                "",
                "in.isAuthorized = !GlobalSettingService.getInstance().findGlobalSettingValueAsBoolean(GlobalVariable.HIDE_CASE_DOCUMENT)",
                "  && CaseService.newInstance().isCaseAccessible(in.caseId);"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 192, "y" : 144 }
          },
          "connect" : { "id" : "S91-f0", "to" : "S91-f248" }
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 3264 }
      },
      "connect" : { "id" : "f190", "to" : "f237" }
    }, {
      "id" : "S81",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S81-f252",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 272, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S81-f1", "to" : "S81-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.isAuthorized" },
            { "id" : "S81-f255", "to" : "S81-f254", "label" : {
                "name" : "No",
                "segment" : 0.45
              } }
          ]
        }, {
          "id" : "S81-f254",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 272, "y" : 224 }
          }
        }, {
          "id" : "S81-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f186",
          "connect" : { "id" : "S81-f4", "to" : "S81-f2" }
        }, {
          "id" : "S81-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 400, "y" : 144 }
          },
          "parentConnector" : "f187"
        }, {
          "id" : "S81-f2",
          "type" : "Script",
          "name" : "Init isAuthorized",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.ivydata.service.impl.TaskService;",
                "import ch.ivy.addon.portalkit.enums.GlobalVariable;",
                "import ch.ivy.addon.portalkit.service.GlobalSettingService;",
                "",
                "in.isAuthorized = !GlobalSettingService.getInstance().findGlobalSettingValueAsBoolean(GlobalVariable.HIDE_TASK_DOCUMENT)",
                "  && TaskService.newInstance().isTaskAccessible(in.taskId);"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 168, "y" : 144 }
          },
          "connect" : { "id" : "S81-f3", "to" : "S81-f252" }
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 3184 }
      },
      "connect" : { "id" : "f187", "to" : "f232" }
    }, {
      "id" : "S72",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S72-f262",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 320, "y" : 224 }
          }
        }, {
          "id" : "S72-f260",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S72-f1", "to" : "S72-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.isAuthorized" },
            { "id" : "S72-f263", "to" : "S72-f262", "label" : {
                "name" : "No",
                "segment" : 0.56
              } }
          ]
        }, {
          "id" : "S72-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f173",
          "connect" : { "id" : "S72-f3", "to" : "S72-f2" }
        }, {
          "id" : "S72-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 456, "y" : 144 }
          },
          "parentConnector" : "f185"
        }, {
          "id" : "S72-f2",
          "type" : "Script",
          "name" : "Init isAuthorized",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.util.PermissionUtils;",
                "in.isAuthorized = in.isPublicDashboard ? PermissionUtils.hasDashboardWritePublicPermission() ",
                "  : PermissionUtils.hasDashboardWriteOwnPermission();"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 192, "y" : 144 }
          },
          "connect" : { "id" : "S72-f0", "to" : "S72-f260" }
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 2464 }
      },
      "connect" : { "id" : "f185", "to" : "f193" }
    }, {
      "id" : "S61",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S61-f256",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 },
            "labelOffset" : { "x" : 24, "y" : -16 }
          },
          "connect" : [
            { "id" : "S61-f1", "to" : "S61-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.isAuthorized" },
            { "id" : "S61-f259", "to" : "S61-f258", "label" : {
                "name" : "No"
              } }
          ]
        }, {
          "id" : "S61-f258",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 320, "y" : 224 }
          }
        }, {
          "id" : "S61-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f131",
          "connect" : { "id" : "S61-f3", "to" : "S61-f2" }
        }, {
          "id" : "S61-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 456, "y" : 144 }
          },
          "parentConnector" : "f184"
        }, {
          "id" : "S61-f2",
          "type" : "Script",
          "name" : "Init isAuthorized",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.util.PermissionUtils;",
                "in.isAuthorized = PermissionUtils.hasDashboardWriteOwnPermission()",
                "  || PermissionUtils.hasDashboardWritePublicPermission();"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 192, "y" : 144 }
          },
          "connect" : { "id" : "S61-f0", "to" : "S61-f256" }
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 2384 }
      },
      "connect" : { "id" : "f184", "to" : "f243" }
    }, {
      "id" : "S51",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S51-f186",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 224 }
          }
        }, {
          "id" : "S51-f184",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S51-f1", "to" : "S51-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.ivydata.service.impl.CaseService.newInstance().isCaseAccessible(in.caseId)" },
            { "id" : "S51-f187", "to" : "S51-f186", "label" : {
                "name" : "No",
                "segment" : 0.43
              } }
          ]
        }, {
          "id" : "S51-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f98",
          "connect" : { "id" : "S51-f0", "to" : "S51-f184" }
        }, {
          "id" : "S51-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 288, "y" : 144 }
          },
          "parentConnector" : "f183"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 2224 }
      },
      "connect" : { "id" : "f183", "to" : "f122" }
    }, {
      "id" : "S40",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S40-f246",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 224 }
          }
        }, {
          "id" : "S40-f244",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S40-f1", "to" : "S40-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.ivydata.service.impl.TaskService.newInstance().isTaskAccessible(in.selectedTaskId)" },
            { "id" : "S40-f247", "to" : "S40-f246", "label" : {
                "name" : "No"
              } }
          ]
        }, {
          "id" : "S40-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f96",
          "connect" : { "id" : "S40-f0", "to" : "S40-f244" }
        }, {
          "id" : "S40-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 288, "y" : 144 }
          },
          "parentConnector" : "f182"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 2064 }
      },
      "connect" : { "id" : "f182", "to" : "f95" }
    }, {
      "id" : "S31",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S31-f194",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S31-f1", "to" : "S31-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.ivydata.service.impl.CaseService.newInstance().isCaseAccessible(in.caseId)" },
            { "id" : "S31-f197", "to" : "S31-f196", "label" : {
                "name" : "No",
                "segment" : 0.54
              } }
          ]
        }, {
          "id" : "S31-f196",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 216 }
          }
        }, {
          "id" : "S31-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f53",
          "connect" : { "id" : "S31-f0", "to" : "S31-f194" }
        }, {
          "id" : "S31-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 288, "y" : 144 }
          },
          "parentConnector" : "f181"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 1984 }
      },
      "connect" : { "id" : "f181", "to" : "f56" }
    }, {
      "id" : "S21",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S21-f191",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 216 }
          }
        }, {
          "id" : "S21-f189",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S21-f1", "to" : "S21-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.ivydata.service.impl.CaseService.newInstance().isCaseAccessible(in.caseId)" },
            { "id" : "S21-f192", "to" : "S21-f191", "label" : {
                "name" : "No",
                "segment" : 0.54
              } }
          ]
        }, {
          "id" : "S21-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f66",
          "connect" : { "id" : "S21-f0", "to" : "S21-f189" }
        }, {
          "id" : "S21-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 288, "y" : 144 }
          },
          "parentConnector" : "f180"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 1904 }
      },
      "connect" : { "id" : "f180", "to" : "f52" }
    }, {
      "id" : "S11",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S11-f180",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S11-f1", "to" : "S11-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.ivydata.service.impl.TaskService.newInstance().isTaskAccessible(in.selectedTaskId)" },
            { "id" : "S11-f183", "to" : "S11-f182", "label" : {
                "name" : "No",
                "segment" : 0.39
              } }
          ]
        }, {
          "id" : "S11-f182",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 232 }
          }
        }, {
          "id" : "S11-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f33",
          "connect" : { "id" : "S11-f0", "to" : "S11-f180" }
        }, {
          "id" : "S11-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 }
          },
          "parentConnector" : "f210"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 1184 }
      },
      "connect" : { "id" : "f210", "to" : "f65" }
    }, {
      "id" : "S00",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S00-f281",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 232 }
          }
        }, {
          "id" : "S00-f279",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S00-f1", "to" : "S00-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.util.PermissionUtils.checkAccessFullStatisticsListPermission()" },
            { "id" : "S00-f282", "to" : "S00-f281", "label" : {
                "name" : "No",
                "segment" : 0.56
              } }
          ]
        }, {
          "id" : "S00-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f26",
          "connect" : { "id" : "S00-f0", "to" : "S00-f279" }
        }, {
          "id" : "S00-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 }
          },
          "parentConnector" : "f27"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 944 }
      },
      "connect" : { "id" : "f27", "to" : "f32" }
    }, {
      "id" : "S90",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S90-f26",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S90-f1", "to" : "S90-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.#caseSelected is initialized" },
            { "id" : "S90-f278", "to" : "S90-f277", "label" : {
                "name" : "No",
                "segment" : 0.48
              } }
          ]
        }, {
          "id" : "S90-f277",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 224 }
          }
        }, {
          "id" : "S90-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f15",
          "connect" : { "id" : "S90-f0", "to" : "S90-f26" }
        }, {
          "id" : "S90-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 }
          },
          "parentConnector" : "f209"
        } ],
      "visual" : {
        "at" : { "x" : 384, "y" : 864 }
      },
      "connect" : { "id" : "f209", "to" : "f274" }
    }, {
      "id" : "S50",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S50-f178",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 24, "y" : -24 }
          },
          "connect" : [
            { "id" : "S50-f1", "to" : "S50-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.ivydata.service.impl.CaseService.newInstance().isCaseAccessible(in.caseId)" },
            { "id" : "S50-f176", "to" : "S50-f175", "label" : {
                "name" : "No",
                "segment" : 0.42,
                "offset" : { "x" : 4, "y" : -6 }
              } }
          ]
        }, {
          "id" : "S50-f175",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 224 }
          }
        }, {
          "id" : "S50-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f283",
          "connect" : { "id" : "S50-f0", "to" : "S50-f178" }
        }, {
          "id" : "S50-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 }
          },
          "parentConnector" : "f284"
        } ],
      "visual" : {
        "at" : { "x" : 240, "y" : 1104 }
      },
      "connect" : { "id" : "f284", "to" : "f59" }
    }, {
      "id" : "f10",
      "type" : "RequestStart",
      "name" : "DefaultEndPage.ivp",
      "config" : {
        "callSignature" : "DefaultEndPage",
        "input" : {
          "params" : [
            { "name" : "endedTaskId", "type" : "Number" }
          ],
          "map" : {
            "out.endedTaskId" : "param.endedTaskId"
          }
        },
        "outLink" : "DefaultEndPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 384 },
        "labelOffset" : { "x" : -23, "y" : 41 }
      },
      "connect" : { "id" : "f7", "to" : "f4" }
    }, {
      "id" : "f11",
      "type" : "Script",
      "name" : "Handle end page",
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.ivydata.service.impl.TaskService;",
            "import ch.ivy.addon.portalkit.constant.CustomFields;",
            "import ch.ivy.addon.portalkit.dto.TaskEndInfo;",
            "import ch.ivy.addon.portalkit.service.StickyTaskListService;",
            "import ch.ivy.addon.portalkit.enums.SessionAttribute;",
            "import ch.ivy.addon.portalkit.util.SecurityServiceUtils;",
            "import ch.ivy.addon.portalkit.enums.PortalPage;",
            "import org.apache.commons.lang3.StringUtils;",
            "import ch.ivyteam.ivy.workflow.ITask;",
            "",
            "ITask task = TaskService.newInstance().findTaskById(in.endedTaskId);",
            "in.isFirstTask = true;",
            "in.portalPage = PortalPage.HOME_PAGE;",
            "",
            "if (#task is initialized) {",
            "  in.isTaskFinished = task.getEndTimestamp() is initialized;",
            "  ",
            "  ITask taskWithTaskEndInfo = null;",
            "  if (task.getStartSwitchEvent() is initialized) {",
            "    taskWithTaskEndInfo = StickyTaskListService.service().getPreviousTaskWithTaskEndInfo(task);",
            "  }",
            "",
            "  if (#taskWithTaskEndInfo is initialized) {",
            "    in.isFirstTask = false;",
            "    String taskEndInfoSessionAttributeKey = StickyTaskListService.service().getTaskEndInfoSessionAttributeKey(taskWithTaskEndInfo.getId());",
            "    TaskEndInfo taskEndInfo = SecurityServiceUtils.getSessionAttribute(taskEndInfoSessionAttributeKey) as TaskEndInfo;",
            "      ",
            "    in.dataModel = taskEndInfo.dataModel;",
            "    in.isTaskStartedInDetails = taskEndInfo.isStartedInTaskDetails;",
            "    in.portalPage = taskEndInfo.portalPage;",
            "    if (!in.isTaskStartedInDetails || in.backFromTaskDetails) {",
            "      SecurityServiceUtils.removeSessionAttribute(taskEndInfoSessionAttributeKey);",
            "    }",
            "    ",
            "    if (in.isTaskFinished) {",
            "      in.callbackUrl = taskWithTaskEndInfo.customFields().stringField(CustomFields.EXPRESS_END_PAGE_URL.toString()).getOrDefault(\"\");",
            "    }",
            "  }",
            "  in.caseSelected = task.getCase();",
            "} else {",
            "  Boolean isTaskFinished = SecurityServiceUtils.getSessionAttribute(SessionAttribute.IS_TASK_FINISHED.toString()).toBoolean();",
            "  in.isTaskFinished = #isTaskFinished is initialized ? isTaskFinished : true;",
            "}",
            "",
            "SecurityServiceUtils.removeSessionAttribute(SessionAttribute.IS_TASK_FINISHED.toString());",
            "ivy.session.setAttribute(SessionAttribute.IS_TASK_STARTED_IN_DETAILS.toString(), in.isTaskStartedInDetails);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 528, "y" : 384 }
      },
      "connect" : { "id" : "f2", "to" : "f1" }
    }, {
      "id" : "f28",
      "type" : "RequestStart",
      "name" : "DefaultApplicationHomePage.ivp",
      "config" : {
        "callSignature" : "DefaultApplicationHomePage",
        "case" : {
          "name" : "<%=ivy.cms.co(\"/Processes/Cases/PortalCategory\")%>: <%=ivy.cms.co(\"/Processes/portalSettingSaved\")%>",
          "description" : "<%=ivy.cms.co(\"/Processes/Cases/PortalInternalProcess/PortalInternalProcessDescription\")%>",
          "category" : "<%=ivy.cms.co(\"/Processes/Cases/PortalCategory\")%>"
        },
        "outLink" : "DefaultApplicationHomePage.ivp",
        "startCustomFields" : [
          { "name" : "cssIcon", "value" : "si si-layout-dashboard" },
          { "name" : "embedInFrame", "value" : "false" }
        ],
        "task" : {
          "name" : "<%=ivy.cms.co(\"/Processes/Cases/PortalCategory\")%>: <%=ivy.cms.co(\"/Processes/portalSettingSaved\")%>",
          "description" : "<%=ivy.cms.co(\"/Processes/Cases/PortalInternalProcess/PortalInternalProcessDescription\")%>",
          "category" : "<%=ivy.cms.co(\"/Processes/Cases/PortalCategory\")%>"
        },
        "startName" : "<%=ivy.cms.co(\"/Processes/portalHome\")%>"
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 224 },
        "labelOffset" : { "x" : -55, "y" : 41 }
      },
      "connect" : { "id" : "f204", "to" : "f203" }
    }, {
      "id" : "f57",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 632, "y" : 624 }
      }
    }, {
      "id" : "f58",
      "type" : "RequestStart",
      "name" : "CaseListPage.ivp",
      "config" : {
        "callSignature" : "CaseListPage",
        "outLink" : "CaseListPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 624 },
        "labelOffset" : { "x" : -15, "y" : 41 }
      },
      "connect" : { "id" : "f175", "to" : "S71" }
    }, {
      "id" : "f103",
      "type" : "RequestStart",
      "name" : "CaseDetailsPage.ivp",
      "config" : {
        "callSignature" : "CaseDetailsPage",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" }
          ],
          "map" : {
            "out.caseId" : "param.caseId"
          }
        },
        "outLink" : "CaseDetailsPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 864 },
        "labelOffset" : { "x" : -23, "y" : 33 }
      },
      "connect" : { "id" : "f275", "to" : "f272" }
    }, {
      "id" : "f63",
      "type" : "RequestStart",
      "name" : "DefaultTaskListPage.ivp",
      "config" : {
        "callSignature" : "DefaultTaskListPage",
        "outLink" : "DefaultTaskListPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 784 },
        "labelOffset" : { "x" : -31, "y" : 41 }
      },
      "connect" : { "id" : "f178", "to" : "S80" }
    }, {
      "id" : "f105",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 776, "y" : 864 }
      }
    }, {
      "id" : "f64",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 632, "y" : 784 }
      }
    }, {
      "id" : "f9",
      "type" : "SubProcessCall",
      "name" : "InitializeTaskDataModel",
      "config" : {
        "processCall" : "Functional Processes/InitializeTaskDataModel:call()",
        "output" : {
          "map" : {
            "out" : "in",
            "out.dataModel" : "result.dataModel",
            "out.dataModel.compactMode" : "true"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 886, "y" : 225 },
        "size" : { "width" : 253, "height" : 63 }
      },
      "connect" : { "id" : "f16", "to" : "f0" }
    }, {
      "id" : "f1",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 632, "y" : 384 }
      },
      "connect" : [
        { "id" : "f30", "to" : "f22", "condition" : "in.#portalPage == null" },
        { "id" : "f36", "to" : "S70", "condition" : "!in.backFromTaskDetails" },
        { "id" : "f19", "to" : "f5", "via" : [ { "x" : 632, "y" : 432 }, { "x" : 1048, "y" : 432 } ] }
      ]
    }, {
      "id" : "f0",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 1048, "y" : 224 }
      },
      "connect" : [
        { "id" : "f92", "to" : "S60" }
      ]
    }, {
      "id" : "f5",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 1048, "y" : 384 }
      },
      "connect" : [
        { "id" : "f20", "to" : "f0", "condition" : "java.util.Objects.equals(ch.ivy.addon.portalkit.enums.PortalPage.HOME_PAGE, in.#portalPage) && org.apache.commons.lang3.StringUtils.isBlank(in.#callbackUrl)" },
        { "id" : "f18", "to" : "S10" }
      ]
    }, {
      "id" : "f14",
      "type" : "RequestStart",
      "name" : "BackFromTaskDetails.ivp",
      "config" : {
        "callSignature" : "BackFromTaskDetails",
        "input" : {
          "params" : [
            { "name" : "endedTaskId", "type" : "Number" }
          ],
          "map" : {
            "out.backFromTaskDetails" : "true",
            "out.endedTaskId" : "param.endedTaskId"
          }
        },
        "outLink" : "BackFromTaskDetails.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 464 },
        "labelOffset" : { "x" : -39, "y" : 41 }
      },
      "connect" : { "id" : "f13", "to" : "f4", "via" : [ { "x" : 384, "y" : 464 } ] }
    }, {
      "id" : "f32",
      "type" : "DialogCall",
      "name" : "Statistic",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.admin.PortalDashBoard",
        "startMethod" : "start()"
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 944 }
      },
      "connect" : { "id" : "f35", "to" : "f34" }
    }, {
      "id" : "f70",
      "type" : "RequestStart",
      "name" : "StatisticPage.ivp",
      "config" : {
        "callSignature" : "StatisticPage",
        "outLink" : "StatisticPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 944 },
        "labelOffset" : { "x" : -15, "y" : 33 }
      },
      "connect" : { "id" : "f26", "to" : "S00" }
    }, {
      "id" : "f34",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 488, "y" : 944 }
      }
    }, {
      "id" : "f39",
      "type" : "RequestStart",
      "name" : "DefaultLoginPage.ivp",
      "config" : {
        "callSignature" : "DefaultLoginPage",
        "input" : {
          "params" : [
            { "name" : "originalUrl", "type" : "String" }
          ],
          "map" : {
            "out.callbackUrl" : "param.#originalUrl is initialized ? param.originalUrl : null"
          }
        },
        "outLink" : "DefaultLoginPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1024 },
        "labelOffset" : { "x" : -23, "y" : 41 }
      },
      "connect" : { "id" : "f42", "to" : "f51" }
    }, {
      "id" : "f51",
      "type" : "Script",
      "name" : [
        "Store portal start ",
        "pmv "
      ],
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.enums.SessionAttribute;",
            "import ch.ivy.addon.portalkit.util.SecurityServiceUtils;",
            "",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.PORTAL_START_PMV_ID.toString(), ivy.task.getProcessModelVersion().getId());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 1024 }
      },
      "connect" : { "id" : "f174", "to" : "f150" }
    }, {
      "id" : "f59",
      "type" : "SubProcessCall",
      "name" : "Functional Processes/Navigator",
      "config" : {
        "processCall" : "Functional Processes/Navigator:viewTask(Long,ch.ivy.addon.portalkit.dto.GlobalCaseId,String)",
        "call" : {
          "params" : [
            { "name" : "taskId", "type" : "Long" },
            { "name" : "caseId", "type" : "ch.ivy.addon.portalkit.dto.GlobalCaseId" },
            { "name" : "caseName", "type" : "String" }
          ],
          "map" : {
            "param.caseId" : "ch.ivy.addon.portalkit.dto.GlobalCaseId.caseId(in.caseId).isBusinessCase(in.isBusinessCase).build()",
            "param.caseName" : "in.caseName"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 456, "y" : 1104 },
        "size" : { "width" : 256, "height" : 60 }
      }
    }, {
      "id" : "f60",
      "type" : "RequestStart",
      "name" : "RelatedTasksOfCasePage.ivp",
      "config" : {
        "callSignature" : "RelatedTasksOfCasePage",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" },
            { "name" : "isBusinessCase", "type" : "Boolean" },
            { "name" : "caseName", "type" : "String" }
          ],
          "map" : {
            "out.caseId" : "param.caseId",
            "out.caseName" : "param.caseName",
            "out.isBusinessCase" : "param.isBusinessCase"
          }
        },
        "outLink" : "RelatedTasksOfCasePage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1104 },
        "labelOffset" : { "x" : -47, "y" : 41 }
      },
      "connect" : { "id" : "f283", "to" : "S50" }
    }, {
      "id" : "f62",
      "type" : "RequestStart",
      "name" : "TaskDetailsPage.ivp",
      "config" : {
        "callSignature" : "TaskDetailsPage",
        "input" : {
          "params" : [
            { "name" : "selectedTaskId", "type" : "Long" }
          ],
          "map" : {
            "out.selectedTaskId" : "param.selectedTaskId"
          }
        },
        "outLink" : "TaskDetailsPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1184 },
        "labelOffset" : { "x" : -23, "y" : 41 }
      },
      "connect" : { "id" : "f33", "to" : "S11" }
    }, {
      "id" : "f65",
      "type" : "SubProcessCall",
      "name" : "Functional Processes/Navigator",
      "config" : {
        "processCall" : "Functional Processes/Navigator:viewRelatedTask(Long,Boolean)",
        "call" : {
          "params" : [
            { "name" : "taskId", "type" : "Long" },
            { "name" : "showItemDetailsHeader", "type" : "Boolean" }
          ],
          "map" : {
            "param.taskId" : "in.selectedTaskId"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 458, "y" : 1183 },
        "size" : { "width" : 260, "height" : 58 }
      }
    }, {
      "id" : "f67",
      "type" : "SubProcessCall",
      "name" : "Functional Processes/OpenPortalSearch",
      "config" : {
        "processCall" : "Functional Processes/OpenPortalSearch:call(String)",
        "call" : {
          "params" : [
            { "name" : "keyword", "type" : "String" }
          ],
          "map" : {
            "param.keyword" : "in.keyword"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 312, "y" : 1263 },
        "size" : { "width" : 260, "height" : 59 }
      }
    }, {
      "id" : "f68",
      "type" : "RequestStart",
      "name" : "GlobalSearchPage.ivp",
      "config" : {
        "callSignature" : "GlobalSearchPage",
        "input" : {
          "params" : [
            { "name" : "keyword", "type" : "String" }
          ],
          "map" : {
            "out.keyword" : "param.keyword"
          }
        },
        "outLink" : "GlobalSearchPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1264 },
        "labelOffset" : { "x" : -31, "y" : 41 }
      },
      "connect" : { "id" : "f69", "to" : "f67" }
    }, {
      "id" : "f71",
      "type" : "DialogCall",
      "name" : "Processes",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.Processes",
        "startMethod" : "start()"
      },
      "visual" : {
        "at" : { "x" : 382, "y" : 1424 }
      }
    }, {
      "id" : "f72",
      "type" : "RequestStart",
      "name" : "Error500Page.ivp",
      "config" : {
        "callSignature" : "Error500Page",
        "outLink" : "Error500Page.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1504 },
        "labelOffset" : { "x" : -15, "y" : 33 }
      },
      "connect" : { "id" : "f77", "to" : "f74" }
    }, {
      "id" : "f73",
      "type" : "RequestStart",
      "name" : "Error404Page.ivp",
      "config" : {
        "callSignature" : "Error404Page",
        "outLink" : "Error404Page.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1584 },
        "labelOffset" : { "x" : -15, "y" : 33 }
      },
      "connect" : { "id" : "f78", "to" : "f75" }
    }, {
      "id" : "f76",
      "type" : "RequestStart",
      "name" : "DefaultProcessStartListPage.ivp",
      "config" : {
        "callSignature" : "DefaultProcessStartListPage",
        "outLink" : "DefaultProcessStartListPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1424 },
        "labelOffset" : { "x" : -55, "y" : 41 }
      },
      "connect" : { "id" : "f198", "to" : "S12" }
    }, {
      "id" : "f74",
      "type" : "DialogCall",
      "name" : "ErrorPage",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.error.ErrorPage",
        "startMethod" : "start(String)",
        "call" : {
          "params" : [
            { "name" : "errorCode", "type" : "String" }
          ],
          "map" : {
            "param.errorCode" : "\"500\""
          }
        }
      },
      "visual" : {
        "at" : { "x" : 238, "y" : 1504 }
      }
    }, {
      "id" : "f75",
      "type" : "DialogCall",
      "name" : "ErrorPage",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.error.ErrorPage",
        "startMethod" : "start(String)",
        "call" : {
          "params" : [
            { "name" : "errorCode", "type" : "String" }
          ],
          "map" : {
            "param.errorCode" : "\"404\""
          }
        }
      },
      "visual" : {
        "at" : { "x" : 238, "y" : 1584 }
      }
    }, {
      "id" : "f80",
      "type" : "Script",
      "name" : " Redirect to task start",
      "config" : {
        "output" : {
          "code" : "ch.ivy.addon.portalkit.util.RequestUtils.redirect(in.callbackUrl);"
        }
      },
      "visual" : {
        "at" : { "x" : 680, "y" : 1744 },
        "size" : { "width" : 128, "height" : 60 }
      }
    }, {
      "id" : "f81",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 488, "y" : 1664 }
      },
      "connect" : [
        { "id" : "f87", "to" : "f84", "condition" : "in.embedInIFrame" },
        { "id" : "f90", "to" : "f80", "via" : [ { "x" : 488, "y" : 1744 } ] }
      ]
    }, {
      "id" : "f82",
      "type" : "RequestStart",
      "name" : "DefaultFramePage.ivp",
      "config" : {
        "callSignature" : "DefaultFramePage",
        "input" : {
          "params" : [
            { "name" : "relativeUrl", "type" : "String" },
            { "name" : "runningTaskId", "type" : "Number" }
          ],
          "map" : {
            "out.callbackUrl" : "param.relativeUrl",
            "out.endedTaskId" : "param.runningTaskId"
          }
        },
        "outLink" : "DefaultFramePage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1664 },
        "labelOffset" : { "x" : -31, "y" : 33 }
      },
      "connect" : { "id" : "f89", "to" : "f83" }
    }, {
      "id" : "f83",
      "type" : "Script",
      "name" : "Check if url is valid",
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivyteam.ivy.workflow.ITask;",
            "import ch.ivyteam.ivy.bpm.error.BpmError;",
            "",
            "ITask task = ivy.wf.findTask(Long.valueOf(in.endedTaskId));",
            "if (!in.callbackUrl.startsWith(task.getApplication().getContextPath())) {",
            "  BpmError.create(\"frame:unsupported:url\").withMessage(\"only relative urls are supported (security reasons)\").throwError();",
            "}"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 1664 }
      },
      "connect" : { "id" : "f88", "to" : "f86" }
    }, {
      "id" : "f84",
      "type" : "DialogCall",
      "name" : "TaskTemplateIFrame",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.iframe.TaskTemplateIFrame",
        "startMethod" : "start(String,Number)",
        "call" : {
          "params" : [
            { "name" : "url", "type" : "String" },
            { "name" : "taskId", "type" : "Number" }
          ],
          "map" : {
            "param.url" : "in.callbackUrl",
            "param.taskId" : "in.endedTaskId"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 680, "y" : 1664 },
        "size" : { "width" : 128, "height" : 60 }
      }
    }, {
      "id" : "f85",
      "type" : "ProcessAnnotation",
      "name" : [
        "If open a process/start in \"embedInFrame\" mode (add to url embedInFrame parameter), ",
        "DefaultFramePage process will run"
      ],
      "visual" : {
        "at" : { "x" : 280, "y" : 1743 },
        "size" : { "width" : 314, "height" : 63 }
      }
    }, {
      "id" : "f86",
      "type" : "Script",
      "name" : "Get embedInIFrame setting",
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.service.IFrameService;",
            "out.embedInIFrame = IFrameService.embedInFrame(in.endedTaskId);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 1664 }
      },
      "connect" : { "id" : "f91", "to" : "f81" }
    }, {
      "id" : "f38",
      "type" : "RequestStart",
      "name" : "UserProfile.ivp",
      "config" : {
        "callSignature" : "UserProfile",
        "case" : {
          "customFields" : [
            { "name" : "embedInFrame", "type" : "String", "value" : "\"false\"" }
          ]
        },
        "outLink" : "UserProfile.ivp",
        "showInStartList" : false,
        "wfuser" : "1"
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1824 },
        "labelOffset" : { "x" : -7, "y" : 41 }
      },
      "connect" : { "id" : "f93", "to" : "f44" }
    }, {
      "id" : "f44",
      "type" : "DialogCall",
      "name" : "UserProfile",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.setting.UserProfile",
        "startMethod" : "start()"
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 1824 }
      },
      "connect" : { "id" : "f46", "to" : "f45" }
    }, {
      "id" : "f45",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 344, "y" : 1824 }
      }
    }, {
      "id" : "f3",
      "type" : "ProcessAnnotation",
      "name" : [
        "Replace by customized ",
        "homepage if you have"
      ],
      "visual" : {
        "at" : { "x" : 1280, "y" : 224 },
        "size" : { "width" : 144, "height" : 44 }
      }
    }, {
      "id" : "f6",
      "type" : "DialogCall",
      "name" : "Login",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.Login",
        "startMethod" : "start(String)",
        "call" : {
          "params" : [
            { "name" : "callbackUrl", "type" : "String" }
          ],
          "map" : {
            "param.callbackUrl" : "in.callbackUrl"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 528, "y" : 1024 }
      }
    }, {
      "id" : "f22",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 632, "y" : 224 }
      },
      "connect" : [
        { "id" : "f50", "to" : "f9", "condition" : "ch.addon.portal.generic.userprofile.homepage.HomepageUtils.isShowLegacyUI()" },
        { "id" : "f141", "to" : "f0", "via" : [ { "x" : 632, "y" : 176 }, { "x" : 1048, "y" : 176 } ] }
      ]
    }, {
      "id" : "f4",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 384, "y" : 384 }
      },
      "connect" : [
        { "id" : "f29", "to" : "f31", "condition" : "ivy.session.isSessionUserUnknown()" },
        { "id" : "f48", "to" : "f11", "label" : {
            "name" : "logged in",
            "segment" : 0.46,
            "offset" : { "x" : -1, "y" : -18 }
          } }
      ]
    }, {
      "id" : "f21",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 384, "y" : 224 }
      },
      "connect" : [
        { "id" : "f49", "to" : "f31", "condition" : "ivy.session.isSessionUserUnknown()" },
        { "id" : "f140", "to" : "f139", "label" : {
            "name" : "logged in",
            "offset" : { "x" : -3, "y" : -18 }
          } }
      ]
    }, {
      "id" : "f31",
      "type" : "Script",
      "name" : [
        "Redirect to",
        "login page"
      ],
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivy.addon.portal.generic.navigation.PortalNavigator;",
            "PortalNavigator.navigateToPortalLoginPage();"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 304 }
      }
    }, {
      "id" : "f12",
      "type" : "RequestStart",
      "name" : "CaseDetailsInIFrame.ivp",
      "config" : {
        "callSignature" : "CaseDetailsInIFrame",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" }
          ],
          "map" : {
            "out.caseId" : "param.caseId"
          }
        },
        "outLink" : "CaseDetailsInIFrame.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1904 },
        "labelOffset" : { "x" : -31, "y" : 41 }
      },
      "connect" : { "id" : "f66", "to" : "S21" }
    }, {
      "id" : "f52",
      "type" : "DialogCall",
      "name" : "CaseInformationInIFrame",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.component.iframe.CaseInformationInIFrame",
        "startMethod" : "start(Long,Boolean)",
        "call" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" },
            { "name" : "showBackButton", "type" : "Boolean" }
          ],
          "map" : {
            "param.caseId" : "in.caseId",
            "param.showBackButton" : "false"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 456, "y" : 1903 },
        "size" : { "width" : 256, "height" : 58 }
      },
      "connect" : { "id" : "f55", "to" : "f54" }
    }, {
      "id" : "f54",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 640, "y" : 1904 }
      }
    }, {
      "id" : "f94",
      "type" : "RequestStart",
      "name" : "RelatedTasksOfCasePageInFrame.ivp",
      "config" : {
        "callSignature" : "RelatedTasksOfCasePageInFrame",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" },
            { "name" : "isBusinessCase", "type" : "Boolean" },
            { "name" : "caseName", "type" : "String" }
          ],
          "map" : {
            "out.caseId" : "param.caseId",
            "out.caseName" : "param.caseName",
            "out.isBusinessCase" : "param.isBusinessCase"
          }
        },
        "outLink" : "RelatedTasksOfCasePageInFrame.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1984 },
        "labelOffset" : { "x" : -71, "y" : 41 }
      },
      "connect" : { "id" : "f53", "to" : "S31" }
    }, {
      "id" : "f56",
      "type" : "SubProcessCall",
      "name" : "Functional Processes/Navigator",
      "config" : {
        "processCall" : "Functional Processes/Navigator:viewTaskInFrame(Long,ch.ivy.addon.portalkit.dto.GlobalCaseId,String)",
        "call" : {
          "params" : [
            { "name" : "taskId", "type" : "Long" },
            { "name" : "caseId", "type" : "ch.ivy.addon.portalkit.dto.GlobalCaseId" },
            { "name" : "caseName", "type" : "String" }
          ],
          "map" : {
            "param.caseId" : "ch.ivy.addon.portalkit.dto.GlobalCaseId.caseId(in.caseId).isBusinessCase(in.isBusinessCase).build()",
            "param.caseName" : "in.caseName"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 458, "y" : 1981 },
        "size" : { "width" : 260, "height" : 66 }
      }
    }, {
      "id" : "f95",
      "type" : "SubProcessCall",
      "name" : "Functional Processes/Navigator",
      "config" : {
        "processCall" : "Functional Processes/Navigator:viewRelatedTaskInFrame(Long)",
        "call" : {
          "params" : [
            { "name" : "taskId", "type" : "Long" }
          ],
          "map" : {
            "param.taskId" : "in.selectedTaskId"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 456, "y" : 2066 },
        "size" : { "width" : 257, "height" : 64 }
      }
    }, {
      "id" : "f97",
      "type" : "RequestStart",
      "name" : "TaskDetailsPageInFrame.ivp",
      "config" : {
        "callSignature" : "TaskDetailsPageInFrame",
        "input" : {
          "params" : [
            { "name" : "selectedTaskId", "type" : "Long" }
          ],
          "map" : {
            "out.selectedTaskId" : "param.selectedTaskId"
          }
        },
        "outLink" : "TaskDetailsPageInFrame.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2064 },
        "labelOffset" : { "x" : -47, "y" : 41 }
      },
      "connect" : { "id" : "f96", "to" : "S40" }
    }, {
      "id" : "f99",
      "type" : "RequestStart",
      "name" : "AbsenceManagement.ivp",
      "config" : {
        "callSignature" : "AbsenceManagement",
        "outLink" : "AbsenceManagement.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2144 },
        "labelOffset" : { "x" : -39, "y" : 33 }
      },
      "connect" : { "id" : "f104", "to" : "f101" }
    }, {
      "id" : "f100",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 488, "y" : 2144 }
      }
    }, {
      "id" : "f101",
      "type" : "DialogCall",
      "name" : "AbsenceManagement",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.setting.AbsenceManagement",
        "startMethod" : "start()"
      },
      "visual" : {
        "at" : { "x" : 312, "y" : 2142 },
        "size" : { "width" : 256, "height" : 56 }
      },
      "connect" : { "id" : "f102", "to" : "f100" }
    }, {
      "id" : "f106",
      "type" : "RequestStart",
      "name" : "PasswordResetPage.ivp",
      "config" : {
        "callSignature" : "PasswordResetPage",
        "input" : {
          "params" : [
            { "name" : "token", "type" : "String" },
            { "name" : "username", "type" : "String" }
          ],
          "map" : {
            "out.passwordResetToken" : "param.token",
            "out.passwordResetUsername" : "param.username"
          }
        },
        "outLink" : "PasswordResetPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2704 },
        "labelOffset" : { "x" : -39, "y" : 33 }
      },
      "connect" : { "id" : "f128", "to" : "f127" }
    }, {
      "id" : "f107",
      "type" : "RequestStart",
      "name" : "ForgotPasswordPage.ivp",
      "config" : {
        "callSignature" : "ForgotPasswordPage",
        "outLink" : "ForgotPasswordPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2544 },
        "labelOffset" : { "x" : -39, "y" : 41 }
      },
      "connect" : { "id" : "f126", "to" : "f125" }
    }, {
      "id" : "f108",
      "type" : "DialogCall",
      "name" : "ForgotPassword",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.ForgotPassword",
        "startMethod" : "start()"
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 2544 }
      }
    }, {
      "id" : "f109",
      "type" : "Script",
      "name" : "Load URL",
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import java.util.Calendar;",
            "import javax.faces.application.FacesMessage;",
            "import javax.faces.context.FacesContext;",
            "import ch.ivy.addon.portalkit.constant.UserProperty;",
            "import ch.ivy.addon.portalkit.util.UserUtils;",
            "import ch.ivyteam.ivy.environment.Ivy;",
            "import org.apache.commons.lang.StringUtils;",
            "import ch.ivyteam.ivy.security.IUser;",
            "in.isValidResetUrl = false;",
            "// TODO check if the ivy Security System is used",
            "// find user by username",
            "IUser user = StringUtils.isNotBlank(in.passwordResetUsername) ? UserUtils.findUserByUsername(in.passwordResetUsername) : null;",
            "in.isValidResetUrl = UserUtils.isValidPasswordResetToken(in.passwordResetToken, user);",
            "if (!in.isValidResetUrl) {",
            "  in.passwordResetMessage = ivy.cms.co(\"/ch.ivy.addon.portalkit.ui.jsf/forgotPassword/invalidResetUrl\");",
            "} else {",
            "  in.passwordResetMessage = \"\";",
            "}"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 2704 }
      },
      "connect" : { "id" : "f111", "to" : "f110" }
    }, {
      "id" : "f110",
      "type" : "DialogCall",
      "name" : "PasswordReset",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.PasswordReset",
        "startMethod" : "start(String,String,Boolean,String)",
        "call" : {
          "params" : [
            { "name" : "token", "type" : "String" },
            { "name" : "username", "type" : "String" },
            { "name" : "isValidResetUrl", "type" : "Boolean" },
            { "name" : "message", "type" : "String" }
          ],
          "map" : {
            "param.token" : "in.passwordResetToken",
            "param.username" : "in.passwordResetUsername",
            "param.isValidResetUrl" : "in.isValidResetUrl",
            "param.message" : "in.passwordResetMessage"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 528, "y" : 2704 }
      }
    }, {
      "id" : "f118",
      "type" : "Script",
      "name" : "Redirect to homepage",
      "config" : {
        "output" : {
          "code" : [
            "import com.axonivy.portal.components.publicapi.PortalNavigatorAPI;",
            "",
            "PortalNavigatorAPI.navigateToPortalHome();"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 456, "y" : 2624 },
        "size" : { "width" : 256, "height" : 60 }
      }
    }, {
      "id" : "f125",
      "type" : "Alternative",
      "name" : "logged in?",
      "visual" : {
        "at" : { "x" : 200, "y" : 2544 },
        "labelOffset" : { "x" : 64, "y" : 17 }
      },
      "connect" : [
        { "id" : "f116", "to" : "f108", "condition" : "ivy.session.isSessionUserUnknown()" },
        { "id" : "f113", "to" : "f118", "via" : [ { "x" : 200, "y" : 2624 } ] }
      ]
    }, {
      "id" : "f127",
      "type" : "Alternative",
      "name" : "logged in?",
      "visual" : {
        "at" : { "x" : 200, "y" : 2704 },
        "labelOffset" : { "x" : 59, "y" : 18 }
      },
      "connect" : [
        { "id" : "f112", "to" : "f109", "condition" : "ivy.session.isSessionUserUnknown()" },
        { "id" : "f115", "to" : "f118", "via" : [ { "x" : 200, "y" : 2624 } ] }
      ]
    }, {
      "id" : "f120",
      "type" : "RequestStart",
      "name" : "DefaultDashboardPage.ivp",
      "config" : {
        "callSignature" : "DefaultDashboardPage",
        "input" : {
          "params" : [
            { "name" : "isShowDashboard", "type" : "Boolean" }
          ],
          "map" : {
            "out.isShowDashboard" : "param.isShowDashboard"
          }
        },
        "outLink" : "DefaultDashboardPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 144 },
        "labelOffset" : { "x" : -39, "y" : 33 }
      },
      "connect" : { "id" : "f47", "to" : "f21", "via" : [ { "x" : 288, "y" : 144 } ] }
    }, {
      "id" : "f122",
      "type" : "SubProcessCall",
      "name" : "Functional Processes/Navigator",
      "config" : {
        "processCall" : "Functional Processes/Navigator:viewCaseItemDetailsInIFrame(ch.ivy.addon.portalkit.dto.GlobalCaseId)",
        "call" : {
          "params" : [
            { "name" : "caseId", "type" : "ch.ivy.addon.portalkit.dto.GlobalCaseId" }
          ],
          "map" : {
            "param.caseId" : "ch.ivy.addon.portalkit.dto.GlobalCaseId.caseId(in.caseId).isBusinessCase(in.isBusinessCase).build()"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 456, "y" : 2223 },
        "size" : { "width" : 256, "height" : 60 }
      }
    }, {
      "id" : "f130",
      "type" : "RequestStart",
      "name" : "CaseDetailsPageInFrame.ivp",
      "config" : {
        "callSignature" : "CaseDetailsPageInFrame",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" },
            { "name" : "isBusinessCase", "type" : "Boolean" }
          ],
          "map" : {
            "out.caseId" : "param.caseId",
            "out.isBusinessCase" : "param.isBusinessCase"
          }
        },
        "outLink" : "CaseDetailsPageInFrame.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2224 },
        "labelOffset" : { "x" : -47, "y" : 41 }
      },
      "connect" : { "id" : "f98", "to" : "S51" }
    }, {
      "id" : "f132",
      "type" : "RequestStart",
      "name" : "ProcessInformation.ivp",
      "config" : {
        "callSignature" : "ProcessInformation",
        "input" : {
          "params" : [
            { "name" : "processKey", "type" : "String" }
          ],
          "map" : {
            "out.processId" : "param.processKey"
          }
        },
        "outLink" : "ProcessInformation.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2304 },
        "labelOffset" : { "x" : -31, "y" : 41 }
      },
      "connect" : { "id" : "f135", "to" : "f134" }
    }, {
      "id" : "f133",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 344, "y" : 2304 }
      }
    }, {
      "id" : "f134",
      "type" : "DialogCall",
      "name" : "ProcessInformation",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.component.ProcessInformation",
        "startMethod" : "start(String)",
        "call" : {
          "params" : [
            { "name" : "processId", "type" : "String" }
          ],
          "map" : {
            "param.processId" : "in.processId"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 2304 }
      },
      "connect" : { "id" : "f136", "to" : "f133" }
    }, {
      "id" : "f139",
      "type" : "Script",
      "name" : [
        "Store portal start ",
        "pmv "
      ],
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.enums.SessionAttribute;",
            "import ch.ivy.addon.portalkit.util.SecurityServiceUtils;",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.PORTAL_START_PMV_ID.toString(), ivy.task.getProcessModelVersion().getId());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 528, "y" : 225 },
        "size" : { "width" : 112, "height" : 62 }
      },
      "connect" : { "id" : "f23", "to" : "f22" }
    }, {
      "id" : "S60",
      "type" : "UserBpmnElement",
      "name" : [
        "Open selected ",
        "homepage"
      ],
      "elements" : [ {
          "id" : "S60-f36",
          "type" : "DialogCall",
          "name" : "Portal Homepage",
          "config" : {
            "dialogId" : "ch.ivy.addon.portal.generic.PortalHome",
            "startMethod" : "start(ch.ivy.addon.portal.generic.view.TaskView)",
            "call" : {
              "params" : [
                { "name" : "taskView", "type" : "ch.ivy.addon.portal.generic.view.TaskView" }
              ],
              "map" : {
                "param.taskView" : "in.taskView"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 660, "y" : 160 }
          }
        }, {
          "id" : "S60-f22",
          "type" : "Script",
          "name" : "Build task view",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivyteam.ivy.request.IHttpRequest;",
                "import ch.ivy.addon.portal.generic.view.TaskView;",
                "",
                "in.taskView = TaskView.create().dataModel(in.dataModel).showHeaderToolbar(true).noTaskFoundMessage(\"\").createNewTaskView();"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 508, "y" : 160 }
          },
          "connect" : { "id" : "S60-f43", "to" : "S60-f36" }
        }, {
          "id" : "S60-f54",
          "type" : "Alternative",
          "visual" : {
            "at" : { "x" : 284, "y" : 160 }
          },
          "connect" : [
            { "id" : "S60-f7", "to" : "S60-f2", "label" : {
                "name" : "dashboard",
                "segment" : 0.41,
                "offset" : { "x" : 0, "y" : -12 }
              }, "condition" : "ch.addon.portal.generic.userprofile.homepage.HomepageUtils.isShowDashboard(in.#homepage, in.#isShowDashboard)" },
            { "id" : "S60-f5", "to" : "S60-f4", "via" : [ { "x" : 284, "y" : 256 } ], "label" : {
                "name" : "others",
                "segment" : 1.43,
                "offset" : { "x" : -22, "y" : -6 }
              } }
          ]
        }, {
          "id" : "S60-f3",
          "type" : "ProcessAnnotation",
          "name" : [
            "Replace by customized ",
            "homepage if you have"
          ],
          "visual" : {
            "at" : { "x" : 832, "y" : 160 },
            "size" : { "width" : 144, "height" : 44 }
          },
          "connect" : { "id" : "S60-f8", "to" : "S60-f36" }
        }, {
          "id" : "S60-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 160 },
            "labelOffset" : { "x" : 18, "y" : 25 }
          },
          "parentConnector" : "f92",
          "connect" : { "id" : "S60-f11", "to" : "S60-f1" }
        }, {
          "id" : "S60-f1",
          "type" : "Script",
          "name" : [
            "Get selected",
            "homepage"
          ],
          "config" : {
            "output" : {
              "code" : [
                "import ch.addon.portal.generic.userprofile.homepage.HomepageUtils;",
                "",
                "if (!in.isOpenDashboardFromLink) {",
                "  out.homepage = HomepageUtils.findHomepage();",
                "}"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 184, "y" : 160 }
          },
          "connect" : { "id" : "S60-f0", "to" : "S60-f54" }
        }, {
          "id" : "S60-f4",
          "type" : "Script",
          "name" : [
            "Redirect to ",
            "selected homepage"
          ],
          "config" : {
            "output" : {
              "code" : "ch.ivy.addon.portalkit.util.RequestUtils.redirect(in.homepage.link);"
            }
          },
          "visual" : {
            "at" : { "x" : 404, "y" : 256 },
            "size" : { "width" : 128, "height" : 60 }
          }
        }, {
          "id" : "S60-f2",
          "type" : "Alternative",
          "visual" : {
            "at" : { "x" : 380, "y" : 160 }
          },
          "connect" : [
            { "id" : "S60-f6", "to" : "S60-f22", "condition" : "ch.addon.portal.generic.userprofile.homepage.HomepageUtils.isShowLegacyUI()" },
            { "id" : "S60-f10", "to" : "S60-f9", "via" : [ { "x" : 380, "y" : 80 } ], "label" : {
                "name" : "new dashboard",
                "segment" : 1.26,
                "offset" : { "x" : 0, "y" : -10 }
              } }
          ]
        }, {
          "id" : "S60-f9",
          "type" : "DialogCall",
          "name" : "PortalDashboard",
          "config" : {
            "dialogId" : "ch.ivy.addon.portal.generic.dashboard.PortalDashboard",
            "startMethod" : "start()"
          },
          "visual" : {
            "at" : { "x" : 656, "y" : 80 }
          }
        } ],
      "visual" : {
        "at" : { "x" : 1136, "y" : 224 }
      }
    }, {
      "id" : "S10",
      "type" : "UserBpmnElement",
      "name" : [
        "Open previous",
        "page before finish task"
      ],
      "elements" : [ {
          "id" : "S10-f17",
          "type" : "Script",
          "name" : "Find case",
          "config" : {
            "security" : "system",
            "output" : {
              "code" : [
                "import ch.ivyteam.ivy.workflow.ITask;",
                "import ch.ivyteam.ivy.workflow.ICase;",
                "import ch.ivyteam.ivy.workflow.query.CaseQuery;",
                "",
                "long caseId = -1;",
                "if (in.endedTaskId is initialized) {",
                "  ITask task = ivy.wf.findTask(Long.valueOf(in.endedTaskId));",
                "  caseId = task.getCase().getId();",
                "}",
                "out.caseSelected = ivy.wf.getGlobalContext().getCaseQueryExecutor().createCaseQuery().where().caseId().isEqual(caseId).executor().firstResult() as ICase;"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 408, "y" : 288 }
          },
          "connect" : { "id" : "S10-f26", "to" : "S10-f23" }
        }, {
          "id" : "S10-f68",
          "type" : "Script",
          "name" : "find task by id",
          "config" : {
            "security" : "system",
            "output" : {
              "code" : "out.taskSelected = ivy.wf.findTask(Long.valueOf(in.endedTaskId));"
            }
          },
          "visual" : {
            "at" : { "x" : 408, "y" : 192 }
          },
          "connect" : { "id" : "S10-f42", "to" : "S10-f6" }
        }, {
          "id" : "S10-f52",
          "type" : "Script",
          "name" : "build data model",
          "config" : {
            "security" : "system",
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.datamodel.CaseLazyDataModel;",
                "import ch.ivy.addon.portalkit.datamodel.SearchResultsDataModel;",
                "",
                "in.searchResultsDataModel = new SearchResultsDataModel();",
                "in.searchResultsDataModel.taskDataModel = in.dataModel;",
                "in.searchResultsDataModel.keyword = in.searchResultsDataModel.taskDataModel.criteria.keyword;",
                "in.searchResultsDataModel.caseDataModel.notKeepFilter = true;",
                "in.searchResultsDataModel.caseDataModel.getCriteria().keyword = in.searchResultsDataModel.taskDataModel.criteria.keyword;"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 408, "y" : 480 }
          },
          "connect" : { "id" : "S10-f49", "to" : "S10-f37" }
        }, {
          "id" : "S10-f19",
          "type" : "Script",
          "name" : [
            "build data model,",
            " task "
          ],
          "config" : {
            "security" : "system",
            "output" : {
              "code" : [
                "import ch.ivy.addon.portal.generic.view.TaskView;",
                "",
                "boolean canLinkBackToCaseDetail = in.#dataModel.#criteria.#caseId is initialized; ",
                "in.taskView = TaskView.create().dataModel(in.dataModel).canLinkBackCaseDetail(canLinkBackToCaseDetail).showHeaderToolbar(false).createNewTaskView();"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 416, "y" : 384 },
            "size" : { "width" : 128, "height" : 56 }
          },
          "connect" : { "id" : "S10-f39", "to" : "S10-f12" }
        }, {
          "id" : "S10-f37",
          "type" : "SubProcessCall",
          "name" : "OpenPortalSearch",
          "config" : {
            "processCall" : "Functional Processes/OpenPortalSearch:call(ch.ivy.addon.portalkit.datamodel.SearchResultsDataModel,Number)",
            "call" : {
              "params" : [
                { "name" : "searchResultsDataModel", "type" : "ch.ivy.addon.portalkit.datamodel.SearchResultsDataModel" },
                { "name" : "activeTabIndex", "type" : "Number" }
              ],
              "map" : {
                "param.searchResultsDataModel" : "in.searchResultsDataModel",
                "param.activeTabIndex" : "1"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 616, "y" : 480 }
          }
        }, {
          "id" : "S10-f0",
          "type" : "Alternative",
          "visual" : {
            "at" : { "x" : 224, "y" : 96 }
          },
          "connect" : [
            { "id" : "S10-f8", "to" : "S10-f7", "label" : {
                "name" : "Express end page",
                "segment" : 0.47,
                "offset" : { "x" : 0, "y" : -11 }
              }, "condition" : "org.apache.commons.lang3.StringUtils.isNotBlank(in.#callbackUrl)" },
            { "id" : "S10-f2", "to" : "S10-f68", "via" : [ { "x" : 288, "y" : 192 } ], "condition" : "in.isTaskStartedInDetails && !in.isTaskFinished && !in.backFromTaskDetails" },
            { "id" : "S10-f3", "to" : "S10-f17", "via" : [ { "x" : 288, "y" : 288 } ], "condition" : "java.util.Objects.equals(ch.ivy.addon.portalkit.enums.PortalPage.CASE_DETAIL_FROM_TASK, in.#portalPage)" },
            { "id" : "S10-f4", "to" : "S10-f19", "via" : [ { "x" : 256, "y" : 384 } ], "condition" : "java.util.Objects.equals(ch.ivy.addon.portalkit.enums.PortalPage.TASK_LIST, in.#portalPage)" },
            { "id" : "S10-f5", "to" : "S10-f52", "via" : [ { "x" : 224, "y" : 480 } ] }
          ]
        }, {
          "id" : "S10-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 96, "y" : 96 },
            "labelOffset" : { "x" : 18, "y" : 25 }
          },
          "parentConnector" : "f18",
          "connect" : { "id" : "S10-f1", "to" : "S10-f0" }
        }, {
          "id" : "S10-f23",
          "type" : "SubProcessCall",
          "name" : "OpenPortalCaseDetailHook",
          "config" : {
            "processCall" : "Functional Processes/OpenPortalCaseDetailsHook:call(ch.ivyteam.ivy.workflow.ICase,Boolean)",
            "call" : {
              "params" : [
                { "name" : "caseData", "type" : "ch.ivyteam.ivy.workflow.ICase" },
                { "name" : "isShowBackButton", "type" : "Boolean" }
              ],
              "map" : {
                "param.caseData" : "in.caseSelected",
                "param.isShowBackButton" : "true"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 624, "y" : 288 },
            "size" : { "width" : 160, "height" : 60 }
          }
        }, {
          "id" : "S10-f6",
          "type" : "SubProcessCall",
          "name" : "OpenPortalTaskDetailsHook",
          "config" : {
            "processCall" : "Functional Processes/OpenPortalTaskDetailsHook:call(ch.ivyteam.ivy.workflow.ITask,ch.ivy.addon.portalkit.datamodel.TaskLazyDataModel,ch.ivy.addon.portalkit.enums.PortalPage,Boolean,Boolean)",
            "call" : {
              "params" : [
                { "name" : "task", "type" : "ch.ivyteam.ivy.workflow.ITask" },
                { "name" : "dataModel", "type" : "ch.ivy.addon.portalkit.datamodel.TaskLazyDataModel" },
                { "name" : "portalPage", "type" : "ch.ivy.addon.portalkit.enums.PortalPage" },
                { "name" : "isFromTaskList", "type" : "Boolean" },
                { "name" : "showItemDetailsHeader", "type" : "Boolean" }
              ],
              "map" : {
                "param.task" : "in.taskSelected",
                "param.dataModel" : "in.dataModel",
                "param.portalPage" : "in.portalPage",
                "param.isFromTaskList" : "false"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 600, "y" : 192 },
            "size" : { "width" : 176, "height" : 60 }
          }
        }, {
          "id" : "S10-f12",
          "type" : "SubProcessCall",
          "name" : "OpenPortalTasks",
          "config" : {
            "processCall" : "Functional Processes/OpenPortalTasks:useView(ch.ivy.addon.portal.generic.view.TaskView)",
            "call" : {
              "params" : [
                { "name" : "taskView", "type" : "ch.ivy.addon.portal.generic.view.TaskView" }
              ],
              "map" : {
                "param.taskView" : "in.taskView"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 624, "y" : 384 },
            "size" : { "width" : 104, "height" : 48 }
          }
        }, {
          "id" : "S10-f7",
          "type" : "DialogCall",
          "name" : "PortalUrlCallback",
          "config" : {
            "dialogId" : "ch.ivy.addon.portal.generic.PortalUrlCallback",
            "startMethod" : "start(String)",
            "call" : {
              "params" : [
                { "name" : "callbackUrl", "type" : "String" }
              ],
              "map" : {
                "param.callbackUrl" : "in.callbackUrl"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 504, "y" : 96 }
          }
        } ],
      "visual" : {
        "at" : { "x" : 1205, "y" : 383 },
        "size" : { "width" : 251, "height" : 65 }
      }
    }, {
      "id" : "S30",
      "type" : "UserBpmnElement",
      "name" : "Case List Page",
      "elements" : [ {
          "id" : "S30-f62",
          "type" : "SubProcessCall",
          "name" : [
            "Initialize case ",
            "data model"
          ],
          "config" : {
            "processCall" : "Functional Processes/InitializeCaseDataModel:call()",
            "output" : {
              "map" : {
                "out" : "in",
                "out.caseDataModel" : "result.caseDataModel"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 192, "y" : 160 }
          },
          "connect" : { "id" : "S30-f61", "to" : "S30-f59" }
        }, {
          "id" : "S30-f59",
          "type" : "Script",
          "name" : [
            "build data model",
            "and case view"
          ],
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.util.PermissionUtils;",
                "import ch.ivy.addon.portalkit.util.SecurityServiceUtils;",
                "import ch.ivy.addon.portal.generic.view.CaseView;",
                "",
                "boolean hasReadAllCasesPermission = PermissionUtils.checkReadAllCasesPermission();",
                "in.caseDataModel.setAdminQuery(hasReadAllCasesPermission);",
                "",
                "in.caseView = CaseView.create().dataModel(in.caseDataModel).buildNewView();"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 352, "y" : 160 },
            "size" : { "width" : 128, "height" : 60 }
          },
          "connect" : { "id" : "S30-f60", "to" : "S30-f55" }
        }, {
          "id" : "S30-f55",
          "type" : "SubProcessCall",
          "name" : "OpenPortalCases",
          "config" : {
            "processCall" : "Functional Processes/OpenPortalCases:useView(ch.ivy.addon.portal.generic.view.CaseView)",
            "call" : {
              "params" : [
                { "name" : "view", "type" : "ch.ivy.addon.portal.generic.view.CaseView" }
              ],
              "map" : {
                "param.view" : "in.caseView"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 544, "y" : 160 },
            "size" : { "width" : 112, "height" : 48 }
          },
          "connect" : { "id" : "S30-f1", "to" : "S30-g1" }
        }, {
          "id" : "S30-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 160 },
            "labelOffset" : { "x" : 18, "y" : 25 }
          },
          "parentConnector" : "f176",
          "connect" : { "id" : "S30-f0", "to" : "S30-f62" }
        }, {
          "id" : "S30-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 672, "y" : 160 },
            "labelOffset" : { "x" : 21, "y" : 25 }
          },
          "parentConnector" : "f25"
        } ],
      "visual" : {
        "at" : { "x" : 528, "y" : 624 }
      },
      "connect" : { "id" : "f25", "to" : "f57" }
    }, {
      "id" : "S20",
      "type" : "UserBpmnElement",
      "name" : "Task List Page",
      "elements" : [ {
          "id" : "S20-f69",
          "type" : "Script",
          "name" : [
            "build data model ",
            "and task view"
          ],
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.enums.TaskAssigneeType;",
                "import ch.ivy.addon.portal.generic.view.TaskView;",
                "import ch.ivy.addon.portalkit.util.PermissionUtils;",
                "",
                "boolean hasReadAllTasksPermisson = PermissionUtils.checkReadAllTasksPermission();",
                "in.dataModel.setAdminQuery(hasReadAllTasksPermisson);",
                "in.dataModel.setTaskAssigneeType(TaskAssigneeType.ALL);",
                "",
                "in.taskView = TaskView.create().dataModel(in.dataModel).noTaskFoundMessage(\"\").showHeaderToolbar(false).createNewTaskView();"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 352, "y" : 160 },
            "size" : { "width" : 112, "height" : 48 }
          },
          "connect" : { "id" : "S20-f67", "to" : "S20-f84" }
        }, {
          "id" : "S20-f84",
          "type" : "SubProcessCall",
          "name" : "OpenPortalTasks",
          "config" : {
            "processCall" : "Functional Processes/OpenPortalTasks:useView(ch.ivy.addon.portal.generic.view.TaskView)",
            "call" : {
              "params" : [
                { "name" : "taskView", "type" : "ch.ivy.addon.portal.generic.view.TaskView" }
              ],
              "map" : {
                "param.taskView" : "in.taskView"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 544, "y" : 160 },
            "size" : { "width" : 104, "height" : 40 }
          },
          "connect" : { "id" : "S20-f1", "to" : "S20-g1" }
        }, {
          "id" : "S20-f73",
          "type" : "SubProcessCall",
          "name" : "Init data model",
          "config" : {
            "processCall" : "Functional Processes/InitializeTaskDataModel:call()",
            "output" : {
              "map" : {
                "out" : "in",
                "out.dataModel" : "result.dataModel"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 192, "y" : 160 }
          },
          "connect" : { "id" : "S20-f118", "to" : "S20-f69" }
        }, {
          "id" : "S20-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 160 },
            "labelOffset" : { "x" : 18, "y" : 25 }
          },
          "parentConnector" : "f179",
          "connect" : { "id" : "S20-f0", "to" : "S20-f73" }
        }, {
          "id" : "S20-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 672, "y" : 160 },
            "labelOffset" : { "x" : 21, "y" : 25 }
          },
          "parentConnector" : "f17"
        } ],
      "visual" : {
        "at" : { "x" : 528, "y" : 784 }
      },
      "connect" : { "id" : "f17", "to" : "f64" }
    }, {
      "id" : "S70",
      "type" : "ServiceBpmnElement",
      "name" : "Init data and display growl msg after finish task",
      "elements" : [ {
          "id" : "S70-f47",
          "type" : "Alternative",
          "name" : "Is first task?",
          "visual" : {
            "at" : { "x" : 152, "y" : 160 },
            "labelOffset" : { "x" : 16, "y" : -23 }
          },
          "connect" : [
            { "id" : "S70-f49", "to" : "S70-f4", "label" : {
                "name" : "Yes",
                "segment" : 0.49,
                "offset" : { "x" : 0, "y" : -13 }
              }, "condition" : "in.isFirstTask" },
            { "id" : "S70-f55", "to" : "S70-f7", "via" : [ { "x" : 152, "y" : 224 }, { "x" : 504, "y" : 224 } ], "label" : {
                "name" : "No",
                "segment" : 1.45,
                "offset" : { "x" : 0, "y" : 10 }
              } }
          ]
        }, {
          "id" : "S70-f4",
          "type" : "SubProcessCall",
          "name" : "InitializeTaskDataModel",
          "config" : {
            "processCall" : "Functional Processes/InitializeTaskDataModel:call()",
            "output" : {
              "map" : {
                "out" : "in",
                "out.dataModel" : "result.dataModel"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 312, "y" : 160 },
            "size" : { "width" : 144, "height" : 60 }
          },
          "connect" : { "id" : "S70-f31", "to" : "S70-f7" }
        }, {
          "id" : "S70-f12",
          "type" : "DialogCall",
          "name" : [
            "Display growl message",
            "after finish task"
          ],
          "config" : {
            "dialogId" : "ch.ivy.addon.portal.generic.PortalFinishTaskHandle",
            "startMethod" : "start(Boolean,ch.ivyteam.ivy.workflow.ICase)",
            "call" : {
              "params" : [
                { "name" : "isTaskFinished", "type" : "Boolean" },
                { "name" : "iCase", "type" : "ch.ivyteam.ivy.workflow.ICase" }
              ],
              "map" : {
                "param.isTaskFinished" : "in.isTaskFinished",
                "param.iCase" : "in.caseSelected"
              }
            }
          },
          "visual" : {
            "at" : { "x" : 680, "y" : 160 },
            "size" : { "width" : 144, "height" : 60 }
          },
          "connect" : { "id" : "S70-f1", "to" : "S70-g1" }
        }, {
          "id" : "S70-f7",
          "type" : "Script",
          "name" : [
            "Set compactMode",
            "DataModel"
          ],
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.enums.PortalPage;",
                "import ch.ivy.addon.portalkit.datamodel.TaskLazyDataModel;",
                "",
                "if(in.#portalPage == PortalPage.HOME_PAGE) {",
                "  in.dataModel.compactMode = true;",
                "}"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 504, "y" : 160 },
            "size" : { "width" : 128, "height" : 60 }
          },
          "connect" : { "id" : "S70-f2", "to" : "S70-f12" }
        }, {
          "id" : "S70-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 160 },
            "labelOffset" : { "x" : 18, "y" : 25 }
          },
          "parentConnector" : "f36",
          "connect" : { "id" : "S70-f0", "to" : "S70-f47" }
        }, {
          "id" : "S70-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 832, "y" : 160 },
            "labelOffset" : { "x" : 21, "y" : 25 }
          },
          "parentConnector" : "f40"
        } ],
      "visual" : {
        "at" : { "x" : 888, "y" : 384 },
        "size" : { "width" : 248, "height" : 64 }
      },
      "connect" : { "id" : "f40", "to" : "f5" }
    }, {
      "id" : "f138",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 776, "y" : 2784 }
      }
    }, {
      "id" : "f142",
      "type" : "DialogCall",
      "name" : "Case note history",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.CaseNoteHistory",
        "startMethod" : "start(java.util.List<ch.ivy.addon.portalkit.bo.History>,String,ch.ivyteam.ivy.workflow.ICase)",
        "call" : {
          "params" : [
            { "name" : "histories", "type" : "java.util.List<ch.ivy.addon.portalkit.bo.History>" },
            { "name" : "exportedFileName", "type" : "String" },
            { "name" : "ivyCase", "type" : "ch.ivyteam.ivy.workflow.ICase" }
          ],
          "map" : {
            "param.histories" : "in.histories",
            "param.exportedFileName" : "ivy.cms.co(\"/ch.ivy.addon.portalkit.ui.jsf/noteHistory/caseExportedFileNamePrefix\", java.util.Arrays.asList(ch.ivy.addon.portalkit.util.PermissionUtils.getCaseName(in.caseSelected)))",
            "param.ivyCase" : "in.caseSelected"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 672, "y" : 2784 }
      },
      "connect" : { "id" : "f146", "to" : "f138" }
    }, {
      "id" : "f143",
      "type" : "Script",
      "name" : "Find case histories",
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.util.CaseUtils;",
            "import ch.ivyteam.ivy.workflow.ICase;",
            "import ch.ivyteam.ivy.workflow.query.CaseQuery;",
            "import ch.ivy.addon.portalkit.service.GlobalSettingService;",
            "import java.util.ArrayList;",
            "import ch.ivyteam.ivy.workflow.TaskState;",
            "import ch.ivyteam.ivy.workflow.ITask;",
            "import ch.ivy.addon.portalkit.service.HistoryService;",
            "",
            "List<ITask> finishedTasks = new ArrayList();",
            "for(ITask task : in.caseSelected.tasks().all()) {",
            "  if(task.getState() == TaskState.DONE",
            "  || task.getState() == TaskState.CREATED ",
            "  || task.getState() == TaskState.DESTROYED ",
            "  || task.getState() == TaskState.ZOMBIE) {",
            "    finishedTasks.add(task);",
            "  }",
            "}",
            "GlobalSettingService globalSettingService = GlobalSettingService.getInstance();",
            "boolean excludeSystemTasks = globalSettingService.findHideSystemTasksFromHistorySettingValue();",
            "boolean excludeSystemNotes = globalSettingService.findHideSystemNotesFromHistorySettingValue();",
            "",
            "List<ICase> cases = new ArrayList();",
            "cases.add(in.caseSelected);",
            "cases.addAll(CaseUtils.findSubCasesByBusinessCaseId(in.caseId));",
            "",
            "HistoryService historyService = new HistoryService();",
            "in.histories = historyService.getCaseHistories(in.caseId, finishedTasks, cases, excludeSystemTasks, excludeSystemNotes);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 528, "y" : 2784 }
      },
      "connect" : { "id" : "f147", "to" : "f142" }
    }, {
      "id" : "f144",
      "type" : "RequestStart",
      "name" : "showCaseNoteHistory.ivp",
      "config" : {
        "callSignature" : "showCaseNoteHistory",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" }
          ],
          "map" : {
            "out.caseId" : "param.caseId"
          }
        },
        "outLink" : "showCaseNoteHistory.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2784 },
        "labelOffset" : { "x" : -39, "y" : 33 }
      },
      "connect" : { "id" : "f161", "to" : "f79" }
    }, {
      "id" : "f148",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 776, "y" : 2864 }
      }
    }, {
      "id" : "f149",
      "type" : "RequestStart",
      "name" : "showTaskNoteHistory.ivp",
      "config" : {
        "callSignature" : "showTaskNoteHistory",
        "input" : {
          "params" : [
            { "name" : "selectedTaskId", "type" : "Long" }
          ],
          "map" : {
            "out.taskId" : "param.selectedTaskId"
          }
        },
        "outLink" : "showTaskNoteHistory.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2864 },
        "labelOffset" : { "x" : -39, "y" : 33 }
      },
      "connect" : { "id" : "f167", "to" : "f145" }
    }, {
      "id" : "f151",
      "type" : "DialogCall",
      "name" : "Task Note History",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.TaskNoteHistory",
        "startMethod" : "start(java.util.List<ch.ivyteam.ivy.workflow.INote>,String,ch.ivyteam.ivy.workflow.ITask)",
        "call" : {
          "params" : [
            { "name" : "notes", "type" : "java.util.List<ch.ivyteam.ivy.workflow.INote>" },
            { "name" : "exportedFileName", "type" : "String" },
            { "name" : "task", "type" : "ch.ivyteam.ivy.workflow.ITask" }
          ],
          "map" : {
            "param.notes" : "in.notes",
            "param.exportedFileName" : "ivy.cms.co(\"/ch.ivy.addon.portalkit.ui.jsf/noteHistory/taskExportedFileNamePrefix\", java.util.Arrays.asList(ch.ivy.addon.portalkit.util.PermissionUtils.getTaskName(in.taskSelected)))",
            "param.task" : "in.taskSelected"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 672, "y" : 2864 }
      },
      "connect" : { "id" : "f153", "to" : "f148" }
    }, {
      "id" : "f152",
      "type" : "Script",
      "name" : "Find task notes",
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivyteam.ivy.workflow.INote;",
            "import ch.ivyteam.ivy.workflow.query.TaskQuery;",
            "import ch.ivyteam.ivy.workflow.ITask;",
            "import ch.ivy.addon.portalkit.util.CaseUtils;",
            "import ch.ivyteam.ivy.workflow.ICase;",
            "import ch.ivy.addon.portalkit.service.GlobalSettingService;",
            "import ch.ivy.addon.portalkit.comparator.NoteComparator;",
            "",
            "ICase iCase = in.taskSelected.getCase().getBusinessCase();",
            "GlobalSettingService globalSettingService = GlobalSettingService.getInstance();",
            "boolean excludeSystemNotes = globalSettingService.findHideSystemNotesFromHistorySettingValue();",
            "in.notes = CaseUtils.findNotes(iCase, excludeSystemNotes);",
            "in.notes.sort(new NoteComparator());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 528, "y" : 2864 }
      },
      "connect" : { "id" : "f168", "to" : "f151" }
    }, {
      "id" : "f156",
      "type" : "DialogCall",
      "name" : [
        "Show Additional",
        "Case Details"
      ],
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.AdditionalCaseDetails",
        "startMethod" : "start(ch.ivyteam.ivy.workflow.ICase)",
        "call" : {
          "params" : [
            { "name" : "iCase", "type" : "ch.ivyteam.ivy.workflow.ICase" }
          ],
          "map" : {
            "param.iCase" : "in.caseSelected"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 528, "y" : 2944 }
      },
      "connect" : { "id" : "f162", "to" : "f157" }
    }, {
      "id" : "f157",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 632, "y" : 2944 }
      }
    }, {
      "id" : "f158",
      "type" : "Script",
      "name" : "Find case",
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.ivydata.service.impl.CaseService;",
            "out.caseSelected = CaseService.newInstance().findCaseById(in.caseId);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 2944 }
      },
      "connect" : { "id" : "f213", "to" : "S22" }
    }, {
      "id" : "f159",
      "type" : "RequestStart",
      "name" : "showAdditionalCaseDetails.ivp",
      "config" : {
        "callSignature" : "showAdditionalCaseDetails",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" }
          ],
          "map" : {
            "out.caseId" : "param.caseId"
          }
        },
        "outLink" : "showAdditionalCaseDetails.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2944 },
        "labelOffset" : { "x" : -55, "y" : 33 }
      },
      "connect" : { "id" : "f160", "to" : "f158" }
    }, {
      "id" : "f163",
      "type" : "RequestStart",
      "name" : "showTaskAnalysis.ivp",
      "config" : {
        "callSignature" : "showTaskAnalysis",
        "outLink" : "showTaskAnalysis.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 3024 },
        "labelOffset" : { "x" : -31, "y" : 41 }
      },
      "connect" : { "id" : "f171", "to" : "S32" }
    }, {
      "id" : "f164",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 488, "y" : 3024 }
      }
    }, {
      "id" : "f166",
      "type" : "DialogCall",
      "name" : "Task Analysis dialog",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.TaskAnalysis",
        "startMethod" : "start()"
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 3024 }
      },
      "connect" : { "id" : "f169", "to" : "f164" }
    }, {
      "id" : "f188",
      "type" : "RequestStart",
      "name" : "DashboardDetails.ivp",
      "config" : {
        "callSignature" : "DashboardDetails",
        "input" : {
          "params" : [
            { "name" : "dashboardId", "type" : "String" },
            { "name" : "isPublicDashboard", "type" : "Boolean" }
          ],
          "map" : {
            "out.dashboardId" : "param.dashboardId",
            "out.isPublicDashboard" : "param.isPublicDashboard"
          }
        },
        "outLink" : "DashboardDetails.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2464 },
        "labelOffset" : { "x" : -23, "y" : 41 }
      },
      "connect" : { "id" : "f173", "to" : "S72" }
    }, {
      "id" : "f193",
      "type" : "DialogCall",
      "name" : "PortalDashboardDetailModification",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.dashboard.PortalDashboardDetailModification",
        "startMethod" : "start(String,Boolean)",
        "call" : {
          "params" : [
            { "name" : "dashboardId", "type" : "String" },
            { "name" : "isPublicDashboard", "type" : "Boolean" }
          ],
          "map" : {
            "param.dashboardId" : "in.dashboardId",
            "param.isPublicDashboard" : "in.isPublicDashboard"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 456, "y" : 2465 },
        "size" : { "width" : 256, "height" : 58 }
      },
      "connect" : { "id" : "f199", "to" : "f195" }
    }, {
      "id" : "f195",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 632, "y" : 2464 }
      }
    }, {
      "id" : "f200",
      "type" : "RequestStart",
      "name" : "DefaultApplicationHomePageInTeams.ivp",
      "config" : {
        "callSignature" : "DefaultApplicationHomePageInTeams",
        "outLink" : "DefaultApplicationHomePageInTeams.ivp",
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 304 },
        "labelOffset" : { "x" : -79, "y" : 41 }
      },
      "connect" : { "id" : "f202", "to" : "f201" }
    }, {
      "id" : "f201",
      "type" : "Script",
      "name" : "Init Teams attrs",
      "config" : {
        "output" : {
          "code" : [
            "import ch.addon.portal.generic.userprofile.homepage.HomepageType;",
            "import ch.ivy.addon.portalkit.enums.SessionAttribute;",
            "import ch.ivy.addon.portalkit.util.SecurityServiceUtils;",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.PORTAL_IN_TEAMS.toString(), true);",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.DEFAULT_PAGE_IN_TEAMS.toString(), HomepageType.DASHBOARD.toString());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 304 }
      },
      "connect" : { "id" : "f205", "to" : "f203" }
    }, {
      "id" : "f203",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 240, "y" : 224 }
      },
      "connect" : [
        { "id" : "f43", "to" : "f21" }
      ]
    }, {
      "id" : "f206",
      "type" : "RequestStart",
      "name" : "DefaultCaseListPageInTeams.ivp",
      "config" : {
        "callSignature" : "DefaultCaseListPageInTeams",
        "outLink" : "DefaultCaseListPageInTeams.ivp",
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 544 },
        "labelOffset" : { "x" : -55, "y" : 41 }
      },
      "connect" : { "id" : "f208", "to" : "f207" }
    }, {
      "id" : "f207",
      "type" : "Script",
      "name" : "Init Teams attrs",
      "config" : {
        "output" : {
          "code" : [
            "import ch.addon.portal.generic.userprofile.homepage.HomepageType;",
            "import ch.ivy.addon.portalkit.enums.SessionAttribute;",
            "import ch.ivy.addon.portalkit.util.SecurityServiceUtils;",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.PORTAL_IN_TEAMS.toString(), true);",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.DEFAULT_PAGE_IN_TEAMS.toString(), HomepageType.CASE.toString());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 544 }
      },
      "connect" : { "id" : "f61", "to" : "S71", "via" : [ { "x" : 384, "y" : 544 } ] }
    }, {
      "id" : "f214",
      "type" : "Script",
      "name" : "Init Teams attrs",
      "config" : {
        "output" : {
          "code" : [
            "import ch.addon.portal.generic.userprofile.homepage.HomepageType;",
            "import ch.ivy.addon.portalkit.enums.SessionAttribute;",
            "import ch.ivy.addon.portalkit.util.SecurityServiceUtils;",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.PORTAL_IN_TEAMS.toString(), true);",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.DEFAULT_PAGE_IN_TEAMS.toString(), HomepageType.TASK.toString());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 704 }
      },
      "connect" : { "id" : "f24", "to" : "S80", "via" : [ { "x" : 384, "y" : 704 } ] }
    }, {
      "id" : "f215",
      "type" : "RequestStart",
      "name" : "DefaultTaskListPageInTeams.ivp",
      "config" : {
        "callSignature" : "DefaultTaskListPageInTeams",
        "outLink" : "DefaultTaskListPageInTeams.ivp",
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 704 },
        "labelOffset" : { "x" : -55, "y" : 41 }
      },
      "connect" : { "id" : "f216", "to" : "f214" }
    }, {
      "id" : "f220",
      "type" : "RequestStart",
      "name" : "DefaultProcessStartListPageInTeams.ivp",
      "config" : {
        "callSignature" : "DefaultProcessStartListPageInTeams",
        "outLink" : "DefaultProcessStartListPageInTeams.ivp",
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 1344 },
        "labelOffset" : { "x" : -79, "y" : 41 }
      },
      "connect" : { "id" : "f222", "to" : "f221" }
    }, {
      "id" : "f221",
      "type" : "Script",
      "name" : "Init Teams attrs",
      "config" : {
        "output" : {
          "code" : [
            "import ch.addon.portal.generic.userprofile.homepage.HomepageType;",
            "import ch.ivy.addon.portalkit.enums.SessionAttribute;",
            "import ch.ivy.addon.portalkit.util.SecurityServiceUtils;",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.PORTAL_IN_TEAMS.toString(), true);",
            "SecurityServiceUtils.setSessionAttribute(SessionAttribute.DEFAULT_PAGE_IN_TEAMS.toString(), HomepageType.PROCESS.toString());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 238, "y" : 1344 }
      },
      "connect" : { "id" : "f197", "to" : "S12" }
    }, {
      "id" : "f224",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 344, "y" : 3104 }
      }
    }, {
      "id" : "f225",
      "type" : "DialogCall",
      "name" : "ProcessViewer",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.ProcessViewer",
        "startMethod" : "start(Long,Long,String)",
        "call" : {
          "params" : [
            { "name" : "taskId", "type" : "Long" },
            { "name" : "caseId", "type" : "Long" },
            { "name" : "processId", "type" : "String" }
          ],
          "map" : {
            "param.taskId" : "in.taskId",
            "param.caseId" : "in.caseId",
            "param.processId" : "in.processId"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 3104 },
        "size" : { "width" : 116, "height" : 60 }
      },
      "connect" : { "id" : "f228", "to" : "f224" }
    }, {
      "id" : "f226",
      "type" : "RequestStart",
      "name" : "PortalProcessViewer.ivp",
      "config" : {
        "callSignature" : "PortalProcessViewer",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" },
            { "name" : "processKey", "type" : "String" },
            { "name" : "selectedTaskId", "type" : "Long" }
          ],
          "map" : {
            "out.caseId" : "param.caseId",
            "out.processId" : "param.processKey",
            "out.taskId" : "param.selectedTaskId"
          }
        },
        "outLink" : "PortalProcessViewer.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 3104 },
        "labelOffset" : { "x" : -31, "y" : 33 }
      },
      "connect" : { "id" : "f227", "to" : "f225" }
    }, {
      "id" : "f229",
      "type" : "RequestStart",
      "name" : "ShowTaskDocument.ivp",
      "config" : {
        "callSignature" : "ShowTaskDocument",
        "input" : {
          "params" : [
            { "name" : "selectedTaskId", "type" : "Long" }
          ],
          "map" : {
            "out.taskId" : "param.selectedTaskId"
          }
        },
        "outLink" : "ShowTaskDocument.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 3184 },
        "labelOffset" : { "x" : -31, "y" : 33 }
      },
      "connect" : { "id" : "f186", "to" : "S81" }
    }, {
      "id" : "f230",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 488, "y" : 3184 }
      }
    }, {
      "id" : "f232",
      "type" : "DialogCall",
      "name" : "TaskDocuments",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.TaskDocuments",
        "startMethod" : "start(Long)",
        "call" : {
          "params" : [
            { "name" : "taskId", "type" : "Long" }
          ],
          "map" : {
            "param.taskId" : "in.taskId"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 3184 }
      },
      "connect" : { "id" : "f231", "to" : "f230" }
    }, {
      "id" : "f234",
      "type" : "RequestStart",
      "name" : "ShowCaseDocument.ivp",
      "config" : {
        "callSignature" : "ShowCaseDocument",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" }
          ],
          "map" : {
            "out.caseId" : "param.caseId"
          }
        },
        "outLink" : "ShowCaseDocument.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 3264 },
        "labelOffset" : { "x" : -31, "y" : 33 }
      },
      "connect" : { "id" : "f189", "to" : "S91" }
    }, {
      "id" : "f235",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 488, "y" : 3264 }
      }
    }, {
      "id" : "f237",
      "type" : "DialogCall",
      "name" : "CaseDocuments",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.CaseDocuments",
        "startMethod" : "start(Long)",
        "call" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" }
          ],
          "map" : {
            "param.caseId" : "in.caseId"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 3264 }
      },
      "connect" : { "id" : "f236", "to" : "f235" }
    }, {
      "id" : "f37",
      "type" : "RequestStart",
      "name" : "PortalManagement.ivp",
      "config" : {
        "callSignature" : "PortalManagement",
        "outLink" : "PortalManagement.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 3344 },
        "labelOffset" : { "x" : -31, "y" : 33 }
      },
      "connect" : { "id" : "f191", "to" : "S01" }
    }, {
      "id" : "f41",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 488, "y" : 3344 }
      }
    }, {
      "id" : "f137",
      "type" : "DialogCall",
      "name" : "PortalManagement",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.setting.PortalManagement",
        "startMethod" : "start()"
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 3344 }
      },
      "connect" : { "id" : "f129", "to" : "f41" }
    }, {
      "id" : "f241",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 632, "y" : 2384 }
      }
    }, {
      "id" : "f243",
      "type" : "DialogCall",
      "name" : "PortalDashboardConfiguration",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.dashboard.PortalDashboardConfiguration",
        "startMethod" : "start()"
      },
      "visual" : {
        "at" : { "x" : 456, "y" : 2384 },
        "size" : { "width" : 256, "height" : 60 }
      },
      "connect" : { "id" : "f242", "to" : "f241" }
    }, {
      "id" : "f177",
      "type" : "RequestStart",
      "name" : "PortalDashboardConfiguration.ivp",
      "config" : {
        "callSignature" : "PortalDashboardConfiguration",
        "outLink" : "PortalDashboardConfiguration.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 2384 },
        "labelOffset" : { "x" : -55, "y" : 33 }
      },
      "connect" : { "id" : "f131", "to" : "S61" }
    }, {
      "id" : "f150",
      "type" : "Script",
      "name" : [
        "Handle blank ",
        "callback URL"
      ],
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivy.addon.portal.generic.navigation.PortalNavigator;",
            "import org.apache.commons.lang3.StringUtils;",
            "// Blank callback URL causes issue https://1ivy.atlassian.net/browse/IVYPORTAL-14851",
            "if (StringUtils.isBlank(in.callbackUrl)){",
            "  in.callbackUrl = PortalNavigator.getPortalStartUrl();",
            "}"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 384, "y" : 1024 }
      },
      "connect" : { "id" : "f8", "to" : "f6" }
    }, {
      "id" : "f272",
      "type" : "Script",
      "name" : "Find Case",
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.ivydata.service.impl.CaseService;",
            "",
            "out.caseSelected = CaseService.newInstance().findCaseById(in.caseId);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 864 }
      },
      "connect" : { "id" : "f15", "to" : "S90" }
    }, {
      "id" : "f274",
      "type" : "SubProcessCall",
      "name" : "OpenPortalCaseDetails",
      "config" : {
        "processCall" : "Functional Processes/OpenPortalCaseDetailsHook:call(ch.ivyteam.ivy.workflow.ICase,Boolean)",
        "call" : {
          "params" : [
            { "name" : "caseData", "type" : "ch.ivyteam.ivy.workflow.ICase" },
            { "name" : "isShowBackButton", "type" : "Boolean" }
          ],
          "map" : {
            "param.caseData" : "in.caseSelected",
            "param.isShowBackButton" : "true"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 600, "y" : 864 },
        "size" : { "width" : 256, "height" : 60 }
      },
      "connect" : { "id" : "f276", "to" : "f105" }
    }, {
      "id" : "S71",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S71-f268",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 224 }
          }
        }, {
          "id" : "S71-f209",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -24 }
          },
          "connect" : [
            { "id" : "S71-f2", "to" : "S71-g2", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.util.PermissionUtils.checkAccessFullCaseListPermission()" },
            { "id" : "S71-f269", "to" : "S71-f268", "label" : {
                "name" : "No",
                "segment" : 0.56
              } }
          ]
        }, {
          "id" : "S71-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 64 }
          },
          "parentConnector" : "f61",
          "connect" : { "id" : "S71-f0", "to" : "S71-f209", "via" : [ { "x" : 152, "y" : 64 } ] }
        }, {
          "id" : "S71-g1",
          "type" : "EmbeddedStart",
          "name" : "in 2",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f175",
          "connect" : { "id" : "S71-f1", "to" : "S71-f209" }
        }, {
          "id" : "S71-g2",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 224, "y" : 144 }
          },
          "parentConnector" : "f176"
        } ],
      "visual" : {
        "at" : { "x" : 384, "y" : 624 }
      },
      "connect" : { "id" : "f176", "to" : "S30" }
    }, {
      "id" : "S80",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S80-f212",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -24 }
          },
          "connect" : [
            { "id" : "S80-f2", "to" : "S80-g2", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.util.PermissionUtils.checkAccessFullTaskListPermission()" },
            { "id" : "S80-f271", "to" : "S80-f270", "label" : {
                "name" : "No"
              } }
          ]
        }, {
          "id" : "S80-f270",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 224 }
          }
        }, {
          "id" : "S80-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 72, "y" : 64 }
          },
          "parentConnector" : "f24",
          "connect" : { "id" : "S80-f0", "to" : "S80-f212", "via" : [ { "x" : 152, "y" : 64 } ] }
        }, {
          "id" : "S80-g1",
          "type" : "EmbeddedStart",
          "name" : "in 2",
          "visual" : {
            "at" : { "x" : 72, "y" : 144 }
          },
          "parentConnector" : "f178",
          "connect" : { "id" : "S80-f1", "to" : "S80-f212" }
        }, {
          "id" : "S80-g2",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 232, "y" : 144 }
          },
          "parentConnector" : "f179"
        } ],
      "visual" : {
        "at" : { "x" : 384, "y" : 784 }
      },
      "connect" : { "id" : "f179", "to" : "S20" }
    }, {
      "id" : "f79",
      "type" : "Script",
      "name" : "Find case",
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.ivydata.service.impl.CaseService;",
            "in.caseSelected = CaseService.newInstance().findCaseById(in.caseId);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 2784 }
      },
      "connect" : { "id" : "f172", "to" : "S41" }
    }, {
      "id" : "f145",
      "type" : "Script",
      "name" : "Find task",
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.ivydata.service.impl.TaskService;",
            "in.taskSelected = TaskService.newInstance().findTaskById(in.taskId);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 2864 }
      },
      "connect" : { "id" : "f165", "to" : "S42" }
    }, {
      "id" : "S42",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S42-f168",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 384, "y" : 176 }
          }
        }, {
          "id" : "S42-f165",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S42-f1", "to" : "S42-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.isAuthorized" },
            { "id" : "S42-f170", "to" : "S42-f168", "via" : [ { "x" : 320, "y" : 176 } ], "label" : {
                "name" : "No",
                "segment" : 1.26
              } }
          ]
        }, {
          "id" : "S42-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f165",
          "connect" : { "id" : "S42-f3", "to" : "S42-f2" }
        }, {
          "id" : "S42-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 488, "y" : 144 }
          },
          "parentConnector" : "f155"
        }, {
          "id" : "S42-f2",
          "type" : "Script",
          "name" : "Init isAuthorized",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.enums.PortalPermission;",
                "import ch.ivy.addon.portalkit.util.PermissionUtils;",
                "in.isAuthorized = PermissionUtils.hasPortalPermission(PortalPermission.TASK_CASE_SHOW_MORE_NOTE) && in.#taskSelected is initialized;"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 192, "y" : 144 }
          },
          "connect" : { "id" : "S42-f0", "to" : "S42-f165" }
        } ],
      "visual" : {
        "at" : { "x" : 384, "y" : 2864 }
      },
      "connect" : { "id" : "f155", "to" : "f152" }
    }, {
      "id" : "f154",
      "type" : "RequestStart",
      "name" : "TaskDetailsLink.ivp",
      "config" : {
        "callSignature" : "TaskDetailsLink",
        "input" : {
          "params" : [
            { "name" : "taskDetailsId", "type" : "Long" }
          ],
          "map" : {
            "out.taskId" : "param.taskDetailsId"
          }
        },
        "outLink" : "TaskDetailsLink.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 3456 },
        "labelOffset" : { "x" : -31, "y" : 41 }
      },
      "connect" : { "id" : "f246", "to" : "f252" }
    }, {
      "id" : "f212",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 848, "y" : 3456 }
      }
    }, {
      "id" : "f233",
      "type" : "RequestStart",
      "name" : "CaseDetailsLink.ivp",
      "config" : {
        "callSignature" : "CaseDetailsLink",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" }
          ],
          "map" : {
            "out.caseId" : "param.caseId"
          }
        },
        "outLink" : "CaseDetailsLink.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 3656 },
        "labelOffset" : { "x" : -31, "y" : 41 }
      },
      "connect" : { "id" : "f256", "to" : "f255" }
    }, {
      "id" : "f239",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 968, "y" : 3656 }
      }
    }, {
      "id" : "S62",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S62-f26",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S62-f1", "to" : "S62-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.#caseSelected is initialized" },
            { "id" : "S62-f278", "to" : "S62-f277", "label" : {
                "name" : "No",
                "segment" : 0.48
              } }
          ]
        }, {
          "id" : "S62-f277",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 224 }
          }
        }, {
          "id" : "S62-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f244",
          "connect" : { "id" : "S62-f0", "to" : "S62-f26" }
        }, {
          "id" : "S62-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 }
          },
          "parentConnector" : "f245"
        } ],
      "visual" : {
        "at" : { "x" : 536, "y" : 3656 }
      },
      "connect" : { "id" : "f245", "to" : "f240" }
    }, {
      "id" : "f238",
      "type" : "Script",
      "name" : "Find Case",
      "config" : {
        "security" : "system",
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.ivydata.service.impl.CaseService;",
            "",
            "out.caseSelected = CaseService.newInstance().findCaseById(in.caseId);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 392, "y" : 3656 }
      },
      "connect" : { "id" : "f244", "to" : "S62" }
    }, {
      "id" : "f240",
      "type" : "SubProcessCall",
      "name" : "OpenPortalCaseDetails",
      "config" : {
        "processCall" : "Functional Processes/OpenPortalCaseDetailsHook:call(ch.ivyteam.ivy.workflow.ICase,Boolean)",
        "call" : {
          "params" : [
            { "name" : "caseData", "type" : "ch.ivyteam.ivy.workflow.ICase" },
            { "name" : "isShowBackButton", "type" : "Boolean" }
          ],
          "map" : {
            "param.caseData" : "in.caseSelected",
            "param.isShowBackButton" : "false"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 752, "y" : 3656 },
        "size" : { "width" : 256, "height" : 60 }
      },
      "connect" : { "id" : "f247", "to" : "f239" }
    }, {
      "id" : "S43",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S43-f180",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 152, "y" : 144 },
            "labelOffset" : { "x" : 16, "y" : -16 }
          },
          "connect" : [
            { "id" : "S43-f1", "to" : "S43-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "ch.ivy.addon.portalkit.ivydata.service.impl.TaskService.newInstance().isTaskAccessible(in.taskId)" },
            { "id" : "S43-f183", "to" : "S43-f182", "label" : {
                "name" : "No",
                "segment" : 0.39
              } }
          ]
        }, {
          "id" : "S43-f182",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 152, "y" : 232 }
          }
        }, {
          "id" : "S43-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f257",
          "connect" : { "id" : "S43-f0", "to" : "S43-f180" }
        }, {
          "id" : "S43-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 }
          },
          "parentConnector" : "f251"
        } ],
      "visual" : {
        "at" : { "x" : 400, "y" : 3456 }
      },
      "connect" : { "id" : "f251", "to" : "f250" }
    }, {
      "id" : "f250",
      "type" : "SubProcessCall",
      "name" : "Functional Processes/Navigator",
      "config" : {
        "processCall" : "Functional Processes/Navigator:viewRelatedTask(Long,Boolean)",
        "call" : {
          "params" : [
            { "name" : "taskId", "type" : "Long" },
            { "name" : "showItemDetailsHeader", "type" : "Boolean" }
          ],
          "map" : {
            "param.taskId" : "in.taskId",
            "param.showItemDetailsHeader" : "false"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 616, "y" : 3456 },
        "size" : { "width" : 260, "height" : 58 }
      },
      "connect" : { "id" : "f218", "to" : "f212" }
    }, {
      "id" : "f219",
      "type" : "RequestStart",
      "name" : "DashboardPage.ivp",
      "config" : {
        "callSignature" : "DashboardPage",
        "input" : {
          "params" : [
            { "name" : "dashboardId", "type" : "String" },
            { "name" : "openWithoutMenu", "type" : "Boolean" }
          ],
          "map" : {
            "out.dashboardId" : "param.dashboardId",
            "out.isOpenWithoutMenu" : "param.openWithoutMenu"
          }
        },
        "outLink" : "DashboardPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 64 }
      },
      "connect" : { "id" : "f248", "to" : "f223" }
    }, {
      "id" : "f223",
      "type" : "Script",
      "name" : "Store dashboardId to session",
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.util.DashboardUtils;",
            "import ch.addon.portal.generic.userprofile.homepage.HomepageType;",
            "import ch.ivy.addon.portalkit.enums.SessionAttribute;",
            "import ch.ivy.addon.portalkit.util.SecurityServiceUtils;",
            "",
            "DashboardUtils.storeDashboardInSession(in.dashboardId);",
            "in.isOpenDashboardFromLink = true;",
            "if (in.isOpenWithoutMenu) {",
            "  SecurityServiceUtils.setSessionAttribute(SessionAttribute.PORTAL_IN_TEAMS.toString(), true);",
            "  SecurityServiceUtils.setSessionAttribute(SessionAttribute.DEFAULT_PAGE_IN_TEAMS.toString(), HomepageType.DASHBOARD.toString()); ",
            "}"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 296, "y" : 64 }
      },
      "connect" : { "id" : "f249", "to" : "f21", "via" : [ { "x" : 384, "y" : 144 } ] }
    }, {
      "id" : "f252",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 240, "y" : 3456 }
      },
      "connect" : [
        { "id" : "f259", "to" : "f253", "condition" : "ivy.session.isSessionUserUnknown()" },
        { "id" : "f257", "to" : "S43" }
      ]
    }, {
      "id" : "f253",
      "type" : "Script",
      "name" : [
        "Redirect to",
        "login page"
      ],
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivy.addon.portal.generic.navigation.PortalNavigator;",
            "PortalNavigator.navigateToPortalLoginPage();"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 240, "y" : 3552 }
      }
    }, {
      "id" : "f255",
      "type" : "Alternative",
      "visual" : {
        "at" : { "x" : 240, "y" : 3656 }
      },
      "connect" : [
        { "id" : "f254", "to" : "f253", "condition" : "ivy.session.isSessionUserUnknown()" },
        { "id" : "f170", "to" : "f238" }
      ]
    }, {
      "id" : "S92",
      "type" : "EmbeddedProcess",
      "name" : "Authorize",
      "elements" : [ {
          "id" : "S92-f256",
          "type" : "Alternative",
          "name" : "Authorized?",
          "visual" : {
            "at" : { "x" : 320, "y" : 144 },
            "labelOffset" : { "x" : 24, "y" : -16 }
          },
          "connect" : [
            { "id" : "S92-f1", "to" : "S92-g1", "label" : {
                "name" : "Yes"
              }, "condition" : "in.isAuthorized" },
            { "id" : "S92-f259", "to" : "S92-f258", "label" : {
                "name" : "No"
              } }
          ]
        }, {
          "id" : "S92-f258",
          "type" : "TaskEnd",
          "visual" : {
            "at" : { "x" : 320, "y" : 224 }
          }
        }, {
          "id" : "S92-g0",
          "type" : "EmbeddedStart",
          "name" : "in 1",
          "visual" : {
            "at" : { "x" : 64, "y" : 144 }
          },
          "parentConnector" : "f263",
          "connect" : { "id" : "S92-f3", "to" : "S92-f2" }
        }, {
          "id" : "S92-g1",
          "type" : "EmbeddedEnd",
          "name" : "out 1",
          "visual" : {
            "at" : { "x" : 456, "y" : 144 }
          },
          "parentConnector" : "f262"
        }, {
          "id" : "S92-f2",
          "type" : "Script",
          "name" : "Init isAuthorized",
          "config" : {
            "output" : {
              "code" : [
                "import ch.ivy.addon.portalkit.util.PermissionUtils;",
                "in.isAuthorized = PermissionUtils.hasDashboardWriteOwnPermission()",
                "  || PermissionUtils.hasDashboardWritePublicPermission();"
              ]
            }
          },
          "visual" : {
            "at" : { "x" : 192, "y" : 144 }
          },
          "connect" : { "id" : "S92-f0", "to" : "S92-f256" }
        } ],
      "visual" : {
        "at" : { "x" : 248, "y" : 3784 }
      },
      "connect" : { "id" : "f262", "to" : "f260" }
    }, {
      "id" : "f258",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 640, "y" : 3784 }
      }
    }, {
      "id" : "f260",
      "type" : "DialogCall",
      "name" : "PortalDashboardConfiguration",
      "config" : {
        "dialogId" : "ch.ivy.addon.portal.generic.dashboard.PortalDashboardConfiguration",
        "startMethod" : "PortalDashboadConfigurationEditPage(Boolean)",
        "call" : {
          "params" : [
            { "name" : "isPublicDashBoard", "type" : "Boolean" }
          ],
          "map" : {
            "param.isPublicDashBoard" : "in.isPublicDashboard"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 464, "y" : 3784 },
        "size" : { "width" : 256, "height" : 60 }
      },
      "connect" : { "id" : "f264", "to" : "f258" }
    }, {
      "id" : "f261",
      "type" : "RequestStart",
      "name" : "PortalDashboardConfigurationEditPage.ivp",
      "config" : {
        "callSignature" : "PortalDashboardConfigurationEditPage",
        "input" : {
          "params" : [
            { "name" : "isPublicDashboard", "type" : "Boolean" }
          ],
          "map" : {
            "out.isPublicDashboard" : "param.isPublicDashboard"
          }
        },
        "outLink" : "PortalDashboardConfigurationEditPage.ivp",
        "showInStartList" : false,
        "case" : { }
      },
      "visual" : {
        "at" : { "x" : 144, "y" : 3784 },
        "labelOffset" : { "x" : -55, "y" : 33 }
      },
      "connect" : { "id" : "f263", "to" : "S92" }
    } ]
}