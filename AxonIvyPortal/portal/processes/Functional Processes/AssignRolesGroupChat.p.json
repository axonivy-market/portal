{
  "format" : "10.0.0",
  "id" : "169B2A4D199FA6EA",
  "kind" : "CALLABLE_SUB",
  "config" : {
    "data" : "ch.ivy.addon.portal.generic.AssignRolesGroupChatData"
  },
  "elements" : [ {
      "id" : "f0",
      "type" : "CallSubStart",
      "name" : "configureRolesForGroupChat(ITask)",
      "config" : {
        "callSignature" : "configureRolesForGroupChat",
        "input" : {
          "params" : [
            { "name" : "task", "type" : "ch.ivyteam.ivy.workflow.ITask" }
          ],
          "map" : {
            "out.task" : "param.task"
          }
        },
        "result" : {
          "params" : [
            { "name" : "roles", "type" : "java.util.List<ch.ivyteam.ivy.security.IRole>" }
          ],
          "map" : {
            "result.roles" : "in.roles"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 112, "y" : 40 },
        "labelOffset" : { "x" : 145, "y" : 1 }
      },
      "connect" : { "id" : "f4", "to" : "f7" }
    }, {
      "id" : "f1",
      "type" : "CallSubEnd",
      "visual" : {
        "at" : { "x" : 112, "y" : 248 }
      }
    }, {
      "id" : "f3",
      "type" : "ProcessAnnotation",
      "name" : [
        "Use this callable to configure a predefined list of responsible roles for group chat feature. ",
        "By default, this does nothing. Set value of in.roles to customize this role list.",
        "",
        "e.g. set predefined role HR for the process leave request.",
        "String processPath = in.task.getCase().getProcessStart().getUserFriendlyRequestPath();",
        "if (processPath.contains(\"Start Processes/CreateTestData/CategoriedLeaveRequest.ivp\")) {",
        "  in.roles.add(ISecurityContext.current().roles().find(\"HR\"));",
        "}"
      ],
      "visual" : {
        "at" : { "x" : 448, "y" : 152 },
        "size" : { "width" : 512, "height" : 140 }
      }
    }, {
      "id" : "f7",
      "type" : "Script",
      "name" : [
        "Call customized",
        "sub process"
      ],
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivyteam.ivy.security.IRole;",
            "import org.apache.commons.lang3.StringUtils;",
            "import java.util.HashMap;",
            "import java.util.Map;",
            "import com.axonivy.portal.components.enums.PortalCustomSignature;",
            "import com.axonivy.portal.components.service.IvyAdapterService;",
            "",
            "Map params = new HashMap();",
            "params.put(\"task\", in.task);",
            "",
            "Map result = IvyAdapterService.startSubProcessInSecurityContext(PortalCustomSignature.CONFIGURE_ROLES_FOR_GROUP_CHAT.getSignature(), params);",
            "if (result != null) {",
            "  in.roles = result.get(\"roles\") as List;",
            "}"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 112, "y" : 144 }
      },
      "connect" : { "id" : "f2", "to" : "f1" }
    } ]
}