<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:pc="http://xmlns.jcp.org/jsf/composite/components">
<h:body>
  <ui:composition template="/layouts/BasicTemplate.xhtml">
    <ui:define name="title">#{ivy.cms.co('/Labels/MenuConfiguration')}</ui:define>
    <ui:define name="pageContent">
      <div class="dashboard-configuration-page">
        <div class="w-full flex flex-column card">
          <div class="col-12 dashboard-configuration__header">
            <h2>#{ivy.cms.co('/Labels/MenuConfiguration')}</h2>
            <span>#{ivy.cms.co('/Dialogs/com/axonivy/portal/page/MenuManagement/HelpText')}</span>
          </div>
          <div class="col-12 flex flex-row-reverse">
            <h:form class="w-full">
              <p:commandButton id="create-menu-action" actionListener="#{menuManagementBean.onCreateNewMenu}"
                  value="#{ivy.cms.co('/Dialogs/com/axonivy/portal/page/MenuManagement/AddNewMenu')}" 
                  styleClass="dashboard-action-container-icon #{selectedDashboardTypeStyleClass} w-full primary-color-light-button"
                  partialSubmit="true" global="false"
                  update="#{p:resolveFirstComponentWithId('menu-configuration-dialog', view).clientId}"
                  oncomplete="PF('menu-configuration-dialog').show();"
                  title="#{ivy.cms.co('/Dialogs/com/axonivy/portal/page/MenuManagement/AddNewMenu')}"
                  ariaLabel="#{ivy.cms.co('/Dialogs/com/axonivy/portal/page/MenuManagement/AddNewMenu')}" />
            </h:form>
          </div>

          <h:panelGroup layout="block" id="menu-table-container" styleClass="col-12">
            <p:dataTable value="#{menuManagementBean.menuDefinitions}" var="menu" id="menu-table"
              emptyMessage="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/noRecordsFound')}"
              draggableRows="true" rowDragSelector="i.si-navigation-menu">
              <p:ajax event="rowReorder" global="false" update="menu-table" listener="#{menuManagementBean.onRowReorder}"/>

              <p:column headerText="#{ivy.cms.co('/Dialogs/com/axonivy/portal/page/MenuManagement/MenuTitle')}">
                <h:outputText value="#{menuManagementBean.getDisplayMenuTitle(menu)}" />
            </p:column>

            <p:column headerText="#{ivy.cms.co('/Labels/Permissions')}">
                <h:outputText value="#{menu.displayedPermission}" />
            </p:column>

            <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/type')}" width="150">
              <h:outputText value="#{menuManagementBean.getMenuKindLabel(menu.type)}" />
            </p:column>

            <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/action')}"
              width="100" styleClass="text-center">
              <div class="w-full flex justify-content-center">
                <p:commandButton id="action-button" icon="fa fa-ellipsis-h"
                  ariaLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/action')}"
                  styleClass="rounded-button icon-more-menu-button #{buttonStyle} ui-no-rounded-button-process-page" type="button" />
                  <p:menu id="configuration-action-menu" styleClass="w-10rem" overlay="true" trigger="action-button"
                    my="right top" at="right bottom">
                    <p:menuitem id="edit" process="@this" actionListener="#{menuManagementBean.onEditMenu(menu)}"
                      icon="si si-graphic-tablet-drawing-pen" styleClass="dashboard-configuration-action-menu-icon"
                      update="menu-configuration-dialog" global="false"
                      value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/edit')}" oncomplete="PF('menu-configuration-dialog').show()"
                      target="_blank" resetValues="true" title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/edit')}" rendered="true" />
                    <p:menuitem id="delete" process="@this" styleClass="rounded-button ui-button-outlined ui-button-danger color-destroy"
                      rendered="#{menu.type ne 'STANDARD'}"
                      icon="si si-bin-1" actionListener="#{menuManagementBean.setSelectedMenuDefinition(menu)}" global="false"
                      update="remove-menu-dialog" oncomplete="PF('remove-menu-dialog').show()"
                      title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/delete')}"
                      value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/delete')}" />
                  </p:menu>
              </div>
            </p:column>

            <p:column styleClass="settings-table-reorder w-3rem">
              <h:panelGroup styleClass=" ui-button-outlined action-column-icon-button u-mar-right-5">
                <i id="reorder-button-#{menu.id}" class="si si-navigation-menu dashboard-icon-drag-drop" />
              </h:panelGroup>
            </p:column>

            </p:dataTable>
          </h:panelGroup>
        </div>
      </div>

      <ui:include src="MenuDetailsDialog.xhtml" />

      <ui:decorate template="/layouts/decorator/portal-dialog-with-icon.xhtml">
        <ui:param name="id" value="remove-menu-dialog" />
        <ui:param name="widgetVar" value="remove-menu-dialog" />
        <ui:param name="iconClass" value="si si-delete-1" />
        <ui:param name="appendTo" value="@(body)" />
        <ui:param name="closeable" value="true" />
        <ui:param name="closeOnEscape" value="true" />
        <ui:param name="iconStyleClass" value="portal-dialog-error-icon portal-dialog-icon" />
        <ui:param name="headerText"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/dashboardManagement/deleteDashboardMessage',[menuManagementBean.getDisplayMenuTitle(menuManagementBean.selectedMenuDefinition)])}" />
        <ui:define name="dialogFooter">
          <div class="flex flex-column">
          <p:commandButton id="remove-menu-button" styleClass="w-full portal-remove-button"
            value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/delete')}"
            actionListener="#{menuManagementBean.removeMenu}"
            update="menu-table-container"
            oncomplete="location.reload();" />
          <p:link href="#" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
            onclick="PF('remove-menu-dialog').hide();" styleClass="ui-button-flat pt-3 flex justify-content-center" />
          </div>
        </ui:define>
      </ui:decorate>
    </ui:define>
  </ui:composition>
</h:body>

</html>
