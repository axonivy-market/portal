<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
  xmlns:pc="http://xmlns.jcp.org/jsf/composite/components">
<cc:interface componentType="IvyComponent">
  <cc:attribute name="managedBean" required="true" />
  <cc:attribute name="shareDialogId" required="true" />
</cc:interface>

<cc:implementation>
  <c:set var="managedBean" value="#{cc.attrs.managedBean}" />

  <p:dialog id="#{cc.attrs.shareDialogId}"
    widgetVar="#{cc.attrs.shareDialogId}"
    styleClass="share-dialog"
    header="#{ivy.cms.co('/Dialogs/com/axonivy/portal/dashboard/component/DashboardSharing/ShareDashboard')}" appendTo="@(body)" closeOnEscape="true"
    draggable="false" fitViewport="true" responsive="true" modal="true" closable="false" 
    width="auto" focus="@(none)" onShow="checkCopyFeature()">

    <div class="ui-fluid ui-inputgroup">
      <p:inputText id="dashboard-url"
        value="#{managedBean.dashboardUrl}" readonly="true"
        styleClass="manage-dashboard__input" />
    </div>
    <f:facet name="footer">
      <h:panelGroup layout="block" styleClass="u-text-align-right">
        <p:commandLink id="dashboard-detail-close-button" type="button"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/close')}"
          onclick="PF('#{cc.attrs.shareDialogId}').hide()" global="false"/>
        <p:spacer width="15" />
        <p:commandButton id="dashboard-share-copy-button" 
          value="#{ivy.cms.co('/Dialogs/com/axonivy/portal/dashboard/component/DashboardSharing/CopyLink')}"
          onclick="copyToClipboard('#{managedBean.dashboardUrl}')" 
          actionListener="#{managedBean.showDashboardUrlCopiedMessage(ivy.cms.co('/Dialogs/com/axonivy/portal/dashboard/component/DashboardSharing/LinkCopied'))}"
          update=":portal-global-growl" global="false"/>
      </h:panelGroup>
    </f:facet>
  </p:dialog>
    
    <script type="text/javascript">
      var clipboard = navigator.clipboard;
      function checkCopyFeature(){
        if (clipboard == undefined) {
          $("button[id$=':dashboard-share-copy-button']")[0].remove();
        }
      }
      function copyToClipboard(text) {
        clipboard.writeText(text);
        PF('#{cc.attrs.shareDialogId}').hide();
      }
    </script>
</cc:implementation>
</html>