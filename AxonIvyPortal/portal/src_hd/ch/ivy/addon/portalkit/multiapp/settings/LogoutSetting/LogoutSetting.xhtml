<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite"
  xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://java.sun.com/jsp/jstl/core">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="task" />
  <cc:attribute name="isWorkingOnATask" type="java.lang.Boolean" />
</cc:interface>

<cc:implementation>
  <f:event listener="#{logic.init(cc.attrs.isWorkingOnATask)}"
    type="preRenderComponent" />

  <c:set var="task"
    value="#{not empty cc.attrs.task ? cc.attrs.task : ivy.task}" />

  <p:commandLink id="logout-menu-item"
    value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/logoutSetting/logout')}"
    rendered="#{!userMenuBean.hiddenLogout}"
    actionListener="#{logic.logout(task)}" global="false" />

    <!-- Warning before leaving task -->
  <ic:ch.ivy.addon.portalkit.component.WarningBeforeLeavingTask id="warning-before-leaving-task-component" componentId="task-leave-warning-dialog"
    widgetVar="logoutConfirmation" renderedDialog="#{data.isWorkingOnATask}" taskState="#{task.state}"
    reserveActionListener="#{logic.reserveTask(task)}" reserveOnComplete="hideErrorDialogAfterReserve(); returnHomePage();"
    cancelOnClick="PF('logoutConfirmation').hide();"
    isLogout="true" logoutActionListener="#{logic.logoutInDialog(task)}" logoutOnComplete="returnHomePage()">
  </ic:ch.ivy.addon.portalkit.component.WarningBeforeLeavingTask>

  <script>
	function returnHomePage() {
      showConfirmDialogBeforeUnload = false;
      window.open('#{userMenuBean.logoutPage}', '_self');
	}

    function hideErrorDialogAfterReserve() {
      $('.js-notification-container').hide();
    }
  </script>
</cc:implementation>
</html>