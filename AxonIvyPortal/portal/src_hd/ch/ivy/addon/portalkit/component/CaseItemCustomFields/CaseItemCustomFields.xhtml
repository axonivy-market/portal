<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
  xmlns:pc="http://xmlns.jcp.org/jsf/composite/components">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="case" shortDescription="Selected case" type="ch.ivyteam.ivy.workflow.ICase"/>
</cc:interface>

<cc:implementation>
  <p:remoteCommand name="initCustomFieldCaseListData" actionListener="#{logic.getCustomFieldsData(cc.attrs.case)}" oncomplete="PF('case-custom-fields-dialog').show()" update="#{cc.clientId}:case-custom-fields-dialog" global="false"/>
  <p:dialog id="case-custom-fields-dialog" widgetVar="case-custom-fields-dialog" 
    header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseDetails/customFieldsDialog', [cc.attrs.case.id])}"
    dynamic="true" closable="true" closeOnEscape="true"
    appendTo="@(body)"
    modal="true" responsive="true" fitViewport="true"
    styleClass="custom-fields-dialog">
  <p:dataTable id="customFieldsTable" var="field" value="#{data.customFieldList}" emptyMessage="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/noRecordsFound')}" >
    <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/name')}" styleClass="field-name">
      <h:outputText id="customFieldLabel" value="#{field.name()}" styleClass="custom-field-tooltip-target" title="#{field.name()}"/>
    </p:column>
    
    <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/adminSettings/value')}" styleClass="field-value">
      <h:outputText id="number-value" value="#{field.getOrNull()}" styleClass="custom-field-tooltip-target" title="#{field.getOrNull()}" rendered="#{field.type() eq 'NUMBER'}">
        <f:convertNumber type="number" integerOnly="true" />
      </h:outputText>
      
      <h:outputText id="timestamp-value" value="#{field.getOrNull()}" styleClass="custom-field-tooltip-target" title="#{field.getOrNull()}" rendered="#{field.type() eq 'TIMESTAMP'}">
        <f:convertDateTime locale="#{localeBean.locale}" pattern="#{dateTimePatternBean.dateTimestampPattern}"/>
      </h:outputText>
      
      <h:outputText id="value" value="#{field.getOrNull()}" styleClass="custom-field-tooltip-target" title="#{field.getOrNull()}" rendered="#{field.type() ne 'TIMESTAMP' and field.type() ne 'NUMBER'}" />
    </p:column>
    
    <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/type')}" styleClass="field-type">
      <h:outputText id="customFieldType" value="#{field.type()}" styleClass="custom-field-tooltip-target" title="#{field.type()}"/>
    </p:column>
  </p:dataTable>

  <p:tooltip globalSelector="span.custom-field-tooltip-target" styleClass="custom-field-dialog-field-tooltip" hideEvent="mouseleave click"/>
  </p:dialog>

</cc:implementation>
</html>