<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:body>
  <p:messages id="error-message" showSummary="false" showDetail="true" />
  <h:form id="userListForm" styleClass="acm-user-list-form">
    <h:panelGrid columns="1" styleClass="add-user-panel">
      <p:autoComplete scrollHeight="200" dropdown="true" id="userList" size="35" styleClass="add-user-list"
        completeMethod="#{logic.autoCompleteForUser}"
        value="#{data.selectedUser}"
        var="user" itemValue="#{user}" itemLabel="#{user.name}"
        converter="pojoConverter" cache="true" maxResults="100"
        moreText="#{component.suggestions.size() - component.maxResults} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/more')}...">
        <f:event listener="#{logic.autoCompleteForUser}" type="preRenderComponent" />
        <p:ajax event="itemSelect" global="false" update="addUserButton" />
        <p:ajax event="query" global="false" />
      </p:autoComplete>
      <p:commandButton id="addUserButton" styleClass="add-user-button" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/add')}"
        disabled="#{data.selectedUser == null}" actionListener="#{logic.insertToUserList}" global="false" update="userSelection error-message" />
    </h:panelGrid>

    <p:fieldset legend="#{ivy.cms.co('/Dialogs/agileBPM/define_WF/ListOfSelectedUser')}" styleClass="selected-user-panel">
      <p:selectManyMenu id="userSelection" value="#{data.userSelection}" var="u" showCheckbox="true" scrollHeight="202"
        filter="true" filterMatchMode="contains" converter="ivy.ListItem" styleClass="acm-assignee-selection">
        <f:selectItems value="#{data.userSelection}" var="user" itemValue="#{user}"
          itemLabel="#{user.getDisplayName().length() ne 0 ? user.getDisplayName() : user.getName()}" />
        <p:column>
          <h:outputText value="#{u.getDisplayName().length() ne 0 ? u.getDisplayName() : u.getName()}" />
        </p:column>
        <p:ajax update="userListForm error-message" process="@this" listener="#{logic.removeFromUserList}" />
      </p:selectManyMenu>
    </p:fieldset>

    <p:commandButton value="Ok" update=":form:taskDef" actionListener="#{logic.setUser}" icon="fa fa-check"
      oncomplete="PF('userList').hide();" styleClass="Fright select-user-ok-button" />
  </h:form>
</h:body>

</html>