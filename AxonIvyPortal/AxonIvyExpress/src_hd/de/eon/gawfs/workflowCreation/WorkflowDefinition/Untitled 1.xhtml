<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:pm="http://primefaces.org/mobile">
<h:body>
	<ui:composition template="/layouts/GenericCaseViewBase.xhtml">
		<!-- 		<ui:composition template="/layouts/BasicTemplate.xhtml"> -->
		<ui:param name="caseId" value="#{ivy.case.id}" />
		<ui:param name="task" value="#{ivy.task}" />
		<ui:param name="steps" value="#{data.data.steps}" />
		<ui:param name="actualStepIndex" value="1" />


		<ui:define name="title">DnDTesting</ui:define>
		<ui:define name="caseForm">
			<h:form id="form">
				<p:fieldset id="prozessSettingsField" legend="Prozesseigenschaften">
					<p:panelGrid id="prozessSettingsGrid"
						style="width:100%; border: none">
						<p:row>
							<p:column style="width:15%; border: none">
								<p:outputLabel value="Prozessart:" for="ProzessType" />
							</p:column>
							<p:column style="width:75%; border: none">
								<p:selectOneRadio id="ProzessType" value="#{data.data.processType}" >
									<f:selectItem itemLabel="Ad-hoc Workflow (einmalig)"
										itemValue="AHWF" />
									<f:selectItem
										itemLabel="Administratrierter Workflow (wiederkehrend)"
										itemValue="AMWF" />
									<f:selectItem
										itemLabel="Administrierter-Workflow (wiederkehrend, Serientyp)"
										itemValue="ASWF" itemDisabled="true" />
								</p:selectOneRadio>

							</p:column>
						</p:row>
						<p:row>
							<p:column style="width:15%; border: none">
								<p:outputLabel value="Prozessname:" for="Processname" />
							</p:column>
							<p:column style="width:75%; border: none">
								<p:inputText id="Processname" style="width:98%" value="#{data.data.processName}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column style="width:15%; border: none; vertical-align: top">
								<p:outputLabel value="Prozessbeschreibung:"
									for="Processdescription" />
							</p:column>
							<p:column style="width:75%; border: none">
								<p:inputTextarea id="Processdescription" style="width:98%" value="#{data.data.processDescription}"/>
							</p:column>
						</p:row>
					</p:panelGrid>

				</p:fieldset>

				<br />

				<p:fieldset id="processFlowField" legend="Prozessfluss" toggleable="true">

					<p:dataGrid id="processFlowGrid" var="gtask"
						value="#{data.data.definedTasks}" columns="1" style="border: none">

						<p:panel id="taskPnl"
							style="text-align:center;  vertical-align: middle; border: none;">
							<p:panelGrid style="border: none; text-align: left; width:100%">
								<p:row style="border: none;">
									<p:column colspan="5"
										style="border: none; border-bottom: thick solid #656565;">
										<p:outputLabel value="#{gtask.count}. Prozessschritt"
											style="font-size:20px;" />
									</p:column>
								</p:row>
								<p:row style="border: none;">
									<p:column colspan="1" rowspan="2" style="border: none; width:15px;">
										<i class="fa fa-long-arrow-down fa-4x"></i>
									</p:column>
									<p:column colspan="1" rowspan="1" style="width:15%; border: none;">
										<p:outputLabel value="Aufgabe:" />
									</p:column>
									<p:column colspan="1" rowspan="1" style="width:35%; border: none;">
										<p:inputText value="#{gtask.subject}"></p:inputText>
									</p:column>
									<p:column colspan="1" rowspan="1" style="width:15%; border: none;">
										<p:outputLabel value="Aufgabenbeschreibung:" />
									</p:column>
									<p:column colspan="1" rowspan="1" style="width:35%; border: none;">
										<p:inputText value="#{gtask.description}"></p:inputText>
									</p:column>
								</p:row>
								<p:row style="border: none;">
									<p:column colspan="1" rowspan="1" style="border: none;">
										<p:outputLabel value="Verantwortlicher:" rendered="#{gtask.count gt 1}"/>
										<p:outputLabel value="Startberechtigt:" rendered="#{gtask.count == 1}"/>
									</p:column>
									<p:column colspan="1" rowspan="1" style="border: none;">
												<p:inputText value="#{gtask.actor}"
													readonly="false">
													<p:ajax event="mousedown" process="case-information:form:processFlowField"
														listener="#{logic.initAssginement(gtask)}"
														update="case-information:form:processFlowField"
														oncomplete="PF('chooseAssignee').show();" />
												</p:inputText>
									</p:column>
									<p:column colspan="1" rowspan="1" style="border: none;">
										<p:outputLabel value="Fälligkeitsfrist in Tagen:" rendered="#{gtask.count gt 1}"/>
									</p:column>
									<p:column colspan="1" rowspan="1" style="border: none;">
										<p:spinner value="#{gtask.untilDays}" min="1" rendered="#{gtask.count gt 1}"></p:spinner>
									</p:column>
								</p:row>
							</p:panelGrid>
						</p:panel>

						<p:panelGrid style="border: none; text-align: left; width:100%" rendered="#{data.data.definedTasks.size() == gtask.count}">
							<p:row>
								<p:column colspan="1" style="border: none; text-align: left; width: 100%;">
									<p:commandButton icon="fa fa-plus" title=" " styleClass="buttonRound"
											actionListener="#{logic.addProcessStep}"
											process="processFlowGrid"
											update="processFlowGrid">
											

									</p:commandButton>
<!-- 									<i class="fa fa-plus-circle fa-2x"></i> -->
<!-- 								</p:column> -->
<!-- 								<p:column colspan="1" style="border: none; width: 100%"> -->
									<p:spacer width="12px"/>
									<p:outputLabel value="Weiteren Prozesschritt hinzufügen!"
										style="font-size:16px;" />
								</p:column>
								
								<p:column colspan="1" style="border: none;">
								
									<p:commandButton icon="fa fa-trash" title=" " styleClass="buttonRound"
									rendered="#{data.data.definedTasks.size()>1}"
	 										actionListener="#{logic.deleteProcessStep}"
											process="processFlowGrid"
											update="processFlowGrid">
											
									</p:commandButton>
									
								</p:column>
							</p:row>
						</p:panelGrid>


					</p:dataGrid>
				</p:fieldset>
				<br />
				
				<p:outputPanel style="text-align: right">
					<p:commandButton actionListener="#{logic.close}" value="Weiter" update="form" icon="ui-icon-check" />
				</p:outputPanel>
				

			</h:form>
			
			<p:dialog id="chooseAssignee" header="Rolle oder User zuweisen:"
				widgetVar="chooseAssignee" modal="true" appendTo="@(body)"> 
				<ui:include src="ChooseAssignee.xhtml"></ui:include>
			</p:dialog>
			
			
			
			

		</ui:define>
	</ui:composition>
</h:body>
</html>