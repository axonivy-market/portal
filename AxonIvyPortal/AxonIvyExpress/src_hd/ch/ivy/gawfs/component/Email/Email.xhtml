<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://xmlns.jcp.org/jsf/core"      
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:ic="http://ivyteam.ch/jsf/component"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
      
  <cc:interface componentType="IvyComponent">
    <cc:attribute name="email" required="true" type="ch.ivy.gawmfs.UserEmail" />
    <cc:attribute name="responsibles" type="java.util.List"/>
    <cc:attribute name="isEmpty" type="java.lang.Boolean"/>
  </cc:interface>
  
  <cc:implementation>
    <c:set var="email" value="#{cc.attrs.email}" />
    <f:event listener="#{emailBean.init(email, cc.attrs.responsibles)}" type="preRenderComponent" />
    <h:panelGroup id="email-container" styleClass="ui-g">
      <div class="ui-g-12">
        <p:outputLabel for="email-recipients" styleClass="ui-g-2 express-email-label-right-align" value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/Email/EmailAddress')}: "/>
        <p:inputText id="email-recipients" styleClass="ui-g-10" value="#{email.recipients}"
                  requiredMessage="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/Email/EmailAddress')} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/requiredFieldMessage')}" />
      </div>
      <div class="ui-g-12">
        <p:outputLabel for="email-response-to" styleClass="ui-g-2 express-email-label-right-align" value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/Email/ResponseTo')}: "/>
        <p:inputText id="email-response-to" styleClass="ui-g-10" value="#{email.responseTo}"/>
      </div>
      <div class="ui-g-12">
        <p:outputLabel for="email-subject" styleClass="ui-g-2 express-email-label-right-align" value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/Email/Subject')}:"/>
        <p:inputText id="email-subject" styleClass="ui-g-10" value="#{email.subject}"
                  requiredMessage="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/Email/Subject')} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/requiredFieldMessage')}" />

      </div>
      <div class="ui-g-12">
        <p:outputLabel for="email-content" styleClass="ui-g-2 express-email-label-right-align" value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/Email/EmailText')}: "/>
        <p:textEditor id="email-content" styleClass="ui-g-10 text-editor-send-email" height="300" value="#{email.content}"
                  requiredMessage="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/Email/EmailText')} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/requiredFieldMessage')}">
          <f:facet name="toolbar">
                   <span class="ql-formats">
                      <button class="ql-bold"/>
                      <button class="ql-italic"/>
                      <button class="ql-underline"/>
                      <button class="ql-strike"/>
                  </span>
                  <span class="ql-formats">
                      <select class="ql-font"/>
                      <select class="ql-size"/>
                  </span>
              </f:facet>
        </p:textEditor>
      </div>
      <div class="ui-g-12">
        
        <p:outputLabel for="attachment-table" styleClass="ui-g-2 express-email-label-right-align" value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/Email/Attachment')}: "/>
        <p:dataTable id="attachment-table" value="#{email.attachments}"
          var="attachment" filteredValue="#{emailBean.filteredAttachments}"
          emptyMessage="#{ivy.cms.co('/Dialogs/components/CaseDocument/NoFiles')}"
          styleClass="MarTop5" widgetVar="attachmentTableVar">
          <p:column
            headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/documentFiles/name')}">
            <h:outputText value="#{attachment.name}"
              title="#{attachment.name}" />
          </p:column>
          <p:column
            headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/documentFiles/size')}">
            <h:outputText value="#{attachment.size}"
              title="#{attachment.size}" />
          </p:column>
    
          <p:column styleClass="u-text-align-center"
            headerText="#{ivy.cms.co('/Dialogs/components/CaseDocument/FileFunctions')}">
    
            <p:commandLink id="download" styleClass="fa fa-download MarRight10 email-attachment"
              immediate="true" ajax="false" process="attachmentTableVar"
              actionListener="#{emailBean.downloadAttachment(attachment)}"
              title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/documentFiles/download')}"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/documentFiles/download')}">
              <p:fileDownload value="#{emailBean.file}" />
            </p:commandLink>
            <p:spacer width="20px"></p:spacer>
            <p:commandLink id="document-delete" styleClass="fa fa-trash-o email-attachment"
              actionListener="#{emailBean.deleteAttachment(attachment)}" immediate="true"
              update="attachment-table"
              title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/delete')}"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/delete')}"
              oncomplete="PF('attachmentTableVar').filter();">
            </p:commandLink>
          </p:column>
        </p:dataTable>
        <script>
        $(document).ready(function() {
                    if (#{cc.attrs.isEmpty == null}) {
           PF('attachmentTableVar').filter();
                    }
        })
      </script>
      </div>
      <div class="ui-g-12">
        <div class="ui-g-1"></div>
        <p:messages id="document-message" for="attachment-table" closable="true" />
      </div>
      <div class="ui-g-12">
        <p:fileUpload id="choose-uploading-file" styleClass="email-attachment email-attachment-upload-btn"
          mode="advanced" auto="true" dragDropSupport="true" previewWidth="40"
          fileUploadListener="#{emailBean.uploadAttachment}" update="attachment-table document-message"
          label="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/documentFiles/upload')}"
                    invalidSizeMessage="#{masterDataBean.getFileUploadInvalidSizeMessage()}"
          cancelLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" oncomplete="PF('attachmentTableVar').filter();"
                    sizeLimit="#{masterDataBean.fileUploadSizeLimit}">
          <f:attribute name="panelId" value="attachment-table" />
        </p:fileUpload>
      </div>
      
    </h:panelGroup>
    
  </cc:implementation>
</html>