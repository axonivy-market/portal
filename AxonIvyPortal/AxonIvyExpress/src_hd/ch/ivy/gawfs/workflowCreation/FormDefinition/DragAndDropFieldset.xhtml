<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:body>
  <h:outputScript library="js" name="express-dyna-form.js" />

  <p:messages id="dnd-message" showDetail="false" autoUpdate="true" closable="true" for="available-form-elements" />
  <p:panelGrid id="form-elements-container" styleClass="form-elements-container card ui-g-12 u-no-padding-top" layout="grid" columns="2"
    columnClasses="form-elements-1st-column, form-elements-2nd-column">

    <p:fieldset id="available-formelements-field" styleClass="available-formelements-field"
      legend="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/FieldSetAvailableFormelements')}">
      <p:messages id="DnDmessage" showDetail="false" closable="true" for="availableFormelements">
       <p:autoUpdate />
      </p:messages>

      <p:dataGrid id="available-form-elements" var="formelement" styleClass="available-form-elements"
        emptyMessage="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/NoFormelementsAvailable')}"
        value="#{data.dragAndDropController.availableFormelements}" columns="1">
        <p:panel id="pnl" styleClass="TexAlCenter vertical-align-middle available-elements-panel ui-g card">
          <h:panelGroup styleClass="TexAlLeft ui-g-12">
            <div class="ui-g">
              <div class="ui-g-12 u-padding-0">
                <h:panelGroup class="available-elements-image">
                  <p:graphicImage library="ivy-cms" name="/Layouts/Icons/#{formelement.type.value}" width="55" />
                </h:panelGroup>

                <h:panelGroup styleClass="available-elements-action-btn">
                  <p:commandButton icon="fa fa-trash-o fa-3x" styleClass="placement-form-element-remove-btn"
                    actionListener="#{data.dragAndDropController.deleteFormelement(formelement)}" process="form:available-form-elements"
                    update="form:available-form-elements">
                  </p:commandButton>
                </h:panelGroup>
              </div>

              <h:panelGroup styleClass="ui-g-12 available-elements-label-col u-padding-0">
                <p:outputLabel value="#{formelement.label}" styleClass="available-elements-label" />
              </h:panelGroup>
            </div>
          </h:panelGroup>
        </p:panel>
        <p:draggable for="pnl" revert="true" stack=".ui-panel" />
      </p:dataGrid>
    </p:fieldset>

    <p:fieldset id="selected-formelements-field" styleClass="selected-formelements-field"
      legend="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/FieldSetFormelementsPlacing')}">
      <p:commandButton id="show-preview-button" value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/Preview')}"
        styleClass="Fright show-preview-button" icon="fa fa-search" oncomplete="PF('preview-dialog').show();"
        actionListener="#{data.dragAndDropController.updateForm}" process="@this" />

      <p:panelGrid styleClass="ui-g-12 form-definition-table">
        <p:row id="selected-form-elements-header-fieldset" styleClass="TexAlCenter form-definition-border-color">
          <p:column colspan="2">

            <p:outputPanel id="selected-form-elements-header-panel" styleClass="selected-formelements-panel header-section">
              <p:outputPanel rendered="#{empty data.dragAndDropController.selectedFormelementsHeader}">
                <br />
                <h:outputText value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/BroadHeaderArea')}" styleClass="Fs24" />
                <br />
                <br />
              </p:outputPanel>
              <h:outputText value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/BroadHeaderArea')}"
                rendered="#{not empty data.dragAndDropController.selectedFormelementsHeader}" />
              <p:dataGrid id="selected-formelements-header" var="formelement" styleClass="no-border selected-form-elements-header"
                value="#{data.dragAndDropController.selectedFormelementsHeader}"
                rendered="#{not empty data.dragAndDropController.selectedFormelementsHeader}" columns="1">
                <p:panel id="pnl" styleClass="TexAlCenter vertical-align-middle available-elements-panel ui-g card">
                  <h:panelGroup styleClass="TexAlLeft ui-g-12">
                    <div class="ui-g">
                      <div class="ui-g-12 u-padding-0">
                        <h:panelGroup class="available-elements-image">
                          <p:graphicImage library="ivy-cms" name="/Layouts/Icons/#{formelement.type.value}" width="55" />
                        </h:panelGroup>

                        <h:panelGroup styleClass="available-elements-action-btn">
                          <p:commandButton icon="fa fa-trash-o fa-3x" styleClass="placement-form-element-remove-btn"
                            actionListener="#{data.dragAndDropController.resetFormelementHeader(formelement)}"
                            process="form:selected-formelements-header" update="form">
                          </p:commandButton>
                        </h:panelGroup>
                      </div>

                      <h:panelGroup styleClass="ui-g-12 available-elements-label-col u-padding-0">
                        <p:outputLabel value="#{formelement.label}" styleClass="available-elements-label" />
                      </h:panelGroup>
                    </div>
                  </h:panelGroup>
                </p:panel>
              </p:dataGrid>

              <p:droppable for="selected-form-elements-header-panel" tolerance="pointer" activeStyleClass="ui-state-highlight"
                datasource="form:available-form-elements" onDrop="handleDrop" hoverStyleClass="hover-drop-section">
                <p:ajax listener="#{data.dragAndDropController.onFieldDropHeader}"
                  update="form:selected-form-elements-header-panel form:available-form-elements form:dyna-form" />
              </p:droppable>
            </p:outputPanel>
          </p:column>
        </p:row>
        <p:row styleClass="TexAlCenter form-definition-border-color">
          <p:column colspan="1" id="selected-form-elements-left-panel-fieldset" styleClass="ui-g-6 TexAlCenter form-definition-border-color">

            <p:outputPanel id="selected-formelements-leftpanel-panel" styleClass="selected-formelements-panel left-section">

              <p:outputPanel rendered="#{empty data.dragAndDropController.selectedFormelementsLeftPanel}">
                <br />
                <h:outputText value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/LeftColumn')}" styleClass="Fs24" />
                <br />
                <br />
              </p:outputPanel>
              <h:outputText value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/LeftColumn')}"
                rendered="#{not empty data.dragAndDropController.selectedFormelementsLeftPanel}" />

              <p:dataGrid id="selected-formelements-left-panel" var="formelement" styleClass="no-border selected-form-elements-left-panel" columns="1"
                value="#{data.dragAndDropController.selectedFormelementsLeftPanel}"
                rendered="#{not empty data.dragAndDropController.selectedFormelementsLeftPanel}">

                <p:panel id="pnl" styleClass="TexAlCenter vertical-align-middle available-elements-panel ui-g card">
                  <h:panelGroup styleClass="TexAlLeft ui-g-12">
                    <div class="ui-g">
                      <div class="ui-g-12 u-padding-0">
                        <h:panelGroup class="available-elements-image">
                          <p:graphicImage library="ivy-cms" name="/Layouts/Icons/#{formelement.type.value}" width="55" />
                        </h:panelGroup>

                        <h:panelGroup styleClass="available-elements-action-btn">
                          <p:commandButton icon="fa fa-trash-o fa-3x" styleClass="placement-form-element-remove-btn"
                            actionListener="#{data.dragAndDropController.resetFormelementLeftPanel(formelement)}"
                            process="form:selected-formelements-left-panel" update="form">
                          </p:commandButton>
                        </h:panelGroup>
                      </div>

                      <h:panelGroup styleClass="ui-g-12 available-elements-label-col u-padding-0">
                        <p:outputLabel value="#{formelement.label}" styleClass="available-elements-label" />
                      </h:panelGroup>
                    </div>
                  </h:panelGroup>
                </p:panel>
              </p:dataGrid>

              <p:droppable for="selected-formelements-leftpanel-panel" tolerance="pointer" activeStyleClass="ui-state-highlight"
                hoverStyleClass="hover-drop-section" datasource="form:available-form-elements" onDrop="handleDrop">
                <p:ajax listener="#{data.dragAndDropController.onFieldDropLeftPanel}"
                  update="form:selected-formelements-leftpanel-panel form:available-form-elements form:dyna-form" />
              </p:droppable>
            </p:outputPanel>
          </p:column>

          <p:column colspan="1" id="selected-formelements-rightpanel-fieldset" styleClass="TexAlCenter ui-g-6">
            <p:outputPanel id="selected-formelements-rightpanel-panel" styleClass="selected-formelements-panel right-section">
              <p:outputPanel rendered="#{empty data.dragAndDropController.selectedFormelementsRightPanel}">
                <br />
                <h:outputText value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/RightColumn')}" styleClass="Fs24" />
                <br />
                <br />
              </p:outputPanel>
              <h:outputText value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/RightColumn')}"
                rendered="#{not empty data.dragAndDropController.selectedFormelementsRightPanel}" />

              <p:dataGrid id="selected-formelements-right-panel" var="formelement"
                styleClass="no-border TexAlCenter selected-form-elements-right-panel" columns="1"
                value="#{data.dragAndDropController.selectedFormelementsRightPanel}"
                rendered="#{not empty data.dragAndDropController.selectedFormelementsRightPanel}">

                <p:panel id="pnl" styleClass="TexAlCenter vertical-align-middle available-elements-panel ui-g card">
                  <h:panelGroup styleClass="TexAlLeft ui-g-12">
                    <div class="ui-g">
                      <div class="ui-g-12 u-padding-0">
                        <h:panelGroup class="available-elements-image">
                          <p:graphicImage library="ivy-cms" name="/Layouts/Icons/#{formelement.type.value}" width="55" />
                        </h:panelGroup>

                        <h:panelGroup styleClass="available-elements-action-btn">
                          <p:commandButton icon="fa fa-trash-o fa-3x" styleClass="placement-form-element-remove-btn"
                            actionListener="#{data.dragAndDropController.resetFormelementRightPanel(formelement)}"
                            process="form:selected-formelements-right-panel" update="form">
                          </p:commandButton>
                        </h:panelGroup>
                      </div>

                      <h:panelGroup styleClass="ui-g-12 available-elements-label-col u-padding-0">
                        <p:outputLabel value="#{formelement.label}" styleClass="available-elements-label" />
                      </h:panelGroup>
                    </div>
                  </h:panelGroup>
                </p:panel>
              </p:dataGrid>

              <p:droppable for="selected-formelements-rightpanel-panel" tolerance="pointer" activeStyleClass="ui-state-highlight"
                hoverStyleClass="hover-drop-section" datasource="form:available-form-elements" onDrop="handleDrop">

                <p:ajax listener="#{data.dragAndDropController.onFieldDropRightPanel}"
                  update="form:selected-formelements-rightpanel-panel form:available-form-elements form:dyna-form" />
              </p:droppable>
            </p:outputPanel>
          </p:column>
        </p:row>

        <p:row id="selected-formelements-footer-fieldset" styleClass="TexAlCenter form-definition-border-color">
          <p:column colspan="2">
            <p:outputPanel id="selected-formelements-footer-panel" styleClass="selected-formelements-panel footer-section">

              <p:outputPanel rendered="#{empty data.dragAndDropController.selectedFormelementsFooter}">
                <br />
                <h:outputText value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/BroadFooterArea')}" styleClass="Fs24" />
                <br />
                <br />
              </p:outputPanel>
              <h:outputText value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/BroadFooterArea')}"
                rendered="#{not empty data.dragAndDropController.selectedFormelementsFooter}" />

              <p:dataGrid id="selected-formelements-footer" var="formelement" value="#{data.dragAndDropController.selectedFormelementsFooter}"
                rendered="#{not empty data.dragAndDropController.selectedFormelementsFooter}"
                styleClass="no-border TexAlCenter selected-form-elements-footer" columns="1">

                <p:panel id="pnl" styleClass="TexAlCenter vertical-align-middle available-elements-panel ui-g card">
                  <h:panelGroup styleClass="TexAlLeft ui-g-12">
                    <div class="ui-g">
                      <div class="ui-g-12 u-padding-0">
                        <h:panelGroup class="available-elements-image">
                          <p:graphicImage library="ivy-cms" name="/Layouts/Icons/#{formelement.type.value}" width="55" />
                        </h:panelGroup>

                        <h:panelGroup styleClass="available-elements-action-btn">
                          <p:commandButton icon="fa fa-trash-o fa-3x" styleClass="placement-form-element-remove-btn"
                            actionListener="#{data.dragAndDropController.resetFormelementFooter(formelement)}"
                            process="form:selected-formelements-footer" update="form">
                          </p:commandButton>
                        </h:panelGroup>
                      </div>

                      <h:panelGroup styleClass="ui-g-12 available-elements-label-col u-padding-0">
                        <p:outputLabel value="#{formelement.label}" styleClass="available-elements-label" />
                      </h:panelGroup>
                    </div>
                  </h:panelGroup>
                </p:panel>
              </p:dataGrid>

              <p:droppable for="selected-formelements-footer-panel" tolerance="pointer" activeStyleClass="ui-state-highlight"
                hoverStyleClass="hover-drop-section" datasource="form:available-form-elements" onDrop="handleDrop">

                <p:ajax listener="#{data.dragAndDropController.onFieldDropFooter}"
                  update="form:selected-formelements-footer-panel form:available-form-elements form:dyna-form" />
              </p:droppable>

            </p:outputPanel>
          </p:column>
        </p:row>
      </p:panelGrid>
    </p:fieldset>
  </p:panelGrid>

  <p:dialog id="preview-dialog" widgetVar="preview-dialog" styleClass="preview-dialog" width="70%" closable="true" modal="true" draggable="false"
    resizable="false" dynamic="true" fitViewport="true" header="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/FieldSetPreviewArea')}"
    position="center" appendTo="@(body)" onShow="ExpressDynaform();">
    <ui:include src="PreviewFieldset.xhtml" />
    <h:panelGroup layout="block" class="u-dialog-footer ui-dialog-footer">
      <p:commandButton type="button" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/close')}" onclick="PF('preview-dialog').hide();" />
    </h:panelGroup>
  </p:dialog>

</h:body>
</html>