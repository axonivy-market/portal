<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:pm="http://primefaces.org/mobile"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:body>

		<ui:composition template="/layouts/TaskTemplate.xhtml">
		<ui:param name="caseId" value="#{ivy.case.id}" />
		<ui:param name="task" value="#{ivy.task}" />
		<ui:param name="steps" value="#{data.data.steps}" />
		<ui:param name="actualStepIndex" value="2" />
		<ui:param name="isShowStartAdhocButton" value="false" />
		<ui:param name="isNotRequiredLogin" value="false" />


		<ui:define name="title">#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/PageTitle')} #{ivy.case.name}</ui:define>
		<ui:define name="taskForm">
			<p:growl autoUpdate="true" globalOnly="true" showDetail="false" showSummary="true" />
			<!-- DEFINED TASKS -->
			<h:panelGroup id="defined-task-container" layout="block" styleClass="defined-task-container">
				<ui:repeat value="#{data.data.definedTasks}" var="definedTask" varStatus="status">
					<h:panelGroup id="defined-task-button-container" layout="block" styleClass="defined-task-button-container">
						<p:commandButton id="defined-task-button" value="#{definedTask.subject}&#10;(#{definedTask.taskType.label})" immediate="true" partialSubmit="true"
							styleClass="defined-task-button #{status.index == data.activeTaskIndex ? 'active' : ''}"
							disabled="#{(status.index == data.activeTaskIndex) || (definedTask.taskType == 'APPROVAL')}"
							actionListener="#{logic.moveToTask(status.index)}" update="form defined-task-container buttons-container" process="form">
							<p:resetInput target="form:createTabs" />
						</p:commandButton>
					</h:panelGroup>
					<p:tooltip id="defined-task-button-tooltip" for="defined-task-button-container" value="#{definedTask.subject} (#{definedTask.taskType.label})" />
				</ui:repeat>
			</h:panelGroup>
			
			<!-- CONTENT -->
			<h:form id="form">
				<h:panelGroup layout="block" rendered="#{data.data.definedTasks.get(data.activeTaskIndex).taskType != 'EMAIL'}">
					<ui:include src="FormElementFieldset.xhtml" />
					<ui:include src="DragAndDropFieldset.xhtml" />
				</h:panelGroup>
				<h:panelGroup layout="block" rendered="#{data.data.definedTasks.get(data.activeTaskIndex).taskType == 'EMAIL'}">
					<ic:ch.ivy.gawfs.component.Email id="information-email" email="#{data.data.definedTasks.get(data.activeTaskIndex).email}" responsibles="#{data.data.definedTasks.get(data.activeTaskIndex).responsibles}" />
				</h:panelGroup>
			</h:form>
			<script type="text/javascript">
				function handleDrop(event, ui) {
					var droppedFormelement = ui.draggable;
					droppedFormelement.fadeOut('fast');
				}
			</script>
			
			<!-- BUTTONS -->
			<p:outputPanel id="buttons-container" styleClass="TexAlRight express-form-buttons-container">
				<p:commandButton value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/back')}" icon="fa fa-arrow-left" partialSubmit="true"
					update="form:selected-formelements-field" styleClass="buttonDelegate floatLeft" process="form:selected-formelements-field form:information-email:email-container" actionListener="#{logic.back}"/>
				<p:spacer width="5" />

				<p:commandButton  value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/SaveWorkflow')}" icon="fa fa-save" partialSubmit="true"
					styleClass="buttonDelegate" update="form:selected-formelements-field" process="form:selected-formelements-field form:information-email:email-container" actionListener="#{logic.save}"/>
				<p:spacer width="5" rendered="#{data.data.processType eq 'REPEAT'}" />

				<p:commandButton id="execute-button" icon="fa fa-check" styleClass="buttonDelegate"
					value="#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/ExecuteWorkflow')}"
					rendered="#{(data.data.processType eq 'AD_HOC')}"
					update="form:selected-formelements-field" process="form:selected-formelements-field form:information-email:email-container" actionListener="#{logic.directExecution}"/>
				<p:spacer width="5" />

				<p:commandButton id="next-button" icon="fa fa-arrow-right" styleClass="buttonDelegate"
					value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/next')}"
					rendered="#{data.activeTaskIndex ne (data.data.definedTasks.size() -1)}" partialSubmit="true"
					update="form defined-task-container buttons-container" process="form:selected-formelements-field form:information-email:email-container" actionListener="#{logic.moveNextTask}" resetValues="true" />
				<p:spacer width="5" />

				<p:commandButton value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" icon="fa fa-times"
					actionListener="#{logic.cancel}" styleClass="buttonDelegate portal-cancel-button" update="form:selected-formelements-field" process="form:selected-formelements-field"/>

			</p:outputPanel>
		</ui:define>

    <ui:define name="css">
      <h:outputStylesheet library="css" name="portal_express.css" />
    </ui:define>
  </ui:composition>
</h:body>
</html>