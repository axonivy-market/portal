<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:ic="http://ivyteam.ch/jsf/component"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:pm="http://primefaces.org/mobile">
<h:body>
	<ui:composition template="/layouts/TaskTemplate.xhtml">
		<ui:param name="caseId" value="#{ivy.case.id}" />
		<ui:param name="task" value="#{ivy.task}" />
		<ui:param name="steps" value="#{data.data.steps}" />
		<ui:param name="actualStepIndex" value="1" />
		<ui:param name="isShowStartAdhocButton" value="false" />
		<ui:param name="isNotRequiredLogin" value="false" />


		<ui:define name="title">#{ivy.cms.co('/Dialogs/workflowCreation/FormDefinition/PageTitle')} #{ivy.case.name}</ui:define>
		<ui:define name="taskForm">
			<h:form id="form">

				<p:messages id="messagesInputFieldLabel" showDetail="false"
					autoUpdate="true" closable="true" />

				<p:fieldset id="prozessSettingsField"
					legend="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/Processdetails')}"
					toggleable="true">
					<p:panelGrid id="prozessSettingsGrid" styleClass="process-property-container">
						<p:row>
							<p:column styleClass="process-property-label-col">
								<p:outputLabel
									value="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/Processtype')}:"
									for="processype" />
							</p:column>
							<p:column styleClass="process-property-input-col">
								<p:selectOneRadio id="processype" styleClass="Wid100"
									value="#{data.data.processType}"
									required="#{param['form:save']!=null}"
									requiredMessage="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/Processtype')} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/requiredFieldMessage')}">
									<f:selectItem
										itemLabel="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/ProcesstypeAdHoc')}"
										itemValue="AHWF" />
									<f:selectItem
										itemLabel="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/ProcesstypeRepeating')}"
										itemValue="AMWF" />
								</p:selectOneRadio>

							</p:column>
						</p:row>
						<p:row>
							<p:column styleClass="process-property-label-col">
								<p:outputLabel
									value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/processName')}:"
									for="processname" />
							</p:column>
							<p:column styleClass="process-property-input-col">
								<p:inputText id="processname" styleClass="process-property-input"
									value="#{data.data.processName}"
									required="#{param['form:save']!=null}"
									maxlength="50"
									requiredMessage="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/processName')} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/requiredFieldMessage')}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column styleClass="process-property-label-col process-description-label-col">
								<p:outputLabel
									value="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/Processdescription')}:"
									for="processdescription" />
							</p:column>
							<p:column styleClass="process-property-input-col">
								<p:inputTextarea id="processdescription" styleClass="process-property-input-description"
									value="#{data.data.processDescription}"
									required="#{param['form:save']!=null}"
									maxlength="60"
									requiredMessage="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/Processdescription')} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/requiredFieldMessage')}" />
							</p:column>
						</p:row>
					</p:panelGrid>

				</p:fieldset>

				<br />

				<p:fieldset id="processFlowField"
					legend="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/Processflow')}"
					toggleable="true">

					<p:dataGrid id="processFlowGrid" var="gtask"
						value="#{data.data.definedTasks}" columns="1"
						styleClass="process-flow-container">

						<p:panel id="taskPnl" styleClass="task-panel-container">
							<p:panelGrid styleClass="dynamicProcessPanelgrid dynamic-task-panel-grid">
								<p:row styleClass="u-no-border">
									<p:column colspan="5" styleClass="dynamic-task-title-col">
										<p:outputLabel
											value="#{gtask.count}. #{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/Processstep')}"
											styleClass="Fs20" />
									</p:column>
								</p:row>
								<p:row styleClass="u-no-border">
									<p:column colspan="1" rowspan="2" styleClass="dynamic-task-arrow">
										<i class="fa fa-long-arrow-down fa-4x"></i>
									</p:column>
									<p:column colspan="1" rowspan="1" styleClass="dynamic-task-name-label-col">
										<p:outputLabel
											value="#{ivy.cms.co('/Labels/Task')}:"
											for="subjectfield" />
									</p:column>
									<p:column colspan="1" rowspan="1" styleClass="dynamic-task-name-input-col">
										<p:inputText id="subjectfield" value="#{gtask.subject}"
											styleClass="dynamic-task-name-input"
											required="#{param['form:save']!=null}"
											maxlength="30"
											requiredMessage="#{ivy.cms.co('/Labels/Task')} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/requiredFieldMessage')}"></p:inputText>
									</p:column>
									<p:column colspan="1" rowspan="1"
										styleClass="dynamic-task-description-label-col">
										<p:outputLabel
											value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AllTasks/taskDescription')}:"
											for="descriptionfield" />
									</p:column>
									<p:column colspan="1" rowspan="1" styleClass="dynamic-task-description-input-col">
										<p:inputText value="#{gtask.description}" styleClass="dynamic-task-description-input"
											required="#{param['form:save']!=null}"
											id="descriptionfield"
											requiredMessage="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AllTasks/taskDescription')} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/requiredFieldMessage')}"></p:inputText>
									</p:column>
								</p:row>
								<p:row styleClass="u-no-border">
									<p:column colspan="1" rowspan="1" styleClass="u-no-border">
										<p:outputLabel
											value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/ACTIVATOR')}:"
											rendered="#{gtask.count gt 1}" for="actorfield" />
										<p:outputLabel
											value="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/EntitledUser')}:"
											rendered="#{gtask.count == 1}" for="actorfield" />
									</p:column>
									<p:column colspan="1" rowspan="1" styleClass="u-no-border">
										<p:inputText value="#{gtask.actorDisplayName}" id="actorfield"
											styleClass="dynamic-task-actor-input" readonly="false"
											required="#{param['form:save']!=null}"
											requiredMessage="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/ACTIVATOR')}/#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/EntitledUser')}  #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/requiredFieldMessage')}">
											<p:ajax event="mousedown"
												listener="#{logic.initAssginement(gtask)}"
												oncomplete="PF('chooseAssignee').show();"
												process="processFlowGrid" update="processFlowGrid" />
										</p:inputText>
									</p:column>
									<p:column colspan="1" rowspan="1" styleClass="u-no-border">
										<p:outputLabel id="untilDaysLabel"
											value="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/DueTimeInDays')}:"
											rendered="#{gtask.count gt 1}" />
                                        <p:tooltip for="untilDaysLabel" id="untilDaysLabelTooltip" value="#{ivy.cms.co('/Dialogs/WorkflowExecution/WfFirstInputForm/untilDaysTooltip')}" />
									</p:column>
									<p:column colspan="1" rowspan="1" styleClass="u-no-border">
										<p:spinner id="untilDays" value="#{gtask.untilDays}" min="1"
											rendered="#{gtask.count gt 1}"></p:spinner>
                                        <p:tooltip for="untilDays" id="untilDaysTooltip" value="#{ivy.cms.co('/Dialogs/WorkflowExecution/WfFirstInputForm/untilDaysTooltip')}" />
									</p:column>
								</p:row>
							</p:panelGrid>
						</p:panel>

						<p:panelGrid styleClass="dynamic-task-action-container"
							rendered="#{data.data.definedTasks.size() == gtask.count}">
							<p:row>
								<p:column colspan="1" styleClass="dynamic-task-left-action">
									<p:commandButton icon="fa fa-plus"
										value="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/AddProcessStep')}"
										styleClass="buttonDelegate"
										actionListener="#{logic.addProcessStep}"
										process="processFlowGrid" update="processFlowGrid" />
								</p:column>

								<p:column colspan="1" styleClass="dynamic-task-right-action">
									<p:commandButton icon="fa fa-minus" title=""
										styleClass="buttonDelegate"
										rendered="#{data.data.definedTasks.size()>1}"
										value="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/DeleteProcessStep')}"
										actionListener="#{logic.deleteProcessStep}"
										process="processFlowGrid" update="processFlowGrid" />

								</p:column>
							</p:row>
						</p:panelGrid>

					</p:dataGrid>
				</p:fieldset>
				<br />

				<p:outputPanel styleClass="TexAlRight">

					<p:commandButton id="save" actionListener="#{logic.close}"
						value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/next')}"
						update="form" icon="fa fa-check"
						styleClass="buttonDelegate" />
					<p:spacer width="5"/>
					<p:commandButton id="cancel-workflow-button"
						value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
						update="form" 
						actionListener="#{logic.cancel}" styleClass="buttonDelegate portal-cancel-button"
						icon="fa fa-times" />
				</p:outputPanel>

			</h:form>

			<p:dialog id="chooseAssignee"
				header="#{ivy.cms.co('/Dialogs/workflowCreation/WorkflowDefinition/ChooseAssigne/AddUserOrRole')}"
				widgetVar="chooseAssignee" modal="true" appendTo="@(body)">
				<ui:include src="ChooseAssignee.xhtml"></ui:include>
			</p:dialog>





		</ui:define>

    <ui:define name="css">
      <h:outputStylesheet library="css" name="portal_express.css" />
    </ui:define>
  </ui:composition>
</h:body>
</html>