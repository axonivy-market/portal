<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
<h:body>
  <ui:composition template="/layouts/BasicTemplate.xhtml">
    <ui:define name="title">ExpressHelper</ui:define>
    <ui:define name="pageContent">

      <h:form id="form">
        <div class="ui-g">
          <div class="ui-g-12">
            <p:messages id="express-helper-messages"></p:messages>
          </div>
          <div class="ui-g-12">

            <p:commandButton id="import-express-btn" value="Import Express" partialSubmit="true" oncomplete="PF('import-express-dialog').show()"
              update="#{p:component('import-express-dialog')}">
            </p:commandButton>
            <p:spacer width="10px" />
            <p:commandButton id="export-express-btn" value="Export Express" process="express-workflow-summary-table" partialSubmit="true"
              oncomplete="PF('export-express-dialog').show()" update="#{p:component('export-express-dialog')}">
            </p:commandButton>
          </div>

          <div class="ui-g-12">
            <p:dataTable id="express-workflow-summary-table" var="express" value="#{data.expressWorkflows}" selection="#{data.selectedExpresses}"
              rowKey="#{express.processName}">
              <f:facet name="header">
                <span>Express Workflow</span>
              </f:facet>

              <p:column selectionMode="multiple" style="width:50px;text-align:center"></p:column>

              <p:column headerText="processName">
                <h:outputText value="#{express.processName}" />
              </p:column>
              <p:column headerText="processDescription">
                <h:outputText value="#{express.processDescription}" />
              </p:column>
              <p:column headerText="processType">
                <h:outputText value="#{express.processType}" />
              </p:column>
              <p:column headerText="processOwner">
                <h:outputText value="#{express.processOwner}" />
              </p:column>
            </p:dataTable>
          </div>
        </div>
      </h:form>

      <p:dialog id="export-express-dialog" widgetVar="export-express-dialog" modal="true" draggable="false" closable="true" resizable="false"
        header="Export Express process" appendTo="@(body)" width="40vw">
        <h:form id="express-export-form">
          <h:panelGroup rendered="#{not empty data.selectedExpresses}" layout="block" class="ui-g">
            <div class="ui-g-6">
              <h4>Express process will be exported:</h4>
            </div>
            <div class="ui-g-6">
              <p:commandButton id="export-express-dowload" value="Export Express" icon="fa fa-download" ajax="false"
                onclick="PrimeFaces.monitorDownload(start, stop);">
                <p:fileDownload value="#{logic.exportExpress()}" />
              </p:commandButton>
            </div>

            <div class="ui-g-12">
              <span id="express-export-loading"  style="display: none"><i class="fa fa-circle-o-notch fa-spin ajax-loader"/> ... Data is collecting </span>
            </div>

            <div style="height: 200px" class="ui-g-12">
              <ui:repeat var="process" value="#{data.selectedExpresses}">
                <li><span>#{process.processName}</span></li>
              </ui:repeat>
            </div>
          </h:panelGroup>

          <h:panelGroup rendered="#{empty data.selectedExpresses}">
            <span>No process is selected, please select process before exporting</span>
          </h:panelGroup>
        </h:form>

      </p:dialog>

      <p:dialog id="import-express-dialog" modal="true" widgetVar="import-express-dialog" draggable="false" closable="true" resizable="false"
        appendTo="@(body)" header="Import Express process" width="40vw" onHide="PF('import-express-dialog').reset()">
        <h:form id="import-express-form">
          <h:panelGroup id="express-process-upload-panel" layout="block" styleClass="ui-g">
            <div class="ui-g-12">
            <h4>Only access json file</h4>
            </div>
            
            <div class="ui-g-12">
            <p:fileUpload id="express-process-upload" mode="advanced" chooseIcon="fa fa-upload" dragDropSupport="true"
              update="import-express-form #{p:component('import-express-result')} impress-export-output"
              invalidSizeMessage="#{masterDataBean.getFileUploadInvalidSizeMessage()}"
              label="Select"
              uploadLabel="Install" 
              cancelLabel="Cancel"
              sizeLimit="#{masterDataBean.fileUploadSizeLimit}"
              fileUploadListener="#{logic.importExpress}"
              value="#{data.importExpressFile}"
              fileLimit="3"
              onstart="start();" oncomplete="stop();">
            </p:fileUpload>
            </div>

            <div class="ui-g-12">
              <span id="express-export-loading" style="display: none"><i class="fa fa-circle-o-notch fa-spin ajax-loader" /> ... Data is
                collecting </span>
            </div>
            
            <div class="ui-g-12">
              <p:messages id="impress-export-message"></p:messages>
              
<!--               <PRE jsf:id="impress-export-output" style="overflow: auto; height: 50px; width: 100%;"> -->
<!--               #{data.importOutput} -->
<!--               </PRE> -->
              <p:inputTextarea id="impress-export-output" value="#{data.importOutput}" readonly="true" rows="5" styleClass="ui-g-12"></p:inputTextarea>
            </div>
            <h:panelGroup id="import-express-result">
            </h:panelGroup>
          </h:panelGroup>
          <h:panelGroup rendered="#{showImportConsole}">
        haha
        </h:panelGroup>
<!-- <p:commandButton value="Install" process="import-express-form" partialSubmit="true"  -->
<!--                 update="import-express-form #{p:component('express-workflow-summary-table')} #{p:component('express-process-upload-panel')}" -->
<!--                 actionListener="#{logic.importExpress}" onclick="$('#express-process-upload-panel').hide();"></p:commandButton> -->
        </h:form>
        
        <f:facet name="footer">
          <div>
            <h:form>
<!--               <p:commandButton value="Install" process="import-express-form" partialSubmit="true"  -->
<!--                 update="import-express-form #{p:component('express-workflow-summary-table')} #{p:component('express-process-upload-panel')}" -->
<!--                 actionListener="#{logic.importExpress}" onclick="$('#express-process-upload-panel').hide();"></p:commandButton> -->
              <p:commandButton value="Close" update="#{p:component('express-workflow-summary-table')} import-express-dialog" resetValues="true" process="import-express-form"></p:commandButton>
            </h:form>
          </div>
        </f:facet>
      </p:dialog>

      <script type="text/javascript">
              function start() {
                $('#express-export-loading').show();
              }

              function stop() {
                $('#express-export-loading').hide();
              }
            </script>

    </ui:define>
  </ui:composition>
</h:body>
</html>