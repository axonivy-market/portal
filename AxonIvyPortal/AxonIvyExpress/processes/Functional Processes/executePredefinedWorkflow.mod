[Ivy]
15781632FDA1EB9E 3.23 #module
>Proto >Proto Collection #zClass
ew0 executePredefinedWorkflow Big #zClass
ew0 B #cInfo
ew0 #process
Bk0 BpmnServiceTask Big #zClass
Bk0 B #cInfo
Bk3 BpmnUserTask Big #zClass
Bk3 BpmnUserTask #cInfo
Bk5 BpmnUserTask Big #zClass
Bk5 B #cInfo
Bk1 BpmnSendTask Big #zClass
Bk1 BpmnSendTask #cInfo
ew0 @TextInP .resExport .resExport #zField
ew0 @TextInP .type .type #zField
ew0 @TextInP .processKind .processKind #zField
ew0 @AnnotationInP-0n ai ai #zField
ew0 @MessageFlowInP-0n messageIn messageIn #zField
ew0 @MessageFlowOutP-0n messageOut messageOut #zField
ew0 @TextInP .xml .xml #zField
ew0 @TextInP .responsibility .responsibility #zField
ew0 @StartSub f0 '' #zField
ew0 @EndSub f1 '' #zField
ew0 @PushWFArc f30 '' #zField
ew0 Bk0 S11 'Sub 1' #zField
ew0 @StartSub f16 '' #zField
ew0 @PushWFArc f18 '' #zField
ew0 Bk3 U21 'User 2' #zField
ew0 @Alternative f5 '' #zField
ew0 @PushWFArc f8 '' #zField
ew0 @PushWFArc f12 '' #zField
ew0 Bk5 S31 'Sub 3' #zField
ew0 @GridStep f9 '' #zField
ew0 @PushWFArc f2 '' #zField
ew0 @PushWFArc f6 '' #zField
ew0 @Alternative f7 '' #zField
ew0 @PushWFArc f10 '' #zField
ew0 @PushWFArc f3 '' #zField
ew0 @PushWFArc f11 '' #zField
ew0 Bk1 S40 'Send 4' #zField
ew0 @PushWFArc f13 '' #zField
ew0 @PushWFArc f4 '' #zField
ew0 @PushWFArc f14 '' #zField
>Proto ew0 ew0 executePredefinedWorkflow #zField
Bk0 @TextInP .resExport .resExport #zField
Bk0 @TextInP .type .type #zField
Bk0 @TextInP .processKind .processKind #zField
Bk0 @AnnotationInP-0n ai ai #zField
Bk0 @MessageFlowInP-0n messageIn messageIn #zField
Bk0 @MessageFlowOutP-0n messageOut messageOut #zField
Bk0 @TextInP .xml .xml #zField
Bk0 @TextInP .responsibility .responsibility #zField
Bk0 @GridStep f28 '' #zField
Bk0 @PushTrueWFInG-01 g0 '' #zField
Bk0 @PushTrueWFOutG-01 g1 '' #zField
Bk0 @PushTrueWFInG-01 g2 '' #zField
Bk0 @PushWFArc f10 '' #zField
Bk0 @PushWFArc f29 '' #zField
Bk0 @GridStep f5 '' #zField
Bk0 @GridStep f8 '' #zField
Bk0 @GridStep f11 '' #zField
Bk0 @PushWFArc f1 '' #zField
Bk0 @PushWFArc f3 '' #zField
Bk0 @PushWFArc f0 '' #zField
Bk0 @PushWFArc f2 '' #zField
>Proto Bk0 Bk0 BpmnServiceTask #zField
Bk3 @TextInP .resExport .resExport #zField
Bk3 @TextInP .type .type #zField
Bk3 @TextInP .processKind .processKind #zField
Bk3 @AnnotationInP-0n ai ai #zField
Bk3 @MessageFlowInP-0n messageIn messageIn #zField
Bk3 @MessageFlowOutP-0n messageOut messageOut #zField
Bk3 @TextInP .xml .xml #zField
Bk3 @TextInP .responsibility .responsibility #zField
Bk3 @PushTrueWFInG-01 g0 '' #zField
Bk3 @PushTrueWFOutG-01 g1 '' #zField
Bk3 @TaskSwitchSimple f6 '' #zField
Bk3 @GridStep f11 '' #zField
Bk3 @Alternative f5 '' #zField
Bk3 @RichDialog f14 '' #zField
Bk3 @PushTrueWFInG-01 g2 '' #zField
Bk3 @PushWFArc f10 '' #zField
Bk3 @TaskSwitch f19 '' #zField
Bk3 @TkArc f25 '' #zField
Bk3 @Alternative f28 '' #zField
Bk3 @PushWFArc f30 '' #zField
Bk3 @GridStep f31 '' #zField
Bk3 @PushWFArc f32 '' #zField
Bk3 @PushWFArc f12 '' #zField
Bk3 @PushWFArc f26 '' #zField
Bk3 @PushWFArc f35 '' #zField
Bk3 @TaskSwitch f36 '' #zField
Bk3 @Alternative f33 '' #zField
Bk3 @Alternative f38 '' #zField
Bk3 @PushWFArc f9 '' #zField
Bk3 @PushWFArc f7 '' #zField
Bk3 @TaskSwitchSimple f16 '' #zField
Bk3 @TkArc f8 '' #zField
Bk3 @TkArc f1 '' #zField
Bk3 @Alternative f0 '' #zField
Bk3 @GridStep f13 '' #zField
Bk3 @PushWFArc f21 '' #zField
Bk3 @CallSub f3 '' #zField
Bk3 @GridStep f34 '' #zField
Bk3 @PushWFArc f29 '' #zField
Bk3 @Alternative f41 '' #zField
Bk3 @PushWFArc f43 '' #zField
Bk3 @GridStep f44 '' #zField
Bk3 @PushWFArc f39 '' #zField
Bk3 @GridStep f48 '' #zField
Bk3 @PushWFArc f49 '' #zField
Bk3 @PushWFArc f2 '' #zField
Bk3 @Alternative f17 '' #zField
Bk3 @PushWFArc f46 '' #zField
Bk3 @PushWFArc f47 '' #zField
Bk3 @Alternative f15 '' #zField
Bk3 @PushWFArc f45 '' #zField
Bk3 @PushWFArc f18 '' #zField
Bk3 @Alternative f4 '' #zField
Bk3 @PushWFArc f22 '' #zField
Bk3 @PushWFArc f53 '' #zField
Bk3 @PushWFArc f20 '' #zField
Bk3 @TkArc f37 '' #zField
Bk3 @TkArc f51 '' #zField
Bk3 @GridStep f52 '' #zField
Bk3 @PushWFArc f54 '' #zField
Bk3 @PushWFArc f23 '' #zField
Bk3 @PushWFArc f27 '' #zField
Bk3 @GridStep f40 '' #zField
Bk3 @PushWFArc f42 '' #zField
Bk3 @PushWFArc f24 '' #zField
Bk3 @RichDialog f55 '' #zField
Bk3 @PushWFArc f57 '' #zField
Bk3 @PushWFArc f56 '' #zField
Bk3 @PushWFArc f50 '' #zField
>Proto Bk3 Bk1 BpmnUserTask #zField
Bk5 @TextInP .resExport .resExport #zField
Bk5 @TextInP .type .type #zField
Bk5 @TextInP .processKind .processKind #zField
Bk5 @AnnotationInP-0n ai ai #zField
Bk5 @MessageFlowInP-0n messageIn messageIn #zField
Bk5 @MessageFlowOutP-0n messageOut messageOut #zField
Bk5 @TextInP .xml .xml #zField
Bk5 @TextInP .responsibility .responsibility #zField
Bk5 @RichDialog f21 '' #zField
Bk5 @Alternative f33 '' #zField
Bk5 @GridStep f29 '' #zField
Bk5 @GridStep f28 '' #zField
Bk5 @TaskSwitchSimple f7 '' #zField
Bk5 @PushWFArc f32 '' #zField
Bk5 @PushWFArc f34 '' #zField
Bk5 @GridStep f24 '' #zField
Bk5 @PushWFArc f22 '' #zField
Bk5 @TkArc f19 '' #zField
Bk5 @PushWFArc f35 '' #zField
Bk5 @PushWFArc f13 '' #zField
Bk5 @PushTrueWFInG-01 g0 '' #zField
Bk5 @PushWFArc f0 '' #zField
Bk5 @PushTrueWFOutG-01 g1 '' #zField
Bk5 @PushWFArc f1 '' #zField
>Proto Bk5 Bk2 BpmnUserTask #zField
Bk1 @TextInP .resExport .resExport #zField
Bk1 @TextInP .type .type #zField
Bk1 @TextInP .processKind .processKind #zField
Bk1 @AnnotationInP-0n ai ai #zField
Bk1 @MessageFlowInP-0n messageIn messageIn #zField
Bk1 @MessageFlowOutP-0n messageOut messageOut #zField
Bk1 @TextInP .xml .xml #zField
Bk1 @TextInP .responsibility .responsibility #zField
Bk1 @PushTrueWFInG-01 g0 '' #zField
Bk1 @PushTrueWFOutG-01 g1 '' #zField
Bk1 @GridStep f3 '' #zField
Bk1 @PushWFArc f4 '' #zField
Bk1 @PushWFArc f0 '' #zField
>Proto Bk1 Bk3 BpmnSendTask #zField
ew0 f0 inParamDecl '<java.lang.Integer actualStepIndex,java.lang.String workflowID> param;' #txt
ew0 f0 inParamTable 'out.actualStepIndex=param.#actualStepIndex is initialized ? param.actualStepIndex : 0;
out.workflowID=param.workflowID;
' #txt
ew0 f0 outParamDecl '<> result;
' #txt
ew0 f0 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f0 callSignature call(Integer,String) #txt
ew0 f0 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>call(Integer,String)</name>
    </language>
</elementInfo>
' #txt
ew0 f0 113 49 30 30 -50 17 #rect
ew0 f0 @|StartSubIcon #fIcon
ew0 f1 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f1 1009 145 30 30 0 15 #rect
ew0 f1 @|EndSubIcon #fIcon
ew0 f30 expr out #txt
ew0 f30 143 64 280 138 #arcP
ew0 f30 1 280 64 #addKink
ew0 f30 0 0.7497048443829264 0 0 #arcLabel
ew0 S11 .resExport export #txt
ew0 S11 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>process initialitation</name>
        <nameStyle>22,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 S11 216 138 128 44 -55 -8 #rect
ew0 S11 @|BpmnServiceTaskIcon #fIcon
ew0 f16 inParamDecl '<List<gawfs.TaskDef> definedTasks,java.lang.String processName,java.lang.String processDescription,ch.ivy.gawfs.enums.ProcessType processType,ch.ivy.gawfs.DragAndDropController dragAndDropController,ch.ivy.gawfs.DynaFormController dynaFormController,java.lang.String processID> param;' #txt
ew0 f16 inParamTable 'out.definedTasks=param.definedTasks;
out.workflowDescription=param.processDescription;
out.workflowID=param.processID;
out.workflowName=param.processName;
out.workflowType=param.processType;
' #txt
ew0 f16 outParamDecl '<> result;
' #txt
ew0 f16 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f16 callSignature call(List<gawfs.TaskDef>,String,String,ch.ivy.gawfs.enums.ProcessType,ch.ivy.gawfs.DragAndDropController,ch.ivy.gawfs.DynaFormController,String) #txt
ew0 f16 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f16 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>call(all parameters)</name>
        <nameStyle>20,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f16 113 145 30 30 -48 23 #rect
ew0 f16 @|StartSubIcon #fIcon
ew0 f18 expr out #txt
ew0 f18 143 160 216 160 #arcP
ew0 f18 0 0.3805374841463163 0 0 #arcLabel
ew0 U21 .resExport export #txt
ew0 U21 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Create task</name>
        <nameStyle>11,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 U21 512 138 112 44 -31 -8 #rect
ew0 U21 @|BpmnUserTaskIcon #fIcon
ew0 f5 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has next task?</name>
        <nameStyle>14
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f5 720 144 32 32 -39 18 #rect
ew0 f5 @|AlternativeIcon #fIcon
ew0 f8 expr in #txt
ew0 f8 outCond 'in.nextTask.taskType == ch.ivy.gawfs.enums.TaskType.FINAL_REVIEW' #txt
ew0 f8 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f8 752 160 832 160 #arcP
ew0 f8 0 0.5125 0 -8 #arcLabel
ew0 f12 944 160 1009 160 #arcP
ew0 S31 .resExport export #txt
ew0 S31 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Final task</name>
        <nameStyle>10,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 S31 832 138 112 44 -26 -8 #rect
ew0 S31 @|BpmnUserTaskIcon #fIcon
ew0 f9 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f9 actionTable 'out=in;
' #txt
ew0 f9 actionCode 'out.nextTask = in.definedTasks.removeGet(0);
in.actualStepIndex++;' #txt
ew0 f9 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f9 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get next Task</name>
        <nameStyle>13,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f9 512 42 112 44 -36 -8 #rect
ew0 f9 @|StepIcon #fIcon
ew0 f2 expr in #txt
ew0 f2 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f2 736 144 624 64 #arcP
ew0 f2 1 736 64 #addKink
ew0 f2 0 0.5063291139240507 14 0 #arcLabel
ew0 f6 624 160 720 160 #arcP
ew0 f7 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>which task type?</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f7 392 144 32 32 12 -27 #rect
ew0 f7 @|AlternativeIcon #fIcon
ew0 f10 344 160 392 160 #arcP
ew0 f3 expr in #txt
ew0 f3 outCond 'in.nextTask.taskType == ch.ivy.gawfs.enums.TaskType.USER_TASK || in.nextTask.taskType == ch.ivy.gawfs.enums.TaskType.USER_TASK_WITH_EMAIL' #txt
ew0 f3 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>user task</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f3 424 160 512 160 #arcP
ew0 f3 0 0.4772727272727273 0 8 #arcLabel
ew0 f11 expr out #txt
ew0 f11 512 64 408 144 #arcP
ew0 f11 1 408 64 #addKink
ew0 f11 0 0.8125675639531414 0 0 #arcLabel
ew0 S40 .resExport export #txt
ew0 S40 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Send email</name>
        <nameStyle>10,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 S40 504 234 112 44 -31 -8 #rect
ew0 S40 @|BpmnSendTaskIcon #fIcon
ew0 f13 expr in #txt
ew0 f13 outCond 'in.nextTask.taskType == ch.ivy.gawfs.enums.TaskType.EMAIL' #txt
ew0 f13 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>mail</name>
        <nameStyle>4,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f13 409 175 504 256 #arcP
ew0 f13 1 416 256 #addKink
ew0 f13 0 0.5049924357034796 11 0 #arcLabel
ew0 f4 616 256 734 174 #arcP
ew0 f4 1 720 256 #addKink
ew0 f4 0 0.8278533742264182 0 0 #arcLabel
ew0 f14 expr in #txt
ew0 f14 408 176 736 176 #arcP
ew0 f14 1 408 328 #addKink
ew0 f14 2 736 328 #addKink
ew0 f14 1 0.5 0 0 #arcLabel
>Proto ew0 .type gawfs.ExecutePredefinedWorkflowData #txt
>Proto ew0 .processKind CALLABLE_SUB #txt
>Proto ew0 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language/>
    <swimlaneOrientation>false</swimlaneOrientation>
</elementInfo>
' #txt
>Proto ew0 0 0 32 24 18 0 #rect
>Proto ew0 @|BIcon #fIcon
Bk0 f28 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f28 actionTable 'out=in;
' #txt
Bk0 f28 actionCode 'import ch.ivy.gawfs.enums.TaskType;
import gawfs.TaskDef;


// Add review task to defined tasks
TaskDef taskDef = new gawfs.TaskDef();
taskDef.taskType = TaskType.FINAL_REVIEW;
taskDef.subject = TaskType.FINAL_REVIEW.getLabel();
in.definedTasks.add(taskDef);

// Initialize steps
for(TaskDef task: in.definedTasks) {
	in.steps.add(task.subject);
}

// Initialize controllers
in.nextTask = in.definedTasks.removeGet(0);
if (in.nextTask.taskType == TaskType.USER_TASK || in.nextTask.taskType == TaskType.USER_TASK_WITH_EMAIL) {
	in.dynaFormController = in.nextTask.dynaFormController;
	in.dragAndDropController = in.nextTask.dragAndDropController;
}

// Others
in.denied = false;
in.actualStepIndex = 0;' #txt
Bk0 f28 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Initialize workflow settings</name>
    </language>
</elementInfo>
' #txt
Bk0 f28 184 298 160 44 -71 -8 #rect
Bk0 f28 @|StepIcon #fIcon
Bk0 g0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>in 1</name>
    </language>
</elementInfo>
' #txt
Bk0 g0 251 19 26 26 17 9 #rect
Bk0 g0 @|MIGIcon #fIcon
Bk0 g1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>out 1</name>
    </language>
</elementInfo>
' #txt
Bk0 g1 627 403 26 26 -27 18 #rect
Bk0 g1 @|MOGIcon #fIcon
Bk0 g2 51 307 26 26 -4 -48 #rect
Bk0 g2 @|MIGIcon #fIcon
Bk0 f10 77 320 184 320 #arcP
Bk0 f29 expr out #txt
Bk0 f29 264 236 264 298 #arcP
Bk0 f5 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f5 actionTable 'out=in;
' #txt
Bk0 f5 actionCode 'import ch.ivy.gawfs.ExpressProcessUtils;

ExpressProcessUtils utils = new ch.ivy.gawfs.ExpressProcessUtils();
in.definedTasks = utils.getDefinedTasks(in.workflowID);' #txt
Bk0 f5 security system #txt
Bk0 f5 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get defined tasks</name>
    </language>
</elementInfo>
' #txt
Bk0 f5 208 192 112 44 -48 -8 #rect
Bk0 f5 @|StepIcon #fIcon
Bk0 f8 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f8 actionTable 'out=in;
' #txt
Bk0 f8 actionCode 'import ch.ivy.gawfs.enums.ProcessType;
import ch.ivy.addon.portalkit.service.ExpressServiceRegistry;
import ch.ivy.addon.portalkit.bo.ExpressProcess;


ExpressProcess workflow = ExpressServiceRegistry.getProcessService().findById(in.workflowID) as ExpressProcess;

in.workflowDescription = workflow.processDescription;
in.workflowName = workflow.processName;

for(ProcessType type : ProcessType.values()) {
	if (type.getValue() == workflow.processType) {
	 	in.workflowType = type;
	}
}' #txt
Bk0 f8 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f8 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Workflow Credentials</name>
        <nameStyle>24,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk0 f8 192 98 144 44 -68 -8 #rect
Bk0 f8 @|StepIcon #fIcon
Bk0 f11 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f11 actionTable 'out=in;
' #txt
Bk0 f11 actionCode 'ivy.task.setName(ivy.cms.co("/Dialogs/Tasks/ProcessLoaded/TaskName"));
ivy.task.setDescription(ivy.cms.co("/Dialogs/Tasks/ProcessLoaded/TaskName"));

ivy.case.setName(in.workflowName);
ivy.case.setDescription(in.workflowDescription);' #txt
Bk0 f11 security system #txt
Bk0 f11 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>set Task and Case Fields</name>
        <nameStyle>24,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk0 f11 376 394 160 44 -70 -8 #rect
Bk0 f11 @|StepIcon #fIcon
Bk0 f1 expr out #txt
Bk0 f1 536 416 627 416 #arcP
Bk0 f3 expr out #txt
Bk0 f3 264 142 264 192 #arcP
Bk0 f0 264 45 264 98 #arcP
Bk0 f2 expr out #txt
Bk0 f2 264 342 376 416 #arcP
Bk0 f2 1 264 416 #addKink
Bk0 f2 1 0.2314443862725309 0 0 #arcLabel
>Proto Bk0 0 0 32 24 18 0 #rect
>Proto Bk0 @|BIcon #fIcon
Bk3 g0 339 51 26 26 21 -3 #rect
Bk3 g0 @|MIGIcon #fIcon
Bk3 g1 339 1931 26 26 19 -15 #rect
Bk3 g1 @|MOGIcon #fIcon
Bk3 f6 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f6 actionTable 'out=in1;
' #txt
Bk3 f6 outTypes "gawfs.ExecutePredefinedWorkflowData" #txt
Bk3 f6 outLinks "TaskA.ivp" #txt
Bk3 f6 taskData 'TaskA.DESC=<%\=in1.nextTask.description%>\n
TaskA.EXP=new Duration(0,0,in1.nextTask.untilDays,0,0,0)
TaskA.EXPRI=1
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.nextTask.subject%>
TaskA.PRI=2
TaskA.ROL=in1.responsible.getMemberName().substring(1)
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=3' #txt
Bk3 f6 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f6 template "" #txt
Bk3 f6 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>create task for user</name>
        <nameStyle>20,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f6 466 562 28 28 21 -17 #rect
Bk3 f6 @|TaskSwitchSimpleIcon #fIcon
Bk3 f11 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f11 actionTable 'out=in;
' #txt
Bk3 f11 actionCode 'if (!in.nextTask.responsibles.isEmpty()) {
	in.responsibleName = in.nextTask.responsibles.removeGet(0);
}' #txt
Bk3 f11 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get next &#xD;
responsible name</name>
    </language>
</elementInfo>
' #txt
Bk3 f11 288 210 128 44 -45 -16 #rect
Bk3 f11 @|StepIcon #fIcon
Bk3 f5 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>task with mail?</name>
        <nameStyle>15,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f5 336 640 32 32 -39 -35 #rect
Bk3 f5 @|AlternativeIcon #fIcon
Bk3 f14 targetWindow NEW #txt
Bk3 f14 targetDisplay TOP #txt
Bk3 f14 richDialogId ch.ivy.gawfs.workflowExecution.UserTaskForm #txt
Bk3 f14 startMethod start(gawfs.ExecutePredefinedWorkflowData) #txt
Bk3 f14 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f14 requestActionDecl '<gawfs.ExecutePredefinedWorkflowData executePredefinedWorkflowData> param;' #txt
Bk3 f14 requestMappingAction 'param.executePredefinedWorkflowData=in;
' #txt
Bk3 f14 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f14 responseMappingAction 'out=result.executePredefinedWorkflowData;
out.userTaskForApproval=result.workingTaskDef;
' #txt
Bk3 f14 isAsynch false #txt
Bk3 f14 isInnerRd false #txt
Bk3 f14 userContext '* ' #txt
Bk3 f14 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Input form</name>
        <nameStyle>10
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f14 296 736 112 44 -27 -8 #rect
Bk3 f14 @|RichDialogIcon #fIcon
Bk3 g2 507 123 26 26 0 5 #rect
Bk3 g2 @|MIGIcon #fIcon
Bk3 f10 expr data #txt
Bk3 f10 outCond ivp=="TaskA.ivp" #txt
Bk3 f10 480 590 368 656 #arcP
Bk3 f10 1 480 656 #addKink
Bk3 f10 1 0.991265262979699 0 0 #arcLabel
Bk3 f19 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f19 actionTable 'out=in1;
' #txt
Bk3 f19 outTypes "gawfs.ExecutePredefinedWorkflowData","gawfs.ExecutePredefinedWorkflowData" #txt
Bk3 f19 outLinks "TaskB.ivp","TaskA.ivp" #txt
Bk3 f19 taskData 'TaskA.DESC=SYSTEM\: Create task
TaskA.EXPRI=2
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=SYSTEM\: Create task
TaskA.PRI=2
TaskA.ROL=SYSTEM
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=0
TaskB.EXPRI=2
TaskB.EXROL=Everybody
TaskB.EXTYPE=0
TaskB.NAM=SYSTEM\: Split
TaskB.PRI=2
TaskB.ROL=SYSTEM
TaskB.SKIP_TASK_LIST=true
TaskB.TYPE=0' #txt
Bk3 f19 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f19 template "" #txt
Bk3 f19 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>SYSTEM Split</name>
        <nameStyle>12
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f19 336 304 32 32 22 -6 #rect
Bk3 f19 @|TaskSwitchIcon #fIcon
Bk3 f25 expr out #txt
Bk3 f25 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f25 var in1 #txt
Bk3 f25 352 254 352 304 #arcP
Bk3 f28 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has more responsible?</name>
        <nameStyle>21
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f28 176 304 32 32 -64 18 #rect
Bk3 f28 @|AlternativeIcon #fIcon
Bk3 f30 expr in #txt
Bk3 f30 outCond !in.nextTask.responsibles.isEmpty() #txt
Bk3 f30 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f30 192 304 288 232 #arcP
Bk3 f30 1 192 232 #addKink
Bk3 f30 0 0.5125 13 0 #arcLabel
Bk3 f31 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f31 actionTable 'out=in;
' #txt
Bk3 f31 actionCode 'import java.util.ArrayList;
import ch.ivy.gawfs.enums.TaskType;
import gawfs.TaskDef;
import ch.ivy.gawfs.enums.TaskType;
import ch.ivy.gawfs.ExpressProcessUtils;

in.nextTask.counter = in.nextTask.responsibles.size();
in.userTaskForApproval = null;
in.userTaskActivator = null;
in.approvalTaskList.clear();

ExpressProcessUtils utils = new ch.ivy.gawfs.ExpressProcessUtils();

for (TaskDef task : in.definedTasks) {
	if (utils.isUserTask(task) || task.taskType == TaskType.EMAIL || task.taskType == TaskType.FINAL_REVIEW) {
		break;
	}
	in.approvalTaskList.add(task);
}

if (!in.approvalTaskList.isEmpty()) {
	in.userTaskForApproval = in.nextTask;
}

in.definedTasks.removeAll(in.approvalTaskList);' #txt
Bk3 f31 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f31 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Initialize</name>
    </language>
</elementInfo>
' #txt
Bk3 f31 296 114 112 44 -22 -8 #rect
Bk3 f31 @|StepIcon #fIcon
Bk3 f32 352 77 352 114 #arcP
Bk3 f12 expr out #txt
Bk3 f12 352 158 352 210 #arcP
Bk3 f26 507 136 408 136 #arcP
Bk3 f35 expr in #txt
Bk3 f35 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f35 176 320 192 1584 #arcP
Bk3 f35 1 64 320 #addKink
Bk3 f35 2 64 1584 #addKink
Bk3 f35 0 0.3402777777777778 0 -8 #arcLabel
Bk3 f36 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f36 actionTable 'out=in2;
out.actualStepIndex=in1.actualStepIndex;
out.definedTasks=in1.definedTasks;
out.finishedTasks=in1.finishedTasks;
' #txt
Bk3 f36 outTypes "gawfs.ExecutePredefinedWorkflowData" #txt
Bk3 f36 outLinks "TaskA.ivp" #txt
Bk3 f36 taskData 'TaskA.EXPRI=2
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=SYSTEM\: Join
TaskA.PRI=2
TaskA.ROL=SYSTEM
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=0' #txt
Bk3 f36 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f36 template "" #txt
Bk3 f36 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>SYSTEM Join</name>
        <nameStyle>11
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f36 336 1568 32 32 21 -26 #rect
Bk3 f36 @|TaskSwitchIcon #fIcon
Bk3 f33 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f33 192 1568 32 32 0 16 #rect
Bk3 f33 @|AlternativeIcon #fIcon
Bk3 f38 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f38 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>All tasks are created?</name>
        <nameStyle>22
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f38 336 1848 32 32 18 2 #rect
Bk3 f38 @|AlternativeIcon #fIcon
Bk3 f9 expr data #txt
Bk3 f9 outCond ivp=="TaskB.ivp" #txt
Bk3 f9 336 320 208 320 #arcP
Bk3 f7 expr data #txt
Bk3 f7 outCond ivp=="TaskA.ivp" #txt
Bk3 f7 224 590 336 656 #arcP
Bk3 f7 1 224 656 #addKink
Bk3 f7 0 0.5055155163921642 0 0 #arcLabel
Bk3 f16 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f16 actionTable 'out=in1;
' #txt
Bk3 f16 outTypes "gawfs.ExecutePredefinedWorkflowData" #txt
Bk3 f16 outLinks "TaskA.ivp" #txt
Bk3 f16 taskData 'TaskA.DESC=<%\=in1.nextTask.description%>\n
TaskA.EXP=new Duration(0,0,in1.nextTask.untilDays,0,0,0)
TaskA.EXPRI=1
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.nextTask.subject%>
TaskA.PRI=2
TaskA.ROL=in1.responsible.getMemberName()
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=2' #txt
Bk3 f16 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f16 template "" #txt
Bk3 f16 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>create  task for group</name>
        <nameStyle>22,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f16 210 562 28 28 -137 -17 #rect
Bk3 f16 @|TaskSwitchSimpleIcon #fIcon
Bk3 f8 expr in #txt
Bk3 f8 outCond !in.responsible.isUser() #txt
Bk3 f8 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f8 var in1 #txt
Bk3 f8 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f8 336 512 224 562 #arcP
Bk3 f8 1 224 512 #addKink
Bk3 f8 0 0.4732142857142857 0 10 #arcLabel
Bk3 f1 expr in #txt
Bk3 f1 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f1 var in1 #txt
Bk3 f1 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f1 368 512 480 562 #arcP
Bk3 f1 1 480 512 #addKink
Bk3 f1 0 0.38392857142857145 0 10 #arcLabel
Bk3 f0 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>assigned to User?</name>
        <nameStyle>17,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f0 336 496 32 32 14 -27 #rect
Bk3 f0 @|AlternativeIcon #fIcon
Bk3 f13 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f13 actionTable 'out=in;
' #txt
Bk3 f13 actionCode 'in.responsible = ivy.session.getSecurityContext().findSecurityMember(in.responsibleName);' #txt
Bk3 f13 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f13 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get responsible</name>
    </language>
</elementInfo>
' #txt
Bk3 f13 296 386 112 44 -44 -8 #rect
Bk3 f13 @|StepIcon #fIcon
Bk3 f21 expr out #txt
Bk3 f21 352 430 352 496 #arcP
Bk3 f3 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f3 processCall 'Functional Processes/executeApprovalTask:call(List<String>,Integer,String,gawfs.TaskDef,gawfs.TaskDef)' #txt
Bk3 f3 doCall true #txt
Bk3 f3 requestActionDecl '<java.util.List<java.lang.String> steps,java.lang.Integer actualStepIndex,java.lang.String userTaskResponsibleName,gawfs.TaskDef approvalTask,gawfs.TaskDef userTask> param;
' #txt
Bk3 f3 requestMappingAction 'param.steps=in.steps;
param.actualStepIndex=in.actualStepIndex;
param.userTaskResponsibleName=in.responsibleName;
param.approvalTask=in.nextApprovalTask;
param.userTask=in.userTaskForApproval;
' #txt
Bk3 f3 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f3 responseMappingAction 'out=in;
out.approvalResult=result.approvalResult;
out.hasRejectedApprovalTask=result.rejected;
' #txt
Bk3 f3 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>executeApprovalTask</name>
        <nameStyle>19,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f3 288 1120 128 44 -58 -8 #rect
Bk3 f3 @|CallSubIcon #fIcon
Bk3 f34 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f34 actionTable 'out=in;
' #txt
Bk3 f34 actionCode 'in.nextApprovalTask = in.approvalTaskList.removeGet(0);
in.actualStepIndex++;' #txt
Bk3 f34 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f34 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get next approval task</name>
    </language>
</elementInfo>
' #txt
Bk3 f34 288 1010 128 44 -60 -8 #rect
Bk3 f34 @|StepIcon #fIcon
Bk3 f29 expr out #txt
Bk3 f29 352 1054 352 1120 #arcP
Bk3 f29 0 0.2987012987012987 17 0 #arcLabel
Bk3 f41 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f41 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Has next approval task?</name>
        <nameStyle>23
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f41 336 1312 32 32 -143 10 #rect
Bk3 f41 @|AlternativeIcon #fIcon
Bk3 f43 expr in #txt
Bk3 f43 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f43 336 1328 288 1032 #arcP
Bk3 f43 1 224 1328 #addKink
Bk3 f43 2 224 1032 #addKink
Bk3 f43 0 0.41964285714285715 0 -9 #arcLabel
Bk3 f44 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f44 actionTable 'out=in;
' #txt
Bk3 f44 actionCode 'in.userTaskActivator = ivy.session.getSecurityContext().findUser(ivy.task.getActivatorName());' #txt
Bk3 f44 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f44 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Initialize approval task</name>
    </language>
</elementInfo>
' #txt
Bk3 f44 288 922 128 44 -60 -8 #rect
Bk3 f44 @|StepIcon #fIcon
Bk3 f39 expr out #txt
Bk3 f39 352 966 352 1010 #arcP
Bk3 f39 0 0.2987012987012987 17 0 #arcLabel
Bk3 f48 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f48 actionTable 'out=in;
' #txt
Bk3 f48 actionCode 'import gawfs.TaskDef;
import gawfs.ApprovalTaskResult;

for (ApprovalTaskResult result : in.approvalResult) {
	if (!result.isApproved) {
		in.hasRejectedApprovalTask = true;
		break;
	}
}

TaskDef taskDef = in.nextTask;
taskDef.approvalResultList.addAll(in.approvalResult);
in.finishedTasks.add(taskDef);' #txt
Bk3 f48 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f48 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get approval result</name>
    </language>
</elementInfo>
' #txt
Bk3 f48 296 1408 112 44 -51 -8 #rect
Bk3 f48 @|StepIcon #fIcon
Bk3 f49 expr in #txt
Bk3 f49 outCond in.approvalTaskList.isEmpty() #txt
Bk3 f49 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f49 352 1344 352 1408 #arcP
Bk3 f49 0 0.328125 13 0 #arcLabel
Bk3 f2 expr in #txt
Bk3 f2 352 1880 352 1931 #arcP
Bk3 f17 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f17 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Rejected?</name>
        <nameStyle>9
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f17 336 1216 32 32 -69 -22 #rect
Bk3 f17 @|AlternativeIcon #fIcon
Bk3 f46 expr out #txt
Bk3 f46 352 1164 352 1216 #arcP
Bk3 f47 expr in #txt
Bk3 f47 outCond in.hasRejectedApprovalTask #txt
Bk3 f47 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f47 368 1232 408 1430 #arcP
Bk3 f47 1 480 1232 #addKink
Bk3 f47 2 480 1430 #addKink
Bk3 f47 0 0.4375 0 -11 #arcLabel
Bk3 f15 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f15 336 1504 32 32 0 16 #rect
Bk3 f15 @|AlternativeIcon #fIcon
Bk3 f45 expr in #txt
Bk3 f45 outCond !in.approvalTaskList.isEmpty() #txt
Bk3 f45 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f45 352 864 352 922 #arcP
Bk3 f45 0 0.3 12 0 #arcLabel
Bk3 f18 expr out #txt
Bk3 f18 352 780 352 832 #arcP
Bk3 f4 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f4 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Has approval tasks?</name>
        <nameStyle>19
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f4 336 832 32 32 -126 -20 #rect
Bk3 f4 @|AlternativeIcon #fIcon
Bk3 f22 expr in #txt
Bk3 f22 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f22 368 848 368 1520 #arcP
Bk3 f22 1 544 848 #addKink
Bk3 f22 2 544 1520 #addKink
Bk3 f22 0 0.4772727272727273 0 -9 #arcLabel
Bk3 f53 expr out #txt
Bk3 f53 352 1452 352 1504 #arcP
Bk3 f20 expr data #txt
Bk3 f20 outCond ivp=="TaskA.ivp" #txt
Bk3 f20 352 336 352 386 #arcP
Bk3 f37 expr in #txt
Bk3 f37 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f37 var in1 #txt
Bk3 f37 352 1536 352 1568 #arcP
Bk3 f51 expr in #txt
Bk3 f51 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f51 var in2 #txt
Bk3 f51 224 1584 336 1584 #arcP
Bk3 f51 0 0.49999999999999994 0 0 #arcLabel
Bk3 f52 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f52 actionTable 'out=in;
out.nextTask.counter=in.nextTask.counter-1;
' #txt
Bk3 f52 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f52 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>counter --</name>
    </language>
</elementInfo>
' #txt
Bk3 f52 296 1754 112 44 -26 -8 #rect
Bk3 f52 @|StepIcon #fIcon
Bk3 f54 expr in #txt
Bk3 f54 outCond 'in.nextTask.counter > 0' #txt
Bk3 f54 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f54 336 1864 208 1600 #arcP
Bk3 f54 1 208 1864 #addKink
Bk3 f54 0 0.5 0 10 #arcLabel
Bk3 f23 expr out #txt
Bk3 f23 352 1798 352 1848 #arcP
Bk3 f27 expr in #txt
Bk3 f27 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f27 352 1248 352 1312 #arcP
Bk3 f27 0 0.3875 12 0 #arcLabel
Bk3 f40 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f40 actionTable 'out=in;
' #txt
Bk3 f40 actionCode in.finishedTasks.addAll(in.tempFinishedTasks); #txt
Bk3 f40 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f40 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Update finished&#xD;
task list</name>
    </language>
</elementInfo>
' #txt
Bk3 f40 288 1658 128 44 -41 -16 #rect
Bk3 f40 @|StepIcon #fIcon
Bk3 f42 expr data #txt
Bk3 f42 outCond ivp=="TaskA.ivp" #txt
Bk3 f42 352 1600 352 1658 #arcP
Bk3 f24 expr out #txt
Bk3 f24 352 1702 352 1754 #arcP
Bk3 f55 targetWindow NEW #txt
Bk3 f55 targetDisplay TOP #txt
Bk3 f55 richDialogId ch.ivy.gawfs.workflowExecution.UserTaskWithMailForm #txt
Bk3 f55 startMethod start(gawfs.ExecutePredefinedWorkflowData) #txt
Bk3 f55 type gawfs.ExecutePredefinedWorkflowData #txt
Bk3 f55 requestActionDecl '<gawfs.ExecutePredefinedWorkflowData executePredefinedWorkflowData> param;' #txt
Bk3 f55 requestMappingAction 'param.executePredefinedWorkflowData=in;
' #txt
Bk3 f55 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk3 f55 responseMappingAction 'out=result.executePredefinedWorkflowData;
out.userTaskForApproval=result.workingTaskDef;
' #txt
Bk3 f55 isAsynch false #txt
Bk3 f55 isInnerRd false #txt
Bk3 f55 userContext '* ' #txt
Bk3 f55 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Task with mail</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f55 448 738 112 44 -39 -8 #rect
Bk3 f55 @|RichDialogIcon #fIcon
Bk3 f57 expr out #txt
Bk3 f57 504 782 366 846 #arcP
Bk3 f57 1 504 832 #addKink
Bk3 f57 1 0.27941505463698263 0 0 #arcLabel
Bk3 f56 expr in #txt
Bk3 f56 outCond 'in.nextTask.taskType == ch.ivy.gawfs.enums.TaskType.USER_TASK_WITH_EMAIL' #txt
Bk3 f56 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f56 366 658 504 738 #arcP
Bk3 f56 1 504 672 #addKink
Bk3 f56 0 0.7605569194185423 0 0 #arcLabel
Bk3 f50 expr in #txt
Bk3 f50 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk3 f50 352 672 352 736 #arcP
>Proto Bk1 0 0 32 24 18 0 #rect
>Proto Bk1 @|BIcon #fIcon
Bk5 f21 targetWindow NEW:card: #txt
Bk5 f21 targetDisplay TOP #txt
Bk5 f21 richDialogId ch.ivy.gawfs.workflowExecution.FinalReviewForm #txt
Bk5 f21 startMethod start(java.util.List<gawfs.TaskDef>,java.util.List<String>,java.lang.Integer) #txt
Bk5 f21 type gawfs.ExecutePredefinedWorkflowData #txt
Bk5 f21 requestActionDecl '<java.util.List<gawfs.TaskDef> finishedTasks, java.util.List<String> steps, java.lang.Integer actualStepIndex> param;' #txt
Bk5 f21 requestMappingAction 'param.finishedTasks=in.finishedTasks;
param.steps=in.steps;
param.actualStepIndex=in.actualStepIndex;
' #txt
Bk5 f21 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk5 f21 responseMappingAction 'out=in;
' #txt
Bk5 f21 windowConfiguration '* ' #txt
Bk5 f21 isAsynch false #txt
Bk5 f21 isInnerRd false #txt
Bk5 f21 userContext '* ' #txt
Bk5 f21 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>final workflow review</name>
        <nameStyle>21,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk5 f21 952 170 128 44 -56 -8 #rect
Bk5 f21 @|RichDialogIcon #fIcon
Bk5 f33 type gawfs.ExecutePredefinedWorkflowData #txt
Bk5 f33 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>use express endpage?</name>
        <nameStyle>20
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk5 f33 616 176 32 32 -65 -35 #rect
Bk5 f33 @|AlternativeIcon #fIcon
Bk5 f29 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk5 f29 actionTable 'out=in;
' #txt
Bk5 f29 actionCode 'import ch.ivy.addon.portalkit.persistence.variable.GlobalVariable;
import ch.ivy.addon.portalkit.service.GlobalSettingService;
String useExpressEndPage = new GlobalSettingService().findGlobalSettingValue(GlobalVariable.EXPRESS_END_PAGE);

in.useExpressEndPage = useExpressEndPage.isEmpty()? true : Boolean.valueOf(useExpressEndPage);' #txt
Bk5 f29 type gawfs.ExecutePredefinedWorkflowData #txt
Bk5 f29 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>read express end page setting</name>
        <nameStyle>29
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk5 f29 376 170 176 44 -83 -8 #rect
Bk5 f29 @|StepIcon #fIcon
Bk5 f28 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk5 f28 actionTable 'out=in;
' #txt
Bk5 f28 actionCode 'import java.util.Map;
import ch.ivy.addon.portalkit.enums.PortalLibrary;
import java.util.Arrays;
import ch.ivy.addon.portalkit.service.IvyAdapterService;
import ch.ivy.addon.portalkit.enums.AdditionalProperty;

Map x =  IvyAdapterService.startSubProcess("handleEndPage()", null, Arrays.asList(PortalLibrary.AXON_EXPRESS.getValue()));
in.callbackUrl = x.get("callbackUrl") as String;
ivy.task.setAdditionalProperty(AdditionalProperty.PORTAL_TASK_CALLBACK_URI.toString(), in.callbackUrl);

' #txt
Bk5 f28 security system #txt
Bk5 f28 type gawfs.ExecutePredefinedWorkflowData #txt
Bk5 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>set callback Url to 
task AdditionalProperty</name>
        <nameStyle>44
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk5 f28 728 170 160 44 -59 -16 #rect
Bk5 f28 @|StepIcon #fIcon
Bk5 f7 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk5 f7 actionTable 'out=in1;
' #txt
Bk5 f7 outTypes "gawfs.ExecutePredefinedWorkflowData" #txt
Bk5 f7 outLinks "TaskA.ivp" #txt
Bk5 f7 taskData 'TaskA.DESC=<%\=ivy.cms.co("/Dialogs/Tasks/FinalWorkflowTask/taskDescription", java.util.Arrays.asList(in1.workflowName, in1.nextTask.description))%>
TaskA.EXPRI=2
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.workflowName%>\: <%\=in1.nextTask.subject%>
TaskA.PRI=2
TaskA.ROL=CREATOR
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=0' #txt
Bk5 f7 type gawfs.ExecutePredefinedWorkflowData #txt
Bk5 f7 template "" #txt
Bk5 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>final workflow task</name>
        <nameStyle>19,7
</nameStyle>
        <desc>inform user about flow and if approved or denied</desc>
    </language>
</elementInfo>
' #txt
Bk5 f7 313 177 30 30 -50 17 #rect
Bk5 f7 @|TaskSwitchSimpleIcon #fIcon
Bk5 f32 expr in #txt
Bk5 f32 outCond in.useExpressEndPage #txt
Bk5 f32 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk5 f32 648 192 728 192 #arcP
Bk5 f32 0 0.3970929020272241 0 -10 #arcLabel
Bk5 f34 expr out #txt
Bk5 f34 552 192 616 192 #arcP
Bk5 f34 0 0.38321279022824617 0 0 #arcLabel
Bk5 f24 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk5 f24 actionTable 'out=in;
' #txt
Bk5 f24 actionCode 'if(in.denied==true){
	in.nextTask.subject = ivy.cms.co("/Dialogs/Tasks/Declined/TaskName");
	in.nextTask.description = ivy.cms.co("/Dialogs/Tasks/Declined/TaskName");
}else{
	in.nextTask.subject = ivy.cms.co("/Dialogs/Tasks/Approved/TaskName");
	in.nextTask.description = ivy.cms.co("/Dialogs/Tasks/Approved/TaskName");
}


' #txt
Bk5 f24 type gawfs.ExecutePredefinedWorkflowData #txt
Bk5 f24 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>setup final task</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk5 f24 136 170 112 44 -41 -8 #rect
Bk5 f24 @|StepIcon #fIcon
Bk5 f22 expr out #txt
Bk5 f22 888 192 952 192 #arcP
Bk5 f19 expr out #txt
Bk5 f19 type gawfs.ExecutePredefinedWorkflowData #txt
Bk5 f19 var in1 #txt
Bk5 f19 248 192 313 192 #arcP
Bk5 f19 0 0.42910208417979817 0 0 #arcLabel
Bk5 f35 expr in #txt
Bk5 f35 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk5 f35 632 208 1016 214 #arcP
Bk5 f35 1 632 254 #addKink
Bk5 f35 2 1016 254 #addKink
Bk5 f35 1 0.39004237799318525 -2 -12 #arcLabel
Bk5 f13 expr data #txt
Bk5 f13 outCond ivp=="TaskA.ivp" #txt
Bk5 f13 343 192 376 192 #arcP
Bk5 g0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>in 1</name>
    </language>
</elementInfo>
' #txt
Bk5 g0 51 179 26 26 0 5 #rect
Bk5 g0 @|MIGIcon #fIcon
Bk5 f0 77 192 136 192 #arcP
Bk5 g1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>out 1</name>
    </language>
</elementInfo>
' #txt
Bk5 g1 1139 179 26 26 0 5 #rect
Bk5 g1 @|MOGIcon #fIcon
Bk5 f1 expr out #txt
Bk5 f1 1080 192 1139 192 #arcP
>Proto Bk2 0 0 32 24 18 0 #rect
>Proto Bk2 @|BpmnSendTaskIcon #fIcon
Bk1 g0 51 179 26 26 0 5 #rect
Bk1 g0 @|MIGIcon #fIcon
Bk1 g1 611 179 26 26 0 5 #rect
Bk1 g1 @|MOGIcon #fIcon
Bk1 f3 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk1 f3 actionTable 'out=in;
' #txt
Bk1 f3 actionCode 'import ch.ivy.gawfs.mail.InformationMailSender;
InformationMailSender sender = new InformationMailSender();
sender.send(in.nextTask.email);' #txt
Bk1 f3 type gawfs.ExecutePredefinedWorkflowData #txt
Bk1 f3 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Send mail</name>
    </language>
</elementInfo>
' #txt
Bk1 f3 216 170 112 44 -28 -8 #rect
Bk1 f3 @|StepIcon #fIcon
Bk1 f4 77 192 216 192 #arcP
Bk1 f0 expr out #txt
Bk1 f0 328 192 611 192 #arcP
>Proto Bk3 0 0 32 24 18 0 #rect
>Proto Bk3 @|BIcon #fIcon
ew0 f0 mainOut f30 tail #connect
ew0 f30 head S11 g0 #connect
ew0 f16 mainOut f18 tail #connect
ew0 f18 head S11 g2 #connect
ew0 f12 head f1 mainIn #connect
ew0 f5 out f8 tail #connect
ew0 f8 head S31 g0 #connect
ew0 S31 g1 f12 tail #connect
ew0 f5 out f2 tail #connect
ew0 f2 head f9 mainIn #connect
ew0 U21 g1 f6 tail #connect
ew0 f6 head f5 in #connect
ew0 S11 g1 f10 tail #connect
ew0 f10 head f7 in #connect
ew0 f7 out f3 tail #connect
ew0 f3 head U21 g0 #connect
ew0 f9 mainOut f11 tail #connect
ew0 f11 head f7 in #connect
ew0 f7 out f13 tail #connect
ew0 f13 head S40 g0 #connect
ew0 S40 g1 f4 tail #connect
ew0 f4 head f5 in #connect
ew0 f7 out f14 tail #connect
ew0 f14 head f5 in #connect
Bk0 f5 mainOut f29 tail #connect
Bk0 f29 head f28 mainIn #connect
Bk0 g2 m f10 tail #connect
Bk0 f10 head f28 mainIn #connect
Bk0 f11 mainOut f1 tail #connect
Bk0 f1 head g1 m #connect
Bk0 f8 mainOut f3 tail #connect
Bk0 f3 head f5 mainIn #connect
Bk0 g0 m f0 tail #connect
Bk0 f0 head f8 mainIn #connect
Bk0 f28 mainOut f2 tail #connect
Bk0 f2 head f11 mainIn #connect
Bk0 0 0 896 520 0 #ivRect
Bk3 f8 head f16 in #connect
Bk3 f0 out f8 tail #connect
Bk3 f0 out f1 tail #connect
Bk3 f1 head f6 in #connect
Bk3 f16 out f7 tail #connect
Bk3 f7 head f5 in #connect
Bk3 f6 out f10 tail #connect
Bk3 f10 head f5 in #connect
Bk3 f11 mainOut f25 tail #connect
Bk3 f25 head f19 in #connect
Bk3 f28 out f30 tail #connect
Bk3 f30 head f11 mainIn #connect
Bk3 g0 m f32 tail #connect
Bk3 f32 head f31 mainIn #connect
Bk3 f31 mainOut f12 tail #connect
Bk3 f12 head f11 mainIn #connect
Bk3 g2 m f26 tail #connect
Bk3 f26 head f31 mainIn #connect
Bk3 f28 out f35 tail #connect
Bk3 f35 head f33 in #connect
Bk3 f9 head f28 in #connect
Bk3 f13 mainOut f21 tail #connect
Bk3 f21 head f0 in #connect
Bk3 f14 mainOut f18 tail #connect
Bk3 f18 head f4 in #connect
Bk3 f34 mainOut f29 tail #connect
Bk3 f29 head f3 mainIn #connect
Bk3 f43 head f34 mainIn #connect
Bk3 f4 out f45 tail #connect
Bk3 f45 head f44 mainIn #connect
Bk3 f44 mainOut f39 tail #connect
Bk3 f39 head f34 mainIn #connect
Bk3 f41 out f49 tail #connect
Bk3 f49 head f48 mainIn #connect
Bk3 f41 out f43 tail #connect
Bk3 f19 out f9 tail #connect
Bk3 f2 head g1 m #connect
Bk3 f3 mainOut f46 tail #connect
Bk3 f46 head f17 in #connect
Bk3 f47 head f48 mainIn #connect
Bk3 f4 out f22 tail #connect
Bk3 f22 head f15 in #connect
Bk3 f48 mainOut f53 tail #connect
Bk3 f53 head f15 in #connect
Bk3 f19 out f20 tail #connect
Bk3 f20 head f13 mainIn #connect
Bk3 f15 out f37 tail #connect
Bk3 f37 head f36 in #connect
Bk3 f33 out f51 tail #connect
Bk3 f51 head f36 in #connect
Bk3 f38 out f54 tail #connect
Bk3 f54 head f33 in #connect
Bk3 f38 out f2 tail #connect
Bk3 f52 mainOut f23 tail #connect
Bk3 f23 head f38 in #connect
Bk3 f17 out f47 tail #connect
Bk3 f17 out f27 tail #connect
Bk3 f27 head f41 in #connect
Bk3 f36 out f42 tail #connect
Bk3 f42 head f40 mainIn #connect
Bk3 f40 mainOut f24 tail #connect
Bk3 f24 head f52 mainIn #connect
Bk3 f55 mainOut f57 tail #connect
Bk3 f57 head f4 in #connect
Bk3 f5 out f56 tail #connect
Bk3 f56 head f55 mainIn #connect
Bk3 f5 out f50 tail #connect
Bk3 f50 head f14 mainIn #connect
Bk3 0 0 688 1976 0 #ivRect
Bk5 f29 mainOut f34 tail #connect
Bk5 f34 head f33 in #connect
Bk5 f35 head f21 mainIn #connect
Bk5 f33 out f32 tail #connect
Bk5 f32 head f28 mainIn #connect
Bk5 f33 out f35 tail #connect
Bk5 f28 mainOut f22 tail #connect
Bk5 f22 head f21 mainIn #connect
Bk5 f24 mainOut f19 tail #connect
Bk5 f19 head f7 in #connect
Bk5 f13 head f29 mainIn #connect
Bk5 f7 out f13 tail #connect
Bk5 g0 m f0 tail #connect
Bk5 f0 head f24 mainIn #connect
Bk5 f1 head g1 m #connect
Bk5 f21 mainOut f1 tail #connect
Bk5 0 0 1216 384 0 #ivRect
Bk1 g0 m f4 tail #connect
Bk1 f4 head f3 mainIn #connect
Bk1 f3 mainOut f0 tail #connect
Bk1 f0 head g1 m #connect
Bk1 0 0 640 512 0 #ivRect
