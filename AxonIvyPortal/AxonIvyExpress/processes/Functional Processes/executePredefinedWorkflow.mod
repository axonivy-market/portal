[Ivy]
15781632FDA1EB9E 3.20 #module
>Proto >Proto Collection #zClass
ew0 executePredefinedWorkflow Big #zClass
ew0 B #cInfo
ew0 #process
Bk0 BpmnServiceTask Big #zClass
Bk0 B #cInfo
Bk1 BpmnUserTask Big #zClass
Bk1 BpmnUserTask #cInfo
ew0 @TextInP .resExport .resExport #zField
ew0 @TextInP .type .type #zField
ew0 @TextInP .processKind .processKind #zField
ew0 @AnnotationInP-0n ai ai #zField
ew0 @MessageFlowInP-0n messageIn messageIn #zField
ew0 @MessageFlowOutP-0n messageOut messageOut #zField
ew0 @TextInP .xml .xml #zField
ew0 @TextInP .responsibility .responsibility #zField
ew0 @StartSub f0 '' #zField
ew0 @EndSub f1 '' #zField
ew0 @GridStep f9 '' #zField
ew0 @Alternative f10 '' #zField
ew0 @PushWFArc f12 '' #zField
ew0 @RichDialog f26 '' #zField
ew0 @PushWFArc f15 '' #zField
ew0 @RichDialog f11 '' #zField
ew0 @PushWFArc f30 '' #zField
ew0 Bk0 S11 'Sub 1' #zField
ew0 @Alternative f4 '' #zField
ew0 @PushWFArc f6 '' #zField
ew0 @Alternative f8 '' #zField
ew0 @PushWFArc f17 '' #zField
ew0 @RichDialog f21 '' #zField
ew0 @PushWFArc f2 '' #zField
ew0 @PushWFArc f14 '' #zField
ew0 @TaskSwitchSimple f7 '' #zField
ew0 @GridStep f24 '' #zField
ew0 @PushWFArc f25 '' #zField
ew0 @TkArc f19 '' #zField
ew0 Bk1 U20 'User 2' #zField
ew0 @PushWFArc f27 '' #zField
ew0 @PushWFArc f13 '' #zField
ew0 @StartSub f16 '' #zField
ew0 @PushWFArc f18 '' #zField
ew0 @PushWFArc f5 '' #zField
ew0 @TaskSwitchSimple f3 '' #zField
ew0 @TkArc f20 '' #zField
ew0 @PushWFArc f23 '' #zField
ew0 @GridStep f28 '' #zField
ew0 @GridStep f29 '' #zField
ew0 @PushWFArc f31 '' #zField
ew0 @Alternative f33 '' #zField
ew0 @PushWFArc f34 '' #zField
ew0 @PushWFArc f35 '' #zField
ew0 @PushWFArc f32 '' #zField
ew0 @PushWFArc f22 '' #zField
>Proto ew0 ew0 executePredefinedWorkflow #zField
Bk0 @TextInP .resExport .resExport #zField
Bk0 @TextInP .type .type #zField
Bk0 @TextInP .processKind .processKind #zField
Bk0 @AnnotationInP-0n ai ai #zField
Bk0 @MessageFlowInP-0n messageIn messageIn #zField
Bk0 @MessageFlowOutP-0n messageOut messageOut #zField
Bk0 @TextInP .xml .xml #zField
Bk0 @TextInP .responsibility .responsibility #zField
Bk0 @GridStep f28 '' #zField
Bk0 @PushTrueWFInG-01 g0 '' #zField
Bk0 @PushTrueWFOutG-01 g1 '' #zField
Bk0 @GridStep f21 '' #zField
Bk0 @PushWFArc f2 '' #zField
Bk0 @PushTrueWFInG-01 g2 '' #zField
Bk0 @PushWFArc f10 '' #zField
Bk0 @PushWFArc f0 '' #zField
Bk0 @PushWFArc f29 '' #zField
Bk0 @PushWFArc f4 '' #zField
Bk0 @PushWFArc f9 '' #zField
Bk0 @PushWFArc f6 '' #zField
Bk0 @GridStep f3 '' #zField
Bk0 @GridStep f5 '' #zField
Bk0 @GridStep f8 '' #zField
Bk0 @GridStep f7 '' #zField
Bk0 @GridStep f11 '' #zField
Bk0 @PushWFArc f12 '' #zField
Bk0 @PushWFArc f1 '' #zField
>Proto Bk0 Bk0 BpmnServiceTask #zField
Bk1 @TextInP .resExport .resExport #zField
Bk1 @TextInP .type .type #zField
Bk1 @TextInP .processKind .processKind #zField
Bk1 @AnnotationInP-0n ai ai #zField
Bk1 @MessageFlowInP-0n messageIn messageIn #zField
Bk1 @MessageFlowOutP-0n messageOut messageOut #zField
Bk1 @TextInP .xml .xml #zField
Bk1 @TextInP .responsibility .responsibility #zField
Bk1 @PushTrueWFInG-01 g0 '' #zField
Bk1 @PushTrueWFOutG-01 g1 '' #zField
Bk1 @TaskSwitchSimple f16 '' #zField
Bk1 @Alternative f0 '' #zField
Bk1 @PushWFArc f2 '' #zField
Bk1 @Alternative f4 '' #zField
Bk1 @PushWFArc f5 '' #zField
Bk1 @PushWFArc f3 '' #zField
Bk1 @TaskSwitchSimple f6 '' #zField
Bk1 @PushWFArc f7 '' #zField
Bk1 @TkArc f8 '' #zField
Bk1 @GridStep f9 '' #zField
Bk1 @PushWFArc f10 '' #zField
Bk1 @TkArc f1 '' #zField
>Proto Bk1 Bk1 BpmnUserTask #zField
ew0 f0 inParamDecl '<java.lang.String workflowID> param;' #txt
ew0 f0 inParamTable 'out.workflowID=param.workflowID;
' #txt
ew0 f0 outParamDecl '<> result;
' #txt
ew0 f0 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f0 callSignature call(String) #txt
ew0 f0 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>call(String)</name>
    </language>
</elementInfo>
' #txt
ew0 f0 113 25 30 30 -29 17 #rect
ew0 f0 @|StartSubIcon #fIcon
ew0 f1 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f1 1993 49 30 30 0 15 #rect
ew0 f1 @|EndSubIcon #fIcon
ew0 f9 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f9 actionTable 'out=in;
' #txt
ew0 f9 actionCode 'out.nextTask = in.definedTasks.removeGet(0);

in.actualStepIndex++;



' #txt
ew0 f9 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f9 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get next Task</name>
        <nameStyle>13,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f9 592 42 112 44 -36 -8 #rect
ew0 f9 @|StepIcon #fIcon
ew0 f10 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f10 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>more Tasks?</name>
        <nameStyle>11
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f10 506 50 28 28 -85 -16 #rect
ew0 f10 @|AlternativeIcon #fIcon
ew0 f12 expr in #txt
ew0 f12 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f12 534 64 592 64 #arcP
ew0 f12 0 0.39655172413793105 0 -7 #arcLabel
ew0 f26 targetWindow NEW:card: #txt
ew0 f26 targetDisplay TOP #txt
ew0 f26 richDialogId ch.ivy.gawfs.workflowExecution.WfFirstInputForm #txt
ew0 f26 startMethod start(gawfs.ExecutePredefinedWorkflowData) #txt
ew0 f26 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f26 requestActionDecl '<gawfs.ExecutePredefinedWorkflowData executePredefinedWorkflowData> param;' #txt
ew0 f26 requestMappingAction 'param.executePredefinedWorkflowData=in;
' #txt
ew0 f26 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f26 responseMappingAction 'out=in;
' #txt
ew0 f26 windowConfiguration '* ' #txt
ew0 f26 isAsynch false #txt
ew0 f26 isInnerRd false #txt
ew0 f26 userContext '* ' #txt
ew0 f26 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>show Formdialog</name>
        <nameStyle>15,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f26 360 170 112 44 -48 -8 #rect
ew0 f26 @|RichDialogIcon #fIcon
ew0 f15 expr out #txt
ew0 f15 416 170 506 64 #arcP
ew0 f15 1 416 64 #addKink
ew0 f15 1 0.03187079517437444 0 0 #arcLabel
ew0 f11 targetWindow NEW:card: #txt
ew0 f11 targetDisplay TOP #txt
ew0 f11 richDialogId ch.ivy.gawfs.workflowExecution.WfSecondReviewForm #txt
ew0 f11 startMethod start(gawfs.ExecutePredefinedWorkflowData) #txt
ew0 f11 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f11 requestActionDecl '<gawfs.ExecutePredefinedWorkflowData executePredefinedWorkflowData> param;' #txt
ew0 f11 requestMappingAction 'param.executePredefinedWorkflowData=in;
' #txt
ew0 f11 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f11 responseMappingAction 'out=result.executePredefinedWorkflowData;
' #txt
ew0 f11 windowConfiguration '* ' #txt
ew0 f11 isAsynch false #txt
ew0 f11 isInnerRd false #txt
ew0 f11 userContext '* ' #txt
ew0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>show form review dialog</name>
        <nameStyle>23,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f11 744 378 144 44 -66 -8 #rect
ew0 f11 @|RichDialogIcon #fIcon
ew0 f30 expr out #txt
ew0 f30 143 40 216 40 #arcP
ew0 S11 .resExport export #txt
ew0 S11 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>process initialitation</name>
        <nameStyle>22,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 S11 216 18 128 44 -55 -8 #rect
ew0 S11 @|BpmnServiceTaskIcon #fIcon
ew0 f4 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f4 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>denied?</name>
        <nameStyle>7,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f4 800 264 32 32 17 3 #rect
ew0 f4 @|AlternativeIcon #fIcon
ew0 f6 expr in #txt
ew0 f6 outCond !in.denied #txt
ew0 f6 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f6 816 264 520 50 #arcP
ew0 f6 1 816 24 #addKink
ew0 f6 2 520 24 #addKink
ew0 f6 0 0.065 14 0 #arcLabel
ew0 f8 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f8 888 176 32 32 0 16 #rect
ew0 f8 @|AlternativeIcon #fIcon
ew0 f17 expr in #txt
ew0 f17 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f17 832 280 904 208 #arcP
ew0 f17 1 904 280 #addKink
ew0 f17 1 0.40625 14 0 #arcLabel
ew0 f21 targetWindow NEW:card: #txt
ew0 f21 targetDisplay TOP #txt
ew0 f21 richDialogId ch.ivy.gawfs.workflowExecution.WfFinalReview #txt
ew0 f21 startMethod start(gawfs.ExecutePredefinedWorkflowData) #txt
ew0 f21 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f21 requestActionDecl '<gawfs.ExecutePredefinedWorkflowData executePredefinedWorkflowData> param;' #txt
ew0 f21 requestMappingAction 'param.executePredefinedWorkflowData=in;
' #txt
ew0 f21 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f21 responseMappingAction 'out=result.executePredefinedWorkflowData;
' #txt
ew0 f21 windowConfiguration '* ' #txt
ew0 f21 isAsynch false #txt
ew0 f21 isInnerRd false #txt
ew0 f21 userContext '* ' #txt
ew0 f21 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>final workflow review</name>
        <nameStyle>21,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f21 1824 170 128 44 -56 -8 #rect
ew0 f21 @|RichDialogIcon #fIcon
ew0 f2 expr out #txt
ew0 f2 1952 192 2008 79 #arcP
ew0 f2 1 2008 192 #addKink
ew0 f2 0 0.7808932228298981 0 0 #arcLabel
ew0 f14 expr in #txt
ew0 f14 outCond in.definedTasks.size()==0 #txt
ew0 f14 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f14 520 78 888 192 #arcP
ew0 f14 1 520 192 #addKink
ew0 f14 0 0.30701754385964913 15 0 #arcLabel
ew0 f7 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f7 actionTable 'out=in1;
' #txt
ew0 f7 outTypes "gawfs.ExecutePredefinedWorkflowData" #txt
ew0 f7 outLinks "TaskA.ivp" #txt
ew0 f7 taskData 'TaskA.DESC=<%\=ivy.cms.co("/Dialogs/Tasks/FinalWorkflowTask/taskDescription", java.util.Arrays.asList(in1.workflowName, in1.nextTask.description))%>
TaskA.EXPRI=2
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.workflowName%>\: <%\=in1.nextTask.subject%>
TaskA.PRI=2
TaskA.ROL=CREATOR
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=0' #txt
ew0 f7 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f7 template "" #txt
ew0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>final workflow task</name>
        <nameStyle>19,7
</nameStyle>
        <desc>inform user about flow and if approved or denied</desc>
    </language>
</elementInfo>
' #txt
ew0 f7 1049 177 30 30 -50 17 #rect
ew0 f7 @|TaskSwitchSimpleIcon #fIcon
ew0 f24 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f24 actionTable 'out=in;
' #txt
ew0 f24 actionCode 'if(in.denied==true){
	in.nextTask.subject = ivy.cms.co("/Dialogs/Tasks/Declined/TaskName");
	in.nextTask.description = ivy.cms.co("/Dialogs/Tasks/Declined/TaskName");
}else{
	in.nextTask.subject = ivy.cms.co("/Dialogs/Tasks/Approved/TaskName");
	in.nextTask.description = ivy.cms.co("/Dialogs/Tasks/Approved/TaskName");
}


' #txt
ew0 f24 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f24 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>setup final task</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f24 928 42 112 44 -41 -8 #rect
ew0 f24 @|StepIcon #fIcon
ew0 f25 expr in #txt
ew0 f25 904 176 928 64 #arcP
ew0 f25 1 904 64 #addKink
ew0 f25 0 0.8021200800812106 0 0 #arcLabel
ew0 f19 expr out #txt
ew0 f19 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f19 var in1 #txt
ew0 f19 1040 64 1064 177 #arcP
ew0 f19 1 1064 64 #addKink
ew0 f19 0 0.8620354369683446 0 0 #arcLabel
ew0 U20 .resExport export #txt
ew0 U20 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>UserTaslk</name>
        <nameStyle>9,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 U20 592 378 112 44 -28 -8 #rect
ew0 U20 @|BpmnUserTaskIcon #fIcon
ew0 f27 expr out #txt
ew0 f27 648 86 648 378 #arcP
ew0 f27 0 0.257219996276489 0 0 #arcLabel
ew0 f13 704 400 744 400 #arcP
ew0 f16 inParamDecl '<List<gawfs.TaskDef> definedTasks,java.lang.String processName,java.lang.String processDescription,java.lang.String processType,ch.ivy.gawfs.DragAndDropController dragAndDropController,ch.ivy.gawfs.DynaFormController dynaFormController,java.lang.String processID> param;' #txt
ew0 f16 inParamTable 'out.definedTasks=param.definedTasks;
out.dragAndDropController=param.dragAndDropController;
out.dynaFormController=param.dynaFormController;
out.workflowDescription=param.processDescription;
out.workflowID=param.processID;
out.workflowName=param.processName;
out.workflowType=param.processType;
' #txt
ew0 f16 outParamDecl '<> result;
' #txt
ew0 f16 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f16 callSignature call(List<gawfs.TaskDef>,String,String,String,ch.ivy.gawfs.DragAndDropController,ch.ivy.gawfs.DynaFormController,String) #txt
ew0 f16 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f16 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>call(all parameters)</name>
        <nameStyle>20,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f16 113 81 30 30 -48 23 #rect
ew0 f16 @|StartSubIcon #fIcon
ew0 f18 expr out #txt
ew0 f18 143 96 216 40 #arcP
ew0 f18 1 184 96 #addKink
ew0 f18 2 184 40 #addKink
ew0 f18 0 0.7517935662402834 0 0 #arcLabel
ew0 f5 expr out #txt
ew0 f5 816 378 816 296 #arcP
ew0 f3 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f3 actionTable 'out=in1;
' #txt
ew0 f3 outTypes "gawfs.ExecutePredefinedWorkflowData" #txt
ew0 f3 outLinks "TaskA.ivp" #txt
ew0 f3 taskData 'TaskA.DESC=<%\=in1.nextTask.description%>
TaskA.EXPRI=2
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.nextTask.subject%>
TaskA.PRI=2
TaskA.ROL=CREATOR
TaskA.SKIP_TASK_LIST=true
TaskA.TYPE=0' #txt
ew0 f3 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f3 template "" #txt
ew0 f3 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>init Task	</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f3 265 177 30 30 -24 21 #rect
ew0 f3 @|TaskSwitchSimpleIcon #fIcon
ew0 f20 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f20 var in1 #txt
ew0 f20 280 62 280 177 #arcP
ew0 f20 0 0.6297874484091895 0 0 #arcLabel
ew0 f23 expr data #txt
ew0 f23 outCond ivp=="TaskA.ivp" #txt
ew0 f23 295 192 360 192 #arcP
ew0 f23 0 0.02819205207412269 0 0 #arcLabel
ew0 f28 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f28 actionTable 'out=in;
' #txt
ew0 f28 actionCode 'import java.util.Map;
import ch.ivy.addon.portalkit.enums.PortalLibrary;
import java.util.Arrays;
import ch.ivy.addon.portalkit.service.IvyAdapterService;
import ch.ivy.addon.portalkit.enums.AdditionalProperty;

Map x =  IvyAdapterService.startSubProcess("handleEndPage()", null, Arrays.asList(PortalLibrary.AXON_EXPRESS.getValue()));
in.callbackUrl = x.get("callbackUrl") as String;
ivy.task.setAdditionalProperty(AdditionalProperty.PORTAL_TASK_CALLBACK_URI.toString(), in.callbackUrl);

' #txt
ew0 f28 security system #txt
ew0 f28 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>set callback Url to 
task AdditionalProperty</name>
        <nameStyle>44
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f28 1552 170 160 44 -59 -16 #rect
ew0 f28 @|StepIcon #fIcon
ew0 f29 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
ew0 f29 actionTable 'out=in;
' #txt
ew0 f29 actionCode 'import ch.ivy.addon.portalkit.support.DataCache;
import ch.ivy.addon.portalkit.persistence.variable.GlobalVariable;

in.useExpressEndPage = DataCache.getGlobalSettingValueAsBoolean(GlobalVariable.EXPRESS_END_PAGE); ' #txt
ew0 f29 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f29 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>read express end page setting</name>
        <nameStyle>29,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f29 1152 170 176 44 -83 -8 #rect
ew0 f29 @|StepIcon #fIcon
ew0 f31 expr data #txt
ew0 f31 outCond ivp=="TaskA.ivp" #txt
ew0 f31 1079 192 1152 192 #arcP
ew0 f31 0 0.38321279022824617 0 0 #arcLabel
ew0 f33 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f33 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>use express endpage?</name>
        <nameStyle>20
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f33 1392 176 32 32 -65 -35 #rect
ew0 f33 @|AlternativeIcon #fIcon
ew0 f34 expr out #txt
ew0 f34 1328 192 1392 192 #arcP
ew0 f34 0 0.38321279022824617 0 0 #arcLabel
ew0 f35 expr in #txt
ew0 f35 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f35 1408 208 1888 214 #arcP
ew0 f35 1 1408 256 #addKink
ew0 f35 2 1888 256 #addKink
ew0 f35 1 0.39004237799318525 -2 -12 #arcLabel
ew0 f32 expr in #txt
ew0 f32 outCond in.useExpressEndPage #txt
ew0 f32 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f32 1424 192 1552 192 #arcP
ew0 f32 0 0.3970929020272241 0 -10 #arcLabel
ew0 f22 expr out #txt
ew0 f22 1712 192 1824 192 #arcP
>Proto ew0 .type gawfs.ExecutePredefinedWorkflowData #txt
>Proto ew0 .processKind CALLABLE_SUB #txt
>Proto ew0 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <swimlaneLabel>engine</swimlaneLabel>
        <swimlaneLabel>workflow initiator</swimlaneLabel>
        <swimlaneLabel>workflow 
form reviewer</swimlaneLabel>
    </language>
    <swimlaneOrientation>false</swimlaneOrientation>
    <swimlaneSize>144</swimlaneSize>
    <swimlaneSize>176</swimlaneSize>
    <swimlaneSize>144</swimlaneSize>
    <swimlaneColor gradient="false">-1</swimlaneColor>
    <swimlaneColor gradient="false">-1</swimlaneColor>
    <swimlaneColor gradient="false">-1</swimlaneColor>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneType>LANE</swimlaneType>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
    <swimlaneSpaceBefore>0</swimlaneSpaceBefore>
</elementInfo>
' #txt
>Proto ew0 0 0 32 24 18 0 #rect
>Proto ew0 @|BIcon #fIcon
Bk0 f28 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f28 actionTable 'out=in;
' #txt
Bk0 f28 actionCode 'import gawfs.TaskDef;
for(TaskDef task: in.definedTasks){
	in.steps.add(task.subject);
}

in.actualStepIndex = 0;
in.denied = false;' #txt
Bk0 f28 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>init workflowsettings</name>
        <nameStyle>21,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk0 f28 200 330 128 44 -55 -8 #rect
Bk0 f28 @|StepIcon #fIcon
Bk0 g0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>in 1</name>
    </language>
</elementInfo>
' #txt
Bk0 g0 51 35 26 26 -25 18 #rect
Bk0 g0 @|MIGIcon #fIcon
Bk0 g1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>out 1</name>
    </language>
</elementInfo>
' #txt
Bk0 g1 675 403 26 26 -27 18 #rect
Bk0 g1 @|MOGIcon #fIcon
Bk0 f21 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f21 actionTable 'out=in;
' #txt
Bk0 f21 actionCode 'out.nextTask = in.definedTasks.removeGet(0);
//out.nextTask.setSubject(in.caseInfo.subject);


' #txt
Bk0 f21 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f21 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get first Task</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk0 f21 208 394 112 44 -35 -8 #rect
Bk0 f21 @|StepIcon #fIcon
Bk0 f2 expr out #txt
Bk0 f2 264 374 264 394 #arcP
Bk0 g2 51 339 26 26 -4 -48 #rect
Bk0 g2 @|MIGIcon #fIcon
Bk0 f10 77 352 200 352 #arcP
Bk0 f0 77 48 208 48 #arcP
Bk0 f29 expr out #txt
Bk0 f29 264 310 264 330 #arcP
Bk0 f4 expr out #txt
Bk0 f4 264 150 264 202 #arcP
Bk0 f9 expr out #txt
Bk0 f9 264 70 264 106 #arcP
Bk0 f6 expr out #txt
Bk0 f6 264 246 264 266 #arcP
Bk0 f3 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f3 actionTable 'out=in;
' #txt
Bk0 f3 actionCode 'import ch.ivy.addon.portalkit.service.ExpressServiceRegistry;
import ch.ivy.addon.portalkit.bo.ExpressFormElement;
List<ExpressFormElement> formelements = ExpressServiceRegistry.getFormElementService().findByProcessId(in.workflowID);

for(ExpressFormElement element: formelements){
	ch.ivy.gawfs.Formelement formelement;
	
	formelement.id = element.elementID;
	formelement.intSetting = element.intSetting;
	formelement.label = element.label;
	formelement.name = element.name;
	formelement.required = element.required;
	formelement.type = element.elementType;
	
	ivy.log.debug("element.optionsStr");
	List<String> optionsStrx = element.optionsStr.split(":",-1);
	
	//direct assignement makes an array list, which makes problems in the seriealization, workaround:
	for(String optionx: optionsStrx){
		ivy.log.debug("1" + optionx);
		formelement.addOption(optionx);
	}
	
	if(element.elementPosition=="HEADER"){
		in.dragAndDropController.selectedFormelementsHeader.add(formelement);
	}else if(element.elementPosition=="LEFTPANEL"){
		in.dragAndDropController.selectedFormelementsLeftPanel.add(formelement);
	}else if(element.elementPosition=="RIGHTPANEL"){
		in.dragAndDropController.selectedFormelementsRightPanel.add(formelement);
	}else{
		in.dragAndDropController.selectedFormelementsFooter.add(formelement);
	}
	
	
}' #txt
Bk0 f3 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f3 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get formelements</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk0 f3 208 202 112 44 -48 -8 #rect
Bk0 f3 @|StepIcon #fIcon
Bk0 f5 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f5 actionTable 'out=in;
' #txt
Bk0 f5 actionCode 'import ch.ivy.addon.portalkit.service.ExpressServiceRegistry;
import ch.ivy.addon.portalkit.bo.ExpressTaskDefinition;
import ch.ivy.gawfs.Helper;
import gawfs.TaskDef;

Helper helper = new Helper();

List<ExpressTaskDefinition> taskSteps = ExpressServiceRegistry.getTaskDefinitionService().findByProcessId(in.workflowID);

for(ExpressTaskDefinition task: taskSteps){
	TaskDef xtask = new TaskDef();
	xtask.actor = task.taskActor;
	xtask.count = task.taskCount;
	xtask.description = task.description;
	xtask.subject = task.subject;
	xtask.untilDays = task.untilDays;
	in.definedTasks.add(xtask);
	
}

in.definedTasks = helper.sortTasks(in.definedTasks);' #txt
Bk0 f5 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Tasksteps</name>
        <nameStyle>13,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk0 f5 208 266 112 44 -39 -8 #rect
Bk0 f5 @|StepIcon #fIcon
Bk0 f8 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f8 actionTable 'out=in;
' #txt
Bk0 f8 actionCode 'import ch.ivy.addon.portalkit.service.ExpressServiceRegistry;
import ch.ivy.addon.portalkit.bo.ExpressProcess;


ExpressProcess workflow = ExpressServiceRegistry.getProcessService().findById(in.workflowID) as ExpressProcess;

in.workflowDescription = workflow.processDescription;
in.workflowName = workflow.processName;
in.workflowType = workflow.processType;


' #txt
Bk0 f8 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f8 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Workflow Credentials</name>
        <nameStyle>24,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk0 f8 192 106 144 44 -68 -8 #rect
Bk0 f8 @|StepIcon #fIcon
Bk0 f7 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f7 actionTable 'out=in;
' #txt
Bk0 f7 actionCode 'import ch.ivy.gawfs.DynaFormController;
import ch.ivy.gawfs.DragAndDropController;

in.dragAndDropController = new DragAndDropController();
in.dynaFormController = new DynaFormController(in.dragAndDropController);
' #txt
Bk0 f7 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>init Controllers</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk0 f7 208 26 112 44 -40 -8 #rect
Bk0 f7 @|StepIcon #fIcon
Bk0 f11 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk0 f11 actionTable 'out=in;
' #txt
Bk0 f11 actionCode 'ivy.task.setName(ivy.cms.co("/Dialogs/Tasks/ProcessLoaded/TaskName"));
ivy.task.setDescription(ivy.cms.co("/Dialogs/Tasks/ProcessLoaded/TaskName"));

ivy.case.setName(in.workflowName);
ivy.case.setDescription(in.workflowDescription);' #txt
Bk0 f11 security system #txt
Bk0 f11 type gawfs.ExecutePredefinedWorkflowData #txt
Bk0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>set Task and Case Fields</name>
        <nameStyle>24,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk0 f11 376 394 160 44 -70 -8 #rect
Bk0 f11 @|StepIcon #fIcon
Bk0 f12 expr out #txt
Bk0 f12 320 416 376 416 #arcP
Bk0 f1 expr out #txt
Bk0 f1 536 416 675 416 #arcP
>Proto Bk0 0 0 32 24 18 0 #rect
>Proto Bk0 @|BIcon #fIcon
Bk1 g0 307 51 26 26 0 5 #rect
Bk1 g0 @|MIGIcon #fIcon
Bk1 g1 307 467 26 26 0 5 #rect
Bk1 g1 @|MOGIcon #fIcon
Bk1 f16 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk1 f16 actionTable 'out=in1;
' #txt
Bk1 f16 outTypes "gawfs.ExecutePredefinedWorkflowData" #txt
Bk1 f16 outLinks "TaskA.ivp" #txt
Bk1 f16 taskData 'TaskA.DESC=<%\=in1.nextTask.description%>\n
TaskA.EXP=new Duration(0,0,in1.nextTask.untilDays,0,0,0)
TaskA.EXPRI=1
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.nextTask.subject%>
TaskA.PRI=2
TaskA.ROL=in1.nextTask.actor
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=2' #txt
Bk1 f16 type gawfs.ExecutePredefinedWorkflowData #txt
Bk1 f16 template "" #txt
Bk1 f16 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>create review  task
for group</name>
        <nameStyle>29,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk1 f16 306 338 28 28 19 -16 #rect
Bk1 f16 @|TaskSwitchSimpleIcon #fIcon
Bk1 f0 type gawfs.ExecutePredefinedWorkflowData #txt
Bk1 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>assigned to User?</name>
        <nameStyle>17,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk1 f0 304 200 32 32 13 -31 #rect
Bk1 f0 @|AlternativeIcon #fIcon
Bk1 f2 320 77 320 200 #arcP
Bk1 f4 type gawfs.ExecutePredefinedWorkflowData #txt
Bk1 f4 304 400 32 32 0 16 #rect
Bk1 f4 @|AlternativeIcon #fIcon
Bk1 f5 expr data #txt
Bk1 f5 outCond ivp=="TaskA.ivp" #txt
Bk1 f5 320 366 320 400 #arcP
Bk1 f3 expr in #txt
Bk1 f3 320 432 320 467 #arcP
Bk1 f6 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk1 f6 actionTable 'out=in1;
' #txt
Bk1 f6 outTypes "gawfs.ExecutePredefinedWorkflowData" #txt
Bk1 f6 outLinks "TaskA.ivp" #txt
Bk1 f6 taskData 'TaskA.DESC=<%\=in1.nextTask.description%>\n
TaskA.EXP=new Duration(0,0,in1.nextTask.untilDays,0,0,0)
TaskA.EXPRI=1
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.nextTask.subject%>
TaskA.PRI=2
TaskA.ROL=in1.nextTask.actor
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=3' #txt
Bk1 f6 type gawfs.ExecutePredefinedWorkflowData #txt
Bk1 f6 template "" #txt
Bk1 f6 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>create review task
for user</name>
        <nameStyle>27,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk1 f6 458 338 28 28 29 -13 #rect
Bk1 f6 @|TaskSwitchSimpleIcon #fIcon
Bk1 f7 expr data #txt
Bk1 f7 outCond ivp=="TaskA.ivp" #txt
Bk1 f7 472 366 336 416 #arcP
Bk1 f7 1 472 416 #addKink
Bk1 f7 1 0.1013107571445728 0 0 #arcLabel
Bk1 f8 expr in #txt
Bk1 f8 type gawfs.ExecutePredefinedWorkflowData #txt
Bk1 f8 var in1 #txt
Bk1 f8 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk1 f8 320 232 320 338 #arcP
Bk1 f8 0 0.16037735849056603 17 0 #arcLabel
Bk1 f9 actionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk1 f9 actionTable 'out=in;
' #txt
Bk1 f9 actionCode 'in.nextTask.actor = in.nextTask.actor.substring(1);' #txt
Bk1 f9 type gawfs.ExecutePredefinedWorkflowData #txt
Bk1 f9 424 272 96 32 0 -8 #rect
Bk1 f9 @|StepIcon #fIcon
Bk1 f10 expr in #txt
Bk1 f10 outCond 'in.nextTask.actor.startsWith("#")' #txt
Bk1 f10 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk1 f10 336 216 472 272 #arcP
Bk1 f10 1 472 216 #addKink
Bk1 f10 1 0.4722222222222222 19 0 #arcLabel
Bk1 f1 expr out #txt
Bk1 f1 type gawfs.ExecutePredefinedWorkflowData #txt
Bk1 f1 var in1 #txt
Bk1 f1 472 304 472 338 #arcP
Bk1 f1 0 0.9254675491835372 0 0 #arcLabel
>Proto Bk1 0 0 32 24 18 0 #rect
>Proto Bk1 @|BpmnUserTaskIcon #fIcon
ew0 f12 head f9 mainIn #connect
ew0 f26 mainOut f15 tail #connect
ew0 f15 head f10 in #connect
ew0 f0 mainOut f30 tail #connect
ew0 f30 head S11 g0 #connect
ew0 f4 out f6 tail #connect
ew0 f6 head f10 in #connect
ew0 f10 out f14 tail #connect
ew0 f14 head f8 in #connect
ew0 f10 out f12 tail #connect
ew0 f4 out f17 tail #connect
ew0 f17 head f8 in #connect
ew0 f21 mainOut f2 tail #connect
ew0 f2 head f1 mainIn #connect
ew0 f8 out f25 tail #connect
ew0 f25 head f24 mainIn #connect
ew0 f24 mainOut f19 tail #connect
ew0 f19 head f7 in #connect
ew0 f9 mainOut f27 tail #connect
ew0 f27 head U20 g0 #connect
ew0 U20 g1 f13 tail #connect
ew0 f13 head f11 mainIn #connect
ew0 f16 mainOut f18 tail #connect
ew0 f18 head S11 g2 #connect
ew0 f11 mainOut f5 tail #connect
ew0 f5 head f4 in #connect
ew0 S11 g1 f20 tail #connect
ew0 f20 head f3 in #connect
ew0 f3 out f23 tail #connect
ew0 f23 head f26 mainIn #connect
ew0 f7 out f31 tail #connect
ew0 f31 head f29 mainIn #connect
ew0 f29 mainOut f34 tail #connect
ew0 f34 head f33 in #connect
ew0 f35 head f21 mainIn #connect
ew0 f33 out f32 tail #connect
ew0 f32 head f28 mainIn #connect
ew0 f33 out f35 tail #connect
ew0 f28 mainOut f22 tail #connect
ew0 f22 head f21 mainIn #connect
Bk0 f3 mainOut f6 tail #connect
Bk0 f6 head f5 mainIn #connect
Bk0 f5 mainOut f29 tail #connect
Bk0 f29 head f28 mainIn #connect
Bk0 g0 m f0 tail #connect
Bk0 f0 head f7 mainIn #connect
Bk0 f28 mainOut f2 tail #connect
Bk0 f2 head f21 mainIn #connect
Bk0 f7 mainOut f9 tail #connect
Bk0 f9 head f8 mainIn #connect
Bk0 f8 mainOut f4 tail #connect
Bk0 f4 head f3 mainIn #connect
Bk0 g2 m f10 tail #connect
Bk0 f10 head f28 mainIn #connect
Bk0 f21 mainOut f12 tail #connect
Bk0 f12 head f11 mainIn #connect
Bk0 f11 mainOut f1 tail #connect
Bk0 f1 head g1 m #connect
Bk0 0 0 896 520 0 #ivRect
Bk1 g0 m f2 tail #connect
Bk1 f2 head f0 in #connect
Bk1 f16 out f5 tail #connect
Bk1 f5 head f4 in #connect
Bk1 f4 out f3 tail #connect
Bk1 f3 head g1 m #connect
Bk1 f6 out f7 tail #connect
Bk1 f7 head f4 in #connect
Bk1 f8 head f16 in #connect
Bk1 f0 out f10 tail #connect
Bk1 f10 head f9 mainIn #connect
Bk1 f0 out f8 tail #connect
Bk1 f9 mainOut f1 tail #connect
Bk1 f1 head f6 in #connect
Bk1 0 0 640 544 0 #ivRect
