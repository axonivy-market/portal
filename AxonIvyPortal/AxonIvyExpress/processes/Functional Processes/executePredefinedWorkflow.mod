[Ivy]
163729F2CBAE7BE4 3.28 #module
>Proto >Proto Collection #zClass
ew0 executePredefinedWorkflow Big #zClass
ew0 B #cInfo
ew0 #process
Bk4 BpmnUserTask Big #zClass
Bk4 BpmnUserTask #cInfo
Bk5 BpmnServiceTask Big #zClass
Bk5 B #cInfo
Bk6 BpmnSendTask Big #zClass
Bk6 BpmnSendTask #cInfo
Bk7 BpmnUserTask Big #zClass
Bk7 B #cInfo
Bk8 BpmnUserTask Big #zClass
Bk8 BpmnUserTask #cInfo
ew0 @TextInP .type .type #zField
ew0 @TextInP .processKind .processKind #zField
ew0 @AnnotationInP-0n ai ai #zField
ew0 @MessageFlowInP-0n messageIn messageIn #zField
ew0 @MessageFlowOutP-0n messageOut messageOut #zField
ew0 @TextInP .xml .xml #zField
ew0 @TextInP .responsibility .responsibility #zField
ew0 @EndSub f1 '' #zField
ew0 @GridStep f9 '' #zField
ew0 Bk4 U21 'User 2' #zField
ew0 @StartSub f0 '' #zField
ew0 @Alternative f7 '' #zField
ew0 Bk5 S11 'Sub 1' #zField
ew0 Bk6 S40 'Send 4' #zField
ew0 Bk7 S31 'Sub 3' #zField
ew0 @StartSub f16 '' #zField
ew0 @Alternative f5 '' #zField
ew0 @PushWFArc f13 '' #zField
ew0 @PushWFArc f18 '' #zField
ew0 @PushWFArc f11 '' #zField
ew0 @PushWFArc f4 '' #zField
ew0 @PushWFArc f6 '' #zField
ew0 @PushWFArc f30 '' #zField
ew0 @PushWFArc f3 '' #zField
ew0 @PushWFArc f2 '' #zField
ew0 @PushWFArc f10 '' #zField
ew0 Bk8 U20 'User 2' #zField
ew0 @PushWFArc f17 '' #zField
ew0 @PushWFArc f15 '' #zField
ew0 @PushWFArc f14 '' #zField
ew0 @EndSub f32 '' #zField
ew0 @Alternative f34 '' #zField
ew0 @StartSub f35 '' #zField
ew0 @EndTask f36 '' #zField
ew0 @PushWFArc f19 '' #zField
ew0 @PushWFArc f39 '' #zField
ew0 @TaskSwitch f26 '' #zField
ew0 @TkArc f20 '' #zField
ew0 @PushWFArc f21 '' #zField
ew0 @Alternative f12 '' #zField
ew0 @PushWFArc f22 '' #zField
ew0 @Alternative f23 '' #zField
ew0 @PushWFArc f25 '' #zField
ew0 @PushWFArc f24 '' #zField
ew0 @PushWFArc f8 '' #zField
ew0 @GridStep f28 '' #zField
ew0 @PushWFArc f29 '' #zField
ew0 @PushWFArc f27 '' #zField
>Proto ew0 ew0 executePredefinedWorkflow #zField
Bk4 @TextInP .type .type #zField
Bk4 @TextInP .processKind .processKind #zField
Bk4 @AnnotationInP-0n ai ai #zField
Bk4 @MessageFlowInP-0n messageIn messageIn #zField
Bk4 @MessageFlowOutP-0n messageOut messageOut #zField
Bk4 @TextInP .xml .xml #zField
Bk4 @TextInP .responsibility .responsibility #zField
Bk4 @PushTrueWFInG-01 g0 '' #zField
Bk4 @PushTrueWFOutG-01 g1 '' #zField
Bk4 @TaskSwitchSimple f6 '' #zField
Bk4 @Alternative f5 '' #zField
Bk4 @UserDialog f14 '' #zField
Bk4 @PushWFArc f10 '' #zField
Bk4 @PushWFArc f7 '' #zField
Bk4 @TaskSwitchSimple f16 '' #zField
Bk4 @TkArc f8 '' #zField
Bk4 @TkArc f1 '' #zField
Bk4 @Alternative f0 '' #zField
Bk4 @GridStep f13 '' #zField
Bk4 @PushWFArc f21 '' #zField
Bk4 @PushWFArc f50 '' #zField
Bk4 @CallSub f64 '' #zField
Bk4 @PushWFArc f12 '' #zField
Bk4 @Alternative f2 '' #zField
Bk4 @PushWFArc f57 '' #zField
Bk4 @CallSub f4 '' #zField
Bk4 @PushWFArc f66 '' #zField
Bk4 @PushWFArc f56 '' #zField
Bk4 @UserDialog f55 '' #zField
Bk4 @GridStep f18 '' #zField
Bk4 @PushWFArc f19 '' #zField
Bk4 @PushWFArc f9 '' #zField
Bk4 @GridStep f20 '' #zField
Bk4 @PushWFArc f22 '' #zField
Bk4 @PushWFArc f3 '' #zField
Bk4 @GridStep f11 '' #zField
Bk4 @PushWFArc f17 '' #zField
Bk4 @PushWFArc f41 '' #zField
>Proto Bk4 Bk0 BpmnUserTask #zField
Bk5 @TextInP .type .type #zField
Bk5 @TextInP .processKind .processKind #zField
Bk5 @AnnotationInP-0n ai ai #zField
Bk5 @MessageFlowInP-0n messageIn messageIn #zField
Bk5 @MessageFlowOutP-0n messageOut messageOut #zField
Bk5 @TextInP .xml .xml #zField
Bk5 @TextInP .responsibility .responsibility #zField
Bk5 @GridStep f28 '' #zField
Bk5 @PushTrueWFInG-01 g0 '' #zField
Bk5 @PushTrueWFOutG-01 g1 '' #zField
Bk5 @PushTrueWFInG-01 g2 '' #zField
Bk5 @PushWFArc f10 '' #zField
Bk5 @PushWFArc f29 '' #zField
Bk5 @GridStep f5 '' #zField
Bk5 @GridStep f8 '' #zField
Bk5 @GridStep f11 '' #zField
Bk5 @PushWFArc f1 '' #zField
Bk5 @PushWFArc f3 '' #zField
Bk5 @PushWFArc f0 '' #zField
Bk5 @PushWFArc f2 '' #zField
>Proto Bk5 Bk1 BpmnServiceTask #zField
Bk6 @TextInP .type .type #zField
Bk6 @TextInP .processKind .processKind #zField
Bk6 @AnnotationInP-0n ai ai #zField
Bk6 @MessageFlowInP-0n messageIn messageIn #zField
Bk6 @MessageFlowOutP-0n messageOut messageOut #zField
Bk6 @TextInP .xml .xml #zField
Bk6 @TextInP .responsibility .responsibility #zField
Bk6 @PushTrueWFInG-01 g0 '' #zField
Bk6 @PushTrueWFOutG-01 g1 '' #zField
Bk6 @GridStep f3 '' #zField
Bk6 @PushWFArc f4 '' #zField
Bk6 @PushWFArc f0 '' #zField
>Proto Bk6 Bk2 BpmnSendTask #zField
Bk7 @TextInP .type .type #zField
Bk7 @TextInP .processKind .processKind #zField
Bk7 @AnnotationInP-0n ai ai #zField
Bk7 @MessageFlowInP-0n messageIn messageIn #zField
Bk7 @MessageFlowOutP-0n messageOut messageOut #zField
Bk7 @TextInP .xml .xml #zField
Bk7 @TextInP .responsibility .responsibility #zField
Bk7 @UserDialog f21 '' #zField
Bk7 @Alternative f33 '' #zField
Bk7 @GridStep f29 '' #zField
Bk7 @GridStep f28 '' #zField
Bk7 @TaskSwitchSimple f7 '' #zField
Bk7 @PushWFArc f32 '' #zField
Bk7 @PushWFArc f34 '' #zField
Bk7 @GridStep f24 '' #zField
Bk7 @PushWFArc f22 '' #zField
Bk7 @TkArc f19 '' #zField
Bk7 @PushWFArc f35 '' #zField
Bk7 @PushWFArc f13 '' #zField
Bk7 @PushTrueWFInG-01 g0 '' #zField
Bk7 @PushTrueWFOutG-01 g1 '' #zField
Bk7 @PushWFArc f1 '' #zField
Bk7 @PushWFArc f0 '' #zField
>Proto Bk7 Bk3 BpmnUserTask #zField
Bk8 @TextInP .type .type #zField
Bk8 @TextInP .processKind .processKind #zField
Bk8 @AnnotationInP-0n ai ai #zField
Bk8 @MessageFlowInP-0n messageIn messageIn #zField
Bk8 @MessageFlowOutP-0n messageOut messageOut #zField
Bk8 @TextInP .xml .xml #zField
Bk8 @TextInP .responsibility .responsibility #zField
Bk8 @PushTrueWFInG-01 g0 '' #zField
Bk8 @PushTrueWFOutG-01 g1 '' #zField
Bk8 @CallSub f64 '' #zField
Bk8 @GridStep f13 '' #zField
Bk8 @PushWFArc f12 '' #zField
Bk8 @PushWFArc f3 '' #zField
Bk8 @TaskSwitchSimple f18 '' #zField
Bk8 @TaskSwitchSimple f20 '' #zField
Bk8 @Alternative f22 '' #zField
Bk8 @PushWFArc f23 '' #zField
Bk8 @PushWFArc f24 '' #zField
Bk8 @Alternative f0 '' #zField
Bk8 @PushWFArc f4 '' #zField
Bk8 @TkArc f11 '' #zField
Bk8 @TkArc f8 '' #zField
Bk8 @CallSub f1 '' #zField
Bk8 @GridStep f10 '' #zField
Bk8 @PushWFArc f2 '' #zField
Bk8 @GridStep f29 '' #zField
Bk8 @PushWFArc f5 '' #zField
Bk8 @PushWFArc f14 '' #zField
Bk8 @UserDialog f7 '' #zField
Bk8 @PushWFArc f16 '' #zField
Bk8 @PushWFArc f15 '' #zField
>Proto Bk8 Bk4 BpmnUserTask #zField
ew0 f1 1137 145 30 30 0 15 #rect
ew0 f1 @|EndSubIcon #fIcon
ew0 f9 actionTable 'out=in;
' #txt
ew0 f9 actionCode 'out.actualStepIndex++;
out.currentTask = in.definedTasks.get(out.actualStepIndex);
' #txt
ew0 f9 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get next Task</name>
        <nameStyle>13,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f9 470 44 112 44 -36 -8 #rect
ew0 f9 @|StepIcon #fIcon
ew0 U21 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Create task</name>
        <nameStyle>11,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 U21 470 140 112 44 -31 -8 #rect
ew0 U21 @|BpmnUserTaskIcon #fIcon
ew0 f0 inParamDecl '<java.lang.Integer actualStepIndex,java.lang.String workflowID> param;' #txt
ew0 f0 inParamTable 'out.actualStepIndex=param.#actualStepIndex is initialized ? param.actualStepIndex : 0;
out.workflowID=param.workflowID;
' #txt
ew0 f0 outParamDecl '<> result;
' #txt
ew0 f0 callSignature call(Integer,String) #txt
ew0 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>call(Integer,String)</name>
    </language>
</elementInfo>
' #txt
ew0 f0 59 51 30 30 -50 17 #rect
ew0 f0 @|StartSubIcon #fIcon
ew0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>which task type?</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f7 338 146 32 32 12 -27 #rect
ew0 f7 @|AlternativeIcon #fIcon
ew0 S11 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>process initialitation</name>
        <nameStyle>22,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 S11 162 140 128 44 -55 -8 #rect
ew0 S11 @|BpmnServiceTaskIcon #fIcon
ew0 S40 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Send email</name>
        <nameStyle>10,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 S40 470 268 112 44 -31 -8 #rect
ew0 S40 @|BpmnSendTaskIcon #fIcon
ew0 S31 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Final task</name>
        <nameStyle>10,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 S31 874 138 112 44 -26 -8 #rect
ew0 S31 @|BpmnUserTaskIcon #fIcon
ew0 f16 inParamDecl '<List<gawfs.TaskDef> definedTasks,java.lang.String processName,java.lang.String processDescription,ch.ivy.gawfs.enums.ProcessType processType,java.lang.String processID,java.lang.Boolean isAdhocProcess,java.lang.Long originalTaskId> param;' #txt
ew0 f16 inParamTable 'out.definedTasks=param.definedTasks;
out.isAdhocProcess=param.isAdhocProcess;
out.originalTaskId=param.originalTaskId;
out.workflowDescription=param.processDescription;
out.workflowID=param.processID;
out.workflowName=param.processName;
out.workflowType=param.processType;
' #txt
ew0 f16 outParamDecl '<> result;' #txt
ew0 f16 callSignature call(List<gawfs.TaskDef>,String,String,ch.ivy.gawfs.enums.ProcessType,String,Boolean,Long) #txt
ew0 f16 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>call(all parameters)</name>
        <nameStyle>20,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f16 59 147 30 30 -48 23 #rect
ew0 f16 @|StartSubIcon #fIcon
ew0 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has next task?</name>
        <nameStyle>14
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f5 666 146 32 32 -39 18 #rect
ew0 f5 @|AlternativeIcon #fIcon
ew0 f13 expr in #txt
ew0 f13 outCond 'in.currentTask.taskType == ch.ivy.gawfs.enums.TaskType.EMAIL && !in.hasRejectedApprovalTask' #txt
ew0 f13 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>mail</name>
        <nameStyle>4,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f13 359 173 470 290 #arcP
ew0 f13 1 416 290 #addKink
ew0 f13 0 0.657279489904357 -10 6 #arcLabel
ew0 f18 expr out #txt
ew0 f18 89 162 162 162 #arcP
ew0 f18 0 0.3805374841463163 0 0 #arcLabel
ew0 f11 expr out #txt
ew0 f11 470 66 354 146 #arcP
ew0 f11 1 354 66 #addKink
ew0 f11 0 0.8125675639531414 0 0 #arcLabel
ew0 f4 582 290 678 174 #arcP
ew0 f4 1 632 290 #addKink
ew0 f4 0 0.8278533742264182 0 0 #arcLabel
ew0 f6 582 162 666 162 #arcP
ew0 f30 expr out #txt
ew0 f30 89 66 226 140 #arcP
ew0 f30 1 226 66 #addKink
ew0 f30 0 0.7497048443829264 0 0 #arcLabel
ew0 f3 expr in #txt
ew0 f3 outCond '(in.currentTask.taskType == ch.ivy.gawfs.enums.TaskType.USER_TASK || in.currentTask.taskType == ch.ivy.gawfs.enums.TaskType.USER_TASK_WITH_EMAIL) && !in.hasRejectedApprovalTask' #txt
ew0 f3 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>user task</name>
        <nameStyle>9,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f3 370 162 470 162 #arcP
ew0 f3 0 0.4772727272727273 -1 8 #arcLabel
ew0 f2 expr in #txt
ew0 f2 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f2 682 146 582 66 #arcP
ew0 f2 1 682 66 #addKink
ew0 f2 0 0.5063291139240507 14 0 #arcLabel
ew0 f10 290 162 338 162 #arcP
ew0 U20 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Approval</name>
        <nameStyle>8,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 U20 470 202 112 44 -23 -8 #rect
ew0 U20 @|BpmnUserTaskIcon #fIcon
ew0 f17 582 224 673 169 #arcP
ew0 f17 1 600 224 #addKink
ew0 f17 1 0.31186578702692835 0 0 #arcLabel
ew0 f15 expr in #txt
ew0 f15 outCond 'in.currentTask.taskType == ch.ivy.gawfs.enums.TaskType.APPROVAL && !in.hasRejectedApprovalTask' #txt
ew0 f15 362 170 470 224 #arcP
ew0 f15 1 424 224 #addKink
ew0 f15 1 0.0 0 0 #arcLabel
ew0 f14 expr in #txt
ew0 f14 354 178 682 178 #arcP
ew0 f14 1 354 360 #addKink
ew0 f14 2 682 360 #addKink
ew0 f14 1 0.5 0 0 #arcLabel
ew0 f32 513 428 26 26 14 0 #rect
ew0 f32 @|EndSubIcon #fIcon
ew0 f34 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>has open tasks?</name>
        <nameStyle>15,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f34 208 427 28 28 -45 -42 #rect
ew0 f34 @|AlternativeIcon #fIcon
ew0 f35 inParamDecl '<gawfs.ExecutePredefinedWorkflowData data> param;' #txt
ew0 f35 inParamTable 'out=param.data;
' #txt
ew0 f35 outParamDecl '<> result;
' #txt
ew0 f35 callSignature join(gawfs.ExecutePredefinedWorkflowData) #txt
ew0 f35 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>join(ExecutePredefinedWorkflowData)</name>
        <nameStyle>35,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f35 65 428 26 26 -75 26 #rect
ew0 f35 @|StartSubIcon #fIcon
ew0 f36 207 514 30 30 16 0 #rect
ew0 f36 @|EndIcon #fIcon
ew0 f19 expr out #txt
ew0 f19 91 441 208 441 #arcP
ew0 f39 expr in #txt
ew0 f39 outCond 'ivy.case.getActiveTasks().size() > 1' #txt
ew0 f39 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f39 222 455 222 514 #arcP
ew0 f39 0 0.3559322033898305 13 0 #arcLabel
ew0 f26 actionTable 'out=in1;
' #txt
ew0 f26 outLinks "TaskA.ivp" #txt
ew0 f26 taskData 'TaskA.EXPRI=2
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=System Task\: Close Task
TaskA.PRI=2
TaskA.ROL=SYSTEM
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=0' #txt
ew0 f26 template "" #txt
ew0 f26 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>close task</name>
        <nameStyle>10,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f26 336 425 32 32 -33 -39 #rect
ew0 f26 @|TaskSwitchIcon #fIcon
ew0 f20 expr in #txt
ew0 f20 type gawfs.ExecutePredefinedWorkflowData #txt
ew0 f20 var in1 #txt
ew0 f20 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f20 236 441 336 441 #arcP
ew0 f20 0 0.5135135135135135 0 11 #arcLabel
ew0 f21 expr data #txt
ew0 f21 outCond ivp=="TaskA.ivp" #txt
ew0 f21 368 441 513 441 #arcP
ew0 f21 0 0.5135135135135135 0 11 #arcLabel
ew0 f12 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Is Adhoc Task?</name>
    </language>
</elementInfo>
' #txt
ew0 f12 760 144 32 32 -36 22 #rect
ew0 f12 @|AlternativeIcon #fIcon
ew0 f22 expr in #txt
ew0 f22 outCond 'in.currentTask.taskType == ch.ivy.gawfs.enums.TaskType.FINAL_REVIEW' #txt
ew0 f22 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
ew0 f22 698 162 760 160 #arcP
ew0 f22 0 0.11363636363636363 0 -10 #arcLabel
ew0 f23 1040 144 32 32 0 16 #rect
ew0 f23 @|AlternativeIcon #fIcon
ew0 f25 986 160 1040 160 #arcP
ew0 f24 expr in #txt
ew0 f24 1072 160 1137 160 #arcP
ew0 f8 expr in #txt
ew0 f8 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>No</name>
    </language>
</elementInfo>
' #txt
ew0 f8 792 160 874 160 #arcP
ew0 f8 0 0.43902439024390244 0 -13 #arcLabel
ew0 f28 actionTable 'out=in;
' #txt
ew0 f28 actionCode 'import ch.ivy.addon.portalkit.util.TaskUtils;
import ch.ivyteam.ivy.workflow.ITask;

if(in.isAdhocProcess){
	ITask originalTask = ivy.wf.findTask(in.originalTaskId);
	if(originalTask != null){
		TaskUtils.removeHidePropertyToDisplayInPortal(originalTask);
		TaskUtils.resetTask(originalTask);
	}
}' #txt
ew0 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Display original adhoc task</name>
    </language>
</elementInfo>
' #txt
ew0 f28 840 42 160 44 -74 -8 #rect
ew0 f28 @|StepIcon #fIcon
ew0 f29 expr in #txt
ew0 f29 outCond in.isAdhocProcess #txt
ew0 f29 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Yes</name>
    </language>
</elementInfo>
' #txt
ew0 f29 776 144 840 64 #arcP
ew0 f29 1 776 64 #addKink
ew0 f29 1 0.40625 0 -13 #arcLabel
ew0 f27 expr out #txt
ew0 f27 1000 64 1056 144 #arcP
ew0 f27 1 1056 64 #addKink
ew0 f27 1 0.5 0 0 #arcLabel
>Proto ew0 .type gawfs.ExecutePredefinedWorkflowData #txt
>Proto ew0 .processKind CALLABLE_SUB #txt
>Proto ew0 0 0 32 24 18 0 #rect
>Proto ew0 @|BIcon #fIcon
Bk4 g0 275 51 26 26 21 -3 #rect
Bk4 g0 @|MIGIcon #fIcon
Bk4 g1 275 1235 26 26 19 -15 #rect
Bk4 g1 @|MOGIcon #fIcon
Bk4 f6 actionTable 'out=in1;
' #txt
Bk4 f6 outLinks "TaskA.ivp" #txt
Bk4 f6 taskData 'TaskA.DESC=<%\=in1.currentTask.description%>\n
TaskA.EXP=new Duration(0,0,in1.currentTask.untilDays,0,0,0)
TaskA.EXPRI=1
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.currentTask.subject%>
TaskA.PRI=2
TaskA.ROL=in1.responsible.getMemberName().substring(1)
TaskA.SCRIPT=if (in1.originalTaskId \!\= null && in1.originalTaskId > 0) {\r\n  task.customFields().stringField(ch.ivy.addon.portalkit.enums.AdditionalProperty.ADHOC_EXPRESS_TASK.toString()).set(ch.ivy.addon.portalkit.enums.AdditionalProperty.ADHOC_EXPRESS_TASK.toString());\r\n}
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=3' #txt
Bk4 f6 template "" #txt
Bk4 f6 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>create task for user</name>
        <nameStyle>20,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f6 418 522 28 28 21 -17 #rect
Bk4 f6 @|TaskSwitchSimpleIcon #fIcon
Bk4 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>task with mail?</name>
        <nameStyle>15,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f5 272 624 32 32 -39 -35 #rect
Bk4 f5 @|AlternativeIcon #fIcon
Bk4 f14 dialogId ch.ivy.gawfs.workflowExecution.UserTaskForm #txt
Bk4 f14 startMethod start(gawfs.ExecutePredefinedWorkflowData) #txt
Bk4 f14 requestActionDecl '<gawfs.ExecutePredefinedWorkflowData executePredefinedWorkflowData> param;' #txt
Bk4 f14 requestMappingAction 'param.executePredefinedWorkflowData=in;
' #txt
Bk4 f14 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk4 f14 responseMappingAction 'out=result.executePredefinedWorkflowData;
' #txt
Bk4 f14 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Input form</name>
        <nameStyle>10
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f14 104 762 112 44 -27 -8 #rect
Bk4 f14 @|UserDialogIcon #fIcon
Bk4 f10 expr data #txt
Bk4 f10 outCond ivp=="TaskA.ivp" #txt
Bk4 f10 432 550 304 640 #arcP
Bk4 f10 1 432 640 #addKink
Bk4 f10 1 0.991265262979699 0 0 #arcLabel
Bk4 f7 expr data #txt
Bk4 f7 outCond ivp=="TaskA.ivp" #txt
Bk4 f7 160 550 272 640 #arcP
Bk4 f7 1 160 640 #addKink
Bk4 f7 0 0.5055155163921642 0 0 #arcLabel
Bk4 f16 actionTable 'out=in1;
' #txt
Bk4 f16 outLinks "TaskA.ivp" #txt
Bk4 f16 taskData 'TaskA.DESC=<%\=in1.currentTask.description%>\n
TaskA.EXP=new Duration(0,0,in1.currentTask.untilDays,0,0,0)
TaskA.EXPRI=1
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.currentTask.subject%>
TaskA.PRI=2
TaskA.ROL=in1.responsible.getMemberName()
TaskA.SCRIPT=if (in1.originalTaskId \!\= null && in1.originalTaskId > 0) {\r\n  task.customFields().stringField(ch.ivy.addon.portalkit.enums.AdditionalProperty.ADHOC_EXPRESS_TASK.toString()).set(ch.ivy.addon.portalkit.enums.AdditionalProperty.ADHOC_EXPRESS_TASK.toString());\r\n}
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=2' #txt
Bk4 f16 template "" #txt
Bk4 f16 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>create  task for group</name>
        <nameStyle>22,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f16 146 522 28 28 -137 -17 #rect
Bk4 f16 @|TaskSwitchSimpleIcon #fIcon
Bk4 f8 expr in #txt
Bk4 f8 outCond !in.responsible.isUser() #txt
Bk4 f8 type gawfs.ExecutePredefinedWorkflowData #txt
Bk4 f8 var in1 #txt
Bk4 f8 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f8 272 472 160 522 #arcP
Bk4 f8 1 160 472 #addKink
Bk4 f8 0 0.4898916508577348 -1 10 #arcLabel
Bk4 f1 expr in #txt
Bk4 f1 type gawfs.ExecutePredefinedWorkflowData #txt
Bk4 f1 var in1 #txt
Bk4 f1 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f1 304 472 432 522 #arcP
Bk4 f1 1 432 472 #addKink
Bk4 f1 0 0.38392857142857145 0 10 #arcLabel
Bk4 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>assigned to User?</name>
        <nameStyle>17,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f0 272 456 32 32 14 -27 #rect
Bk4 f0 @|AlternativeIcon #fIcon
Bk4 f13 actionTable 'out=in;
' #txt
Bk4 f13 actionCode 'String responsibleName = in.currentTask.getResponsibles().get(in.taskSplittingCounter);
in.responsible = ivy.session.getSecurityContext().findSecurityMember(responsibleName);' #txt
Bk4 f13 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get responsible</name>
    </language>
</elementInfo>
' #txt
Bk4 f13 232 362 112 44 -44 -8 #rect
Bk4 f13 @|StepIcon #fIcon
Bk4 f21 expr out #txt
Bk4 f21 288 406 288 456 #arcP
Bk4 f50 expr in #txt
Bk4 f50 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f50 288 656 216 784 #arcP
Bk4 f50 1 288 784 #addKink
Bk4 f50 1 0.463235294117647 1 -7 #arcLabel
Bk4 f64 processCall 'Functional Processes/ParallelTasksUtil:splitTasks(Number)' #txt
Bk4 f64 requestActionDecl '<java.lang.Number numberOfTasks> param;
' #txt
Bk4 f64 requestMappingAction 'param.numberOfTasks=in.currentTask.getResponsibles().size();
' #txt
Bk4 f64 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk4 f64 responseMappingAction 'out=in;
out.taskSplittingCounter=result.counter;
' #txt
Bk4 f64 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>split tasks</name>
        <nameStyle>11,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f64 232 266 112 44 -28 -8 #rect
Bk4 f64 @|CallSubIcon #fIcon
Bk4 f12 expr out #txt
Bk4 f12 288 310 288 362 #arcP
Bk4 f12 0 0.42340889686368355 0 0 #arcLabel
Bk4 f2 272 872 32 32 0 16 #rect
Bk4 f2 @|AlternativeIcon #fIcon
Bk4 f57 expr out #txt
Bk4 f57 160 806 272 888 #arcP
Bk4 f57 1 160 888 #addKink
Bk4 f57 1 0.40436755213021147 0 0 #arcLabel
Bk4 f4 processCall 'Functional Processes/executePredefinedWorkflow:join(gawfs.ExecutePredefinedWorkflowData)' #txt
Bk4 f4 requestActionDecl '<gawfs.ExecutePredefinedWorkflowData data> param;
' #txt
Bk4 f4 requestMappingAction 'param.data=in;
' #txt
Bk4 f4 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk4 f4 responseMappingAction 'out=in;
' #txt
Bk4 f4 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>join tasks</name>
        <nameStyle>10,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f4 232 1058 112 44 -26 -8 #rect
Bk4 f4 @|CallSubIcon #fIcon
Bk4 f66 expr out #txt
Bk4 f66 432 806 304 888 #arcP
Bk4 f66 1 432 888 #addKink
Bk4 f66 1 0.41968068058180114 0 0 #arcLabel
Bk4 f56 expr in #txt
Bk4 f56 outCond 'in.currentTask.taskType == ch.ivy.gawfs.enums.TaskType.USER_TASK_WITH_EMAIL' #txt
Bk4 f56 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f56 288 656 376 784 #arcP
Bk4 f56 1 288 784 #addKink
Bk4 f56 1 0.47678018575851394 0 -10 #arcLabel
Bk4 f55 dialogId ch.ivy.gawfs.workflowExecution.UserTaskWithMailForm #txt
Bk4 f55 startMethod start(gawfs.ExecutePredefinedWorkflowData) #txt
Bk4 f55 requestActionDecl '<gawfs.ExecutePredefinedWorkflowData executePredefinedWorkflowData> param;' #txt
Bk4 f55 requestMappingAction 'param.executePredefinedWorkflowData=in;
' #txt
Bk4 f55 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk4 f55 responseMappingAction 'out=result.executePredefinedWorkflowData;
' #txt
Bk4 f55 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Task with mail</name>
        <nameStyle>14,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk4 f55 376 762 112 44 -39 -8 #rect
Bk4 f55 @|UserDialogIcon #fIcon
Bk4 f18 actionTable 'out=in;
' #txt
Bk4 f18 actionCode 'import ch.ivy.addon.portalkit.util.ExecutingExpressProcessUtils;
ivy.task.setAdditionalProperty(ExecutingExpressProcessUtils.TASK_GROUP_ID_KEY, String.valueOf(in.actualStepIndex));' #txt
Bk4 f18 security system #txt
Bk4 f18 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set groupId</name>
    </language>
</elementInfo>
' #txt
Bk4 f18 232 962 112 44 -31 -8 #rect
Bk4 f18 @|StepIcon #fIcon
Bk4 f19 expr in #txt
Bk4 f19 288 904 288 962 #arcP
Bk4 f9 expr out #txt
Bk4 f9 288 1006 288 1058 #arcP
Bk4 f20 actionTable 'out=in;
' #txt
Bk4 f20 actionCode 'import gawfs.TaskDef;
import ch.ivy.addon.portalkit.util.ExecutingExpressProcessUtils;

List<TaskDef> result = ExecutingExpressProcessUtils.getAttributesOfTasks(String.valueOf(in.actualStepIndex), "currentTask");
in.finishedTasks.addAll(result);' #txt
Bk4 f20 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Store finished tasks</name>
    </language>
</elementInfo>
' #txt
Bk4 f20 224 1154 128 44 -54 -8 #rect
Bk4 f20 @|StepIcon #fIcon
Bk4 f22 expr out #txt
Bk4 f22 288 1102 288 1154 #arcP
Bk4 f3 expr out #txt
Bk4 f3 288 1198 288 1235 #arcP
Bk4 f11 actionTable 'out=in;
' #txt
Bk4 f11 actionCode 'import java.util.ArrayList;

in.approvalTaskResults = new ArrayList();' #txt
Bk4 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Renew approval list</name>
    </language>
</elementInfo>
' #txt
Bk4 f11 232 170 112 44 -53 -8 #rect
Bk4 f11 @|StepIcon #fIcon
Bk4 f17 expr out #txt
Bk4 f17 288 214 288 266 #arcP
Bk4 f41 288 77 288 170 #arcP
Bk4 f41 0 0.5063999557805953 0 0 #arcLabel
>Proto Bk0 0 0 32 24 18 0 #rect
>Proto Bk0 @|BIcon #fIcon
Bk5 f28 actionTable 'out=in;
' #txt
Bk5 f28 actionCode 'import ch.ivyteam.ivy.workflow.ITask;
import ch.ivy.gawfs.enums.TaskType;
import gawfs.TaskDef;


// Add review task to defined tasks
TaskDef taskDef = new gawfs.TaskDef();
taskDef.taskType = TaskType.FINAL_REVIEW;
if(in.isAdhocProcess) {
	ITask originalTask = ivy.wf.findTask(in.originalTaskId);
	taskDef.subject = originalTask.name;
}
else {
	taskDef.subject = TaskType.FINAL_REVIEW.getLabel();
}
in.definedTasks.add(taskDef);

// Initialize steps
for(TaskDef task: in.definedTasks) {
	in.steps.add(task.subject);
}

// Initialize controllers
in.actualStepIndex = 0;
in.currentTask = in.definedTasks.get(in.actualStepIndex);' #txt
Bk5 f28 security system #txt
Bk5 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Initialize workflow settings</name>
    </language>
</elementInfo>
' #txt
Bk5 f28 184 298 160 44 -71 -8 #rect
Bk5 f28 @|StepIcon #fIcon
Bk5 g0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>in 1</name>
    </language>
</elementInfo>
' #txt
Bk5 g0 251 19 26 26 17 9 #rect
Bk5 g0 @|MIGIcon #fIcon
Bk5 g1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>out 1</name>
    </language>
</elementInfo>
' #txt
Bk5 g1 627 403 26 26 -27 18 #rect
Bk5 g1 @|MOGIcon #fIcon
Bk5 g2 51 307 26 26 -4 -48 #rect
Bk5 g2 @|MIGIcon #fIcon
Bk5 f10 77 320 184 320 #arcP
Bk5 f29 expr out #txt
Bk5 f29 264 236 264 298 #arcP
Bk5 f5 actionTable 'out=in;
' #txt
Bk5 f5 actionCode 'import ch.ivy.gawfs.ExpressProcessUtils;

ExpressProcessUtils utils = new ch.ivy.gawfs.ExpressProcessUtils();
in.definedTasks = utils.getDefinedTasks(in.workflowID);' #txt
Bk5 f5 security system #txt
Bk5 f5 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get defined tasks</name>
    </language>
</elementInfo>
' #txt
Bk5 f5 208 192 112 44 -48 -8 #rect
Bk5 f5 @|StepIcon #fIcon
Bk5 f8 actionTable 'out=in;
' #txt
Bk5 f8 actionCode 'import ch.ivy.gawfs.enums.ProcessType;
import ch.ivy.addon.portalkit.service.ExpressServiceRegistry;
import ch.ivy.addon.portalkit.bo.ExpressProcess;


ExpressProcess workflow = ExpressServiceRegistry.getProcessService().findById(in.workflowID) as ExpressProcess;

in.workflowDescription = workflow.processDescription;
in.workflowName = workflow.processName;

for(ProcessType type : ProcessType.values()) {
	if (type.getValue() == workflow.processType) {
	 	in.workflowType = type;
	}
}' #txt
Bk5 f8 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>get Workflow Credentials</name>
        <nameStyle>24,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk5 f8 192 98 144 44 -68 -8 #rect
Bk5 f8 @|StepIcon #fIcon
Bk5 f11 actionTable 'out=in;
' #txt
Bk5 f11 actionCode 'ivy.task.setName(ivy.cms.co("/Dialogs/Tasks/ProcessLoaded/TaskName"));
ivy.task.setDescription(ivy.cms.co("/Dialogs/Tasks/ProcessLoaded/TaskName"));

ivy.case.setName(in.workflowName);
ivy.case.setDescription(in.workflowDescription);' #txt
Bk5 f11 security system #txt
Bk5 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>set Task and Case Fields</name>
        <nameStyle>24,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk5 f11 376 394 160 44 -70 -8 #rect
Bk5 f11 @|StepIcon #fIcon
Bk5 f1 expr out #txt
Bk5 f1 536 416 627 416 #arcP
Bk5 f3 expr out #txt
Bk5 f3 264 142 264 192 #arcP
Bk5 f0 264 45 264 98 #arcP
Bk5 f2 expr out #txt
Bk5 f2 264 342 376 416 #arcP
Bk5 f2 1 264 416 #addKink
Bk5 f2 1 0.2314443862725309 0 0 #arcLabel
>Proto Bk1 0 0 32 24 18 0 #rect
>Proto Bk1 @|BIcon #fIcon
Bk6 g0 51 179 26 26 0 5 #rect
Bk6 g0 @|MIGIcon #fIcon
Bk6 g1 611 179 26 26 0 5 #rect
Bk6 g1 @|MOGIcon #fIcon
Bk6 f3 actionTable 'out=in;
' #txt
Bk6 f3 actionCode 'import ch.ivy.gawfs.mail.InformationMailSender;
InformationMailSender sender = new InformationMailSender();
sender.send(in.currentTask.email);' #txt
Bk6 f3 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Send mail</name>
    </language>
</elementInfo>
' #txt
Bk6 f3 216 170 112 44 -28 -8 #rect
Bk6 f3 @|StepIcon #fIcon
Bk6 f4 77 192 216 192 #arcP
Bk6 f0 expr out #txt
Bk6 f0 328 192 611 192 #arcP
>Proto Bk2 0 0 32 24 18 0 #rect
>Proto Bk2 @|BIcon #fIcon
Bk7 f21 dialogId ch.ivy.gawfs.workflowExecution.FinalReviewForm #txt
Bk7 f21 startMethod start(java.util.List<gawfs.TaskDef>,java.util.List<String>,java.lang.Integer) #txt
Bk7 f21 requestActionDecl '<java.util.List<gawfs.TaskDef> finishedTasks, java.util.List<String> steps, java.lang.Integer actualStepIndex> param;' #txt
Bk7 f21 requestMappingAction 'param.finishedTasks=in.finishedTasks;
param.steps=in.steps;
param.actualStepIndex=in.actualStepIndex;
' #txt
Bk7 f21 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk7 f21 responseMappingAction 'out=in;
' #txt
Bk7 f21 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>final workflow review</name>
        <nameStyle>21,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk7 f21 1008 170 128 44 -56 -8 #rect
Bk7 f21 @|UserDialogIcon #fIcon
Bk7 f33 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>use express endpage?</name>
        <nameStyle>20
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk7 f33 672 176 32 32 -65 -35 #rect
Bk7 f33 @|AlternativeIcon #fIcon
Bk7 f29 actionTable 'out=in;
' #txt
Bk7 f29 actionCode 'import ch.ivy.addon.portalkit.enums.GlobalVariable;
import ch.ivy.addon.portalkit.service.GlobalSettingService;
String useExpressEndPage = new GlobalSettingService().findGlobalSettingValue(GlobalVariable.EXPRESS_END_PAGE.toString());

in.useExpressEndPage = useExpressEndPage.isEmpty()? true : Boolean.valueOf(useExpressEndPage);' #txt
Bk7 f29 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>read express end page setting</name>
        <nameStyle>29
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk7 f29 432 170 176 44 -83 -8 #rect
Bk7 f29 @|StepIcon #fIcon
Bk7 f28 actionTable 'out=in;
' #txt
Bk7 f28 actionCode 'import java.util.Map;
import ch.ivy.addon.portalkit.enums.PortalLibrary;
import java.util.Arrays;
import ch.ivy.addon.portalkit.service.IvyAdapterService;
import ch.ivy.addon.portalkit.enums.AdditionalProperty;

Map x =  IvyAdapterService.startSubProcess("handleEndPage()", null, Arrays.asList(PortalLibrary.AXON_EXPRESS.getValue()));
String callbackUrl = x.get("callbackUrl") as String;
ivy.task.setAdditionalProperty(AdditionalProperty.PORTAL_TASK_CALLBACK_URI.toString(), callbackUrl);

' #txt
Bk7 f28 security system #txt
Bk7 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>set callback Url to 
task AdditionalProperty</name>
        <nameStyle>44
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk7 f28 784 170 160 44 -59 -16 #rect
Bk7 f28 @|StepIcon #fIcon
Bk7 f7 actionTable 'out=in1;
' #txt
Bk7 f7 outLinks "TaskA.ivp" #txt
Bk7 f7 taskData 'TaskA.DESC=<%\=ivy.cms.co("/Dialogs/Tasks/FinalWorkflowTask/taskDescription", java.util.Arrays.asList(in1.workflowName))%>
TaskA.EXPRI=2
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.workflowName%>\: <%\=in1.currentTask.subject%>
TaskA.PRI=2
TaskA.ROL=CREATOR
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=0' #txt
Bk7 f7 template "" #txt
Bk7 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>final workflow task</name>
        <nameStyle>19,7
</nameStyle>
        <desc>inform user about flow and if approved or denied</desc>
    </language>
</elementInfo>
' #txt
Bk7 f7 369 177 30 30 -50 17 #rect
Bk7 f7 @|TaskSwitchSimpleIcon #fIcon
Bk7 f32 expr in #txt
Bk7 f32 outCond in.useExpressEndPage #txt
Bk7 f32 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk7 f32 704 192 784 192 #arcP
Bk7 f32 0 0.3970929020272241 0 -10 #arcLabel
Bk7 f34 expr out #txt
Bk7 f34 608 192 672 192 #arcP
Bk7 f34 0 0.38321279022824617 0 0 #arcLabel
Bk7 f24 actionTable 'out=in;
' #txt
Bk7 f24 actionCode 'ivy.session.setContentLocale(ivy.case.creatorUser.getEMailLanguage());
ivy.session.setFormattingLocale(ivy.case.creatorUser.getEMailLanguage());
in.currentTask.subject = ivy.cms.co("/Dialogs/Tasks/FinalReview/TaskName");' #txt
Bk7 f24 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>setup final task</name>
        <nameStyle>16,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk7 f24 192 170 112 44 -41 -8 #rect
Bk7 f24 @|StepIcon #fIcon
Bk7 f22 expr out #txt
Bk7 f22 944 192 1008 192 #arcP
Bk7 f19 expr out #txt
Bk7 f19 type gawfs.ExecutePredefinedWorkflowData #txt
Bk7 f19 var in1 #txt
Bk7 f19 304 192 369 192 #arcP
Bk7 f19 0 0.42910208417979817 0 0 #arcLabel
Bk7 f35 expr in #txt
Bk7 f35 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk7 f35 688 208 1072 214 #arcP
Bk7 f35 1 688 256 #addKink
Bk7 f35 2 1072 256 #addKink
Bk7 f35 1 0.39004237799318525 -2 -12 #arcLabel
Bk7 f13 expr data #txt
Bk7 f13 outCond ivp=="TaskA.ivp" #txt
Bk7 f13 399 192 432 192 #arcP
Bk7 g0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>in 1</name>
    </language>
</elementInfo>
' #txt
Bk7 g0 51 179 26 26 0 5 #rect
Bk7 g0 @|MIGIcon #fIcon
Bk7 g1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>out 1</name>
    </language>
</elementInfo>
' #txt
Bk7 g1 1187 179 26 26 0 5 #rect
Bk7 g1 @|MOGIcon #fIcon
Bk7 f1 expr out #txt
Bk7 f1 1136 192 1187 192 #arcP
Bk7 f0 77 192 192 192 #arcP
>Proto Bk3 0 0 32 24 18 0 #rect
>Proto Bk3 @|BpmnSendTaskIcon #fIcon
Bk8 g0 307 51 26 26 21 -3 #rect
Bk8 g0 @|MIGIcon #fIcon
Bk8 g1 307 963 26 26 19 -15 #rect
Bk8 g1 @|MOGIcon #fIcon
Bk8 f64 processCall 'Functional Processes/ParallelTasksUtil:splitTasks(Number)' #txt
Bk8 f64 requestActionDecl '<java.lang.Number numberOfTasks> param;
' #txt
Bk8 f64 requestMappingAction 'param.numberOfTasks=in.currentTask.getResponsibles().size();
' #txt
Bk8 f64 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk8 f64 responseMappingAction 'out=in;
out.taskSplittingCounter=result.counter;
' #txt
Bk8 f64 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>split tasks</name>
        <nameStyle>11,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk8 f64 264 120 112 44 -28 -8 #rect
Bk8 f64 @|CallSubIcon #fIcon
Bk8 f13 actionTable 'out=in;
' #txt
Bk8 f13 actionCode 'String responsibleName = in.currentTask.getResponsibles().get(in.taskSplittingCounter);
in.responsible = ivy.session.getSecurityContext().findSecurityMember(responsibleName);' #txt
Bk8 f13 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get responsible</name>
    </language>
</elementInfo>
' #txt
Bk8 f13 264 224 112 44 -44 -8 #rect
Bk8 f13 @|StepIcon #fIcon
Bk8 f12 expr out #txt
Bk8 f12 320 164 320 224 #arcP
Bk8 f12 0 0.42340889686368355 0 0 #arcLabel
Bk8 f3 320 77 320 120 #arcP
Bk8 f3 0 0.5634285714285714 0 0 #arcLabel
Bk8 f18 actionTable 'out=in1;
' #txt
Bk8 f18 outLinks "TaskA.ivp" #txt
Bk8 f18 taskData 'TaskA.DESC=<%\=in1.currentTask.description%>
TaskA.EXP=new Duration(0,0,in1.currentTask.untilDays,0,0,0)
TaskA.EXPRI=1
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.currentTask.subject%>
TaskA.PRI=2
TaskA.ROL=in1.responsible.getMemberName()
TaskA.SCRIPT=if (in1.originalTaskId \!\= null && in1.originalTaskId > 0) {\r\n  task.customFields().stringField(ch.ivy.addon.portalkit.enums.AdditionalProperty.ADHOC_EXPRESS_TASK.toString()).set(ch.ivy.addon.portalkit.enums.AdditionalProperty.ADHOC_EXPRESS_TASK.toString());\r\n}
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=2' #txt
Bk8 f18 template "" #txt
Bk8 f18 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>create  task for group</name>
        <nameStyle>22,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk8 f18 212 406 30 30 -135 -9 #rect
Bk8 f18 @|TaskSwitchSimpleIcon #fIcon
Bk8 f20 actionTable 'out=in1;
' #txt
Bk8 f20 outLinks "TaskA.ivp" #txt
Bk8 f20 taskData 'TaskA.DESC=<%\=in1.currentTask.description%>
TaskA.EXP=new Duration(0,0,in1.currentTask.untilDays,0,0,0)
TaskA.EXPRI=1
TaskA.EXROL=Everybody
TaskA.EXTYPE=0
TaskA.NAM=<%\=in1.currentTask.subject%>
TaskA.PRI=2
TaskA.ROL=in1.responsible.getMemberName().substring(1)
TaskA.SCRIPT=if (in1.originalTaskId \!\= null && in1.originalTaskId > 0) {\r\n  task.customFields().stringField(ch.ivy.addon.portalkit.enums.AdditionalProperty.ADHOC_EXPRESS_TASK.toString()).set(ch.ivy.addon.portalkit.enums.AdditionalProperty.ADHOC_EXPRESS_TASK.toString());\r\n}
TaskA.SKIP_TASK_LIST=false
TaskA.TYPE=3' #txt
Bk8 f20 template "" #txt
Bk8 f20 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>create task for user</name>
        <nameStyle>20,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk8 f20 396 406 30 30 20 -10 #rect
Bk8 f20 @|TaskSwitchSimpleIcon #fIcon
Bk8 f22 304 485 32 32 0 16 #rect
Bk8 f22 @|AlternativeIcon #fIcon
Bk8 f23 expr data #txt
Bk8 f23 outCond ivp=="TaskA.ivp" #txt
Bk8 f23 227 436 304 501 #arcP
Bk8 f23 1 227 501 #addKink
Bk8 f23 1 0.13217932650050215 0 0 #arcLabel
Bk8 f24 expr data #txt
Bk8 f24 outCond ivp=="TaskA.ivp" #txt
Bk8 f24 411 436 336 501 #arcP
Bk8 f24 1 411 501 #addKink
Bk8 f24 0 0.9138369937494684 0 0 #arcLabel
Bk8 f0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>assigned to User?</name>
        <nameStyle>17,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk8 f0 304 333 32 32 14 -27 #rect
Bk8 f0 @|AlternativeIcon #fIcon
Bk8 f4 expr out #txt
Bk8 f4 320 268 320 333 #arcP
Bk8 f11 expr in #txt
Bk8 f11 outCond !in.responsible.isUser() #txt
Bk8 f11 type gawfs.ExecutePredefinedWorkflowData #txt
Bk8 f11 var in1 #txt
Bk8 f11 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no</name>
        <nameStyle>2,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk8 f11 304 349 225 406 #arcP
Bk8 f11 1 224 349 #addKink
Bk8 f11 0 0.4875 0 13 #arcLabel
Bk8 f8 expr in #txt
Bk8 f8 type gawfs.ExecutePredefinedWorkflowData #txt
Bk8 f8 var in1 #txt
Bk8 f8 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
        <nameStyle>3
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk8 f8 336 349 411 406 #arcP
Bk8 f8 1 411 349 #addKink
Bk8 f8 0 0.45796837519732153 0 10 #arcLabel
Bk8 f1 processCall 'Functional Processes/executePredefinedWorkflow:join(gawfs.ExecutePredefinedWorkflowData)' #txt
Bk8 f1 requestActionDecl '<gawfs.ExecutePredefinedWorkflowData data> param;
' #txt
Bk8 f1 requestMappingAction 'param.data=in;
' #txt
Bk8 f1 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk8 f1 responseMappingAction 'out=in;
' #txt
Bk8 f1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>join tasks</name>
        <nameStyle>10,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
Bk8 f1 264 770 112 44 -26 -8 #rect
Bk8 f1 @|CallSubIcon #fIcon
Bk8 f10 actionTable 'out=in;
' #txt
Bk8 f10 actionCode 'import gawfs.TaskDef;
import gawfs.ApprovalTaskResult;
import ch.ivy.addon.portalkit.util.ExecutingExpressProcessUtils;

in.approvalTaskResults.addAll(ExecutingExpressProcessUtils.getAttributesOfTasks(String.valueOf(in.actualStepIndex), "approvalTaskResult"));

for (ApprovalTaskResult approvalTaskResult: in.approvalTaskResults) {
	if (!approvalTaskResult.isApproved) {
		in.hasRejectedApprovalTask = true;
		break;
	}
}

int latestUserTaskPosition = in.finishedTasks.get(in.finishedTasks.size() - 1).position;
for (TaskDef task : in.finishedTasks) {
	if (task.position == latestUserTaskPosition) {
		task.approvalResultList = in.approvalTaskResults;
	}
}' #txt
Bk8 f10 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>store approval</name>
    </language>
</elementInfo>
' #txt
Bk8 f10 264 882 112 44 -39 -8 #rect
Bk8 f10 @|StepIcon #fIcon
Bk8 f2 expr out #txt
Bk8 f2 320 926 320 963 #arcP
Bk8 f29 actionTable 'out=in;
' #txt
Bk8 f29 actionCode 'import ch.ivy.addon.portalkit.util.ExecutingExpressProcessUtils;
ivy.task.setAdditionalProperty(ExecutingExpressProcessUtils.TASK_GROUP_ID_KEY, String.valueOf(in.actualStepIndex));' #txt
Bk8 f29 security system #txt
Bk8 f29 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>set groupId</name>
    </language>
</elementInfo>
' #txt
Bk8 f29 264 656 112 44 -31 -8 #rect
Bk8 f29 @|StepIcon #fIcon
Bk8 f5 expr out #txt
Bk8 f5 320 700 320 770 #arcP
Bk8 f14 expr out #txt
Bk8 f14 320 814 320 882 #arcP
Bk8 f7 dialogId ch.ivy.gawfs.workflowExecution.ApprovalForm #txt
Bk8 f7 startMethod start(java.util.List<gawfs.TaskDef>,List<String>,Integer,Boolean,Long) #txt
Bk8 f7 requestActionDecl '<java.util.List<gawfs.TaskDef> finishedTasks,List<String> steps,java.lang.Integer actualStepIndex,java.lang.Boolean isAdhocProcess,java.lang.Long originalTaskId> param;' #txt
Bk8 f7 requestMappingAction 'param.finishedTasks=in.finishedTasks;
param.steps=in.steps;
param.actualStepIndex=in.actualStepIndex;
param.isAdhocProcess=in.isAdhocProcess;
param.originalTaskId=in.originalTaskId;
' #txt
Bk8 f7 responseActionDecl 'gawfs.ExecutePredefinedWorkflowData out;
' #txt
Bk8 f7 responseMappingAction 'out=in;
out.approvalTaskResult=result.approvalResult;
' #txt
Bk8 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Approval Form</name>
    </language>
</elementInfo>
' #txt
Bk8 f7 264 554 112 44 -39 -8 #rect
Bk8 f7 @|UserDialogIcon #fIcon
Bk8 f16 expr in #txt
Bk8 f16 320 517 320 554 #arcP
Bk8 f15 expr out #txt
Bk8 f15 320 598 320 656 #arcP
>Proto Bk4 0 0 32 24 18 0 #rect
>Proto Bk4 @|BIcon #fIcon
ew0 f0 mainOut f30 tail #connect
ew0 f30 head S11 g0 #connect
ew0 f16 mainOut f18 tail #connect
ew0 f18 head S11 g2 #connect
ew0 f2 head f9 mainIn #connect
ew0 U21 g1 f6 tail #connect
ew0 f6 head f5 in #connect
ew0 S11 g1 f10 tail #connect
ew0 f10 head f7 in #connect
ew0 f7 out f3 tail #connect
ew0 f3 head U21 g0 #connect
ew0 f9 mainOut f11 tail #connect
ew0 f11 head f7 in #connect
ew0 f7 out f13 tail #connect
ew0 f13 head S40 g0 #connect
ew0 S40 g1 f4 tail #connect
ew0 f4 head f5 in #connect
ew0 U20 g1 f17 tail #connect
ew0 f17 head f5 in #connect
ew0 f7 out f15 tail #connect
ew0 f15 head U20 g0 #connect
ew0 f7 out f14 tail #connect
ew0 f14 head f5 in #connect
ew0 f34 out f39 tail #connect
ew0 f39 head f36 mainIn #connect
ew0 f35 mainOut f19 tail #connect
ew0 f19 head f34 in #connect
ew0 f34 out f20 tail #connect
ew0 f20 head f26 in #connect
ew0 f26 out f21 tail #connect
ew0 f21 head f32 mainIn #connect
ew0 f5 out f22 tail #connect
ew0 f22 head f12 in #connect
ew0 f5 out f2 tail #connect
ew0 S31 g1 f25 tail #connect
ew0 f25 head f23 in #connect
ew0 f23 out f24 tail #connect
ew0 f24 head f1 mainIn #connect
ew0 f8 head S31 g0 #connect
ew0 f12 out f29 tail #connect
ew0 f29 head f28 mainIn #connect
ew0 f12 out f8 tail #connect
ew0 f28 mainOut f27 tail #connect
ew0 f27 head f23 in #connect
Bk4 f8 head f16 in #connect
Bk4 f0 out f8 tail #connect
Bk4 f0 out f1 tail #connect
Bk4 f1 head f6 in #connect
Bk4 f16 out f7 tail #connect
Bk4 f7 head f5 in #connect
Bk4 f6 out f10 tail #connect
Bk4 f10 head f5 in #connect
Bk4 f13 mainOut f21 tail #connect
Bk4 f21 head f0 in #connect
Bk4 f5 out f56 tail #connect
Bk4 f56 head f55 mainIn #connect
Bk4 f5 out f50 tail #connect
Bk4 f50 head f14 mainIn #connect
Bk4 f64 mainOut f12 tail #connect
Bk4 f12 head f13 mainIn #connect
Bk4 f55 mainOut f66 tail #connect
Bk4 f66 head f2 in #connect
Bk4 f14 mainOut f57 tail #connect
Bk4 f57 head f2 in #connect
Bk4 f2 out f19 tail #connect
Bk4 f19 head f18 mainIn #connect
Bk4 f18 mainOut f9 tail #connect
Bk4 f9 head f4 mainIn #connect
Bk4 f4 mainOut f22 tail #connect
Bk4 f22 head f20 mainIn #connect
Bk4 f20 mainOut f3 tail #connect
Bk4 f3 head g1 m #connect
Bk4 f11 mainOut f17 tail #connect
Bk4 f17 head f64 mainIn #connect
Bk4 g0 m f41 tail #connect
Bk4 f41 head f11 mainIn #connect
Bk4 0 0 904 1248 0 #ivRect
Bk5 f5 mainOut f29 tail #connect
Bk5 f29 head f28 mainIn #connect
Bk5 g2 m f10 tail #connect
Bk5 f10 head f28 mainIn #connect
Bk5 f11 mainOut f1 tail #connect
Bk5 f1 head g1 m #connect
Bk5 f8 mainOut f3 tail #connect
Bk5 f3 head f5 mainIn #connect
Bk5 g0 m f0 tail #connect
Bk5 f0 head f8 mainIn #connect
Bk5 f28 mainOut f2 tail #connect
Bk5 f2 head f11 mainIn #connect
Bk5 0 0 896 520 0 #ivRect
Bk6 g0 m f4 tail #connect
Bk6 f4 head f3 mainIn #connect
Bk6 f3 mainOut f0 tail #connect
Bk6 f0 head g1 m #connect
Bk6 0 0 640 512 0 #ivRect
Bk7 f29 mainOut f34 tail #connect
Bk7 f34 head f33 in #connect
Bk7 f35 head f21 mainIn #connect
Bk7 f33 out f32 tail #connect
Bk7 f32 head f28 mainIn #connect
Bk7 f33 out f35 tail #connect
Bk7 f28 mainOut f22 tail #connect
Bk7 f22 head f21 mainIn #connect
Bk7 f24 mainOut f19 tail #connect
Bk7 f19 head f7 in #connect
Bk7 f13 head f29 mainIn #connect
Bk7 f7 out f13 tail #connect
Bk7 f1 head g1 m #connect
Bk7 f21 mainOut f1 tail #connect
Bk7 g0 m f0 tail #connect
Bk7 f0 head f24 mainIn #connect
Bk7 0 0 1408 384 0 #ivRect
Bk8 f64 mainOut f12 tail #connect
Bk8 f12 head f13 mainIn #connect
Bk8 g0 m f3 tail #connect
Bk8 f3 head f64 mainIn #connect
Bk8 f18 out f23 tail #connect
Bk8 f23 head f22 in #connect
Bk8 f20 out f24 tail #connect
Bk8 f24 head f22 in #connect
Bk8 f13 mainOut f4 tail #connect
Bk8 f4 head f0 in #connect
Bk8 f0 out f11 tail #connect
Bk8 f11 head f18 in #connect
Bk8 f0 out f8 tail #connect
Bk8 f8 head f20 in #connect
Bk8 f10 mainOut f2 tail #connect
Bk8 f2 head g1 m #connect
Bk8 f29 mainOut f5 tail #connect
Bk8 f5 head f1 mainIn #connect
Bk8 f1 mainOut f14 tail #connect
Bk8 f14 head f10 mainIn #connect
Bk8 f22 out f16 tail #connect
Bk8 f16 head f7 mainIn #connect
Bk8 f7 mainOut f15 tail #connect
Bk8 f15 head f29 mainIn #connect
Bk8 0 0 552 1160 0 #ivRect
