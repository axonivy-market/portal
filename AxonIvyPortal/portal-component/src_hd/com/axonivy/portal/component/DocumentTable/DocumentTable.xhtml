<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:cc="http://java.sun.com/jsf/composite"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions">
<cc:interface componentType="IvyComponent">
  <cc:attribute name="nameColumnRendered" default="true" />
  <cc:attribute name="sizeColumnRendered" default="true" />
  <cc:attribute name="typeColumnRendered" default="true" />
  <cc:attribute name="functionColumnRendered" default="true" />
  <cc:attribute name="uploadRendered" default="true" />
  <cc:attribute name="downloadRendered" default="true" />
  <cc:attribute name="deleteRendered" default="true" />
  <cc:attribute name="messageRendered" default="true" />
  <cc:attribute name="renderChooseUploadIcon" default="true" />
  
  <cc:attribute name="fileLimit" type="Integer" shortDescription="Number of files are in the given ICase" default="-1" />
  <cc:attribute name="uploadText" default="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Upload')}" />
  <cc:attribute name="updatedComponentAfterUploaded" />

  <cc:attribute name="downloadText" default="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Download')}" />
  <cc:attribute name="downloadTitle" default="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Download')}" />
  <cc:attribute name="downloadIcon" default="si si-download-bottom" />
  <cc:attribute name="downloadStyleClass" />

  <cc:attribute name="deleteText" default="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Delete')}" />
  <cc:attribute name="deleteTitle" default="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Delete')}" />
  <cc:attribute name="deleteIcon" default="si si-bin-1" />
  <cc:attribute name="deleteStyleClass" />
  <cc:attribute name="updatedComponentAfterDeleted" />
  
  <cc:attribute name="selectedType" />
  <cc:attribute name="typeSelectionItems" shortDescription="Use #{documentUploadBean.documentTypes} if there are no custom Document Type" />
  
  <cc:attribute name="enableScriptCheckingForUploadedDocument" default="#{documentUploadBean.enableScriptCheckingForUploadedDocument()}" />
  <cc:attribute name="enableVirusScannerForUploadedDocument" default="#{documentUploadBean.enableVirusScannerForUploadedDocument()}" />
  <cc:attribute name="allowedUploadFileTypes" default="#{documentUploadBean.allowedUploadFileTypes}" type="java.lang.String"/>

</cc:interface>

<cc:implementation>
  <h:outputStylesheet library="css" name="document-table-component.css" />
  
  <ui:param name="messageComponentId" value="#{cc.clientId.concat(':document-messages')}" />
  <ui:param name="typeSelectionItems" value="#{not empty cc.attrs.typeSelectionItems ? cc.attrs.typeSelectionItems : documentUploadBean.documentTypes}" />
  <ui:param name="selectedType" value="#{not empty cc.attrs.selectedType ? cc.attrs.selectedType : typeSelectionItems[0]}" />
  <f:event type="preRenderComponent" listener="#{logic.renderComponent(messageComponentId, cc.attrs.typeColumnRendered, selectedType, cc.attrs.enableScriptCheckingForUploadedDocument, cc.attrs.enableVirusScannerForUploadedDocument, cc.attrs.allowedUploadFileTypes)}" />

  <div id="#{cc.clientId}" class="document-table-component">

    <cc:renderFacet name="componentHeader" />

    <p:messages id="document-messages" for="document-messages" rendered="#{cc.attrs.messageRendered}" />
    <p:dataTable id="document-table" value="#{data.documents}" var="document"
      emptyMessage="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/NoFile')}" styleClass="margin-top-5"
      widgetVar="fileTableVar" lazy="false">
      <f:event type="preRenderComponent" listener="#{logic.renderTable()}" />

      <p:column headerText="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Name')}"
        rendered="#{cc.attrs.nameColumnRendered}" styleClass="document-name-column">
        <h:outputText id="name" value="#{document.name}" title="#{document.name}" />
      </p:column>
      <p:column headerText="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Size')}"
        rendered="#{cc.attrs.sizeColumnRendered}" styleClass="document-size-column">
        <h:outputText id="size" value="#{document.userFriendlySize}" title="#{document.userFriendlySize}" />
      </p:column>
      <p:column headerText="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Type')}" rendered="#{cc.attrs.typeColumnRendered}"
        styleClass="document-type-column">
        <h:outputText id="type" value="#{document.type.toString()}" />
      </p:column>
      <cc:insertChildren />
      <p:column styleClass="align-center-column document-action-column" rendered="#{cc.attrs.functionColumnRendered}"
        headerText="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/FileFunction')}">
        <p:commandLink id="document-download" styleClass="#{cc.attrs.downloadStyleClass}"
          immediate="true" ajax="false" process="@none" title="#{cc.attrs.downloadTitle}"
          rendered="#{cc.attrs.downloadRendered}">
          <i class="fa #{cc.attrs.downloadIcon}" />
          <p:fileDownload value="#{logic.download(document)}" />
        </p:commandLink>

        <p:spacer width="10px" />

        <p:commandLink id="document-delete" styleClass="#{cc.attrs.deleteStyleClass}"
          actionListener="#{data.setSelectedDocument(document)}" rendered="#{cc.attrs.deleteRendered}"
          update="#{cc.attrs.updatedComponentAfterDeleted}" immediate="true" title="#{cc.attrs.deleteTitle}"
          oncomplete="PF('document-delete-dialog').show()">
          <i class="fa #{cc.attrs.deleteIcon}" />
        </p:commandLink>
      </p:column>
    </p:dataTable>
    <div class="ui-g">
      <h:panelGroup layout="block" rendered="#{cc.attrs.typeColumnRendered or cc.attrs.uploadRendered}" styleClass="upload-container ui-g-12">
        <p:fileUpload id="document-upload" mode="advanced" auto="true" dragDropSupport="true"
          chooseIcon="#{cc.attrs.renderChooseUploadIcon? 'si si-add-small' : '' }"
          listener="#{logic.upload}"
          rendered="#{cc.attrs.uploadRendered}"
          update="document-table document-messages #{cc.attrs.updatedComponentAfterUploaded}"
          invalidSizeMessage="#{documentUploadBean.getFileUploadInvalidSizeMessage()}" 
          label="#{not empty cc.attrs.uploadText ? cc.attrs.uploadText : ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Upload')}"
          cancelLabel="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/Common/Cancel')}"
          onstart="#{logic.setFileLimit(cc.attrs.fileLimit)}" sizeLimit="#{documentUploadBean.fileUploadSizeLimit}"
          styleClass="upload-button">
        </p:fileUpload>
        <p:selectOneMenu id="type-selection" value="#{data.typeSelection}" rendered="#{cc.attrs.typeColumnRendered}" converter="pojoConverter" styleClass="type-selection">
          <p:ajax global="false" />
          <f:selectItems value="#{typeSelectionItems}" var="type" itemLabel="#{type.toString()}"
            itemValue="#{type}" />
        </p:selectOneMenu>
        <p:outputLabel for="type-selection" value="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/DocumentTable/Type')}: " styleClass="type-selection-label" rendered="#{cc.attrs.typeColumnRendered}" />
      </h:panelGroup>
    </div>

    <cc:renderFacet name="componentFooter" />

    <p:dialog id="document-delete-dialog" widgetVar="document-delete-dialog" appendTo="@(body)" closable="true"
      closeOnEscape="true" modal="true" draggable="false" rendered="#{cc.attrs.deleteRendered}"
      header="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/Common/Confirmation')}" resizable="false"
      responsive="true">
      #{ivy.cms.co('/Dialogs/com/axonivy/portal/component/Common/ConfirmForDelete')}
      <f:facet name="footer">
        <p:commandButton id="document-deletion-yes"
          value="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/Common/Yes')}" process="@this"
          update="document-table document-messages #{cc.attrs.updatedComponentAfterDeleted}"
          actionListener="#{logic.delete}" oncomplete="PF('document-delete-dialog').hide();" />
        <p:commandButton id="document-deletion-no" styleClass="portal-cancel-button"
          value="#{ivy.cms.co('/Dialogs/com/axonivy/portal/component/Common/No')}" type="button"
          onclick="PF('document-delete-dialog').hide()" />
      </f:facet>
    </p:dialog>
  </div>
</cc:implementation>
</html>