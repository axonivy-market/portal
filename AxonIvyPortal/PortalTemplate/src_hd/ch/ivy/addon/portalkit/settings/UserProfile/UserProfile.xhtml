<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
  <ui:composition template="/layouts/BasicTemplate.xhtml">
    <ui:param name="viewName" value="USER_PROFILE" />
    <ui:define name="title">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/userProfile/myProfileTitle')}</ui:define>
    <ui:define name="pageContent">
      <f:event listener="#{logic.initSettings}" type="preRenderComponent" />
      <h:form id="my-profile-form" styleClass="my-profile-form">
        <div class="ui-g">
          <div id="my-profile-container" class="my-profile-container card ui-g-12 ui-md-8 ui-lg-6 ui-xl-4">
            <p:messages id="errors-message" severity="warn,error" showDetail="true" escape="false" closable="true" />
            <p:growl id="user-setting-info" showDetail="true" severity="info" for="user-profile-message" sticky="true" />

            <div id="language-setting-container">
              <h2 id="language-setting-title" class="setting-header">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/languageSetting/languageSetting')}</h2>
              <div class="md-inputfield language-selection">
                <p:selectOneMenu id="language-selection" value="#{data.language.userLanguage}">
                  <f:selectItem itemLabel="" itemValue="#{null}" />
                  <f:selectItems value="#{data.language.languages}" />
                </p:selectOneMenu>
                <p:outputLabel id="language-selection-label" styleClass="language-selection-label"
                  value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/languageSetting/selectedLanguage')}" />
              </div>
            </div>

            <div id="email-setting-container" class="email-setting-container">

              <h2 class="setting-header">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/emailSetting')}</h2>
              <h:panelGrid columns="2" rowClasses="application-email-setting-row"
                styleClass="application-email-setting-row">
                <!-- MAIL NOTIFICATION ON TASK ASSIGNMENT -->
                <p:outputLabel id="mail-notification-on-task-assign-label"
                  value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/mailNotificationOnTaskAssign')}"
                  for="mail-notification-on-task-assign" />
                <p:inputSwitch id="mail-notification-on-task-assign" styleClass="Fright"
                  value="#{data.emailSetting.emailSendOnNewWorkTasks}" />

                <!-- FURTHER MAILS FROM APPLICATION -->
                <p:outputLabel id="further-mails-from-application-label"
                  value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/furtherEmailFromApp')}"
                  for="further-mails-from-application" />
                <p:inputSwitch id="further-mails-from-application" value="#{data.emailSetting.customMailEnabled}"
                  styleClass="Fright" />

                <!--  DAILY SUMMARY -->
                <p:outputLabel id="daily-summary-label"
                  value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/dailySummary')}"
                  for="daily-summary" />
                <p:inputSwitch id="daily-summary" value="#{data.emailSetting.enableDailySummary}" styleClass="Fright">
                  <p:ajax event="change" update="daily-summary-checkbox-selection-container"
                    listener="#{logic.updateDailyList}" oncomplete="changeWidthDailySummaryPanel()" />
                </p:inputSwitch>
              </h:panelGrid>

              <h:panelGroup id="daily-summary-checkbox-selection-container" layout="block">
                <p:selectCheckboxMenu id="daily-summary-checkbox"
                  value="#{data.emailSetting.emailSendDailyTaskSummary}" onShow="changeWidthDailySummaryPanel();"
                  onHide="updateDailySummaryMail();"
                  label="#{empty data.emailSetting.emailSendDailyTaskSummary ? ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/day'):ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/selectedDay', [data.emailSetting.emailSendDailyTaskSummary.size()])}"
                  styleClass="daily-summary-checkbox" rendered="#{data.emailSetting.enableDailySummary}">
                  <f:selectItems value="#{data.dailySummaryList}" var="day"
                    itemLabel="#{day.getLocalizedName(ivy.session.getContentLocale())}" itemValue="#{day}" />
                </p:selectCheckboxMenu>
                <p:remoteCommand name="updateDailySummaryMail" update="daily-summary-checkbox-selection-container"
                  global="false" />
              </h:panelGroup>
              <script>
                function changeWidthDailySummaryPanel() {
                  var dailySummary = $('[id $= ":daily-summary-checkbox"]').get(0);
                  if (dailySummary != null) {
                    $('[id $= ":daily-summary-checkbox_panel"]').width(dailySummary.offsetWidth);
                  }
                }
              </script>
            </div>

            <h:panelGroup layout="block" styleClass="user-profile-footer">
              <p:commandButton id="save-settings" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}"
                icon="#{visibilityBean.generateButtonIcon('icon ivyicon-floppy-disk')}" actionListener="#{logic.save}"
                update="errors-message" />
              <p:spacer width="5px" />
            </h:panelGroup>
          </div>
        </div>
      </h:form>
    </ui:define>
  </ui:composition>
</h:body>
</html>