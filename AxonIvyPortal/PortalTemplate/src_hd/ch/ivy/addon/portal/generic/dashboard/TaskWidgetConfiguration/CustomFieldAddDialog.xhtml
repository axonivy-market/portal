<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:jsf="http://xmlns.jcp.org/jsf">

<p:dialog id="custom-field-add-dialog" widgetVar="custom-field-add-dialog"
  header="Custom Field selection" appendTo="@(body)" fitViewport="true" width="500px"
  closeOnEscape="true" draggable="false" dynamic="true" responsive="true" modal="true">
  <h:form id="custom-field-add-form">
    <div class="ui-g">
      <div class="ui-g-4 custom-field-dialog__label">
        <p:outputLabel for="custom-field-selection" value="Field Type" />
      </div>
      <div class="ui-g-8 custom-field-dialog__label">
        <p:selectOneMenu id="custom-field-selection" value="#{taskWidgetConfigurationBean.selectedCustomFieldType}" styleClass="custom-field-dialog__input">
          <f:selectItems value="#{taskWidgetConfigurationBean.customFieldTypes}" />
          
          <p:ajax listener="#{taskWidgetConfigurationBean.fetchCustomFieldNames}" update="custom-field-name-selection number-pattern-container" />
        </p:selectOneMenu>
      </div>
      
      <div class="ui-g-4 custom-field-dialog__label">
        <p:outputLabel for="custom-field-name-selection" value="Custom Field" />
      </div>
      <div class="ui-g-8">
        <p:selectOneMenu id="custom-field-name-selection" value="#{taskWidgetConfigurationBean.selectedCustomFieldName}" styleClass="custom-field-dialog__input"
          converter="pojoConverter" required="true" 
          requiredMessage="Custom Field #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/isRequiredMessage')}">
          <f:selectItems value="#{taskWidgetConfigurationBean.customFieldNames}" var="field" itemValue="#{field}" itemLabel="#{field.name()}" />
        </p:selectOneMenu>
        <p:message for="custom-field-name-selection" />
      </div>
      
      <h:panelGroup id="number-pattern-container" 
        styleClass="#{taskWidgetConfigurationBean.selectedCustomFieldType eq 'NUMBER' ? 'ui-g-12 custom-field-dialog__number-pattern-container' : ''}">
        <h:panelGroup styleClass="ui-g-4 custom-field-dialog__label" rendered="#{taskWidgetConfigurationBean.selectedCustomFieldType eq 'NUMBER'}">
          <p:outputLabel for="custom-number-field-pattern" value="Number Pattern" />
        </h:panelGroup>
        <h:panelGroup styleClass="ui-g-8" rendered="#{taskWidgetConfigurationBean.selectedCustomFieldType eq 'NUMBER'}">
          <p:inputText id="custom-number-field-pattern" value="#{taskWidgetConfigurationBean.customNumberFieldPattern}"
            styleClass="custom-field-dialog__input" />
        </h:panelGroup>
      </h:panelGroup>
      
      <div class="ui-g-4 custom-field-dialog__label">
        <p:outputLabel for="custom-field-display-name" value="Display Name" />
      </div>
      <div class="ui-g-8">
        <p:inputText id="custom-field-display-name" value="#{taskWidgetConfigurationBean.customFieldDisplayName}" styleClass="custom-field-dialog__input"
           required="true" requiredMessage="Display Name #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/processwidget/isRequiredMessage')}" />
         <p:message for="custom-field-display-name" />
      </div>
    </div>
  </h:form>
  <f:facet name="footer">
    <p:commandLink id="task-configuration-cancel-link" styleClass="u-mar-right-10"
      value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
      onclick="PF('custom-field-add-dialog').hide()" />
      
    <p:commandButton id="custom-field-add-button"
      value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/add')}" actionListener="#{taskWidgetConfigurationBean.addCustomField()}"
      process="custom-field-add-form" partialSubmit="true" update="custom-field-add-form task-configuration-form"
      oncomplete="if (args &amp;&amp; !args.validationFailed) PF('custom-field-add-dialog').hide();" />
  </f:facet>
</p:dialog>
</html>