<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:pm="http://primefaces.org/mobile">
<h:body>
  <ui:composition template="/layouts/BasicTemplate.xhtml">
    <ui:param name="isNotRequiredLogin" value="false" />
    <ui:define name="pageTitle">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/noteHistory/caseHistoryPageTitle')}</ui:define>
    <ui:define name="simplePageContent">
      <h:form id="form" onkeypress="if (event.keyCode == 13) { return false; }">
        <p:panelGrid columns="2" styleClass="u-no-border" layout="grid" columnClasses="ui-grid-col-2, ui-grid-col-10">
          <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/name')}"/>
          <p:outputLabel id="case-name" value="#{data.remoteCase.name}"/>
          <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/caseId')}"/>
          <p:outputLabel id="case-id" value="#{data.remoteCase.id}"/>
          <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/creator')}"/>
          <p:outputLabel id="case-creator" value="#{data.remoteCase.creatorFullName}"/>
          <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/STATE')}"/>
          <p:outputLabel id="case-state" value="#{caseBean.getState(data.remoteCase)}"/>
        </p:panelGrid>
        <br/>
        
        <p:dataTable id="case-info" var="case" value="#{data.remoteCase}" styleClass="hide">
          <p:column width="40%" >
            <f:facet name="header">
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/name')}" />
            </f:facet>
            <h:outputText value="#{data.remoteCase.name}" />
          </p:column>
          <p:column width="20%" >
            <f:facet name="header">
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/caseId')}" />
            </f:facet>
            <h:outputText value="#{data.remoteCase.id}" />
          </p:column>
          <p:column width="20%">
            <f:facet name="header">
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/creator')}" />
            </f:facet>
            <h:outputText value="#{data.remoteCase.creatorFullName}" />
          </p:column>
          <p:column>
            <f:facet name="header">
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/STATE')}" />
            </f:facet>
            <h:outputText value="#{caseBean.getState(data.remoteCase)}" />
          </p:column>
        </p:dataTable>
        
        <p:dataTable id="notes-table" widgetVar="notesTable" var="history" sortBy="#{history.timestamp}"
          sortOrder="DESCENDING" value="#{data.histories}" filteredValue="#{data.filteredHistories}">
          <p:column width="15%" sortBy="#{history.involvedFullname}" filterBy="#{history.involvedFullname}"
            filterMatchMode="contains">
            <f:facet name="header">
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/name')}" />
            </f:facet>
            <h:outputText value="#{history.involvedFullname}" />
          </p:column>
          <p:column width="20%" sortBy="#{history.timestamp}" filterBy="#{history.timestamp}"
            filterFunction="#{dateFilterBean.filterByDate}">
            <f:facet name="header">
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/noteHistory/columnTimestamp')}" />
            </f:facet>
            <f:facet name="filter">
              <p:calendar pattern="#{dateTimePatternBean.datePattern}" locale="#{localeBean.locale}">
                <p:ajax event="dateSelect" oncomplete="PF('notesTable').filter()" />
                <p:ajax event="change" oncomplete="PF('notesTable').filter()" />
              </p:calendar>
            </f:facet>
            <h:outputText value="#{history.timestamp}">
              <f:convertDateTime pattern="#{ivy.cms.co('/patterns/dateTimePattern')}" />
            </h:outputText>
          </p:column>
          <p:column sortBy="#{caseTaskNoteHistoryBean.getCaseNoteContent(history)}"
            filterBy="#{caseTaskNoteHistoryBean.getCaseNoteContent(history)}" filterMatchMode="contains">
            <f:facet name="header">
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/noteHistory/columnContent')}" />
            </f:facet>
            <h:outputText value="#{caseTaskNoteHistoryBean.getCaseNoteContent(history)}" />
          </p:column>
        </p:dataTable>
        
        <p:commandButton ajax="false" styleClass="note-history-export-button"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/noteHistory/exportButton')}">
          <p:dataExporter type="xls" target="notes-table, case-info" fileName="#{data.exportedFileName}" />
        </p:commandButton>
      </h:form>

    </ui:define>
  </ui:composition>
</h:body>
</html>