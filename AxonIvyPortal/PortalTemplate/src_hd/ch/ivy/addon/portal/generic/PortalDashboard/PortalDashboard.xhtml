<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions">
<h:body>
  <ui:composition template="/layouts/BasicTemplate.xhtml">
    <ui:define name="title">Dashboard</ui:define>
    <ui:define name="pageContent">
      <h1>Dashboard</h1>
      <style type="text/css">
        .new-widget-container .ui-grid.ui-grid-responsive {
          padding: 0;
          border: none;
        }
        .header {
          background-color: var(--primary-color);
          color: var(--ivy-primary-color-white);
          padding: 10px;
        }
        .card {
          padding: 0;
        }
        .actions {
          float: right;
        }
        .actions a {
          color: var(--ivy-primary-color-white);
        }
      </style>
      <div class="grid-stack" style="background-color: var(--ivy-primary-color-grey-pale)">
        <ui:repeat var="widget" value="#{dashboardBean.widgets}">
          <div class="grid-stack-item" data-gs-x="#{widget.posX}" data-gs-y="#{widget.posY}"
            data-gs-width="#{widget.width}" data-gs-height="#{widget.height}">
            <div class="grid-stack-item-content card" style="display: flex;flex-direction: column;">
              <h:panelGroup rendered="#{widget.type eq 'TASK'}">
                <div class="header" style="flex: 0 0 30px">
                  <span class="title">
                    Your Tasks
                  </span>
                  
                  <div class="actions">
                    <p:commandLink styleClass="u-mar-right-5">
                      <i class="fa fa-info-circle" />
                    </p:commandLink>
                    <p:commandLink styleClass="u-mar-right-5" onclick="PF('edit-task-widget-dialog').show()">
                      <i class="fa fa-pencil" />
                    </p:commandLink>
                    <i class="fa fa-arrows drag-handler" style="cursor: move;" data-action="Drag" />
                  </div>
                </div>
                <div style="flex: auto;overflow:auto;margin-bottom: 20px;padding:10px">
                  <ic:ch.ivy.addon.portal.generic.prototype.TaskWidget />
                </div>
              </h:panelGroup>
                
              <h:panelGroup rendered="#{widget.type eq 'PROCESS'}">
                <div class="header" style="flex: 0 0 30px">
                  <span class="title">
                    Your Processes
                  </span>
                  
                  <div class="actions">
                    <i class="fa fa-arrows drag-handler" style="cursor: move;" data-action="Drag" /> 
                  </div>
                </div>
                <div style="flex: auto;overflow:auto;margin-bottom: 20px;padding:10px">
                  <ic:ch.ivy.addon.portalkit.component.UserProcessWidget id="process-widget-component" />
                </div>
              </h:panelGroup>
              
              <h:panelGroup id="actions" layout="block" style="text-align: center; padding: 4px" rendered="#{widget.type eq 'NEW'}">
                <i class="fa fa-arrows drag-handler" data-action="Drag" 
                  style="cursor: move; position: absolute; top: 5px; right: 5px;" />
                <p:commandButton id="add-widget-button" value="Add a new widget" type="button" style="margin-bottom: 5px"
                  onclick="PF('new-widget-dialog').show()" />
                <br />
                <p:commandLink id="restore-widget-button" value="Restore default widgets" />
              </h:panelGroup>
            </div>
          </div>
        </ui:repeat>
      </div>

<script type="text/javascript">
  GridStack.init({column: 12, row: 11, handleClass :'drag-handler'});
</script>
      <p:dialog id="new-widget-dialog" widgetVar="new-widget-dialog" header="Create a Widget" appendTo="@(body)"
        closeOnEscape="true" draggable="false" dynamic="true" fitViewport="true" responsive="true" modal="true">

        <p:dataGrid id="new-widget-container" var="sample" value="#{dashboardBean.samples}" layout="grid" columns="2"
          styleClass="new-widget-container">
          <p:panel header="#{sample.name}" style="text-align:center;" styleClass="widget-selection">
            <h:panelGrid columns="1" style="width:300px; height: 300px;">
              <i class="#{sample.image}" style="font-size: 5rem" />
              <p:link href="#" value="Select" rendered="#{sample.type ne 'TASK'}" />
              <p:link href="#" value="Select" rendered="#{sample.type eq 'TASK'}"
                onclick="PF('new-widget-dialog').hide();PF('task-widget-configuration-dialog').show();" />
            </h:panelGrid>
          </p:panel>
        </p:dataGrid>

        <f:facet name="footer">
          <p:commandButton id="new-widget-close-button" value="Close" type="button"
            onclick="PF('new-widget-dialog').hide()" />
        </f:facet>
      </p:dialog>

      <p:dialog id="task-widget-configuration-dialog" widgetVar="task-widget-configuration-dialog"
        header="Task Widget Configuration" appendTo="@(body)" closeOnEscape="true" draggable="false" dynamic="true"
        fitViewport="true" responsive="true" modal="true" width="80vw">
        <ui:include src="TaskWidgetConfiguration.xhtml" />
        <f:facet name="footer">
          <p:commandButton id="task-configuration-save-button" value="Save" type="button"
            onclick="PF('task-widget-configuration-dialog').hide()" />
          <p:commandButton id="task-configuration-cancel-button" value="Cancel" type="button"
            onclick="PF('task-widget-configuration-dialog').hide()" />
        </f:facet>
      </p:dialog>
    </ui:define>
  </ui:composition>
</h:body>
</html>