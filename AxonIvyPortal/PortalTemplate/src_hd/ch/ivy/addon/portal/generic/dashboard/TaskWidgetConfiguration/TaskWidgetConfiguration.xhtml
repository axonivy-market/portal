<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:jsf="http://xmlns.jcp.org/jsf"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:fn="http://java.sun.com/jsp/jstl/functions"
  xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="taskWidget" />
</cc:interface>
<cc:implementation>
  <f:event listener="#{taskWidgetConfigurationBean.preRender(cc.attrs.taskWidget)}" type="preRenderComponent" />
  <div class="ui-g">
    <div class="task-configuration filter-container card">
      <div class="ui-g-12">
        #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/taskConfigurationText1')} <br />
        #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/taskConfigurationText2')}  
      </div>

      <div class="ui-g-3">
        <p:outputLabel for="widget-title" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/widgetTitle')}" />
      </div>
      <div class="ui-g-9">
        <p:inputText id="widget-title" styleClass="task-configuration__input-text"
        value="#{cc.attrs.taskWidget.name}" />
      </div>

      <div class="ui-g-12" />
  
      <div class="ui-g-4">
        <strong>#{ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/dashboard/availableFilters")}</strong>
      </div>
      <div class="ui-g-8">
        <p:commandButton id="preview-button" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/preview')}"
          styleClass="Fright" update="task-preview" process="@(form :not(.task-configuration__category) :not(.task-configuration__category-panel))" />
      </div>

      <div class="ui-g-3">
        <p:outputLabel for="name" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/taskName')}" />
      </div>
      <div class="ui-g-9">
        <p:inputText id="name" styleClass="task-configuration__input-text"
          value="#{cc.attrs.taskWidget.taskName}" />
      </div>
  
      <div class="ui-g-3">
        <p:outputLabel for="description" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/description')}" />
      </div>
      <div class="ui-g-9">
        <p:inputText id="description" styleClass="task-configuration__input-text"
          value="#{cc.attrs.taskWidget.description}" />
      </div>
  
      <div class="ui-g-3">
        <p:outputLabel for="priorities" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/PRIORITY')}" />
      </div>
      <div class="ui-g-9">
        <p:selectCheckboxMenu id="priorities" value="#{cc.attrs.taskWidget.priorities}" multiple="true"
          filter="true" filterMatchMode="startsWith" panelStyle="width:300px" styleClass="task-configuration__selectcheckboxmenu">
          <f:selectItems value="#{taskWidgetConfigurationBean.priorities}" var="priority" itemValue="#{priority}" 
            itemLabel="#{taskWidgetConfigurationBean.getUserFriendlyTaskPriority(priority)}" />
        </p:selectCheckboxMenu>
      </div>
  
      <div class="ui-g-3">
        <p:outputLabel for="states" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/STATE')}" />
      </div>
      <div class="ui-g-9">
        <p:selectCheckboxMenu id="states" value="#{cc.attrs.taskWidget.states}" multiple="true"
          filter="true" filterMatchMode="startsWith" panelStyle="width:300px" styleClass="task-configuration__selectcheckboxmenu">
          <f:selectItems value="#{taskWidgetConfigurationBean.filteredStates}" var="state" itemValue="#{state}" 
            itemLabel="#{taskWidgetConfigurationBean.getUserFriendlyTaskState(state)}" />
        </p:selectCheckboxMenu>
      </div>
  
      <div class="ui-g-3">
        <p:outputLabel for="responsibles" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskList/defaultColumns/ACTIVATOR')}" />
      </div>
      <div class="ui-g-9">
        <p:autoComplete id="responsibles" scrollHeight="210" dropdown="true" size="35"
          completeMethod="#{taskWidgetConfigurationBean.completeResponsibles}" value="#{cc.attrs.taskWidget.responsibles}"
          var="responsible" itemValue="#{responsible.name}" itemLabel="#{responsible.briefDisplayNameWithState}"
          converter="pojoConverter" cache="true" maxResults="100" multiple="true"
          moreText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/more')}..." dynamic="true"
          styleClass="task-configuration__responsibles" forceSelection="true">
          <p:column>
            <i class="fa #{responsible.isUser() ? 'fa-user' : 'fa-users'} u-mar-right-5" />
            <h:outputText value="#{taskWidgetConfigurationBean.formatName(responsible)}" />
          </p:column>
        </p:autoComplete>
      </div>
      <div class="ui-g-3" />
      <div class="ui-g-9">
        <span style="width: 10%; display: inline-block" />
        <p:selectBooleanCheckbox id="can-work-on" value="#{cc.attrs.taskWidget.canWorkOn}" itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/canWorkOn')}" />
      </div>

      <div class="ui-g-3">
        <p:outputLabel for="created-from" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/createdFrom')}" />
      </div>
      <div class="ui-g-9">
        <p:calendar id="created-from" showOn="button" styleClass="task-configuration__calendar"
          value="#{cc.attrs.taskWidget.createdDateFrom}" pattern="#{dateTimePatternBean.configuredPattern}" locale="#{localeBean.locale}" />
      </div>
  
      <div class="ui-g-3">
        <p:outputLabel for="created-to" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/createdTo')}" />
      </div>
      <div class="ui-g-9">
        <p:calendar id="created-to" showOn="button" styleClass="task-configuration__calendar"
          value="#{cc.attrs.taskWidget.createdDateTo}" pattern="#{dateTimePatternBean.configuredPattern}" locale="#{localeBean.locale}" />
      </div>
  
      <div class="ui-g-3">
        <p:outputLabel for="expiry-from" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/expiryFrom')}" />
      </div>
      <div class="ui-g-9">
        <p:calendar id="expiry-from" showOn="button" styleClass="task-configuration__calendar"
          value="#{cc.attrs.taskWidget.expiryDateFrom}" pattern="#{dateTimePatternBean.configuredPattern}" locale="#{localeBean.locale}" />
      </div>
  
      <div class="ui-g-3">
        <p:outputLabel for="expiry-to" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/expiryTo')}" />
      </div>
      <div class="ui-g-9">
        <p:calendar id="expiry-to" showOn="button" styleClass="task-configuration__calendar"
          value="#{cc.attrs.taskWidget.expiryDateTo}" pattern="#{dateTimePatternBean.configuredPattern}" locale="#{localeBean.locale}" />
      </div>
      
      <div class="ui-g-3">
        <p:outputLabel for="category" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/category')}" />
      </div>
      <div class="ui-g-9">
      <h:panelGroup id="category-container" styleClass="task-configuration__category">
        <p:inputText id="category" styleClass="task-configuration__input-text" value="#{cc.attrs.taskWidget.getDisplayCategories()}" readonly="true" />
        <p:overlayPanel id="category-panel" widgetVar="category-panel" for="category" appendTo="category-container" styleClass="task-configuration__category-panel"
          onHide="$(this.targetElement).parents('.task-configuration__category').find('.portal-cancel-button').click();">
          <p:tree id="task-category-filter-tree" value="#{taskWidgetConfigurationBean.categoryTree}" var="node" selectionMode="checkbox"
            selection="#{taskWidgetConfigurationBean.categoryNodes}" filterMatchMode="contains" filterBy="#{node}">
            <p:treeNode>
              <h:outputText value="#{node.value}" />
            </p:treeNode>
          </p:tree>
          
          <h:panelGroup id="category-panel-footer" layout="block" styleClass="task-configuration__category-panel-footer">
            <p:commandButton id="update-command"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/apply')}"
              process="category-panel" partialSubmit="true" update="category-container">
            </p:commandButton>
            <p:spacer width="5" />
            <p:commandButton id="cancel-command" styleClass="portal-cancel-button" process="@this" global="false"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" update="category-container">
            </p:commandButton>
          </h:panelGroup>
        </p:overlayPanel>
      </h:panelGroup>
      </div>
    </div>
    
    <h:panelGroup id="task-preview" styleClass="card task-preview">
      <div class="ui-g">
        <h2 class="ui-g-12 task-preview__header">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/preview')}</h2>
        <ic:ch.ivy.addon.portal.generic.dashboard.TaskWidget id="task-widget-preview" taskWidget="#{cc.attrs.taskWidget}" renderColumnConfiguration="true" />
      </div>
    </h:panelGroup>
  </div>
</cc:implementation>
</html>