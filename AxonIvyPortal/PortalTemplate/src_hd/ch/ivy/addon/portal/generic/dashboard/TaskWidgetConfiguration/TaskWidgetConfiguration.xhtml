<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:cc="http://xmlns.jcp.org/jsf/composite" xmlns:jsf="http://xmlns.jcp.org/jsf"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:fn="http://java.sun.com/jsp/jstl/functions"
  xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

<cc:interface componentType="IvyComponent">
  <cc:attribute name="taskWidget" />
</cc:interface>
<cc:implementation>
  <f:event listener="#{taskWidgetConfigurationBean.preRender(cc.attrs.taskWidget)}" type="preRenderComponent" />
  <div class="ui-g">
    <div class="task-configuration filter-container card">
      <div class="ui-g-12">
        #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/taskConfigurationText1')} <br />
        #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/taskConfigurationText2')}  
      </div>

      <div class="ui-g-3">
        <p:outputLabel for="widget-title" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/widgetTitle')}" />
      </div>
      <div class="ui-g-9">
        <p:inputText id="widget-title" styleClass="task-configuration__input-text"
        value="#{cc.attrs.taskWidget.name}" />
      </div>

      <div class="ui-g-12" />
  
      <div class="ui-g-4">
        <strong>#{ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/dashboard/availableFilters")}</strong>
      </div>
      <div class="ui-g-8">
        <p:commandButton id="preview-button" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/preview')}"
          styleClass="Fright" update="task-preview" process="@(form :not(.task-configuration__category) :not(.task-configuration__category-panel))" />
      </div>
  
      <ui:repeat var="field" value="#{cc.attrs.taskWidget.filterableColumns}">
        <h:panelGroup rendered="#{field.field eq 'priority'}">
          <div class="ui-g-3">
            <p:outputLabel value="#{field.header}" />
          </div>
          <div class="ui-g-9">
            <p:selectCheckboxMenu id="priorities" value="#{field.priorities}" multiple="true"
              panelStyle="width:300px" styleClass="task-configuration__selectcheckboxmenu">
              <f:selectItems value="#{taskWidgetConfigurationBean.priorities}" var="priority" itemValue="#{priority}" 
                itemLabel="#{taskWidgetConfigurationBean.getUserFriendlyTaskPriority(priority)}" />
            </p:selectCheckboxMenu>
          </div>
        </h:panelGroup>
        
        <h:panelGroup rendered="#{field.field eq 'state'}">
          <div class="ui-g-3">
            <p:outputLabel value="#{field.header}" />
          </div>
          <div class="ui-g-9">
            <p:selectCheckboxMenu id="states" value="#{field.states}" multiple="true"
              filter="true" filterMatchMode="contains" panelStyle="width:300px" styleClass="task-configuration__selectcheckboxmenu">
              <f:selectItems value="#{taskWidgetConfigurationBean.states}" var="state" itemValue="#{state}" 
                itemLabel="#{taskWidgetConfigurationBean.getUserFriendlyTaskState(state)}" />
            </p:selectCheckboxMenu>
          </div>
        </h:panelGroup>
        
        <h:panelGroup rendered="#{field.field eq 'activator'}">
          <div class="ui-g-3">
            <p:outputLabel value="#{field.header}" />
          </div>
          <div class="ui-g-9">
            <p:autoComplete id="responsibles" scrollHeight="210" dropdown="true" size="35"
              completeMethod="#{taskWidgetConfigurationBean.completeResponsibles}" value="#{field.filterList}"
              var="responsible" itemValue="#{responsible.name}" itemLabel="#{responsible.briefDisplayNameWithState}"
              converter="pojoConverter" cache="true" maxResults="100" multiple="true"
              moreText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/more')}..." dynamic="true"
              styleClass="task-configuration__responsibles" forceSelection="true">
              <p:column>
                <i class="fa #{responsible.isUser() ? 'fa-user' : 'fa-users'} u-mar-right-5" />
                <h:outputText value="#{taskWidgetConfigurationBean.formatName(responsible)}" />
              </p:column>
            </p:autoComplete>
          </div>
          <div class="ui-g-3" />
          <div class="ui-g-9">
            <span style="width: 10%; display: inline-block" />
            <p:selectBooleanCheckbox id="can-work-on" value="#{cc.attrs.taskWidget.canWorkOn}" itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/canWorkOn')}" />
          </div>
        </h:panelGroup>
        
        <h:panelGroup rendered="#{field.format eq 'STRING' or field.format eq 'TEXT'}">
          <div class="ui-g-3">
            <p:outputLabel value="#{field.header}" />
          </div>
          <div class="ui-g-9">
            <p:inputText id="text-field-input" styleClass="task-configuration__input-text" value="#{field.filter}" rendered="#{field.filterType eq 'LIKE'}" />
            
            <p:selectCheckboxMenu id="text-field-selection" value="#{field.filterList}" multiple="true"
              filter="true" filterMatchMode="contains" panelStyle="width:300px" styleClass="task-configuration__selectcheckboxmenu"
              rendered="#{field.filterType eq 'SELECTION'}">
              <f:selectItems value="#{field.filterListOptions}" />
            </p:selectCheckboxMenu>
          </div>
        </h:panelGroup>
        
        <h:panelGroup rendered="#{field.format eq 'NUMBER'}">
          <div class="ui-g-3">
            <p:outputLabel value="#{field.header} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/filter/from')}" />
          </div>
          <div class="ui-g-9">
            <p:inputText id="from-number-field-input" styleClass="task-configuration__input-text" value="#{field.filterFrom}" />
          </div>
          
          <div class="ui-g-3">
            <p:outputLabel value="#{field.header} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/filter/to')}" />
          </div>
          <div class="ui-g-9">
            <p:inputText id="to-number-field-input" styleClass="task-configuration__input-text" value="#{field.filterTo}" />
          </div>
        </h:panelGroup>
        
        <h:panelGroup rendered="#{field.format eq 'TIMESTAMP'}">
          <div class="ui-g-3">
            <p:outputLabel value="#{field.header} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/filter/from')}" />
          </div>
          <div class="ui-g-9">
            <p:calendar id="from-date-field-input" showOn="button" styleClass="task-configuration__calendar"
              value="#{field.filterFrom}" pattern="#{dateTimePatternBean.datePattern}" locale="#{localeBean.locale}" />
          </div>
          
          <div class="ui-g-3">
            <p:outputLabel value="#{field.header} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/filter/to')}" />
          </div>
          <div class="ui-g-9">
            <p:calendar id="to-date-field-input" showOn="button" styleClass="task-configuration__calendar"
              value="#{field.filterTo}" pattern="#{dateTimePatternBean.datePattern}" locale="#{localeBean.locale}" />
          </div>
        </h:panelGroup>
      </ui:repeat>
    
    
       <div class="ui-g-3">
        <p:outputLabel for="category" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/category')}" />
      </div>
      <div class="ui-g-9">
        <h:panelGroup id="category-container" styleClass="task-configuration__category">
          <p:inputText id="category" styleClass="task-configuration__input-text" value="#{cc.attrs.taskWidget.getDisplayCategories()}" readonly="true" />
          <p:overlayPanel id="category-panel" widgetVar="category-panel" for="category" appendTo="category-container" styleClass="task-configuration__category-panel"
            onHide="$(this.targetElement).parents('.task-configuration__category').find('.portal-cancel-button').click();">
            <p:tree id="task-category-filter-tree" value="#{taskWidgetConfigurationBean.categoryTree}" var="node" selectionMode="checkbox"
              selection="#{taskWidgetConfigurationBean.categoryNodes}" filterMatchMode="contains" filterBy="#{node}">
              <p:treeNode>
                <h:outputText value="#{node.value}" />
              </p:treeNode>
            </p:tree>
            
            <h:panelGroup id="category-panel-footer" layout="block" styleClass="task-configuration__category-panel-footer">
              <p:commandLink id="cancel-command" styleClass="portal-cancel-button u-mar-right-10" process="@this" global="false"
                value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}" update="category-container" />
                
              <p:commandButton id="update-command"
                value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/apply')}"
                process="category-panel" partialSubmit="true" update="category-container" />
            </h:panelGroup>
          </p:overlayPanel>
        </h:panelGroup>
      </div>
    </div>
    
    <h:panelGroup id="task-preview" styleClass="card task-preview">
      <div class="ui-g">
        <h2 class="ui-g-12 task-preview__header">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/preview')}</h2>
        <ic:ch.ivy.addon.portal.generic.dashboard.TaskWidget id="task-widget-preview" taskWidget="#{cc.attrs.taskWidget}" renderColumnConfiguration="true" />
      </div>
    </h:panelGroup>
  </div>
  
  <ui:include src="CustomFieldAddDialog.xhtml" />
</cc:implementation>
</html>