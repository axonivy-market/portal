<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:fn="http://java.sun.com/jsp/jstl/functions"
  xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<p:dialog id="manage-dashboard-dialog" widgetVar="manage-dashboard-dialog"
  width="#{dashboardConfigurationBean.isPublicDashboard ? '50%' : '30%'}"
  header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/dashboardManagement/manageDashboard')}"
  appendTo="@(body)" closeOnEscape="true" draggable="false" fitViewport="true" responsive="true" modal="true">
  <h:form id="dashboard-form">
    <p:dataTable value="#{dashboardConfigurationBean.editingDashboards}" var="dashboard" id="dashboard-table"
      styleClass="admin-table application-table" widgetVar="dashboard-table"
      emptyMessage="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/noRecordsFound')}">
      <p:column
        headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/dashboardManagement/dashboardTitle')}"
        styleClass="application-table-type-column" width="40%">
        <h:outputText value="#{dashboard.title}" />
      </p:column>
      <p:column
        headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/dashboardManagement/dashboardPermission')}"
        rendered="#{dashboardConfigurationBean.getIsPublicDashboard()}" width="60%">
        <h:outputText value="#{dashboard.displayedPermission}" />
      </p:column>
      <p:column headerText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/action')}"
        styleClass="TexAlCenter settings-table-action-buttons" width="100">
        <p:commandLink id="edit" process="@this" styleClass="action-column-icon-button"
          actionListener="#{dashboardConfigurationBean.openDashboardDetail(dashboard)}"
          update=":#{p:component('dashboard-detail-dialog')}" oncomplete="PF('dashboard-detail-dialog').show()"
          title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/edit')}">
          <p:resetInput target="dashboard-detail-dialog" />
          <span class="si si-graphic-tablet-drawing-pen" />
        </p:commandLink>
        <p:commandLink id="delete-dashboard" process="@this" styleClass="action-column-icon-button" global="false"
          actionListener="#{dashboardConfigurationBean.selectDeletingDashboard(dashboard)}"
          update="remove-dashboard-dialog" oncomplete="PF('remove-dashboard-dialog').show()"
          title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/delete')}">
          <span class="si si-bin-1" />
        </p:commandLink>
      </p:column>
    </p:dataTable>

    <div class="ui-g-12">
      <p:commandButton id="add-new-row-btn"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/dashboardManagement/addDashboard')}"
        process="@this" icon="si si-add" update="dashboard-detail-dialog"
        oncomplete="PF('dashboard-detail-dialog').show()"
        actionListener="#{dashboardConfigurationBean.onAddDashboard()}">
        <p:resetInput target="dashboard-detail-dialog" />
      </p:commandButton>
    </div>
  </h:form>
  <f:facet name="footer">
    <h:panelGroup layout="block" styleClass="u-text-align-right">
      <p:commandLink id="manage-dashboard-close-button"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
        onclick="PF('manage-dashboard-dialog').hide()" />
      <p:spacer width="15" />
      <p:commandButton id="manage-dashboard-save-button"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}"
        actionListener="#{dashboardConfigurationBean.saveDashboards()}"
        icon="#{visibilityBean.generateButtonIcon('si si-floppy-disk')}"
        update="grid-stack dashboard-title-container dashboard-title-dropdown-container dashboard-header-action"
        oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('manage-dashboard-dialog').hide();loadGrid();}" />
    </h:panelGroup>
  </f:facet>
</p:dialog>

<p:dialog id="dashboard-detail-dialog" widgetVar="dashboard-detail-dialog"
  header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/dashboardManagement/editDashboard')}"
  appendTo="@(body)" closeOnEscape="true" draggable="false" fitViewport="true" responsive="true" modal="true"
  width="40%">
  <h:form id="dashboard-detail-form">
    <p:messages id="dashboard-detail-messages" />
    <div class="ui-g">
      <div class="ui-g-4 manage-dashboard__label">
        <p:outputLabel for="dashboard-title"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/dashboardManagement/dashboardTitle')}" />
      </div>
      <div class="ui-g-8">
        <p:inputText id="dashboard-title" value="#{dashboardConfigurationBean.selectedEditingDashboard.title}"
          required="true" styleClass="manage-dashboard__input" />
      </div>
      <h:panelGroup layout="block" styleClass="ui-g-4 manage-dashboard__label"
        rendered="#{dashboardConfigurationBean.getIsPublicDashboard()}">
        <p:outputLabel for="dashboard-permission"
          value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/dashboardManagement/dashboardPermission')}" />
      </h:panelGroup>
      <h:panelGroup layout="block" styleClass="ui-g-8" rendered="#{dashboardConfigurationBean.getIsPublicDashboard()}">
        <p:autoComplete id="dashboard-permission" scrollHeight="210" dropdown="true" required="true"
          completeMethod="#{dashboardConfigurationBean.completePermissions}" styleClass="manage-dashboard__input"
          inputStyleClass="manage-dashboard__autocomplete-input"
          value="#{dashboardConfigurationBean.selectedEditingDashboard.permissionDTOs}" var="responsible"
          itemValue="#{responsible}" itemLabel="#{responsible.briefDisplayNameWithState}" converter="pojoConverter"
          cache="true" maxResults="100" multiple="true"
          moreText="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/more')}..." dynamic="true" forceSelection="true">
          <p:column>
            <i class="fa #{responsible.isUser() ? 'fa-user' : 'fa-users'} u-mar-right-5" />
            <h:outputText value="#{dashboardTaskFilterBean.formatName(responsible)}" />
          </p:column>
        </p:autoComplete>
      </h:panelGroup>
    </div>
  </h:form>
  <f:facet name="footer">
    <h:panelGroup layout="block" styleClass="u-text-align-right">
      <p:commandLink id="dashboard-detail-close-button"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
        onclick="PF('dashboard-detail-dialog').hide()" />
      <p:spacer width="15" />
      <p:commandButton id="dashboard-detail-save-button"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/save')}"
        actionListener="#{dashboardConfigurationBean.saveDashboardDetail()}"
        process="dashboard-detail-form:dashboard-title dashboard-detail-form:dashboard-permission" partialSubmit="true"
        icon="#{visibilityBean.generateButtonIcon('si si-floppy-disk')}"
        update="dashboard-form:dashboard-table dashboard-detail-form"
        oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('dashboard-detail-dialog').hide();}" />
    </h:panelGroup>
  </f:facet>
</p:dialog>

<ui:decorate template="/layouts/decorator/portal-dialog-with-icon.xhtml">
  <ui:param name="id" value="remove-dashboard-dialog" />
  <ui:param name="widgetVar" value="remove-dashboard-dialog" />
  <ui:param name="appendTo" value="@(body)" />
  <ui:param name="iconClass" value="si si-delete-1" />
  <ui:param name="iconStyleClass" value="portal-dialog-error-icon portal-dialog-icon" />
  <ui:param name="headerText"
    value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/dashboardManagement/removeDashboardHeader', [dashboardConfigurationBean.selectedEditingDashboard.title])}" />
  <ui:param name="dialogContent" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/dashboard/removeWidgetMessage')}" />

  <ui:define name="dialogFooter">
    <p:link href="#" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/cancel')}"
      onclick="PF('remove-dashboard-dialog').hide();" styleClass="u-mar-right-15" />
    <p:commandButton id="remove-dashboard-button" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/remove')}"
      actionListener="#{dashboardConfigurationBean.removeDashboard()}"
      icon="#{visibilityBean.generateButtonIcon('si si-remove-circle')}" update="dashboard-form"
      oncomplete="PF('remove-dashboard-dialog').hide();" />
  </ui:define>
</ui:decorate>

</html>