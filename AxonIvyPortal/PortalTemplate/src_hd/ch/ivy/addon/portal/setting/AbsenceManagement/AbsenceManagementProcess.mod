[Ivy]
1756E0BE3BCBAD12 9.3.1 #module
>Proto >Proto Collection #zClass
As0 AbsenceManagementProcess Big #zClass
As0 RD #cInfo
As0 #process
Ct2 Component Big #zClass
Ct2 B #cInfo
Ct0 Component Big #zClass
Ct0 B #cInfo
As0 Ct2 S20 'Sub 2' #zField
As0 Ct0 S10 'Sub 1' #zField
As0 @TextInP .type .type #zField
As0 @TextInP .processKind .processKind #zField
As0 @TextInP .xml .xml #zField
As0 @TextInP .responsibility .responsibility #zField
As0 @GridStep f86 '' #zField
As0 @Alternative f98 '' #zField
As0 @GridStep f37 '' #zField
As0 @UdProcessEnd f117 '' #zField
As0 @GridStep f55 '' #zField
As0 @CallSub f39 '' #zField
As0 @UdProcessEnd f23 '' #zField
As0 @UdEvent f96 '' #zField
As0 @GridStep f9 '' #zField
As0 @UdProcessEnd f19 '' #zField
As0 @GridStep f138 '' #zField
As0 @UdMethod f17 '' #zField
As0 @UdProcessEnd f122 '' #zField
As0 @UdProcessEnd f130 '' #zField
As0 @UdEvent f54 '' #zField
As0 @UdMethod f11 '' #zField
As0 @UdEvent f38 '' #zField
As0 @UdEvent f6 '' #zField
As0 @UdInit f7 '' #zField
As0 @GridStep f8 '' #zField
As0 @UdMethod f53 '' #zField
As0 @Alternative f90 '' #zField
As0 @UdEvent f157 '' #zField
As0 @UdProcessEnd f136 '' #zField
As0 @Alternative f140 '' #zField
As0 @UdEvent f31 '' #zField
As0 @UdMethod f12 '' #zField
As0 @UdProcessEnd f57 '' #zField
As0 @CallSub f111 '' #zField
As0 @GridStep f121 '' #zField
As0 @GridStep f137 '' #zField
As0 @CallSub f147 '' #zField
As0 @UdProcessEnd f100 '' #zField
As0 @CallSub f45 '' #zField
As0 @UdProcessEnd f10 '' #zField
As0 @GridStep f13 '' #zField
As0 @GridStep f14 '' #zField
As0 @UdMethod f52 '' #zField
As0 @CallSub f129 '' #zField
As0 @CallSub f101 '' #zField
As0 @CallSub f48 '' #zField
As0 @GridStep f102 '' #zField
As0 @UdProcessEnd f35 '' #zField
As0 @PushWFArc f15 '' #zField
As0 @PushWFArc f131 '' #zField
As0 @PushWFArc f36 '' #zField
As0 @PushWFArc f84 '' #zField
As0 @PushWFArc f33 '' #zField
As0 @PushWFArc f16 '' #zField
As0 @PushWFArc f91 '' #zField
As0 @PushWFArc f148 '' #zField
As0 @PushWFArc f99 '' #zField
As0 @PushWFArc f134 '' #zField
As0 @PushWFArc f20 '' #zField
As0 @PushWFArc f106 '' #zField
As0 @PushWFArc f21 '' #zField
As0 @PushWFArc f22 '' #zField
As0 @PushWFArc f87 '' #zField
As0 @PushWFArc f132 '' #zField
As0 @PushWFArc f149 '' #zField
As0 @PushWFArc f128 '' #zField
As0 @PushWFArc f63 '' #zField
As0 @PushWFArc f30 '' #zField
As0 @PushWFArc f46 '' #zField
As0 @PushWFArc f56 '' #zField
As0 @PushWFArc f158 '' #zField
As0 @PushWFArc f40 '' #zField
As0 @PushWFArc f155 '' #zField
As0 @PushWFArc f43 '' #zField
As0 @PushWFArc f107 '' #zField
As0 @PushWFArc f0 '' #zField
As0 @UdProcessEnd f1 '' #zField
As0 @UdMethod f2 '' #zField
As0 @GridStep f3 '' #zField
As0 @PushWFArc f4 '' #zField
As0 @PushWFArc f5 '' #zField
As0 @GridStep f47 '' #zField
As0 @PushWFArc f18 '' #zField
As0 @PushWFArc f50 '' #zField
As0 @GridStep f32 '' #zField
As0 @PushWFArc f49 '' #zField
As0 @PushWFArc f58 '' #zField
As0 @GridStep f28 '' #zField
As0 @PushWFArc f60 '' #zField
As0 @PushWFArc f27 '' #zField
As0 @PushWFArc f61 '' #zField
As0 @UdMethod f66 '' #zField
As0 @PushWFArc f26 '' #zField
As0 @PushWFArc f25 '' #zField
As0 @PushWFArc f42 '' #zField
As0 @PushWFArc f59 '' #zField
As0 @PushWFArc f24 '' #zField
As0 @UdMethod f34 '' #zField
As0 @UdProcessEnd f41 '' #zField
As0 @GridStep f44 '' #zField
As0 @PushWFArc f68 '' #zField
As0 @UdProcessEnd f69 '' #zField
As0 @UdMethod f70 '' #zField
As0 @PushWFArc f71 '' #zField
As0 @UdEvent f72 '' #zField
As0 @UdMethod f73 '' #zField
As0 @GridStep f74 '' #zField
As0 @GridStep f75 '' #zField
As0 @UdProcessEnd f76 '' #zField
As0 @UdMethod f77 '' #zField
As0 @GridStep f78 '' #zField
As0 @PushWFArc f79 '' #zField
As0 @PushWFArc f80 '' #zField
As0 @PushWFArc f81 '' #zField
As0 @PushWFArc f82 '' #zField
As0 @PushWFArc f83 '' #zField
As0 @PushWFArc f85 '' #zField
As0 @PushWFArc f29 '' #zField
As0 @GridStep f51 '' #zField
As0 @PushWFArc f62 '' #zField
As0 @PushWFArc f64 '' #zField
>Proto As0 As0 AbsenceManagementProcess #zField
Ct2 @TextInP .type .type #zField
Ct2 @TextInP .processKind .processKind #zField
Ct2 @TextInP .xml .xml #zField
Ct2 @TextInP .responsibility .responsibility #zField
Ct2 @CallSub f105 '' #zField
Ct2 @CallSub f115 '' #zField
Ct2 @PushWFArc f29 '' #zField
Ct2 @PushTrueWFInG-01 g0 '' #zField
Ct2 @PushWFArc f0 '' #zField
Ct2 @PushTrueWFOutG-01 g1 '' #zField
Ct2 @PushWFArc f1 '' #zField
>Proto Ct2 Ct0 Component #zField
Ct0 @TextInP .type .type #zField
Ct0 @TextInP .processKind .processKind #zField
Ct0 @TextInP .xml .xml #zField
Ct0 @TextInP .responsibility .responsibility #zField
Ct0 @GridStep f71 '' #zField
Ct0 @PushWFArc f77 '' #zField
Ct0 @GridStep f70 '' #zField
Ct0 @PushWFArc f75 '' #zField
Ct0 @CallSub f67 '' #zField
Ct0 @PushTrueWFInG-01 g0 '' #zField
Ct0 @PushWFArc f0 '' #zField
Ct0 @PushTrueWFOutG-01 g1 '' #zField
Ct0 @PushWFArc f1 '' #zField
Ct0 @PushTrueWFInG-01 g2 '' #zField
Ct0 @PushWFArc f3 '' #zField
>Proto Ct0 Ct1 Component #zField
As0 S20 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Find Substitutes/Substitutions</name>
    </language>
</elementInfo>
' #txt
As0 S20 616 74 176 44 -82 -8 #rect
As0 S10 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>Find Absences</name>
    </language>
</elementInfo>
' #txt
As0 S10 400 74 112 44 -41 -8 #rect
As0 f86 actionTable 'out=in;
' #txt
As0 f86 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import java.util.Set;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

boolean showNewAbsence = in.selectedAbsence.user.name.equals(in.selectedAbsenceUser.name);

if (showNewAbsence && (!AbsenceAndSubstituteUtils.isInThePast(in.selectedAbsence) || in.absenceInThePastShown)){
	in.displayedAbsences.add(in.selectedAbsence);
	(in.absencesByUser.get(in.selectedAbsenceUser.getName()) as Set).add(in.selectedAbsence);
}

in.message = ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceManagement/Messages/addNewAbsence", Arrays.asList(in.selectedAbsence.user.name));
' #txt
As0 f86 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>update data</name>
    </language>
</elementInfo>
' #txt
As0 f86 1088 570 112 44 -32 -8 #rect
As0 f98 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>is create absence?</name>
    </language>
</elementInfo>
' #txt
As0 f98 176 568 32 32 22 -15 #rect
As0 f37 actionTable 'out=in;
' #txt
As0 f37 actionCode 'in.backupAbsence.setUser(in.selectedAbsence.getUser());
in.backupAbsence.setFrom(in.selectedAbsence.getFrom());
in.backupAbsence.setUntil(in.selectedAbsence.getUntil());
in.backupAbsence.setComment(in.selectedAbsence.getComment());
in.selectedUser = in.selectedAbsence.getUser();
in.isCreateMode = false;' #txt
As0 f37 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Backup absence</name>
    </language>
</elementInfo>
' #txt
As0 f37 208 842 112 44 -46 -8 #rect
As0 f117 891 83 26 26 0 12 #rect
As0 f55 actionTable 'out=in;
' #txt
As0 f55 actionCode 'out.selectedAbsence.setUser(in.backupAbsence.getUser());
out.selectedAbsence.setFrom(in.backupAbsence.getFrom());
out.selectedAbsence.setUntil(in.backupAbsence.getUntil());
out.selectedAbsence.setComment(in.backupAbsence.getComment());
' #txt
As0 f55 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Reset</name>
    </language>
</elementInfo>
' #txt
As0 f55 208 938 112 44 -16 -8 #rect
As0 f39 processCall 'Ivy Data Processes/AbsenceService:deleteAbsence(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence)' #txt
As0 f39 requestActionDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence ivyAbsence> param;' #txt
As0 f39 requestMappingAction 'param.ivyAbsence=in.selectedAbsence;
' #txt
As0 f39 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f39 responseMappingAction 'out=in;
' #txt
As0 f39 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AbsenceService</name>
    </language>
</elementInfo>
' #txt
As0 f39 472 298 112 44 -44 -8 #rect
As0 f23 211 307 26 26 0 12 #rect
As0 f96 guid 1756E446A9C4FC28 #txt
As0 f96 actionTable 'out=in;
' #txt
As0 f96 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>saveSubstitutes</name>
    </language>
</elementInfo>
' #txt
As0 f96 91 411 26 26 -47 15 #rect
As0 f9 actionTable 'out=in;
' #txt
As0 f9 actionCode 'import java.util.Arrays;
import javax.faces.application.FacesMessage;
import org.primefaces.context.PrimeFacesContext;
import ch.ivy.addon.portalkit.util.UserUtils;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import java.util.Set;

out.displayedAbsences.remove(in.selectedAbsence);
Set<IvyAbsence> ivyAbsences = out.absencesByUser.get(in.selectedAbsence.user.getName()) as Set;
ivyAbsences.remove(in.selectedAbsence);

in.message = ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceManagement/Messages/removedAbsences", Arrays.asList(in.selectedAbsence.user.getName()));
' #txt
As0 f9 security system #txt
As0 f9 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Remove from list</name>
    </language>
</elementInfo>
' #txt
As0 f9 660 298 112 44 -46 -8 #rect
As0 f19 1235 755 26 26 0 12 #rect
As0 f138 actionTable 'out=in;
' #txt
As0 f138 actionCode 'import java.util.Set;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

in.validationError = false;
String username = in.selectedUser.getName();
boolean fromBiggerThanTill = AbsenceAndSubstituteUtils.checkFromBiggerThanTill(in.selectedAbsence);
in.selectedAbsence.user = in.selectedUser;

if (fromBiggerThanTill) {
	in.validationError = true;
}

boolean doesNewAbsenceOverlap = AbsenceAndSubstituteUtils.doesNewAbsenceOverlap(in.absencesByUser.get(username) as Set, in.selectedAbsence);
if (doesNewAbsenceOverlap) {
	in.validationError = true;
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR,ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/overlappingAbsence"), ""));
}

if (in.validationError) {
	FacesContext.getCurrentInstance().validationFailed();
}' #txt
As0 f138 security system #txt
As0 f138 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Validation</name>
    </language>
</elementInfo>
' #txt
As0 f138 660 618 112 44 -27 -8 #rect
As0 f17 guid 1756E446A9CC288A #txt
As0 f17 method autoCompleteForSubstituteOnApp(String) #txt
As0 f17 inParameterDecl '<String query> param;' #txt
As0 f17 inParameterMapAction 'out.queryAutoComplete=param.query;
' #txt
As0 f17 outParameterDecl '<java.util.List<ch.ivy.addon.portalkit.dto.UserDTO> users> result;' #txt
As0 f17 outActionCode 'import ch.ivy.addon.portalkit.dto.UserDTO;
import ch.ivy.addon.portalkit.util.UserUtils;

java.util.List<UserDTO> users = UserUtils.filterOut(in.users, in.selectedAbsenceUser);
result.users.addAll(users);' #txt
As0 f17 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>autoCompleteForSubstituteOnApp(String)</name>
    </language>
</elementInfo>
' #txt
As0 f17 691 755 26 26 -114 15 #rect
As0 f122 1235 947 26 26 0 12 #rect
As0 f130 371 851 26 26 0 12 #rect
As0 f54 guid 1756E446A9C95213 #txt
As0 f54 actionTable 'out=in;
' #txt
As0 f54 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>cancel</name>
    </language>
</elementInfo>
' #txt
As0 f54 83 947 26 26 -19 16 #rect
As0 f11 guid 1756E446A9C6B05E #txt
As0 f11 method editAbsence(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence) #txt
As0 f11 inParameterDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence selectedAbsence> param;' #txt
As0 f11 inParameterMapAction 'out.selectedAbsence=param.selectedAbsence;
out.validationError=false;
' #txt
As0 f11 outParameterDecl '<> result;' #txt
As0 f11 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>editAbsence(IvyAbsence)</name>
    </language>
</elementInfo>
' #txt
As0 f11 83 851 26 26 -68 15 #rect
As0 f38 guid 1756E446A9D95FC1 #txt
As0 f38 actionTable 'out=in;
' #txt
As0 f38 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>deleteAbsence</name>
    </language>
</elementInfo>
' #txt
As0 f38 323 307 26 26 -47 15 #rect
As0 f6 guid 1756E446A9DE09BB #txt
As0 f6 actionTable 'out=in;
' #txt
As0 f6 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>dateChange</name>
    </language>
</elementInfo>
' #txt
As0 f6 691 947 26 26 -36 15 #rect
As0 f7 guid 1756E446A9DF005A #txt
As0 f7 method start() #txt
As0 f7 inParameterDecl '<> param;' #txt
As0 f7 outParameterDecl '<> result;' #txt
As0 f7 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>start()</name>
    </language>
</elementInfo>
' #txt
As0 f7 83 83 26 26 -16 15 #rect
As0 f8 actionTable 'out=in;
' #txt
As0 f8 actionCode 'import ch.ivy.addon.portalkit.ivydata.utils.ServiceUtilities;
import ch.ivy.addon.portalkit.dto.UserDTO;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;

UserDTO currentUserDTO = new UserDTO(in.selectedAbsenceUser);

in.selectedAbsence = new IvyAbsence();
in.selectedAbsence.from = new Date();
in.selectedAbsence.until = new Date();
in.selectedAbsence.user = currentUserDTO;

in.selectedUser = currentUserDTO;

in.validationError = false;
in.isCreateMode = true;
' #txt
As0 f8 security system #txt
As0 f8 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Init</name>
    </language>
</elementInfo>
' #txt
As0 f8 208 746 112 44 -8 -8 #rect
As0 f53 guid 1756E446A9D252D7 #txt
As0 f53 method autoCompleteForUserOnApp(String) #txt
As0 f53 inParameterDecl '<String query> param;' #txt
As0 f53 inParameterMapAction 'out.queryAutoComplete=param.query;
' #txt
As0 f53 outParameterDecl '<java.util.List<ch.ivy.addon.portalkit.dto.UserDTO> users> result;' #txt
As0 f53 outParameterMapAction 'result.users=in.users;
' #txt
As0 f53 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>autoCompleteForUserOnApp(String)</name>
    </language>
</elementInfo>
' #txt
As0 f53 691 851 26 26 -82 22 #rect
As0 f90 792 944 32 32 0 16 #rect
As0 f157 guid 1756E446A9DB886F #txt
As0 f157 actionTable 'out=in;
' #txt
As0 f157 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>userSelectInAbsence</name>
    </language>
</elementInfo>
' #txt
As0 f157 691 1043 26 26 -48 14 #rect
As0 f136 1235 667 26 26 0 12 #rect
As0 f140 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>no errors?</name>
    </language>
</elementInfo>
' #txt
As0 f140 824 624 32 32 20 -13 #rect
As0 f31 guid 1756E446A9D175DA #txt
As0 f31 actionTable 'out=in;
' #txt
As0 f31 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>add</name>
    </language>
</elementInfo>
' #txt
As0 f31 83 755 26 26 -10 15 #rect
As0 f12 guid 1756E446A9D3C830 #txt
As0 f12 method preDelete(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence) #txt
As0 f12 inParameterDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence selectedAbsence> param;' #txt
As0 f12 inParameterMapAction 'out.selectedAbsence=param.selectedAbsence;
' #txt
As0 f12 outParameterDecl '<> result;' #txt
As0 f12 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>preDelete(IvyAbsence)</name>
    </language>
</elementInfo>
' #txt
As0 f12 91 307 26 26 -61 15 #rect
As0 f57 371 947 26 26 0 12 #rect
As0 f111 processCall 'Ivy Data Processes/AbsenceService:updateAbsences(String,java.util.Set)' #txt
As0 f111 requestActionDecl '<String username,java.util.Set ivyAbsences> param;' #txt
As0 f111 requestMappingAction 'param.username=in.selectedAbsenceUser.getName();
param.ivyAbsences=in.absencesByUser.get(in.selectedAbsenceUser.getName()) as java.util.Set;
' #txt
As0 f111 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f111 responseMappingAction 'out=in;
' #txt
As0 f111 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AbsenceService</name>
    </language>
</elementInfo>
' #txt
As0 f111 280 506 112 44 -44 -8 #rect
As0 f121 actionTable 'out=in;
' #txt
As0 f121 actionCode 'import java.util.Set;

Set<IvyAbsence> absencesFromUser = in.absencesByUser.get(in.selectedUser.getName()) as Set;
absencesFromUser.add(in.selectedAbsence);
' #txt
As0 f121 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>update data</name>
    </language>
</elementInfo>
' #txt
As0 f121 472 506 112 44 -32 -8 #rect
As0 f137 actionTable 'out=in;
' #txt
As0 f137 actionCode 'import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import ch.ivy.addon.portalkit.util.Dates;

java.util.Date endOfDate = Dates.toEndOfDate(in.selectedAbsence.getUntil());
in.selectedAbsence.setUntil(endOfDate);

in.isAbsenceBeingCreated = true;' #txt
As0 f137 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set end date&#xD;
to selected absence</name>
    </language>
</elementInfo>
' #txt
As0 f137 264 618 144 44 -51 -16 #rect
As0 f147 processCall 'Ivy Data Processes/AbsenceService:findAbsences(String)' #txt
As0 f147 requestActionDecl '<String username> param;' #txt
As0 f147 requestMappingAction 'param.username=in.selectedAbsence.getUsername();
' #txt
As0 f147 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f147 responseMappingAction 'out=in;
out.absencesByUser=result.absencesByUser;
' #txt
As0 f147 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Find current &#xD;
user''s absences</name>
    </language>
</elementInfo>
' #txt
As0 f147 472 618 112 44 -46 -20 #rect
As0 f100 1363 411 26 26 0 12 #rect
As0 f45 processCall 'Ivy Data Processes/SecurityService:findUsers(String,Integer,Integer,java.util.List<String>,java.util.List<String>)' #txt
As0 f45 requestActionDecl '<String query,Integer startIndex,Integer count,java.util.List<String> fromRoles,java.util.List<String> excludedUsernames> param;' #txt
As0 f45 requestMappingAction 'param.query=in.queryAutoComplete;
param.startIndex=0;
param.count=ch.ivy.addon.portalkit.constant.PortalConstants.MAX_USERS_IN_AUTOCOMPLETE;
' #txt
As0 f45 responseMappingAction 'out=in;
out.users=result.users;
' #txt
As0 f45 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Ivy Data Processes/SecurityService</name>
    </language>
</elementInfo>
' #txt
As0 f45 864 842 192 44 -93 -8 #rect
As0 f10 1235 851 26 26 0 12 #rect
As0 f13 actionTable 'out=in;
' #txt
As0 f13 actionCode 'import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;
import java.util.Set;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;

String username = in.selectedUser.getName();

boolean doesNewAbsenceOverlap = AbsenceAndSubstituteUtils.doesNewAbsenceOverlap(in.absencesByUser.get(username) as Set, in.selectedAbsence);
if (doesNewAbsenceOverlap) {
	in.validationError = true;
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR,ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/overlappingAbsence"), ""));
	FacesContext.getCurrentInstance().validationFailed();
}
' #txt
As0 f13 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>validation overlap</name>
    </language>
</elementInfo>
' #txt
As0 f13 1056 938 112 44 -47 -8 #rect
As0 f14 actionTable 'out=in;
' #txt
As0 f14 actionCode 'import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;
import java.util.Set;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;

in.validationError = false;
String username = in.selectedUser.getName();
boolean fromBiggerThanTill = AbsenceAndSubstituteUtils.checkFromBiggerThanTill(in.selectedAbsence);
in.selectedAbsence.user = in.selectedUser;

if (fromBiggerThanTill) {
	in.validationError = true;
	FacesContext.getCurrentInstance().validationFailed();
}

' #txt
As0 f14 security system #txt
As0 f14 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Validation date</name>
    </language>
</elementInfo>
' #txt
As0 f14 864 938 112 44 -40 -8 #rect
As0 f52 guid 1756E446A9D22ECA #txt
As0 f52 method saveAbsence() #txt
As0 f52 inParameterDecl '<> param;' #txt
As0 f52 outParameterDecl '<> result;' #txt
As0 f52 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>saveAbsence()</name>
    </language>
</elementInfo>
' #txt
As0 f52 83 571 26 26 -25 15 #rect
As0 f129 processCall 'Ivy Data Processes/AbsenceService:createAbsence(ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence)' #txt
As0 f129 requestActionDecl '<ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence absence> param;' #txt
As0 f129 requestMappingAction 'param.absence=in.selectedAbsence;
' #txt
As0 f129 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f129 responseMappingAction 'out=in;
' #txt
As0 f129 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>AbsenceService</name>
    </language>
</elementInfo>
' #txt
As0 f129 912 570 112 44 -44 -8 #rect
As0 f101 processCall 'Ivy Data Processes/SubstituteService:saveSubstitutes(ch.ivy.addon.portalkit.dto.UserDTO,java.util.List<ch.ivy.addon.portalkit.ivydata.bo.IvySubstitute>)' #txt
As0 f101 requestActionDecl '<ch.ivy.addon.portalkit.dto.UserDTO userDTO,java.util.List<ch.ivy.addon.portalkit.ivydata.bo.IvySubstitute> substitutes> param;' #txt
As0 f101 requestMappingAction 'param.userDTO=in.selectedAbsenceUser;
param.substitutes=in.substitutes;
' #txt
As0 f101 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
As0 f101 responseMappingAction 'out=in;
' #txt
As0 f101 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>save substitutes</name>
    </language>
</elementInfo>
' #txt
As0 f101 472 402 112 44 -45 -8 #rect
As0 f48 processCall 'Ivy Data Processes/SecurityService:findUsers(String,Integer,Integer,java.util.List<String>,java.util.List<String>)' #txt
As0 f48 requestActionDecl '<String query,Integer startIndex,Integer count,java.util.List<String> fromRoles,java.util.List<String> excludedUsernames> param;' #txt
As0 f48 requestMappingAction 'param.query=in.queryAutoComplete;
param.startIndex=0;
param.count=ch.ivy.addon.portalkit.constant.PortalConstants.MAX_USERS_IN_AUTOCOMPLETE;
' #txt
As0 f48 responseMappingAction 'out=in;
out.users=result.users;
' #txt
As0 f48 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>find Users</name>
    </language>
</elementInfo>
' #txt
As0 f48 864 746 112 44 -28 -8 #rect
As0 f102 actionTable 'out=in;
' #txt
As0 f102 actionCode 'import ch.ivy.addon.portalkit.dto.UserDTO;
import ch.ivy.addon.portalkit.ivydata.utils.ServiceUtilities;

in.selectedAbsenceUser = new UserDTO(ivy.session.getSessionUser());
' #txt
As0 f102 security system #txt
As0 f102 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Set current user</name>
    </language>
</elementInfo>
' #txt
As0 f102 220 74 112 44 -43 -8 #rect
As0 f35 371 755 26 26 0 12 #rect
As0 f15 1056 864 1235 864 #arcP
As0 f131 expr out #txt
As0 f131 109 864 208 864 #arcP
As0 f36 expr out #txt
As0 f36 320 768 371 768 #arcP
As0 f84 expr out #txt
As0 f84 717 1056 808 976 #arcP
As0 f84 1 808 1056 #addKink
As0 f84 0 0.7315307908545355 0 0 #arcLabel
As0 f33 717 768 864 768 #arcP
As0 f16 1024 592 1088 592 #arcP
As0 f91 expr out #txt
As0 f91 717 960 792 960 #arcP
As0 f148 expr out #txt
As0 f148 408 640 472 640 #arcP
As0 f99 109 584 176 584 #arcP
As0 f134 1168 960 1235 960 #arcP
As0 f20 expr out #txt
As0 f20 109 768 208 768 #arcP
As0 f106 expr in #txt
As0 f106 outCond in.isCreateMode #txt
As0 f106 .xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>yes</name>
    </language>
</elementInfo>
' #txt
As0 f106 192 600 264 640 #arcP
As0 f106 1 192 640 #addKink
As0 f106 1 0.24927302398624562 0 10 #arcLabel
As0 f21 392 528 472 528 #arcP
As0 f22 expr out #txt
As0 f22 584 320 660 320 #arcP
As0 f87 expr out #txt
As0 f87 320 960 371 960 #arcP
As0 f132 expr out #txt
As0 f132 320 864 371 864 #arcP
As0 f149 584 640 660 640 #arcP
As0 f128 expr in #txt
As0 f128 824 960 864 960 #arcP
As0 f63 expr out #txt
As0 f63 349 320 472 320 #arcP
As0 f30 expr out #txt
As0 f30 117 320 211 320 #arcP
As0 f46 717 864 864 864 #arcP
As0 f56 expr out #txt
As0 f56 109 960 208 960 #arcP
As0 f158 expr in #txt
As0 f158 outCond !in.validationError #txt
As0 f158 840 624 912 592 #arcP
As0 f158 1 840 592 #addKink
As0 f158 1 0.27930210302679576 0 0 #arcLabel
As0 f40 expr out #txt
As0 f40 976 960 1056 960 #arcP
As0 f155 expr out #txt
As0 f155 772 640 824 640 #arcP
As0 f43 976 768 1235 768 #arcP
As0 f107 expr in #txt
As0 f107 192 568 280 528 #arcP
As0 f107 1 192 528 #addKink
As0 f107 1 0.07251131769162951 0 0 #arcLabel
As0 f0 expr out #txt
As0 f0 109 96 220 96 #arcP
As0 f0 0 0.7501964716426519 0 0 #arcLabel
As0 f1 1595 83 26 26 0 12 #rect
As0 f2 guid 1756E4AF3567EC52 #txt
As0 f2 method backToHome() #txt
As0 f2 inParameterDecl '<> param;' #txt
As0 f2 outParameterDecl '<> result;' #txt
As0 f2 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>backToHome()</name>
    </language>
</elementInfo>
' #txt
As0 f2 1195 83 26 26 -25 15 #rect
As0 f3 actionTable 'out=in;
' #txt
As0 f3 actionCode 'import ch.ivy.addon.portalkit.publicapi.PortalNavigatorAPI;
import javax.faces.context.FacesContext;
import javax.faces.context.Flash;


// Turn off growl message
Flash flash = FacesContext.getCurrentInstance().getExternalContext().getFlash();
flash.put("overridePortalGrowl", true);
flash.setRedirect(true);

PortalNavigatorAPI.navigateToPortalEndPage();' #txt
As0 f3 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Navigate To Portal EndPage</name>
    </language>
</elementInfo>
' #txt
As0 f3 1304 74 160 44 -77 -8 #rect
As0 f4 1464 96 1595 96 #arcP
As0 f5 1221 96 1304 96 #arcP
As0 f47 actionTable 'out=in;
' #txt
As0 f47 actionCode 'import org.primefaces.context.PrimeFacesContext;
import javax.faces.application.FacesMessage;

FacesMessage message = new javax.faces.application.FacesMessage(FacesMessage.SEVERITY_INFO, "", in.message);
PrimeFacesContext.getCurrentInstance().addMessage("absences-management-message", message);' #txt
As0 f47 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Show message</name>
    </language>
</elementInfo>
' #txt
As0 f47 1192 402 112 44 -43 -8 #rect
As0 f18 1304 424 1363 424 #arcP
As0 f50 expr out #txt
As0 f50 772 320 1248 402 #arcP
As0 f50 1 1248 320 #addKink
As0 f50 0 0.7419816244893347 0 0 #arcLabel
As0 f32 actionTable 'out=in;
' #txt
As0 f32 actionCode 'in.message = ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceManagement/Messages/saveAbsenceSetting");' #txt
As0 f32 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Add message</name>
    </language>
</elementInfo>
' #txt
As0 f32 660 402 112 44 -38 -8 #rect
As0 f49 772 424 1192 424 #arcP
As0 f58 1200 592 1248 446 #arcP
As0 f58 1 1248 592 #addKink
As0 f58 0 0.8351937567881191 0 0 #arcLabel
As0 f28 actionTable 'out=in;
' #txt
As0 f28 actionCode 'in.message = ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceManagement/Messages/updateAbsence");' #txt
As0 f28 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Add message</name>
    </language>
</elementInfo>
' #txt
As0 f28 660 506 112 44 -38 -8 #rect
As0 f60 584 528 660 528 #arcP
As0 f60 0 0.6621446032546272 0 0 #arcLabel
As0 f27 772 528 1248 446 #arcP
As0 f27 1 1248 528 #addKink
As0 f27 0 0.6621446032546272 0 0 #arcLabel
As0 f61 expr in #txt
As0 f61 840 656 1235 680 #arcP
As0 f61 1 840 680 #addKink
As0 f61 1 0.9604896375018812 0 0 #arcLabel
As0 f66 guid 175B525253D92382 #txt
As0 f66 method findAbsencesAndSubstitutes() #txt
As0 f66 inParameterDecl '<> param;' #txt
As0 f66 outParameterDecl '<> result;' #txt
As0 f66 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>findAbsencesAndSubstitutes()</name>
    </language>
</elementInfo>
' #txt
As0 f66 83 203 26 26 -89 20 #rect
As0 f26 332 96 400 96 #arcP
As0 f25 expr out #txt
As0 f25 109 216 456 118 #arcP
As0 f25 1 456 216 #addKink
As0 f25 0 0.858310473048035 0 0 #arcLabel
As0 f42 512 96 616 96 #arcP
As0 f59 792 96 891 96 #arcP
As0 f24 584 424 660 424 #arcP
As0 f34 guid 178C51E41C8D1372 #txt
As0 f34 method addDeputy() #txt
As0 f34 inParameterDecl '<> param;' #txt
As0 f34 outParameterDecl '<> result;' #txt
As0 f34 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>addDeputy()</name>
    </language>
</elementInfo>
' #txt
As0 f34 83 1139 26 26 -40 15 #rect
As0 f41 659 1139 26 26 0 12 #rect
As0 f44 actionTable 'out=in;
' #txt
As0 f44 actionCode 'import java.util.Arrays;
import ch.ivy.addon.portalkit.enums.DeputyRoleType;
import ch.ivy.addon.portalkit.util.DeputyRoleUtils;
import javax.faces.application.FacesMessage;
import javax.faces.context.FacesContext;
import ch.ivyteam.ivy.security.ISecurityMember;

ISecurityMember selectedAssignee = in.#selectedDeputy is initialized ? ivy.security.members().find(in.selectedDeputy.getMemberName()) : null;
if (!(#selectedAssignee is initialized) || in.selectedDeputies.contains(selectedAssignee)) {
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "", ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/errorSelectInvalidDeputy")));
} else if (DeputyRoleType.PERSONAL_TASK_DURING_ABSENCE.equals(in.selectedDeputyRole.deputyRoleType) && DeputyRoleUtils.isSecurityMemberSelectedInDeputyRoleByType(in.deputyRoles, DeputyRoleType.PERSONAL_TASK_PERMANENT, selectedAssignee)) {
	String errorMessage = ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/errorSelectedInPersonalTaskPermanentDeputies", Arrays.asList(ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/personalTaskPermanentDeputies")));
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "", errorMessage));
} else if (DeputyRoleType.PERSONAL_TASK_PERMANENT.equals(in.selectedDeputyRole.deputyRoleType) && DeputyRoleUtils.isSecurityMemberSelectedInDeputyRoleByType(in.deputyRoles, DeputyRoleType.PERSONAL_TASK_DURING_ABSENCE, selectedAssignee)) {
	String errorMessage = ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/Messages/errorSelectedInPersonalTaskPermanentDeputies", Arrays.asList(ivy.cms.co("/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/personalTaskDuringAbsenceDeputies")));
	FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "", errorMessage));
} else {
	in.selectedDeputies.add(selectedAssignee);
}
' #txt
As0 f44 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Add deputy</name>
    </language>
</elementInfo>
' #txt
As0 f44 192 1130 112 44 -30 -8 #rect
As0 f68 expr out #txt
As0 f68 109 1152 192 1152 #arcP
As0 f69 659 1235 26 26 0 12 #rect
As0 f70 guid 178C53ACFA8D53DD #txt
As0 f70 method removeDeputy(ch.ivyteam.ivy.security.ISecurityMember) #txt
As0 f70 inParameterDecl '<ch.ivyteam.ivy.security.ISecurityMember assignee> param;' #txt
As0 f70 inActionCode out.selectedDeputies.remove(param.assignee); #txt
As0 f70 outParameterDecl '<> result;' #txt
As0 f70 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>removeDeputy(ISecurityMember)</name>
    </language>
</elementInfo>
' #txt
As0 f70 83 1235 26 26 -86 16 #rect
As0 f71 expr out #txt
As0 f71 109 1248 659 1248 #arcP
As0 f72 guid 0178C5540F2D37A3 #txt
As0 f72 actionTable 'out=in;
' #txt
As0 f72 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>closeDialog</name>
        <nameStyle>11,5,7
</nameStyle>
    </language>
</elementInfo>
' #txt
As0 f72 83 1459 26 26 -33 15 #rect
As0 f73 guid 178C5540F2DA7BD2 #txt
As0 f73 method updateSelectedDeputies() #txt
As0 f73 inParameterDecl '<> param;' #txt
As0 f73 outParameterDecl '<> result;' #txt
As0 f73 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>updateSelectedDeputies()</name>
    </language>
</elementInfo>
' #txt
As0 f73 83 1395 26 26 -62 15 #rect
As0 f74 actionTable 'out=in;
' #txt
As0 f74 actionCode 'import ch.ivy.addon.portalkit.util.DeputyRoleUtils;

in.selectedDeputies = in.selectedDeputyRole.getDeputies();
' #txt
As0 f74 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Initialize dialog</name>
    </language>
</elementInfo>
' #txt
As0 f74 192 1290 112 44 -40 -8 #rect
As0 f75 actionTable 'out=in;
' #txt
As0 f75 actionCode in.selectedDeputyRole.setDeputies(in.selectedDeputies); #txt
As0 f75 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>update selected deputies</name>
    </language>
</elementInfo>
' #txt
As0 f75 184 1386 144 44 -69 -8 #rect
As0 f76 659 1299 26 26 0 12 #rect
As0 f77 guid 178C5540F2DB1373 #txt
As0 f77 method initSelectedDeputies(ch.ivy.addon.portalkit.dto.DeputyRole) #txt
As0 f77 inParameterDecl '<ch.ivy.addon.portalkit.dto.DeputyRole deputyRole> param;' #txt
As0 f77 inParameterMapAction 'out.selectedDeputyRole=param.deputyRole;
' #txt
As0 f77 inActionCode 'int indexOfSelectedDeputyRole = out.deputyRoles.indexOf(param.deputyRole);
out.selectedDeputyRoleId = "absences-management-form:substitute-table:" + indexOfSelectedDeputyRole + ":selected-deputies-link";
' #txt
As0 f77 outParameterDecl '<> result;' #txt
As0 f77 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>initSelectedDeputies(DeputyRole)</name>
    </language>
</elementInfo>
' #txt
As0 f77 83 1299 26 26 -70 15 #rect
As0 f78 actionTable 'out=in;
' #txt
As0 f78 actionCode 'import java.util.ArrayList;

out.selectedDeputies = new ArrayList();
out.selectedDeputy = null;' #txt
As0 f78 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Reset dialog inputs</name>
    </language>
</elementInfo>
' #txt
As0 f78 384 1386 112 44 -53 -8 #rect
As0 f79 expr out #txt
As0 f79 109 1472 440 1430 #arcP
As0 f79 1 440 1472 #addKink
As0 f79 0 0.8593296567373708 0 0 #arcLabel
As0 f80 expr out #txt
As0 f80 328 1408 384 1408 #arcP
As0 f80 0 0.6592264889893998 0 0 #arcLabel
As0 f81 expr out #txt
As0 f81 496 1408 672 1325 #arcP
As0 f81 1 672 1408 #addKink
As0 f81 0 0.6592264889893998 0 0 #arcLabel
As0 f82 expr out #txt
As0 f82 304 1312 659 1312 #arcP
As0 f83 expr out #txt
As0 f83 109 1312 192 1312 #arcP
As0 f85 expr out #txt
As0 f85 109 1408 184 1408 #arcP
As0 f85 0 0.6592264889893998 0 0 #arcLabel
As0 f29 304 1152 659 1152 #arcP
As0 f51 actionTable 'out=in;
' #txt
As0 f51 actionCode 'import ch.ivy.addon.portalkit.util.DeputyRoleUtils;

in.substitutes = DeputyRoleUtils.getSubstitutesFromDeputyRoles(in.deputyRoles, ivy.wf.getApplication());' #txt
As0 f51 security system #txt
As0 f51 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>update substitutes</name>
    </language>
</elementInfo>
' #txt
As0 f51 280 402 112 44 -51 -8 #rect
As0 f62 expr out #txt
As0 f62 117 424 280 424 #arcP
As0 f64 392 424 472 424 #arcP
>Proto As0 .type ch.ivy.addon.portal.setting.AbsenceManagement.AbsenceManagementData #txt
>Proto As0 .processKind HTML_DIALOG #txt
>Proto As0 -8 -8 16 16 16 26 #rect
Ct2 f105 processCall 'Ivy Data Processes/SubstituteService:findSubstitutions(String)' #txt
Ct2 f105 requestActionDecl '<String username> param;' #txt
Ct2 f105 requestMappingAction 'param.username=in.selectedAbsenceUser.name;
' #txt
Ct2 f105 responseMappingAction 'out=in;
out.substitutions=result.substitutes;
' #txt
Ct2 f105 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>find substitutions</name>
    </language>
</elementInfo>
' #txt
Ct2 f105 408 138 112 44 -47 -8 #rect
Ct2 f115 processCall 'Ivy Data Processes/SubstituteService:findSubstitutes(String)' #txt
Ct2 f115 requestActionDecl '<String username> param;' #txt
Ct2 f115 requestMappingAction 'param.username=in.selectedAbsenceUser.name;
' #txt
Ct2 f115 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
Ct2 f115 responseMappingAction 'out=in;
out.deputyRoles=ch.ivy.addon.portalkit.util.DeputyRoleUtils.getDeputyRolesFromSubstitutes(result.substitutes);
out.substitutes=result.substitutes;
' #txt
Ct2 f115 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>find substitutes</name>
    </language>
</elementInfo>
' #txt
Ct2 f115 192 138 112 44 -42 -8 #rect
Ct2 f29 expr out #txt
Ct2 f29 304 160 408 160 #arcP
Ct2 g0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>in 1</name>
    </language>
</elementInfo>
' #txt
Ct2 g0 51 147 26 26 -17 22 #rect
Ct2 f0 77 160 192 160 #arcP
Ct2 g1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>out 1</name>
    </language>
</elementInfo>
' #txt
Ct2 g1 627 147 26 26 0 12 #rect
Ct2 f1 520 160 627 160 #arcP
>Proto Ct0 0 0 32 24 18 0 #rect
>Proto Ct0 @|BIcon #fIcon
Ct0 f71 actionTable 'out=in;
' #txt
Ct0 f71 actionCode 'import ch.ivy.addon.portalkit.util.PermissionUtils;
import ch.ivyteam.ivy.security.IPermission;

in.isSupervisor = PermissionUtils.hasAllPermissions(IPermission.USER_CREATE_ABSENCE, IPermission.USER_READ_ABSENCES, IPermission.USER_DELETE_ABSENCE);' #txt
Ct0 f71 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Check if current user &#xD;
can manage other users'' absences</name>
    </language>
</elementInfo>
' #txt
Ct0 f71 160 138 224 44 -92 -16 #rect
Ct0 f77 expr out #txt
Ct0 f77 592 160 688 160 #arcP
Ct0 f77 0 0.6865900143900335 0 0 #arcLabel
Ct0 f70 actionTable 'out=in;
' #txt
Ct0 f70 actionCode 'import java.util.ArrayList;
import java.util.Set;
import ch.ivy.addon.portalkit.ivydata.bo.IvyAbsence;
import ch.ivy.addon.portalkit.util.AbsenceAndSubstituteUtils;

if (in.#absencesByUser is initialized) {
	Set<IvyAbsence> ivyAbsences = in.absencesByUser.get(in.selectedAbsenceUser.getName()) as Set;
	if (!in.absenceInThePastShown) {
		out.displayedAbsences.clear();
		for (IvyAbsence absence : ivyAbsences) {
				if (!AbsenceAndSubstituteUtils.isInThePast(absence)) {
					out.displayedAbsences.add(absence);
				}
		}
	} else {
		out.displayedAbsences = new ArrayList(ivyAbsences);
	}
}

' #txt
Ct0 f70 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Get the absences&#xD;
of current user</name>
    </language>
</elementInfo>
' #txt
Ct0 f70 688 138 128 44 -44 -16 #rect
Ct0 f75 384 160 480 160 #arcP
Ct0 f67 processCall 'Ivy Data Processes/AbsenceService:findAbsences(String)' #txt
Ct0 f67 requestActionDecl '<String username> param;' #txt
Ct0 f67 requestMappingAction 'param.username=in.selectedAbsenceUser.getName();
' #txt
Ct0 f67 responseActionDecl 'ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy.AbsencesAndDeputyData out;
' #txt
Ct0 f67 responseMappingAction 'out=in;
out.absencesByUser=result.absencesByUser;
' #txt
Ct0 f67 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language>
        <name>Find current &#xD;
user''s absences</name>
    </language>
</elementInfo>
' #txt
Ct0 f67 480 138 112 44 -46 -20 #rect
Ct0 g0 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>in 1</name>
    </language>
</elementInfo>
' #txt
Ct0 g0 51 147 26 26 -22 18 #rect
Ct0 f0 77 160 160 160 #arcP
Ct0 g1 @C|.xml '<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<elementInfo>
    <language lang="en">
        <name>out 1</name>
    </language>
</elementInfo>
' #txt
Ct0 g1 915 147 26 26 0 5 #rect
Ct0 f1 816 160 915 160 #arcP
Ct0 g2 59 59 26 26 0 5 #rect
Ct0 f3 85 72 272 138 #arcP
Ct0 f3 1 272 72 #addKink
Ct0 f3 0 0.6999082358290764 0 0 #arcLabel
>Proto Ct1 0 0 32 24 18 0 #rect
>Proto Ct1 @|BIcon #fIcon
As0 f11 mainOut f131 tail #connect
As0 f131 head f37 mainIn #connect
As0 f37 mainOut f132 tail #connect
As0 f132 head f130 mainIn #connect
As0 f12 mainOut f30 tail #connect
As0 f30 head f23 mainIn #connect
As0 f31 mainOut f20 tail #connect
As0 f20 head f8 mainIn #connect
As0 f8 mainOut f36 tail #connect
As0 f36 head f35 mainIn #connect
As0 f54 mainOut f56 tail #connect
As0 f56 head f55 mainIn #connect
As0 f55 mainOut f87 tail #connect
As0 f87 head f57 mainIn #connect
As0 f38 mainOut f63 tail #connect
As0 f63 head f39 mainIn #connect
As0 f6 mainOut f91 tail #connect
As0 f91 head f90 in #connect
As0 f90 out f128 tail #connect
As0 f128 head f14 mainIn #connect
As0 f157 mainOut f84 tail #connect
As0 f84 head f90 in #connect
As0 f138 mainOut f155 tail #connect
As0 f155 head f140 in #connect
As0 f140 out f158 tail #connect
As0 f158 head f129 mainIn #connect
As0 f13 mainOut f134 tail #connect
As0 f134 head f122 mainIn #connect
As0 f137 mainOut f148 tail #connect
As0 f148 head f147 mainIn #connect
As0 f147 mainOut f149 tail #connect
As0 f149 head f138 mainIn #connect
As0 f53 mainOut f46 tail #connect
As0 f46 head f45 mainIn #connect
As0 f14 mainOut f40 tail #connect
As0 f40 head f13 mainIn #connect
As0 f52 mainOut f99 tail #connect
As0 f99 head f98 in #connect
As0 f98 out f106 tail #connect
As0 f106 head f137 mainIn #connect
As0 f98 out f107 tail #connect
As0 f107 head f111 mainIn #connect
As0 f39 mainOut f22 tail #connect
As0 f22 head f9 mainIn #connect
As0 f45 mainOut f15 tail #connect
As0 f15 head f10 mainIn #connect
As0 f48 mainOut f43 tail #connect
As0 f43 head f19 mainIn #connect
As0 f111 mainOut f21 tail #connect
As0 f21 head f121 mainIn #connect
As0 f129 mainOut f16 tail #connect
As0 f16 head f86 mainIn #connect
As0 f17 mainOut f33 tail #connect
As0 f33 head f48 mainIn #connect
As0 f7 mainOut f0 tail #connect
As0 f0 head f102 mainIn #connect
As0 f2 mainOut f5 tail #connect
As0 f5 head f3 mainIn #connect
As0 f3 mainOut f4 tail #connect
As0 f4 head f1 mainIn #connect
As0 f47 mainOut f18 tail #connect
As0 f18 head f100 mainIn #connect
As0 f9 mainOut f50 tail #connect
As0 f50 head f47 mainIn #connect
As0 f32 mainOut f49 tail #connect
As0 f49 head f47 mainIn #connect
As0 f86 mainOut f58 tail #connect
As0 f58 head f47 mainIn #connect
As0 f121 mainOut f60 tail #connect
As0 f60 head f28 mainIn #connect
As0 f28 mainOut f27 tail #connect
As0 f27 head f47 mainIn #connect
As0 f140 out f61 tail #connect
As0 f61 head f136 mainIn #connect
As0 f102 mainOut f26 tail #connect
As0 f26 head S10 g2 #connect
As0 f66 mainOut f25 tail #connect
As0 f25 head S10 g0 #connect
As0 f42 head S20 g0 #connect
As0 S20 g1 f59 tail #connect
As0 f59 head f117 mainIn #connect
As0 S10 g1 f42 tail #connect
As0 f101 mainOut f24 tail #connect
As0 f24 head f32 mainIn #connect
As0 f34 mainOut f68 tail #connect
As0 f68 head f44 mainIn #connect
As0 f70 mainOut f71 tail #connect
As0 f71 head f69 mainIn #connect
As0 f73 mainOut f85 tail #connect
As0 f85 head f75 mainIn #connect
As0 f75 mainOut f80 tail #connect
As0 f80 head f78 mainIn #connect
As0 f78 mainOut f81 tail #connect
As0 f81 head f76 mainIn #connect
As0 f77 mainOut f83 tail #connect
As0 f83 head f74 mainIn #connect
As0 f74 mainOut f82 tail #connect
As0 f82 head f76 mainIn #connect
As0 f72 mainOut f79 tail #connect
As0 f79 head f78 mainIn #connect
As0 f44 mainOut f29 tail #connect
As0 f29 head f41 mainIn #connect
As0 f96 mainOut f62 tail #connect
As0 f62 head f51 mainIn #connect
As0 f51 mainOut f64 tail #connect
As0 f64 head f101 mainIn #connect
Ct2 f115 mainOut f29 tail #connect
Ct2 f29 head f105 mainIn #connect
Ct2 g0 m f0 tail #connect
Ct2 f0 head f115 mainIn #connect
Ct2 f1 head g1 m #connect
Ct2 f105 mainOut f1 tail #connect
Ct2 0 0 696 328 0 #ivRect
Ct0 f67 mainOut f77 tail #connect
Ct0 f77 head f70 mainIn #connect
Ct0 f71 mainOut f75 tail #connect
Ct0 f75 head f67 mainIn #connect
Ct0 g0 m f0 tail #connect
Ct0 f0 head f71 mainIn #connect
Ct0 f1 head g1 m #connect
Ct0 f70 mainOut f1 tail #connect
Ct0 g2 m f3 tail #connect
Ct0 f3 head f71 mainIn #connect
Ct0 0 0 984 384 0 #ivRect
