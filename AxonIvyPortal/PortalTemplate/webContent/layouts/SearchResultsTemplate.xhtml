<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:p="http://primefaces.org/ui"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:pe="http://primefaces.org/ui/extensions"
  xmlns:pm="http://primefaces.org/mobile">
<h:body>
  <ui:composition template="/layouts/BasicTemplate.xhtml">
    <ui:param name="dataModel" value="#{data.dataModel}" />
    <ui:define name="pageTitle">#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/searchResult/searchResults')}</ui:define>
    <ui:define name="simplePageContent">
      <c:set var="isShowResultTabView" value="#{compactProcessWidgetBean.displayShowAllProcessesLink or taskWidgetBean.showFullTaskList or caseWidgetBean.showFullCaseList}"></c:set>
      <h:form id="global-search-form-in-page">
        <div id="global-search-container-in-page" class="global-search">
          <p:inputText id="global-search-data" styleClass="global-search-input js-global-search js-filter-process-widget-list-item" value="#{dataModel.keyword}"
            placeholder="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/search')}"
            onkeypress="if (event.keyCode == 13) { portalGlobalSearchInPage(); return false; }">
          </p:inputText>
          <i class="global-search-icon fa fa-search" />
        </div>
        <p:remoteCommand name="portalGlobalSearchInPage" actionListener="#{dataModel.search}"
          update="#{p:component('search-results-tabview')}" oncomplete="processWidget.filter();" />
        <p:remoteCommand autoRun="true" global="false" process="@none" onstart="PF('search-results-tabview').select(#{data.activeTabIndex})" />
      </h:form>
      <c:if test="#{!isShowResultTabView}" >
      	<h:outputText styleClass="not-display-result-tab-view" value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/searchResult/notDisplayResultTabView')}."/>
      </c:if>
      <p:tabView id="search-results-tabview" widgetVar="search-results-tabview" onTabShow="onTabShow()" dynamic="true" styleClass="search-results-tabview"
        rendered="#{isShowResultTabView}">
        <p:tab id="process-tab" title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/processes')}" titleStyleClass="process-tab-title"
          rendered="#{compactProcessWidgetBean.displayShowAllProcessesLink}">
          <ic:ch.ivy.addon.portalkit.component.ProcessWidget id="process-results" hideProcessNavigation="true"
            hideHeader="true" hideExpressCreation="true" processListStyleClass="process-in-search" />
        </p:tab>
        
        <p:tab id="task-tab" title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/tasks')}" titleStyleClass="task-tab-title"
          rendered="#{taskWidgetBean.showFullTaskList}">
          <div class="task-list-container js-task-list-container js-for-search-result">
            <ic:ch.ivy.addon.portalkit.component.TaskWidget id="task-results" listHeaderStyleClass="task-in-search"
              keyword="#{dataModel.taskDataModel.criteria.keyword}" hideTaskFilter="true" currentPortalPage="SEARCH_RESULTS"
              dataModel="#{dataModel.taskDataModel}" hideWidgetHeader="true" compactMode="false">
              <f:facet name="taskListHeader">
                <ui:fragment rendered="#{useTaskOverrideListHeader}">
                  <ui:insert name="taskListHeader">
                  </ui:insert>
                </ui:fragment>
  
                <ui:fragment rendered="#{not useTaskOverrideListHeader}">
                  <ic:ch.ivy.addon.portalkit.component.task.column.TaskListHeader id="task-list-header-component"
                    dataModel="#{dataModel.taskDataModel}" />
                </ui:fragment>
              </f:facet>
  
              <f:facet name="taskHeader">
                <ui:fragment rendered="#{useTaskOverrideHeader}">
                  <ui:insert name="taskHeader">
                  </ui:insert>
                </ui:fragment>
  
                <ui:fragment rendered="#{not useTaskOverrideHeader}">
                  <ic:ch.ivy.addon.portalkit.component.task.column.TaskPriority id="task-priority-component"
                    priority="#{task.priority}" dataModel="#{dataModel.taskDataModel}" />
                  <div class="task-start-info">
                    <ic:ch.ivy.addon.portalkit.component.task.column.TaskName id="task-name-component" task="#{task}"
                      dataModel="#{dataModel.taskDataModel}" />
                  </div>
                  <ic:ch.ivy.addon.portalkit.component.task.column.TaskResponsible id="task-responsible-component"
                    dataModel="#{dataModel.taskDataModel}" userName="#{task.getActivatorName()}"
                    fullName="#{task.getActivator().getDisplayName()}"
                    styleClass="activatior-column #{dataModel.taskDataModel.isAutoHideColumns()? 'hidden-sm':''}" />
                  <ic:ch.ivy.addon.portalkit.component.task.column.TaskId id="task-id-component" value="#{task.getId()}"
                    dataModel="#{dataModel.taskDataModel}" />
                  <ic:ch.ivy.addon.portalkit.component.task.column.TaskDate id="task-creation-date-component"
                    rendered="#{dataModel.taskDataModel.isSelectedColumn('CREATION_TIME')}" componentId="creation-time"
                    value="#{task.startTimestamp}"
                    styleClass="#{dataModel.taskDataModel.isAutoHideColumns()?'js-create-cell':''}" />
                  <ic:ch.ivy.addon.portalkit.component.task.column.TaskDate id="task-expiry-date-component"
                    rendered="#{dataModel.taskDataModel.isSelectedColumn('EXPIRY_TIME')}" componentId="expiry-time"
                    value="#{task.expiryTimestamp}"
                    styleClass="#{dataModel.taskDataModel.isAutoHideColumns()?'js-expiry-cell':''}" />
                  <ic:ch.ivy.addon.portalkit.component.task.column.TaskState id="task-state-component"
                    dataModel="#{dataModel.taskDataModel}" state="#{task.state}" />
                </ui:fragment>
              </f:facet>
            </ic:ch.ivy.addon.portalkit.component.TaskWidget>
          </div>
        </p:tab>
        
        <p:tab id="case-tab" title="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/cases')}" titleStyleClass="case-tab-title"
          rendered="#{caseWidgetBean.showFullCaseList}">
          <div class="js-case-default-widget-container case-default-widget-container js-simple-container js-for-search-result">
            <ic:ch.ivy.addon.portalkit.component.CaseWidget id="case-results" hideWidgetHeader="true"
              dataModel="#{dataModel.caseDataModel}" hideCaseFilter="true" listHeaderStyleClass="case-in-search">
              <f:facet name="caseListHeader">
                <ui:fragment rendered="#{useCaseOverrideListHeader}">
                  <ui:insert name="caseListHeader" />
                </ui:fragment>

                <ui:fragment rendered="#{not useCaseOverrideListHeader}">
                  <ic:ch.ivy.addon.portalkit.component.CaseListHeader id="case-list-header"
                    dataModel="#{dataModel.caseDataModel}" />
                </ui:fragment>
              </f:facet>
              <f:facet name="caseHeader">
              	<ui:fragment rendered="#{useCaseOverrideHeader}">
                  <ui:insert name="caseHeader">
                  </ui:insert>
                </ui:fragment>
                
                <ui:fragment rendered="#{not useCaseOverrideHeader}">
	                <div class="case-header-name-desc-cell u-truncate-text">
	                  <ic:ch.ivy.addon.portalkit.component.cases.column.CaseName id="case-name-component" caseNameId="case-header-name-cell" caseDescriptionId="description-cell"
	                    case="#{case}" dataModel="#{dataModel.caseDataModel}" />
	                </div>
	                <ic:ch.ivy.addon.portalkit.component.cases.column.CaseId componentId="case-id-cell" case="#{case}" dataModel="#{dataModel.caseDataModel}" />
	                <ic:ch.ivy.addon.portalkit.component.cases.column.CaseCreator componentId="case-creator-cell" case="#{case}" dataModel="#{dataModel.caseDataModel}" 
	                  styleClass="#{caseView.dataModel.isAutoHideColumns()? 'hidden-sm':''}" />
	                <ic:ch.ivy.addon.portalkit.component.cases.column.CaseDate componentId="case-creation-date-cell" 
	                  rendered="#{dataModel.caseDataModel.isSelectedColumn('CREATION_TIME')}" value="#{case.startTimestamp}"
	                  styleClass="#{dataModel.caseDataModel.isAutoHideColumns()?'js-create-cell':''}" />
	                <ic:ch.ivy.addon.portalkit.component.cases.column.CaseDate componentId="case-expiry-date-cell" 
	                  rendered="#{dataModel.caseDataModel.isSelectedColumn('FINISHED_TIME')}" value="#{case.endTimestamp}"
	                  styleClass="#{dataModel.caseDataModel.isAutoHideColumns()?'js-finish-cell':''}"  />
	                <ic:ch.ivy.addon.portalkit.component.cases.column.CaseState componentId="case-state-cell" case="#{case}" dataModel="#{dataModel.caseDataModel}"/>
              	</ui:fragment>
              </f:facet>
            </ic:ch.ivy.addon.portalkit.component.CaseWidget>
          </div>
        </p:tab>
        
        <ui:insert name="custom-search"></ui:insert>
        
      </p:tabView>
      <script>
        function onTabShow() {
          var $selectedTab = $("#search-results-tabview").find(".ui-tabs-panel").filter(function() {return $(this).css('display') == 'block'});
          var isSelectTaskTab = $selectedTab.find('.js-task-list-container').length != 0;
          if (isSelectTaskTab) {
            var taskListScreen = new TaskListScreenHandler();
            var responsiveToolkit = ResponsiveToolkit(taskListScreen);

            Portal.init(responsiveToolkit, true);
            taskWidget.setupHeader();
            return;
          }

          var isSelectCaseTab = $selectedTab.find('.js-case-default-widget-container').length != 0;
          if (isSelectCaseTab) {
            var caseListScreen = new CaseListScreenHandler();
            var responsiveToolkit = ResponsiveToolkit(caseListScreen);

            Portal.init(responsiveToolkit, true);
            caseWidget.setupHeader();
            return;
          }

        }
      </script>
    </ui:define>
  </ui:composition>
</h:body>
</html>