<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:cc="http://xmlns.jcp.org/jsf/composite"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:p="http://primefaces.org/ui" xmlns:jsf="http://xmlns.jcp.org/jsf"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:pm="http://primefaces.org/modena"
  xmlns:pc="http://xmlns.jcp.org/jsf/composite/components">

  <!-- TOPBAR START -->
  <h:outputScript name="global-search.js" library="js" target="head" />
  <div class="TexAlCenter">

    <p:commandLink id="logo" action="#{userMenuBean.navigateToHomePageOrDisplayWorkingTaskWarning(isWorkingOnATask)}">
      <p:graphicImage styleClass="portal-home-logo" value="#{resource['ivy-cms:images/logo/CorporateLogo']}"
        alt="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/homeLogo')}" />
    </p:commandLink>
    <ic:ch.ivy.addon.portalkit.component.WarningBeforeLeavingTask id="task-leave-warning-component"
      rendered="#{isWorkingOnATask}" leaveActionListener="#{userMenuBean.resetTaskAndNavigateToHomePage()}"
      reserveActionListener="#{userMenuBean.reserveTaskAndNavigateToHomePage()}"
      componentId="logo-task-losing-confirmation-dialog" widgetVar="logo-task-losing-confirmation-dialog" />
    <c:if test="#{!isNotRequiredLogin}">
      <ic:ch.ivy.addon.portalkit.singleapp.general.SetLanguage />
    </c:if>
  </div>

  <ui:insert name="menu-bar">

    <ul id="top-menu" class="js-top-menu">
      <li><h:form prependId="false" styleClass="global-search" onsubmit="return false;"
          rendered="#{showGlobalSearch}">
          <p:inputText id="global-search-data" value="#{userMenuBean.searchKeyword}"
            placeholder="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/search')}">
            <p:ajax event="keyup" delay="#{mainMenuBean.searchDelayTime}" listener="#{userMenuBean.search}"
              update="global-search-result-container" oncomplete="showHideOverlayPanel()" />
          </p:inputText>
          <i class="global-search-icon fa fa-search" />
          <p:overlayPanel for="global-search-data" styleClass="global-search-result-overlay" my="left top"
            at="left bottom" dynamic="true" showEvent="none" hideEvent="none" widgetVar="search-result-overlay-panel">
            <h:panelGroup id="global-search-result-container" styleClass="global-search-result-container">
              <h:panelGroup id="global-process-result" rendered="#{not empty userMenuBean.foundWebStartables}"
                layout="block" styleClass="global-search-result">
                <span class="Fs12 underline-section">>#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/processes')}</span>
                <ui:repeat id="found-processes" var="foundProcess" value="#{userMenuBean.foundWebStartables}">
                  <ic:ch.ivy.addon.portal.generic.ProcessSearchResult foundProcess="#{foundProcess}" />
                </ui:repeat>
              </h:panelGroup>
              <h:panelGroup id="global-task-result" rendered="#{not empty userMenuBean.foundTasks}" layout="block"
                styleClass="global-search-result">
                <span class="Fs12 underline-section">>#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/tasks')}</span>
                <ui:repeat id="found-tasks" var="foundTask" value="#{userMenuBean.foundTasks}">
                  <ic:ch.ivy.addon.portal.generic.TaskSearchResult keyword="#{userMenuBean.searchKeyword}"
                    foundTask="#{foundTask}" />
                </ui:repeat>
              </h:panelGroup>
              <h:panelGroup id="global-case-result" rendered="#{not empty userMenuBean.foundCases}" layout="block"
                styleClass="global-search-result">
                <span class="Fs12 underline-section">>
                  #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/cases')}</span>
                <ui:repeat id="found-cases" var="foundCase" value="#{userMenuBean.foundCases}">
                  <ic:ch.ivy.addon.portal.generic.CaseSearchResult foundCase="#{foundCase}"
                    keyword="#{userMenuBean.searchKeyword}" />
                </ui:repeat>
              </h:panelGroup>
              <h:panelGroup id="empty-search-result" layout="block" rendered="#{userMenuBean.hasNoRecordsFound}"
                styleClass="global-search-result">
                <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/noRecordsFound')}" />
              </h:panelGroup>
            </h:panelGroup>
          </p:overlayPanel>
        </h:form></li>
      <li class="setting-container">
      	<a href="#" jsf:rendered="#{userMenuBean.showServerInformation}"> <span
          jsf:id="server-infor" class="TexAlLeft DispBlock Fs11"> Host: #{serverInformationBean.host}
            Env:#{serverInformationBean.environment} </span> <span class="TexAlLeft DispBlock Fs17"><b
            class="dropdown-icon">#{userMenuBean.userName}</b></span>
      	</a>
     	 <a href="#" jsf:rendered="#{not userMenuBean.showServerInformation}" id="user-settings-menu"> <span
          class="dropdown-icon user-name js-user-name">#{userMenuBean.userName}</span>
      	</a>
        <ul id="user-setting-container">
          <li><p:commandLink id="adminui-menu-item" resetValues="true"
              rendered="#{permissionBean.hasAdminPermission()}"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/applicationMenuHeader/adminSettings')}"
              update="admin-ui-dialog" oncomplete="PF('adminUI').show()" /></li>

          <li><p:link id="absence-menu-item" href="#"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/absences')}"
              onclick="PF('absenceSetting').show()" rendered="#{absenceBean.ownAbsencesReadable}" /></li>

          <li><p:commandLink id="email-setting-menu-item"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/emailSetting')}"
              oncomplete="PF('emailSetting').show();" resetValues="true" update="applications-email-setting-form">
              <p:resetInput target=":applications-email-setting-dialog" />
            </p:commandLink></li>

          <li><p:commandLink id="language-setting-menu-item"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/languageSetting/languageSetting')}"
              oncomplete="PF('languageDialogVar').show();" resetValues="true" update="language-settings-form">
              <p:resetInput target=":language-setting-dialog" />
            </p:commandLink></li>

          <li><p:commandLink id="change-password-menu-item"
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/applicationMenuHeader/changePassword')}"
              rendered="#{not userMenuBean.hiddenChangePassword}" oncomplete="PF('changePasswordDialog').show();"
              resetValues="true" update="change-password-form">
              <p:resetInput target=":change-password-dialog" />
            </p:commandLink></li>

          <li><p:link id="project-info-menu-item" href="#" 
              value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/projectInfo/info')}"
              onclick="rcProjectInfo();" /></li>

          <li><ic:ch.ivy.addon.portalkit.multiapp.settings.LogoutSetting id="logout-setting"
              isWorkingOnATask="#{isWorkingOnATask}" hideLogout="#{userMenuBean.hiddenLogout}"/></li>
        </ul></li>
      <li jsf:rendered="#{enablesChat}"><a jsf:id="toggle-chat-panel-command"
        class="notification-badge mod-chat-menu js-toggle-chat-panel"><i class="fa fa-comment" /></a></li>
    </ul>

    <p:dialog header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/applicationMenuHeader/changePassword')}" 
      width="500" closeOnEscape="true" widgetVar="changePasswordDialog" id="change-password-dialog" resizable="false" 
      modal="true" draggable="false" appendTo="@(body)" dynamic="true" >
      <h:form id="change-password-form" >
        <ic:ch.ivy.addon.portalkit.multiapp.settings.PasswordSetting id="password-setting" dialogName="changePasswordDialog" />
      </h:form>
    </p:dialog>

    <p:dialog header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/applicationMenuHeader/adminSettings')}" 
      width="90%" height="450" closeOnEscape="true" widgetVar="adminUI" id="admin-ui-dialog" resizable="false" 
      modal="true" draggable="false" appendTo="@(body)" dynamic="true" onHide="PF('dialogClosingInformation').show();">
      <ic:ch.ivy.addon.portalkit.admin.AdminSettings id="adminui" />
      <f:facet name="footer">
        <p:commandButton value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/close')}" 
          id="close-button" type="button" onclick="PF('adminUI').hide();" />
      </f:facet>
    </p:dialog>

    <p:dialog header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/adminSettings/dialogclosinginformation/dialogHeader')}" 
      width="50%" closeOnEscape="true" widgetVar="dialogClosingInformation" id="dialog-closing-information" resizable="false" 
      modal="true" draggable="false" appendTo="@(body)" dynamic="true" >
      <p:outputLabel value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/adminSettings/dialogclosinginformation/informMessage')}" />
      <f:facet name="footer">
        <p:commandButton value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/ok')}" 
          id="close-dialog-button" type="button" onclick="PF('dialogClosingInformation').hide();" />
      </f:facet>
    </p:dialog>

    <p:dialog header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/AbsenceAndDeputy/absences')}" 
      width="80%" height="420" closeOnEscape="true" widgetVar="absenceSetting" id="absence-settings-dialog" resizable="false" 
      modal="true" draggable="true" appendTo="@(body)" dynamic="true" responsive="true">
      <ic:ch.ivy.addon.portalkit.multiapp.settings.AbsencesAndDeputy id="absence-settings" dialogName="absenceSetting" />
      <f:facet name="footer">
        <p:commandButton value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/close')}" 
          id="cancel-absences-command" type="button" onclick="PF('absenceSetting').hide();" />
      </f:facet>
    </p:dialog>

    <p:dialog header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/emailSetting/emailSetting')}" 
      closeOnEscape="true" widgetVar="emailSetting" id="applications-email-setting-dialog" resizable="false"
      modal="true" appendTo="@(body)" dynamic="true">
      <h:form id="applications-email-setting-form">
        <ic:ch.ivy.addon.portalkit.multiapp.settings.EmailSetting id="applications-email-setting"
          dialogName="emailSetting" />
      </h:form>
    </p:dialog>

    <p:dialog header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/languageSetting/languageSetting')}" 
      width="50%" closeOnEscape="true" widgetVar="languageDialogVar" id="language-setting-dialog" resizable="false"  
      modal="true" dynamic="true" appendTo="@(body)">
      <h:form id="language-settings-form">
        <ic:ch.ivy.addon.portalkit.multiapp.settings.CentralLanguage id="language-settings" startMethod="start"
          dialogName="languageDialogVar" />
      </h:form>
    </p:dialog>

    <p:dialog header="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/projectInfo/header')}"
      width="800" closeOnEscape="true" widgetVar="project-info-dialog" id="project-info-dialog" resizable="false" 
      modal="true" draggable="false" appendTo="@(body)" dynamic="true" >
      <ic:ch.ivy.addon.portalkit.component.ProjectVersion id="project-version" />
      <h:panelGroup layout="block" styleClass="ui-dialog-footer u-dialog-footer u-email-dialog-footer">
        <p:commandButton value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/close')}" 
          id="project-version-close-button" type="button" onclick="PF('project-info-dialog').hide();" />
      </h:panelGroup>
    </p:dialog>
    
    <h:form>
      <p:remoteCommand name="rcProjectInfo" actionListener="#{projectVersionBean.loadData}" oncomplete="PF('project-info-dialog').show()" update="project-info-dialog" />
    </h:form>
    
  </ui:insert>
  <c:if test="#{enablesChat eq true}">
    <ui:include src="/layouts/includes/chat.xhtml" />
  </c:if>
  <!-- TOPBAR END -->
</ui:composition>