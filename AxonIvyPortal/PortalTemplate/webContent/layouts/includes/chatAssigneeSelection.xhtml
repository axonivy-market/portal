<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:ic="http://ivyteam.ch/jsf/component" xmlns:cc="http://xmlns.jcp.org/jsf/composite"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:p="http://primefaces.org/ui" xmlns:jsf="http://xmlns.jcp.org/jsf"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:pc="http://xmlns.jcp.org/jsf/composite/components">

  <h:panelGroup id="chat-assignee-selection-panel" class="ui-g">
    <p:messages id="error-message" showSummary="false" showDetail="true" styleClass="Wid100" />
    <div class="ui-g-12">
      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/chat/chatAssigneeDialogHint')}" />
    </div>
    <div class="ui-g-12">
      <p:selectOneRadio id="chat-assignee-type" value="#{chatAssigneeBean.isAssignToUser}">
        <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDelegate/toUser')}" itemValue="true"
          itemDisabled="#{empty chatAssigneeBean.availableUsers}" />
        <f:selectItem itemLabel="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/taskDelegate/toGroup')}" itemValue="false"
          itemDisabled="#{empty chatAssigneeBean.availableRoles}" />
        <p:ajax event="change" listener="#{chatAssigneeBean.changeAssigneeType}" update="chat-assignee-selection-panel" />
      </p:selectOneRadio>
    </div>

    <div id="chat-select-assignee" class="ui-g-12">
      <p:autoComplete id="chat-user-selection" rendered="#{chatAssigneeBean.isAssignToUser}" scrollHeight="400" dropdown="true"
        value="#{chatAssigneeBean.selectedUser}" styleClass="chat-user-selection" inputStyleClass="chat-user-selection-input"
        completeMethod="#{chatAssigneeBean.populateUserAutoComplete}" var="user" itemLabel="#{user.displayName}"
        itemValue="#{user}" converter="pojoConverter" cache="true" queryDelay="500" maxResults="100" panelStyleClass="chat-select-assignee-panel"
        moreText="#{component.suggestions.size() - component.maxResults} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/more')}...">
        <f:event listener="#{chatAssigneeBean.populateUserAutoComplete}" type="preRenderComponent" />
        <p:ajax event="query" global="false" />
        <p:ajax event="itemSelect" update="chat-add-assignee-button" />
        <p:column>
          <h:outputText value="#{userFormatBean.formatWithTip(user.displayName, user.memberName.substring(1))}" />
        </p:column>
      </p:autoComplete>

      <p:autoComplete id="chat-role-selection" rendered="#{not chatAssigneeBean.isAssignToUser}" scrollHeight="400" dropdown="true"
        value="#{chatAssigneeBean.selectedRole}" styleClass="chat-role-selection" inputStyleClass="chat-role-selection-input"
        completeMethod="#{chatAssigneeBean.populateRoleAutoComplete}" var="role"
        itemLabel="#{role.getDisplayName() != '' ? role.getDisplayName() : role.getMemberName()}" itemValue="#{role}"
        converter="pojoConverter" cache="true" queryDelay="500" maxResults="100" selectLimit="100" panelStyleClass="chat-select-assignee-panel"
        moreText="#{component.suggestions.size() - component.maxResults} #{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/more')}...">
        <f:event listener="#{chatAssigneeBean.populateRoleAutoComplete}" type="preRenderComponent" />
        <p:ajax event="query" global="false" />
        <p:ajax event="itemSelect" update="chat-add-assignee-button" />
      </p:autoComplete>
    </div>
    
    <div class="ui-g-12 chat-add-assignee-button-grid">
      <p:commandButton id="chat-add-assignee-button"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/common/add')}"
        disabled="#{chatAssigneeBean.selectedUser == null and chatAssigneeBean.selectedRole == null}" actionListener="#{chatAssigneeBean.addAssignee}"
        global="false" update="error-message chat-selected-assignee-fieldset" ignoreAutoUpdate="true" />
    </div>

    <div class="ui-g-12">
      <p:fieldset id="chat-selected-assignee-fieldset"
        legend="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/chat/selectedAssignees')}">
        <ui:repeat var="assignee" value="#{chatAssigneeBean.selectedAssignees}">
          <div class="ui-g">
            <div class="ui-g-12">
              <h:outputText id="chat-assign-type-icon" class="fa #{assignee.isUser() ? 'fa-user' : 'fa-users'} u-mar-right-5" />
              <h:outputText value="#{not empty assignee.getDisplayName() ? assignee.getDisplayName() : assignee.getName()}" />
              <p:commandLink id="chat-delete-assignee" styleClass="fa fa-trash chat-delete-assignee"
                rendered="#{assignee ne ivy.session.getSessionUser()}"
                actionListener="#{chatAssigneeBean.removeAssignee(assignee)}" update="#{p:component('chat-assignee-selection-panel')}" />
            </div>
          </div>
        </ui:repeat>
      </p:fieldset>
    </div>

    <div class="ui-g-12 chat-action-container">
      <p:commandButton id="chat-group-create-button" actionListener="#{chatBean[createGroupChat]}"
        value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/chat/createProcessChat')}" icon="fa fa-check">
      </p:commandButton>
    </div>
  </h:panelGroup>
</ui:composition>