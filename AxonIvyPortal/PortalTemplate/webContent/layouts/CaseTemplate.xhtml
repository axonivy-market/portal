<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:ic="http://ivyteam.ch/jsf/component"
  xmlns:p="http://primefaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:pe="http://primefaces.org/ui/extensions" xmlns:pm="http://primefaces.org/mobile">

<h:body>
  <ui:composition template="/layouts/BasicTemplate.xhtml">
    <ui:define name="head">
      <h:outputScript name="case-widget.js" library="js" />
    </ui:define>
    <ui:define name="simplePageContent">
      <c:set var="case" value="#{caseWidgetBean.findCase(caseId)}" scope="request" />
      <div>
        <div class="Fleft Wid50 Fs20 MarTop10">
          <ui:insert name="caseName">
            <span class="fa fa-plane case-template-title-icon"></span>
            <h:outputText title="#{case.name} (#{case.id})" value="#{case.name} (#{case.id})" rendered="#{!caseWidgetBean.isHiddenCase(case)}" />
          </ui:insert>
        </div>
        <div class="process-chain-container Fright Wid70">
          <ui:insert name="process_chain_area">
            <ic:ch.ivy.addon.portalkit.singleapp.process.ProcessChain id="process-step-container" componentId="process-chain-component-id" shape="CIRCLE" direction="HORIZONTAL" isShowAllSteps="false"
              startMethod="start" actualStepIndex="#{actualStepIndex}" steps="#{steps}" />
          </ui:insert>
        </div>
      </div>

      <div class="ClearBoth" />
      <div id="case-template-content" class="case-template-content">
        <ui:insert name="errorsZone" />
        <ui:insert name="infoZone" />

        <p:tabView id="case-template-tabview" prependId="false" onTabShow="onTabShow()">
          <ui:insert name="dynamicTabs">
            <!-- You can add one or many tabs here -->
          </ui:insert>

          <p:tab id="request-tab" rendered="#{showCaseFormTab == null ? true : showCaseFormTab}"
            title="#{ivy.cms.co('/ch.ivy.addon.portal.generic/CaseDetailsTemplate/requestTabTitle')}">
            <ui:insert name="caseForm">
              <!-- Case form -->
              <br />
            </ui:insert>
          </p:tab>

          <p:tab id="status-tab"
            title="#{ivy.cms.co('/ch.ivy.addon.portal.generic/CaseDetailsTemplate/statusTabTitle')}"
            rendered="#{showCaseStatusInfoTab == null ? true : showCaseStatusInfoTab}">
            <ui:insert name="caseStatusTab">
              <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portal.generic/CaseDetailsTemplate/noCaseId')}" rendered="#{caseWidgetBean.isHiddenCase(case)}" />
              <h:form id="case-details-form" prependId="false" rendered="#{!caseWidgetBean.isHiddenCase(case)}">
                <div class="js-case-default-widget-container case-default-widget-container js-simple-container js-for-search-result case-details">
                  <!-- HEADER -->
                  <h:panelGroup id="widget-column-header" class="widget-column-header js-case-widget-column-header">
                    <h:panelGroup styleClass="case-list-unsortable-header-cell case-list-name-desc-header-cell">
                      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/defaultColumns/NAME')}" />
                    </h:panelGroup>
                    <h:panelGroup styleClass="case-list-unsortable-header-cell TexAlCenter">
                      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/defaultColumns/ID')}" />
                    </h:panelGroup>
                    <h:panelGroup styleClass="case-list-unsortable-header-cell">
                      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/defaultColumns/CREATOR')}" />
                    </h:panelGroup>
                    <h:panelGroup styleClass="case-list-unsortable-header-cell TexAlCenter">
                      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/defaultColumns/CREATION_TIME')}" />
                    </h:panelGroup>
                    <h:panelGroup styleClass="case-list-unsortable-header-cell TexAlCenter">
                      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/defaultColumns/FINISHED_TIME')}" />
                    </h:panelGroup>
                    <h:panelGroup styleClass="case-list-unsortable-header-cell TexAlCenter">
                      <h:outputText value="#{ivy.cms.co('/ch.ivy.addon.portalkit.ui.jsf/caseList/defaultColumns/STATE')}" />
                    </h:panelGroup>
                  </h:panelGroup>

                  <ic:ch.ivy.addon.portalkit.component.CaseItem caseItem="#{case}" id="case-item"
                    initialActive="#{true}"
                    itemStyleClass="case-even-row"
                    alwaysShowDetails="true"
                    canDestroyCase="false">

                    <!-- CASE HEADER -->
                    <f:facet name="caseHeader">
                      <ic:ch.ivy.addon.portalkit.component.CaseHeader id="case-header" case="#{case}" />
                    </f:facet>

                    <!-- CASE BODY -->
                    <f:facet name="caseBody">
                      <ic:ch.ivy.addon.portalkit.component.CaseItemGeneralInformation id="general-information" case="#{case}" />
                      <ic:ch.ivy.addon.portalkit.component.CaseItemRelatedTask id="related-tasks" case="#{case}" />
                      <ic:ch.ivy.addon.portalkit.component.CaseItemHistory id="history" case="#{case}" />
                      <ic:ch.ivy.addon.portalkit.component.CaseItemDocument id="document" case="#{case}" componentToUpdate="#{p:component('history')}" />
                      <ic:ch.ivy.addon.portalkit.component.CaseItemDescription id="description" case="#{case}" />
                      <ic:ch.ivy.addon.portalkit.component.ResponsivenessHandleContainer styleClass="hidden-lg">
                        <ic:ch.ivy.addon.portalkit.component.ResponsivenessHandleButton
                          icon="fa fa-share-alt js-related-task-column-responsive-button" displayedSelectors="['.js-related-task-column']"
                          hiddenSelectorsInLargeScreen="['.case-details .replaced']"
                          hiddenSelectorsInMediumScreen="['.case-details .replaced']"
                          hiddenSelectorsInSmallScreen="['.case-details .replaced']" />
                        <ic:ch.ivy.addon.portalkit.component.ResponsivenessHandleButton
                          icon="fa fa-align-left js-history-column-responsive-button" displayedSelectors="['.js-history-column']"
                          hiddenSelectorsInLargeScreen="['.case-details .replaced']"
                          hiddenSelectorsInMediumScreen="['.case-details .replaced']"
                          hiddenSelectorsInSmallScreen="['.case-details .replaced']" />
                        <ic:ch.ivy.addon.portalkit.component.ResponsivenessHandleButton
                          icon="fa fa-file js-document-column-responsive-button" displayedSelectors="['.js-document-column']"
                          hiddenSelectorsInLargeScreen="['.case-details .replaced']"
                          hiddenSelectorsInMediumScreen="['.case-details .replaced']"
                          hiddenSelectorsInSmallScreen="['.case-details .replaced']" />
                        <ic:ch.ivy.addon.portalkit.component.ResponsivenessHandleButton
                          icon="fa fa-clipboard js-description-column-responsive-button" displayedSelectors="['.js-description-column']"
                          hiddenSelectorsInLargeScreen="['.case-details .replaced']"
                          hiddenSelectorsInMediumScreen="['.case-details .replaced']"
                          hiddenSelectorsInSmallScreen="['.case-details .replaced']" />
                      </ic:ch.ivy.addon.portalkit.component.ResponsivenessHandleContainer>
                    </f:facet>
                  </ic:ch.ivy.addon.portalkit.component.CaseItem>
                </div>
              </h:form>
            </ui:insert>
          </p:tab>
        </p:tabView>
      </div>

      <div>
        <div class="Fleft">
          <ui:insert name="leftButtons">
            <!-- Left Buttons -->
          </ui:insert>
        </div>

        <div class="Fright">
          <ui:insert name="rightButtons">
            <!-- Right Buttons -->
          </ui:insert>
        </div>
      </div>
      <h:outputScript library="js" name="document-truncation.js" />
      <script type="text/javascript">
        $(document).ready(function(){
          setTimeout(function(){onTabShow();}, 1 );
        });

        function onTabShow() {
          var caseWidget = new CaseWidget("main-area-panel");
          var $selectedTab = $("#case-template-tabview").find(".ui-tabs-panel").filter(function() {return $(this).css('display') == 'block'});
          var isSelectCaseDetailsTab = $selectedTab.find('.js-case-default-widget-container').length != 0;

          if (isSelectCaseDetailsTab) {
            var caseListLargeScreen = new CaseListLargeScreenHandler();
            var caseListMediumScreen = new CaseListMediumScreenHandler();
            var caseListSmallScreen = new CaseListSmallScreenHandler();
            var responsiveToolkit = ResponsiveToolkit(caseListLargeScreen, caseListMediumScreen, caseListSmallScreen);

            Portal.init(responsiveToolkit, true);
            caseWidget.setupHeader();
            return;
          }

          var simpleLargeScreen = new SimpleLargeScreen();
          var simpleMediumScreen = new SimpleMediumScreen();
          var simpleSmallScreen = new SimpleSmallScreen();
          var responsiveToolkit = ResponsiveToolkit(simpleLargeScreen, simpleMediumScreen, simpleSmallScreen);
          Portal.init(responsiveToolkit, true);
          documentTruncation.truncate();
        }

        </script>
    </ui:define>
      
  </ui:composition>
</h:body>
</html>