{
  "format" : "10.0.0",
  "id" : "176465FBFE257CF3",
  "config" : {
    "data" : "com.axonivy.portal.developerexamples.customization.AdditionalCaseDetailPageIframeData"
  },
  "elements" : [ {
      "id" : "f10",
      "type" : "Script",
      "name" : "Find case by id",
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.util.CaseUtils;",
            "out.iCase = CaseUtils.findCase(in.caseId);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 344, "y" : 64 }
      },
      "connect" : { "id" : "f14", "to" : "f9" }
    }, {
      "id" : "f0",
      "type" : "RequestStart",
      "name" : "createInvestmentRequestIframe.ivp",
      "config" : {
        "callSignature" : "createInvestmentRequestIframe",
        "startCategory" : "Investment",
        "case" : {
          "name" : "Investment request with custom case detail using iFrame",
          "description" : "Investment request for customized case detail page using iframe example",
          "customFields" : [
            { "name" : "AccountNumber", "type" : "Number", "value" : "100" },
            { "name" : "CustomerName", "type" : "String", "value" : "\"Apartment A\"" },
            { "name" : "InvoiceDate", "type" : "Timestamp", "value" : "new DateTime(2018, 2, 2, 2, 2, 2)" },
            { "name" : "InvoiceNumber", "type" : "Number", "value" : "2000" },
            { "name" : "ShipmentDate", "type" : "Timestamp", "value" : "new DateTime(2018, 1, 1, 1, 1, 1)" },
            { "name" : "SupportData", "type" : "String", "value" : "\"Request for new computer\"" }
          ]
        },
        "outLink" : "createInvestmentRequestIframe.ivp",
        "startDescription" : "Investment request for customized case detail page using iFrame  example",
        "startName" : "Investment request for customized case detail page using iFrame example"
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 184 },
        "labelOffset" : { "x" : 26, "y" : 37 },
        "description" : "Investment Request for Customized Case Detail Page example"
      },
      "connect" : { "id" : "f6", "to" : "f5" }
    }, {
      "id" : "f1",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 616, "y" : 184 }
      }
    }, {
      "id" : "f9",
      "type" : "DialogCall",
      "name" : [
        "Customization",
        "Additional Case Details Page"
      ],
      "config" : {
        "dialogId" : "com.axonivy.portal.developerexamples.customization.InvestmentRequestCaseDetailPageIframe",
        "startMethod" : "start(ch.ivyteam.ivy.workflow.ICase)",
        "call" : {
          "params" : [
            { "name" : "ivyCase", "type" : "ch.ivyteam.ivy.workflow.ICase" }
          ],
          "map" : {
            "param.ivyCase" : "in.iCase"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 560, "y" : 64 },
        "size" : { "width" : 192, "height" : 60 }
      },
      "connect" : { "id" : "f11", "to" : "f8" }
    }, {
      "id" : "f5",
      "type" : "SubProcessCall",
      "name" : "SetAdditonalCaseDetailPage",
      "config" : {
        "processCall" : "Functional Processes/SetAdditonalCaseDetailPage:call(String)",
        "call" : {
          "params" : [
            { "name" : "linkToAddtionalCaseDetailPage", "type" : "String" }
          ],
          "map" : {
            "param.linkToAddtionalCaseDetailPage" : "\"Start Processes/AdditionalCaseDetailPageIframe/showInvestmentRequestCustomFieldIframe.ivp\""
          }
        }
      },
      "visual" : {
        "at" : { "x" : 368, "y" : 184 },
        "size" : { "width" : 176, "height" : 60 }
      },
      "connect" : { "id" : "f4", "to" : "f3", "var" : "in1" }
    }, {
      "id" : "f3",
      "type" : "TaskSwitchEvent",
      "config" : {
        "outLinks" : [ "TaskA.ivp" ],
        "task" : {
          "name" : "Investment request with custom case detail iframe"
        }
      },
      "visual" : {
        "at" : { "x" : 520, "y" : 184 }
      },
      "connect" : { "id" : "f2", "to" : "f1", "condition" : "ivp==\"TaskA.ivp\"" }
    }, {
      "id" : "f7",
      "type" : "RequestStart",
      "name" : "showInvestmentRequestCustomFieldIframe.ivp",
      "config" : {
        "callSignature" : "showInvestmentRequestCustomFieldIframe",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" }
          ],
          "map" : {
            "out.caseId" : "param.caseId"
          }
        },
        "case" : {
          "customFields" : [
            { "name" : "embedInFrame", "type" : "String", "value" : "\"false\"" }
          ]
        },
        "outLink" : "showInvestmentRequestCustomFieldIframe.ivp",
        "showInStartList" : false
      },
      "visual" : {
        "at" : { "x" : 144, "y" : 64 },
        "labelOffset" : { "x" : 22, "y" : 37 }
      },
      "connect" : { "id" : "f12", "to" : "f10" }
    }, {
      "id" : "f8",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 716, "y" : 64 }
      }
    }, {
      "id" : "f13",
      "type" : "ProcessAnnotation",
      "name" : [
        "HOW TO CUSTOMIZE CASE DETAIL PAGE USING IFRAME:",
        "We need to do 3 steps:",
        "",
        "1. Create the process for the customize case detail page. In this example, it is showInvestmentRequestCustomFieldIframe.ivp",
        "",
        "2. 2 ways to create custom page:",
        "",
        "\t- Call BusinessDetailsAPI.create()",
        "\t",
        "\t- Use SetAdditonalCaseDetailPage subprocess",
        "",
        "3. Input for this process is the friendly URL of your customized case detail page. ",
        "For this example, it's : Start Processes/AdditionalCaseDetailPageIframe/showInvestmentRequestCustomFieldIframe.ivp",
        "",
        "HOW TO RUN THIS EXAMPLE:",
        "",
        "1. Run createInvestmentRequestIframe.ivp to use subprocess style or run CaseDetailWithProcessPath.ivp to use public api style",
        "",
        "2. In Portal case list, expand \"Investment request with custom case detail using iFrame\" case, then click to \"Show business details\" button"
      ],
      "visual" : {
        "at" : { "x" : 1176, "y" : 232 },
        "size" : { "width" : 768, "height" : 316 }
      }
    }, {
      "id" : "f15",
      "type" : "RequestStart",
      "name" : "CaseDetailWithProcessPath.ivp",
      "config" : {
        "callSignature" : "CaseDetailWithProcessPath",
        "outLink" : "CaseDetailWithProcessPath.ivp"
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 304 }
      },
      "connect" : { "id" : "f17", "to" : "f16" }
    }, {
      "id" : "f16",
      "type" : "Script",
      "name" : "Process Path",
      "config" : {
        "output" : {
          "code" : [
            "import com.axonivy.portal.components.dto.BusinessDetailsDTO;",
            "import com.axonivy.portal.components.publicapi.BusinessDetailsAPI;",
            "",
            "",
            "BusinessDetailsAPI.create(",
            "    BusinessDetailsDTO.builder()",
            "    .path(\"Start Processes/AdditionalCaseDetailPageIframe/showInvestmentRequestCustomFieldIframe.ivp\")",
            "    .isEmbedInFrame(true)",
            "    .build()",
            ");"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 344, "y" : 304 }
      },
      "connect" : { "id" : "f21", "to" : "f19" }
    }, {
      "id" : "f18",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 616, "y" : 304 }
      }
    }, {
      "id" : "f19",
      "type" : "TaskSwitchEvent",
      "config" : {
        "outLinks" : [ "TaskA.ivp" ],
        "task" : {
          "name" : "Investment request with custom case detail iframe"
        }
      },
      "visual" : {
        "at" : { "x" : 520, "y" : 304 }
      },
      "connect" : { "id" : "f20", "to" : "f18", "condition" : "ivp==\"TaskA.ivp\"" }
    }, {
      "id" : "f22",
      "type" : "RequestStart",
      "name" : "caseDetailWithExternalLink.ivp",
      "config" : {
        "callSignature" : "caseDetailWithExternalLink",
        "outLink" : "caseDetailWithExternalLink.ivp"
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 432 }
      },
      "connect" : { "id" : "f28", "to" : "f23" }
    }, {
      "id" : "f23",
      "type" : "Script",
      "name" : "External Link",
      "config" : {
        "output" : {
          "code" : [
            "import com.axonivy.portal.components.dto.BusinessDetailsDTO;",
            "import com.axonivy.portal.components.publicapi.BusinessDetailsAPI;",
            "",
            "BusinessDetailsAPI.create(BusinessDetailsDTO.builder()",
            "     .iCase(ivy.case)",
            "    .path(\"https://www.google.com/\")",
            "    .build());"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 344, "y" : 432 }
      },
      "connect" : { "id" : "f27", "to" : "f25" }
    }, {
      "id" : "f24",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 616, "y" : 432 }
      }
    }, {
      "id" : "f25",
      "type" : "TaskSwitchEvent",
      "config" : {
        "outLinks" : [ "TaskA.ivp" ],
        "task" : {
          "name" : "Investment request with custom case detail iframe"
        }
      },
      "visual" : {
        "at" : { "x" : 520, "y" : 432 }
      },
      "connect" : { "id" : "f26", "to" : "f24", "condition" : "ivp==\"TaskA.ivp\"" }
    }, {
      "id" : "f29",
      "type" : "RequestStart",
      "name" : "oldStyleBusinessDetails.ivp",
      "config" : {
        "callSignature" : "oldStyleBusinessDetails",
        "outLink" : "oldStyleBusinessDetails.ivp"
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 568 }
      },
      "connect" : { "id" : "f31", "to" : "f30" }
    }, {
      "id" : "f30",
      "type" : "Script",
      "name" : "Old style setting business case detail",
      "config" : {
        "output" : {
          "code" : [
            "import com.axonivy.portal.components.publicapi.ProcessStartAPI;",
            "",
            "",
            "String casePageUrl = ProcessStartAPI.findRelativeUrlByProcessStartFriendlyRequestPath(\"Start Processes/AdditionalCaseDetailPageIframe/showInvestmentRequestCustomFieldIframe.ivp\")",
            " + \"?caseId=\" + ivy.case.getId();",
            " ivy.case.customFields().textField(\"CUSTOMIZATION_ADDITIONAL_CASE_DETAILS_PAGE\").set(casePageUrl);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 344, "y" : 568 }
      },
      "connect" : { "id" : "f35", "to" : "f33" }
    }, {
      "id" : "f32",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 616, "y" : 568 }
      }
    }, {
      "id" : "f33",
      "type" : "TaskSwitchEvent",
      "config" : {
        "outLinks" : [ "TaskA.ivp" ],
        "task" : {
          "name" : "Investment request with custom case detail iframe"
        }
      },
      "visual" : {
        "at" : { "x" : 520, "y" : 568 }
      },
      "connect" : { "id" : "f34", "to" : "f32", "condition" : "ivp==\"TaskA.ivp\"" }
    } ]
}