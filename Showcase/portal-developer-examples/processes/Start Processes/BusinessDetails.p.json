{
  "format" : "10.0.0",
  "id" : "1624D1F5CBEA5332",
  "config" : {
    "data" : "com.axonivy.portal.developerexamples.customization.BusinessDetailsData"
  },
  "elements" : [ {
      "id" : "f0",
      "type" : "RequestStart",
      "name" : "createInvestmentRequest.ivp",
      "config" : {
        "callSignature" : "createInvestmentRequest",
        "startCategory" : "Investment",
        "case" : {
          "name" : "<%=ivy.cms.co(\"/Processes/CreateInvestment/name\")%>",
          "description" : "<%=ivy.cms.co(\"/Processes/CreateInvestment/description\")%>",
          "customFields" : [
            { "name" : "AccountNumber", "type" : "Number", "value" : "100" },
            { "name" : "CustomerName", "type" : "String", "value" : "\"Apartment A\"" },
            { "name" : "InvoiceDate", "type" : "Timestamp", "value" : "new DateTime(2018, 2, 2, 2, 2, 2)" },
            { "name" : "InvoiceNumber", "type" : "Number", "value" : "2000" },
            { "name" : "ShipmentDate", "type" : "Timestamp", "value" : "new DateTime(2018, 1, 1, 1, 1, 1)" },
            { "name" : "SupportData", "type" : "String", "value" : "\"Request for new computer\"" }
          ]
        },
        "outLink" : "createInvestmentRequest.ivp",
        "startDescription" : "<%=ivy.cms.co(\"/Processes/CreateInvestment/description\")%>",
        "startName" : "<%=ivy.cms.co(\"/Processes/CreateInvestment/description\")%>"
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 184 },
        "description" : "Investment Request for Customized Case Detail Page example"
      },
      "connect" : { "id" : "f6", "to" : "f5" }
    }, {
      "id" : "f1",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 552, "y" : 184 }
      }
    }, {
      "id" : "f3",
      "type" : "TaskSwitchEvent",
      "config" : {
        "outLinks" : [ "TaskA.ivp" ],
        "task" : {
          "name" : "<%=ivy.cms.co(\"/Processes/CreateInvestment/Tasks/Request/name\")%>"
        }
      },
      "visual" : {
        "at" : { "x" : 456, "y" : 184 }
      },
      "connect" : { "id" : "f2", "to" : "f1", "condition" : "ivp==\"TaskA.ivp\"" }
    }, {
      "id" : "f5",
      "type" : "SubProcessCall",
      "name" : "SetBusinessDetailsPage",
      "config" : {
        "processCall" : "Functional Processes/SetBusinessDetailsPage:call(String)",
        "call" : {
          "params" : [
            { "name" : "linkToAddtionalCaseDetailPage", "type" : "String" }
          ],
          "map" : {
            "param.linkToAddtionalCaseDetailPage" : "\"Start Processes/AdditionalCaseDetailPage/showInvestmentRequestCustomFields.ivp\""
          }
        }
      },
      "visual" : {
        "at" : { "x" : 320, "y" : 184 },
        "size" : { "width" : 176, "height" : 60 }
      },
      "connect" : { "id" : "f4", "to" : "f3", "var" : "in1" }
    }, {
      "id" : "f7",
      "type" : "RequestStart",
      "name" : "showInvestmentRequestCustomFields.ivp",
      "config" : {
        "callSignature" : "showInvestmentRequestCustomFields",
        "input" : {
          "params" : [
            { "name" : "caseId", "type" : "Long" }
          ],
          "map" : {
            "out.caseId" : "param.caseId"
          }
        },
        "case" : {
          "customFields" : [
            { "name" : "embedInFrame", "type" : "String", "value" : "\"false\"" }
          ]
        },
        "outLink" : "showInvestmentRequestCustomFields.ivp",
        "showInStartList" : false
      },
      "visual" : {
        "at" : { "x" : 144, "y" : 64 }
      },
      "connect" : { "id" : "f12", "to" : "f10" }
    }, {
      "id" : "f8",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 716, "y" : 64 }
      }
    }, {
      "id" : "f9",
      "type" : "DialogCall",
      "name" : [
        "Customization",
        "Additional Case Details Page"
      ],
      "config" : {
        "dialogId" : "com.axonivy.portal.developerexamples.customization.InvestmentRequestCaseDetailPage",
        "startMethod" : "start(ch.ivyteam.ivy.workflow.ICase)",
        "call" : {
          "params" : [
            { "name" : "iCase", "type" : "ch.ivyteam.ivy.workflow.ICase" }
          ],
          "map" : {
            "param.iCase" : "in.iCase"
          }
        }
      },
      "visual" : {
        "at" : { "x" : 572, "y" : 64 },
        "size" : { "width" : 192, "height" : 60 }
      },
      "connect" : { "id" : "f11", "to" : "f8" }
    }, {
      "id" : "f10",
      "type" : "Script",
      "name" : "Find case by id",
      "config" : {
        "output" : {
          "code" : [
            "import ch.ivy.addon.portalkit.util.CaseUtils;",
            "out.iCase = CaseUtils.findCase(in.caseId);"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 352, "y" : 64 }
      },
      "connect" : { "id" : "f14", "to" : "f9" }
    }, {
      "id" : "f19",
      "type" : "RequestStart",
      "name" : "caseDetailWithProcessPath.ivp",
      "config" : {
        "callSignature" : "caseDetailWithProcessPath",
        "outLink" : "caseDetailWithProcessPath.ivp"
      },
      "visual" : {
        "at" : { "x" : 136, "y" : 296 },
        "labelOffset" : { "x" : 17, "y" : 33 }
      },
      "connect" : { "id" : "f23", "to" : "f20" }
    }, {
      "id" : "f20",
      "type" : "Script",
      "name" : "Process Path",
      "config" : {
        "output" : {
          "code" : [
            "import com.axonivy.portal.components.dto.BusinessDetailsDTO;",
            "import com.axonivy.portal.components.publicapi.BusinessDetailsAPI;",
            "",
            "BusinessDetailsAPI.create(BusinessDetailsDTO.builder()",
            "    .path(\"Start Processes/AdditionalCaseDetailPageIframe/showInvestmentRequestCustomFieldIframe.ivp\")",
            "    .build()",
            ");"
          ]
        }
      },
      "visual" : {
        "at" : { "x" : 320, "y" : 295 },
        "size" : { "width" : 174, "height" : 58 }
      },
      "connect" : { "id" : "f25", "to" : "f22" }
    }, {
      "id" : "f21",
      "type" : "TaskEnd",
      "visual" : {
        "at" : { "x" : 552, "y" : 296 }
      }
    }, {
      "id" : "f22",
      "type" : "TaskSwitchEvent",
      "config" : {
        "outLinks" : [ "TaskA.ivp" ],
        "task" : {
          "name" : "Investment request with custom case detail iframe"
        }
      },
      "visual" : {
        "at" : { "x" : 456, "y" : 296 }
      },
      "connect" : { "id" : "f24", "to" : "f21", "condition" : "ivp==\"TaskA.ivp\"" }
    }, {
      "id" : "f15",
      "type" : "ProcessAnnotation",
      "name" : [
        "HOW TO CUSTOMIZE CASE DETAIL PAGE USING IFRAME:",
        "We need to do 3 steps:",
        "",
        "1. Create the process for the customize case detail page. In this example, it is showInvestmentRequestCustomFieldIframe.ivp",
        "",
        "2. 2 ways to create custom page:",
        "",
        "\t- Call BusinessDetailsAPI.create()",
        "\t",
        "\t- Use SetBusinessDetailPage subprocess",
        "",
        "3. Input for this process is the friendly URL of your customized case detail page. ",
        "For this example, it's : Start Processes/BusinessDetails/showInvestmentRequestCustomFieldIframe.ivp",
        "",
        "HOW TO RUN THIS EXAMPLE:",
        "",
        "1. Run createInvestmentRequestIframe.ivp to use subprocess style or run caseDetailWithProcessPath.ivp to use public api style",
        "",
        "2. In Portal case list, expand \"Investment request with custom case detail using iFrame\" case, then click to \"Show business details\" button"
      ],
      "visual" : {
        "at" : { "x" : 1184, "y" : 192 },
        "size" : { "width" : 768, "height" : 316 }
      }
    } ]
}