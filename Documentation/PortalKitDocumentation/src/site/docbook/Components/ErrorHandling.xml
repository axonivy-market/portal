<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="axonivyportal.components.errorhandling">
	<title>Error handling</title>
	<para>
		In this section, we introduce 2 kinds of errors, when and how to handle them in Portal.
		<itemizedlist>
			<listitem>
				<para>
					Ajax error : this kind of errors occur during a JSF ajax requests, for example when the user clicks on the show full mode button to tell the task widget switches to full mode, without handling the end user would not get any form of feedback if the action was successfully performed or not.
				</para>
			</listitem>
			<listitem>
				<para>
					Non-ajax error : this kind of errors occur when user access to Portal from a url which could not be handled successfully by server side, or being navigated by a corrupted url. For example, when the user clicks on a link to start a task which does not exist.
				</para>
			</listitem>
		</itemizedlist>
	</para>
	<sect2 xml:id="axonivyportal.components.errorhandling.ajaxerrorhandling">
		<title>Ajax error handling</title>
		<sect3 xml:id="axonivyportal.components.errorhandling.ajaxerrorhandling.introduction">
			<title>Introduction</title>
			<para>
				By default, when an exception occurs during a JSF ajax request, Portal would not get any form of feedback if the action was successfully performed or not. It would make sense if exceptions during ajax requests are handled as the way that the end user would see an alert with the exception type and message (exception stack trace might be included for advanced user).
			</para>
			<para>
				Portal uses the <code>ajaxExceptionHandler</code> component provided by PrimeFaces to handle exceptions occur during JSF ajax requests. This document describes when and how to enable this feature.
			</para>
			<note>
				This feature is only available if using the portal default template: <code>BasicTemplate</code> or its extension.
			</note>
		</sect3>
		<sect3 xml:id="axonivyportal.components.errorhandling.ajaxerrorhandling.configuration">
			<title>Configuration</title>
			<para>
				This exception handler must be registered by a factory as follows in <code>faces-config.xml</code> in order to get it to run:
			</para>
			<para>
				Config Ajax Exception Handler of Primefaces
				<para><code>&lt;application&gt;</code></para>
				<para><code>&lt;el-resolver&gt;</code></para>
				<para><code>org.primefaces.application.exceptionhandler.PrimeExceptionHandlerELResolver</code></para>
				<para><code>&lt;/el-resolver&gt;</code></para>
				<para><code>&lt;/application&gt;</code></para>
				<para><code>&lt;factory&gt;</code></para>
				<para><code>&lt;exception-handler-factory&gt;</code></para>
				<para><code>org.primefaces.application.exceptionhandler.PrimeExceptionHandlerFactory</code></para>
				<para><code>&lt;/exception-handler-factory&gt;</code></para>
				<para><code>&lt;/factory&gt;</code></para>
			</para>
			<note>
				The <code>faces-config.xml</code> file is located at <code>../webapps/ivy/WEB-INF</code> inside your Ivy Designer/Engine. The designer/engine need to be restarted in order to make the changes affect.
			</note>
		</sect3>
		<sect3 xml:id="axonivyportal.components.errorhandling.ajaxerrorhandling.defaultexceptionhandlerbyportal">
			<title>Default exception handler by Portal</title>
			<para>
				The default exception handler of Portal after being configured will transparently handle all exceptions during ajax requests. It is configured to handle the exception type <code>java.lang.Throwable</code>, therefore any specific exceptions would match.
			</para>
			<para>
				When an exception occurs, Portal will show an error notification with the exception type and message to end user. The exception details is available when user click on the show details button.
			</para>
			<para>
				The default exception handler defined in Portal:
				<para><code>&lt;p:ajaxExceptionHandler type="java.lang.Throwable" update="exception-dialog" onexception="portal.notifyError('Action completed with an error! Error message: #{pfExceptionHandler.message}')" /&gt;</code></para>
			</para>
		</sect3>
		<sect3 xml:id="axonivyportal.components.errorhandling.ajaxerrorhandling.customizingexceptionhandler">
			<title>Customizing exception handler</title>
			<para>
				If more fine grained control is desired for determining the root cause of the caught exception, or whether it should be handled, or determining the error notification, or logging the exception, then the developer can opt to define their own exception handler and override the default exception handler of Portal:
				<para><code>&lt;p:ajaxExceptionHandler type="your.business.domain.MyCustomWidgetException" update="exception-dialog" onexception="portal.notifyError('MyCustomWidget could not perform the action completely! Error message: #{pfExceptionHandler.message}')" /&gt;</code></para>
			</para>
			<note>
				<para>
					Portal provides following Javascript methods for notification:
					<itemizedlist>
						<listitem>
							<para><code>portal.notifyError(String message)</code></para>
						</listitem>
						<listitem>
							<para><code>portal.notifyWarning(String message)</code></para>
						</listitem>
						<listitem>
							<para><code>portal.notifyInfo(String message)</code></para>
						</listitem>
					</itemizedlist>
				</para>
			</note>
		</sect3>
	</sect2>
	<sect2 xml:id="axonivyportal.components.errorhandling.nonajaxerrorhandling">
		<title>Non-ajax error handling</title>
		<sect3 xml:id="axonivyportal.components.errorhandling.nonajaxerrorhandling.introduction">
			<title>Introduction</title>
			<para>
				By default, when the server has any error such as : <code>HTTP 404</code>, <code>HTTP 500</code>, or exception while page's loading, AxonIvyEngine will show an default error page. E.g.:
				<mediaobject>
					<imageobject>
						<imagedata fileref="images/ErrorHandling/defaultIvyError.png" />
					</imageobject>
				</mediaobject>
			</para>
			<para>
				You can find content of this page is the file located on <code>${AxonIvyEngineFolder}/webapp/ivy/ivy-error-page.xhtml</code>, but the error page is not user friendly, too much technical information that normal user may not understand. Thus, Axon Ivy Portal provides an alternative solution to make this page nicer. 
			</para>
		</sect3>
		<sect3 xml:id="axonivyportal.components.errorhandling.nonajaxerrorhandling.howtoconfigure">
			<title>How to configure</title>
			<para>
				Download the zip file below to configure on your own engine (or designer).
			</para>
			<important>
				Read README.txt
			</important>
			<para>
				<link xlink:href="documents/ErrorHandling/PortalErrorPageConfiguration.zip">PortalErrorPageConfiguration.zip</link>
			</para>
		</sect3>
		<sect3 xml:id="axonivyportal.components.errorhandling.nonajaxerrorhandling.result">
			<title>Result</title>
			<para>
				HTTP 404 Page Not Found
				<para>
					Example testing URL: 404
					<mediaobject>
						<imageobject>
							<imagedata fileref="images/ErrorHandling/404.png" />
						</imageobject>
					</mediaobject>
				</para>
			</para>
			<para>
				HTTP 500 Error
				<para>
					Example testing URL: 500
					<mediaobject>
						<imageobject>
							<imagedata fileref="images/ErrorHandling/500.png" />
						</imageobject>
					</mediaobject>
				</para>
			</para>
		</sect3>
	</sect2>
</sect1>